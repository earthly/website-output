<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<link rel="icon" type="image/png" href="/blog/assets/images/favicon.png">
<!-- begin _includes/seo.html -->





<title>Creating and hosting your own rpm packages and yum repo - Earthly Blog</title>
<meta name="description" content="This tutorial is a follow up to creating and hosting your own deb and apt repo, but is written for creating rpm packages for redhat-based Linux distributions such as Fedora, CentOS, and Rocky Linux.   Prerequisites   This tutorial assumes you are using CentOS 8, and that the following packages are installed:   sudo yum install -y createrepo rpm-build rpm-sign wget gcc python3 yum-utils    If you don’t have a CentOS machine, you can still follow along using docker, just run   docker run -ti --rm centos:8 /bin/bash   to create a temporary CentOS environment to follow along with.    Step 0: Creating a Simple Hello World Program   We will be using the same basic hello world program that was used in the previous tutorial. In this tutorial, we will assume you have a binary located under ~/example/hello-world-program/hello-world.   To quickly create a hello world binary using C, run:   mkdir -p ~/example/hello-world-program echo &#39;#include &lt;stdio.h&gt; int main() {     printf(&quot;Hello World!\\n&quot;);     return 0; }&#39; | gcc -o ~/example/hello-world-program/hello-world -x c -   This tutorial will only cover distributing binaries in rpm packages and will not cover creating source-based rpms. There’s other tutorials that cover creating spec files – the main goal of this tutorial is to document how to package a pre-compiled binary, and show how to generate your own self-hosted yum repository.   Step 1: Creating a rpm Package   Redhat-based Linux distributions use .rpm packages to package and distribute programs.   let’s start by making a directory to work out of:   mkdir -p ~/example/rpm-work-dir   Inside this directory, we will create a spec file which contains package metadata such as the name, and summary of the package:   cd ~/example/rpm-work-dir echo &quot;Summary: A simple program that prints hello Name: hello-world Version: 1.0.0 Release: 1 URL: https://example.com Group: System License: example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List Packager: Example Team Requires: bash BuildRoot: ~/example/rpm-work-dir # this should be replaced with your working directory where the spec is saved  %description An example package containing a hello-world binary  %install mkdir -p %{buildroot}/usr/bin/ cp ~/example/hello-world-program/hello-world %{buildroot}/usr/bin/hello-world  %files /usr/bin/hello-world  %changelog * Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt; - initial example &quot; &gt; hello-world.spec   Next, we will use rpmbuild to produce the rpm:   rpmbuild --target &quot;x86_64&quot; -bb hello-world.spec   This will output an rpm under /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm.   We can inspect the contents with:   rpm -qpivl --changelog --nomanifest /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm   which will output something similar to:  Name        : hello-world Version     : 1.0.0 Release     : 1 Architecture: x86_64 Install Date: (not installed) Group       : System Size        : 10832 License     : example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List Signature   : (none) Source RPM  : hello-world-1.0.0-1.src.rpm Build Date  : Fri 18 Jun 2021 09:21:39 PM UTC Build Host  : 83f4a9d4e295 Relocations : (not relocatable) Packager    : Example Team URL         : https://example.com Summary     : A simple program that prints hello Description : An example package containing a hello-world binary * Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt; - initial example  -rwxr-xr-x    1 root    root                    10832 Jun 18 21:21 /usr/bin/hello-world drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id/b9 lrwxrwxrwx    1 root    root                       31 Jun 18 21:21 /usr/lib/.build-id/b9/fea765874fcd0863841bc8f5d1aa1d65396751 -&gt; ../../../../usr/bin/hello-world   You can also inspect the content via less /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm. Under the hood less will invoke /usr/bin/lesspipe.sh. You can perform a global regular expression print (grep) against the script to find the same command being used:   grep rpm /usr/bin/lesspipe.sh   This should print the line where the same rpm -qpivl … command is being invoked:   *.rpm) rpm -qpivl --changelog --nomanifest -- &quot;$1&quot;; exit $? ;;    Next, we can install our rpm via:  yum install -y /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm  Then finally, we can test it was installed by running   hello-world   which should print  Hello World!  Step 2: Creating a yum Repository   Next we’re going to create a yum repository which can be uploaded to a server to make it easier to share your package with other users.   Our first step will be to import a pgp key which we will be using to sign our rpm packages and repo, to allow our users to verify the packages have not been tampered. Creating pgp keys was covered in our previous tutorial; in particular, we will assume you have public and private keys stored under ~/example/pgp-key.public and ~/example/pgp-key.private respectively.   First let’s import our private key, so we have access to it for signing the repo:   gpg --import ~/example/pgp-key.private   This should output something similar to:  gpg: directory &#39;/root/.gnupg&#39; created gpg: keybox &#39;/root/.gnupg/pubring.kbx&#39; created gpg: /root/.gnupg/trustdb.gpg: trustdb created gpg: key E1933532750E9EEF: public key &quot;example &lt;example@example.com&gt;&quot; imported gpg: key E1933532750E9EEF: secret key imported gpg: Total number processed: 1 gpg:               imported: 1 gpg:       secret keys read: 1 gpg:   secret keys imported: 1  We will then configure the rpm tools to use this key for signing our packages and repository:   echo &quot;%_signature gpg %_gpg_name E1933532750E9EEF&quot; &gt; /root/.rpmmacros    Don’t forget to replace E1933532750E9EEF with your key’s ID.    Let’s create a directory for our packages:   mkdir -p ~/example/packages/   Then copy our rpm(s) into this directory:   cp /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm ~/example/packages/.   Since we didn’t configure a key in step 1, the rpm we created was not signed. We can add a signature to it by running:   rpm --addsign ~/example/packages/*.rpm    If you forgot to create /root/.rpmmacros, or forgot to update the key ID, you might see an error such as You must set &quot;%_gpg_name&quot; in your macro file or gpg: signing failed: No secret key.    Once all the packages are signed, we will use createrepo to create the repository:   cd ~/example/packages/ createrepo .   Finally, we will sign the repodata metadata by running:   gpg --detach-sign --armor repodata/repomd.xml   Step 3: Testing the Repository   We are going to use python to temporarily create a web server to serve the contents of our repository:   cd ~/example python3 -m http.server   We will create a config for this server:   echo &quot;[example-repo] name=Example Repo baseurl=http://127.0.0.1:8000/packages enabled=1 gpgcheck=1 gpgkey=http://127.0.0.1:8000/pgp-key.public&quot; &gt; ~/example/example.repo   Next let’s configure our machine to use this new repository:   yum-config-manager --add-repo http://127.0.0.1:8000/example.repo   Then we can install our package from the self-hosted repository with:   yum install -y hello-world    In this example, we were hosting the entire contents of ~/example, which may include your private key if you followed this tutorial completely and created it under ~/example/pgp-key.private. In practice, you would never serve a directory containing your private key.    Appendix A: A Complete Example using Earthly   A complete example has been created under github.com/earthly/example-yum-repo/Earthfile.   This Earthfile contains all the above steps from this tutorial in a single location, which can be run directly in a single shot with:   earthly -P github.com/earthly/example-yum-repo:main+test   Alternatively, you can clone the repo and run +test directly.">


  <meta name="author" content="Alex Couture-Beil">
  
  <meta property="article:author" content="Alex Couture-Beil">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Earthly Blog">
<meta property="og:title" content="Creating and hosting your own rpm packages and yum repo">
<meta property="og:url" content="https://earthly.dev/blog/creating-and-hosting-your-own-rpm-packages-and-yum-repo/">


  <meta property="og:description" content="This tutorial is a follow up to creating and hosting your own deb and apt repo, but is written for creating rpm packages for redhat-based Linux distributions such as Fedora, CentOS, and Rocky Linux.   Prerequisites   This tutorial assumes you are using CentOS 8, and that the following packages are installed:   sudo yum install -y createrepo rpm-build rpm-sign wget gcc python3 yum-utils    If you don’t have a CentOS machine, you can still follow along using docker, just run   docker run -ti --rm centos:8 /bin/bash   to create a temporary CentOS environment to follow along with.    Step 0: Creating a Simple Hello World Program   We will be using the same basic hello world program that was used in the previous tutorial. In this tutorial, we will assume you have a binary located under ~/example/hello-world-program/hello-world.   To quickly create a hello world binary using C, run:   mkdir -p ~/example/hello-world-program echo &#39;#include &lt;stdio.h&gt; int main() {     printf(&quot;Hello World!\\n&quot;);     return 0; }&#39; | gcc -o ~/example/hello-world-program/hello-world -x c -   This tutorial will only cover distributing binaries in rpm packages and will not cover creating source-based rpms. There’s other tutorials that cover creating spec files – the main goal of this tutorial is to document how to package a pre-compiled binary, and show how to generate your own self-hosted yum repository.   Step 1: Creating a rpm Package   Redhat-based Linux distributions use .rpm packages to package and distribute programs.   let’s start by making a directory to work out of:   mkdir -p ~/example/rpm-work-dir   Inside this directory, we will create a spec file which contains package metadata such as the name, and summary of the package:   cd ~/example/rpm-work-dir echo &quot;Summary: A simple program that prints hello Name: hello-world Version: 1.0.0 Release: 1 URL: https://example.com Group: System License: example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List Packager: Example Team Requires: bash BuildRoot: ~/example/rpm-work-dir # this should be replaced with your working directory where the spec is saved  %description An example package containing a hello-world binary  %install mkdir -p %{buildroot}/usr/bin/ cp ~/example/hello-world-program/hello-world %{buildroot}/usr/bin/hello-world  %files /usr/bin/hello-world  %changelog * Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt; - initial example &quot; &gt; hello-world.spec   Next, we will use rpmbuild to produce the rpm:   rpmbuild --target &quot;x86_64&quot; -bb hello-world.spec   This will output an rpm under /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm.   We can inspect the contents with:   rpm -qpivl --changelog --nomanifest /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm   which will output something similar to:  Name        : hello-world Version     : 1.0.0 Release     : 1 Architecture: x86_64 Install Date: (not installed) Group       : System Size        : 10832 License     : example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List Signature   : (none) Source RPM  : hello-world-1.0.0-1.src.rpm Build Date  : Fri 18 Jun 2021 09:21:39 PM UTC Build Host  : 83f4a9d4e295 Relocations : (not relocatable) Packager    : Example Team URL         : https://example.com Summary     : A simple program that prints hello Description : An example package containing a hello-world binary * Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt; - initial example  -rwxr-xr-x    1 root    root                    10832 Jun 18 21:21 /usr/bin/hello-world drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id/b9 lrwxrwxrwx    1 root    root                       31 Jun 18 21:21 /usr/lib/.build-id/b9/fea765874fcd0863841bc8f5d1aa1d65396751 -&gt; ../../../../usr/bin/hello-world   You can also inspect the content via less /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm. Under the hood less will invoke /usr/bin/lesspipe.sh. You can perform a global regular expression print (grep) against the script to find the same command being used:   grep rpm /usr/bin/lesspipe.sh   This should print the line where the same rpm -qpivl … command is being invoked:   *.rpm) rpm -qpivl --changelog --nomanifest -- &quot;$1&quot;; exit $? ;;    Next, we can install our rpm via:  yum install -y /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm  Then finally, we can test it was installed by running   hello-world   which should print  Hello World!  Step 2: Creating a yum Repository   Next we’re going to create a yum repository which can be uploaded to a server to make it easier to share your package with other users.   Our first step will be to import a pgp key which we will be using to sign our rpm packages and repo, to allow our users to verify the packages have not been tampered. Creating pgp keys was covered in our previous tutorial; in particular, we will assume you have public and private keys stored under ~/example/pgp-key.public and ~/example/pgp-key.private respectively.   First let’s import our private key, so we have access to it for signing the repo:   gpg --import ~/example/pgp-key.private   This should output something similar to:  gpg: directory &#39;/root/.gnupg&#39; created gpg: keybox &#39;/root/.gnupg/pubring.kbx&#39; created gpg: /root/.gnupg/trustdb.gpg: trustdb created gpg: key E1933532750E9EEF: public key &quot;example &lt;example@example.com&gt;&quot; imported gpg: key E1933532750E9EEF: secret key imported gpg: Total number processed: 1 gpg:               imported: 1 gpg:       secret keys read: 1 gpg:   secret keys imported: 1  We will then configure the rpm tools to use this key for signing our packages and repository:   echo &quot;%_signature gpg %_gpg_name E1933532750E9EEF&quot; &gt; /root/.rpmmacros    Don’t forget to replace E1933532750E9EEF with your key’s ID.    Let’s create a directory for our packages:   mkdir -p ~/example/packages/   Then copy our rpm(s) into this directory:   cp /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm ~/example/packages/.   Since we didn’t configure a key in step 1, the rpm we created was not signed. We can add a signature to it by running:   rpm --addsign ~/example/packages/*.rpm    If you forgot to create /root/.rpmmacros, or forgot to update the key ID, you might see an error such as You must set &quot;%_gpg_name&quot; in your macro file or gpg: signing failed: No secret key.    Once all the packages are signed, we will use createrepo to create the repository:   cd ~/example/packages/ createrepo .   Finally, we will sign the repodata metadata by running:   gpg --detach-sign --armor repodata/repomd.xml   Step 3: Testing the Repository   We are going to use python to temporarily create a web server to serve the contents of our repository:   cd ~/example python3 -m http.server   We will create a config for this server:   echo &quot;[example-repo] name=Example Repo baseurl=http://127.0.0.1:8000/packages enabled=1 gpgcheck=1 gpgkey=http://127.0.0.1:8000/pgp-key.public&quot; &gt; ~/example/example.repo   Next let’s configure our machine to use this new repository:   yum-config-manager --add-repo http://127.0.0.1:8000/example.repo   Then we can install our package from the self-hosted repository with:   yum install -y hello-world    In this example, we were hosting the entire contents of ~/example, which may include your private key if you followed this tutorial completely and created it under ~/example/pgp-key.private. In practice, you would never serve a directory containing your private key.    Appendix A: A Complete Example using Earthly   A complete example has been created under github.com/earthly/example-yum-repo/Earthfile.   This Earthfile contains all the above steps from this tutorial in a single location, which can be run directly in a single shot with:   earthly -P github.com/earthly/example-yum-repo:main+test   Alternatively, you can clone the repo and run +test directly.">



  <meta property="og:image" content="/blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-762-4f7a3cc4d.jpg">



  <meta name="twitter:site" content="@EarthlyTech">
  <meta name="twitter:title" content="Creating and hosting your own rpm packages and yum repo">
  <meta name="twitter:description" content="This tutorial is a follow up to creating and hosting your own deb and apt repo, but is written for creating rpm packages for redhat-based Linux distributions such as Fedora, CentOS, and Rocky Linux.   Prerequisites   This tutorial assumes you are using CentOS 8, and that the following packages are installed:   sudo yum install -y createrepo rpm-build rpm-sign wget gcc python3 yum-utils    If you don’t have a CentOS machine, you can still follow along using docker, just run   docker run -ti --rm centos:8 /bin/bash   to create a temporary CentOS environment to follow along with.    Step 0: Creating a Simple Hello World Program   We will be using the same basic hello world program that was used in the previous tutorial. In this tutorial, we will assume you have a binary located under ~/example/hello-world-program/hello-world.   To quickly create a hello world binary using C, run:   mkdir -p ~/example/hello-world-program echo &#39;#include &lt;stdio.h&gt; int main() {     printf(&quot;Hello World!\\n&quot;);     return 0; }&#39; | gcc -o ~/example/hello-world-program/hello-world -x c -   This tutorial will only cover distributing binaries in rpm packages and will not cover creating source-based rpms. There’s other tutorials that cover creating spec files – the main goal of this tutorial is to document how to package a pre-compiled binary, and show how to generate your own self-hosted yum repository.   Step 1: Creating a rpm Package   Redhat-based Linux distributions use .rpm packages to package and distribute programs.   let’s start by making a directory to work out of:   mkdir -p ~/example/rpm-work-dir   Inside this directory, we will create a spec file which contains package metadata such as the name, and summary of the package:   cd ~/example/rpm-work-dir echo &quot;Summary: A simple program that prints hello Name: hello-world Version: 1.0.0 Release: 1 URL: https://example.com Group: System License: example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List Packager: Example Team Requires: bash BuildRoot: ~/example/rpm-work-dir # this should be replaced with your working directory where the spec is saved  %description An example package containing a hello-world binary  %install mkdir -p %{buildroot}/usr/bin/ cp ~/example/hello-world-program/hello-world %{buildroot}/usr/bin/hello-world  %files /usr/bin/hello-world  %changelog * Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt; - initial example &quot; &gt; hello-world.spec   Next, we will use rpmbuild to produce the rpm:   rpmbuild --target &quot;x86_64&quot; -bb hello-world.spec   This will output an rpm under /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm.   We can inspect the contents with:   rpm -qpivl --changelog --nomanifest /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm   which will output something similar to:  Name        : hello-world Version     : 1.0.0 Release     : 1 Architecture: x86_64 Install Date: (not installed) Group       : System Size        : 10832 License     : example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List Signature   : (none) Source RPM  : hello-world-1.0.0-1.src.rpm Build Date  : Fri 18 Jun 2021 09:21:39 PM UTC Build Host  : 83f4a9d4e295 Relocations : (not relocatable) Packager    : Example Team URL         : https://example.com Summary     : A simple program that prints hello Description : An example package containing a hello-world binary * Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt; - initial example  -rwxr-xr-x    1 root    root                    10832 Jun 18 21:21 /usr/bin/hello-world drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id/b9 lrwxrwxrwx    1 root    root                       31 Jun 18 21:21 /usr/lib/.build-id/b9/fea765874fcd0863841bc8f5d1aa1d65396751 -&gt; ../../../../usr/bin/hello-world   You can also inspect the content via less /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm. Under the hood less will invoke /usr/bin/lesspipe.sh. You can perform a global regular expression print (grep) against the script to find the same command being used:   grep rpm /usr/bin/lesspipe.sh   This should print the line where the same rpm -qpivl … command is being invoked:   *.rpm) rpm -qpivl --changelog --nomanifest -- &quot;$1&quot;; exit $? ;;    Next, we can install our rpm via:  yum install -y /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm  Then finally, we can test it was installed by running   hello-world   which should print  Hello World!  Step 2: Creating a yum Repository   Next we’re going to create a yum repository which can be uploaded to a server to make it easier to share your package with other users.   Our first step will be to import a pgp key which we will be using to sign our rpm packages and repo, to allow our users to verify the packages have not been tampered. Creating pgp keys was covered in our previous tutorial; in particular, we will assume you have public and private keys stored under ~/example/pgp-key.public and ~/example/pgp-key.private respectively.   First let’s import our private key, so we have access to it for signing the repo:   gpg --import ~/example/pgp-key.private   This should output something similar to:  gpg: directory &#39;/root/.gnupg&#39; created gpg: keybox &#39;/root/.gnupg/pubring.kbx&#39; created gpg: /root/.gnupg/trustdb.gpg: trustdb created gpg: key E1933532750E9EEF: public key &quot;example &lt;example@example.com&gt;&quot; imported gpg: key E1933532750E9EEF: secret key imported gpg: Total number processed: 1 gpg:               imported: 1 gpg:       secret keys read: 1 gpg:   secret keys imported: 1  We will then configure the rpm tools to use this key for signing our packages and repository:   echo &quot;%_signature gpg %_gpg_name E1933532750E9EEF&quot; &gt; /root/.rpmmacros    Don’t forget to replace E1933532750E9EEF with your key’s ID.    Let’s create a directory for our packages:   mkdir -p ~/example/packages/   Then copy our rpm(s) into this directory:   cp /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm ~/example/packages/.   Since we didn’t configure a key in step 1, the rpm we created was not signed. We can add a signature to it by running:   rpm --addsign ~/example/packages/*.rpm    If you forgot to create /root/.rpmmacros, or forgot to update the key ID, you might see an error such as You must set &quot;%_gpg_name&quot; in your macro file or gpg: signing failed: No secret key.    Once all the packages are signed, we will use createrepo to create the repository:   cd ~/example/packages/ createrepo .   Finally, we will sign the repodata metadata by running:   gpg --detach-sign --armor repodata/repomd.xml   Step 3: Testing the Repository   We are going to use python to temporarily create a web server to serve the contents of our repository:   cd ~/example python3 -m http.server   We will create a config for this server:   echo &quot;[example-repo] name=Example Repo baseurl=http://127.0.0.1:8000/packages enabled=1 gpgcheck=1 gpgkey=http://127.0.0.1:8000/pgp-key.public&quot; &gt; ~/example/example.repo   Next let’s configure our machine to use this new repository:   yum-config-manager --add-repo http://127.0.0.1:8000/example.repo   Then we can install our package from the self-hosted repository with:   yum install -y hello-world    In this example, we were hosting the entire contents of ~/example, which may include your private key if you followed this tutorial completely and created it under ~/example/pgp-key.private. In practice, you would never serve a directory containing your private key.    Appendix A: A Complete Example using Earthly   A complete example has been created under github.com/earthly/example-yum-repo/Earthfile.   This Earthfile contains all the above steps from this tutorial in a single location, which can be run directly in a single shot with:   earthly -P github.com/earthly/example-yum-repo:main+test   Alternatively, you can clone the repo and run +test directly.">
  <meta name="twitter:url" content="https://earthly.dev/blog/creating-and-hosting-your-own-rpm-packages-and-yum-repo/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://earthly.dev/blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-762-4f7a3cc4d.jpg">
  

  



  <meta property="article:published_time" content="2021-06-24T00:00:00-04:00">





  

  


<link rel="canonical" href="https://earthly.dev/blog/creating-and-hosting-your-own-rpm-packages-and-yum-repo/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Organization",
      "url": "https://earthly.dev/blog/",
      "logo": "/assets/images/logo-header.png"
    
  }
</script>






<!-- end _includes/seo.html -->



  <link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Earthly Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/blog/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161831101-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161831101-5');
</script>
  <!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '259843109045285');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=259843109045285&ev=PageView&noscript=1"
    />
</noscript>
 <!-- End Facebook Pixel Code -->
  <!-- Twitter universal website tag code -->
<script>
  !function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
  },s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
  a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
  // Insert Twitter Pixel ID and Standard Event data below
  twq('init','o5s6p');
  twq('track','PageView');
  </script>
  <!-- End Twitter universal website tag code -->


  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/blog/assets/images/white-logo.png" alt="Earthly"></a>
        
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/blog/">Blog home</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/categories/articles/">Articles</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/categories/news/">News</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/categories/tutorials/">Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/earthly/earthly">GitHub</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      




  







<div class="page__hero"
  style=" background-image: url('');"
>
  
      <picture class="page__hero-image"><source srcset="/blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-400-132fb2a60.webp 400w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-600-132fb2a60.webp 600w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-800-132fb2a60.webp 800w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-1000-132fb2a60.webp 1000w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-1200-132fb2a60.webp 1200w" type="image/webp"><source srcset="/blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-400-132fb2a60.png 400w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-600-132fb2a60.png 600w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-800-132fb2a60.png 800w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-1000-132fb2a60.png 1000w, /blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-1200-132fb2a60.png 1200w" type="image/png"><img src="/blog/generated/assets/images/creating-and-hosting-your-own-rpm-packages-and-yum-repo/header-800-132fb2a60.jpg" alt="Creating and hosting your own rpm packages and yum repo"></picture>

  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar">
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Creating and hosting your own rpm packages and yum repo">
    <meta itemprop="description" content="This tutorial is a follow up to creating and hosting your own deb and apt repo, but is written for creating rpm packages for redhat-based Linux distributions such as Fedora, CentOS, and Rocky Linux.PrerequisitesThis tutorial assumes you are using CentOS 8, and that the following packages are installed:sudo yum install -y createrepo rpm-build rpm-sign wget gcc python3 yum-utilsIf you don’t have a CentOS machine, you can still follow along using docker, just rundocker run -ti --rm centos:8 /bin/bashto create a temporary CentOS environment to follow along with.Step 0: Creating a Simple Hello World ProgramWe will be using the same basic hello world program that was used in the previous tutorial. In this tutorial, we will assume you have a binary located under ~/example/hello-world-program/hello-world.To quickly create a hello world binary using C, run:mkdir -p ~/example/hello-world-programecho &#39;#include &lt;stdio.h&gt;int main() {    printf(&quot;Hello World!\\n&quot;);    return 0;}&#39; | gcc -o ~/example/hello-world-program/hello-world -x c -This tutorial will only cover distributing binaries in rpm packages and will not cover creating source-based rpms. There’s other tutorials that cover creating spec files – the main goal of this tutorial is to document how to package a pre-compiled binary, and show how to generate your own self-hosted yum repository.Step 1: Creating a rpm PackageRedhat-based Linux distributions use .rpm packages to package and distribute programs.let’s start by making a directory to work out of:mkdir -p ~/example/rpm-work-dirInside this directory, we will create a spec file which contains package metadata such as the name, and summary of the package:cd ~/example/rpm-work-direcho &quot;Summary: A simple program that prints helloName: hello-worldVersion: 1.0.0Release: 1URL: https://example.comGroup: SystemLicense: example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_ListPackager: Example TeamRequires: bashBuildRoot: ~/example/rpm-work-dir # this should be replaced with your working directory where the spec is saved%descriptionAn example package containing a hello-world binary%installmkdir -p %{buildroot}/usr/bin/cp ~/example/hello-world-program/hello-world %{buildroot}/usr/bin/hello-world%files/usr/bin/hello-world%changelog* Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt;- initial example&quot; &gt; hello-world.specNext, we will use rpmbuild to produce the rpm:rpmbuild --target &quot;x86_64&quot; -bb hello-world.specThis will output an rpm under /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm.We can inspect the contents with:rpm -qpivl --changelog --nomanifest /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpmwhich will output something similar to:Name        : hello-worldVersion     : 1.0.0Release     : 1Architecture: x86_64Install Date: (not installed)Group       : SystemSize        : 10832License     : example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_ListSignature   : (none)Source RPM  : hello-world-1.0.0-1.src.rpmBuild Date  : Fri 18 Jun 2021 09:21:39 PM UTCBuild Host  : 83f4a9d4e295Relocations : (not relocatable)Packager    : Example TeamURL         : https://example.comSummary     : A simple program that prints helloDescription :An example package containing a hello-world binary* Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt;- initial example-rwxr-xr-x    1 root    root                    10832 Jun 18 21:21 /usr/bin/hello-worlddrwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-iddrwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id/b9lrwxrwxrwx    1 root    root                       31 Jun 18 21:21 /usr/lib/.build-id/b9/fea765874fcd0863841bc8f5d1aa1d65396751 -&gt; ../../../../usr/bin/hello-worldYou can also inspect the content via less /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm. Under the hood less will invoke /usr/bin/lesspipe.sh. You can perform a global regular expression print (grep) against the script to find the same command being used:grep rpm /usr/bin/lesspipe.shThis should print the line where the same rpm -qpivl … command is being invoked:*.rpm) rpm -qpivl --changelog --nomanifest -- &quot;$1&quot;; exit $? ;;Next, we can install our rpm via:yum install -y /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpmThen finally, we can test it was installed by runninghello-worldwhich should printHello World!Step 2: Creating a yum RepositoryNext we’re going to create a yum repository which can be uploaded to a server to make it easier to share your package with other users.Our first step will be to import a pgp key which we will be using to sign our rpm packages and repo, to allow our users to verify the packages have not been tampered. Creating pgp keys was covered in our previous tutorial; in particular, we will assume you have public and private keys stored under ~/example/pgp-key.public and ~/example/pgp-key.private respectively.First let’s import our private key, so we have access to it for signing the repo:gpg --import ~/example/pgp-key.privateThis should output something similar to:gpg: directory &#39;/root/.gnupg&#39; createdgpg: keybox &#39;/root/.gnupg/pubring.kbx&#39; createdgpg: /root/.gnupg/trustdb.gpg: trustdb createdgpg: key E1933532750E9EEF: public key &quot;example &lt;example@example.com&gt;&quot; importedgpg: key E1933532750E9EEF: secret key importedgpg: Total number processed: 1gpg:               imported: 1gpg:       secret keys read: 1gpg:   secret keys imported: 1We will then configure the rpm tools to use this key for signing our packages and repository:echo &quot;%_signature gpg%_gpg_name E1933532750E9EEF&quot; &gt; /root/.rpmmacrosDon’t forget to replace E1933532750E9EEF with your key’s ID.Let’s create a directory for our packages:mkdir -p ~/example/packages/Then copy our rpm(s) into this directory:cp /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm ~/example/packages/.Since we didn’t configure a key in step 1, the rpm we created was not signed. We can add a signature to it by running:rpm --addsign ~/example/packages/*.rpmIf you forgot to create /root/.rpmmacros, or forgot to update the key ID, you might see an error such as You must set &quot;%_gpg_name&quot; in your macro file or gpg: signing failed: No secret key.Once all the packages are signed, we will use createrepo to create the repository:cd ~/example/packages/createrepo .Finally, we will sign the repodata metadata by running:gpg --detach-sign --armor repodata/repomd.xmlStep 3: Testing the RepositoryWe are going to use python to temporarily create a web server to serve the contents of our repository:cd ~/examplepython3 -m http.serverWe will create a config for this server:echo &quot;[example-repo]name=Example Repobaseurl=http://127.0.0.1:8000/packagesenabled=1gpgcheck=1gpgkey=http://127.0.0.1:8000/pgp-key.public&quot; &gt; ~/example/example.repoNext let’s configure our machine to use this new repository:yum-config-manager --add-repo http://127.0.0.1:8000/example.repoThen we can install our package from the self-hosted repository with:yum install -y hello-worldIn this example, we were hosting the entire contents of ~/example, which may include your private key if you followed this tutorial completely and created it under ~/example/pgp-key.private. In practice, you would never serve a directory containing your private key.Appendix A: A Complete Example using EarthlyA complete example has been created under github.com/earthly/example-yum-repo/Earthfile.This Earthfile contains all the above steps from this tutorial in a single location, which can be run directly in a single shot with:earthly -P github.com/earthly/example-yum-repo:main+testAlternatively, you can clone the repo and run +test directly.">
    <meta itemprop="datePublished" content="2021-06-24T00:00:00-04:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Creating and hosting your own rpm packages and yum repo
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
        
        &nbsp;	&nbsp;<i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-06-24T00:00:00-04:00">June 24, 2021</time>
        

      </span>
    
    <span>
      
      
      
      <div class="author__avatar_top">
          <picture class="image-author"><source srcset="/blog/generated/assets/images/authors/alexcouturebeil-240-5d6b0185c.webp 240w" type="image/webp"><source srcset="/blog/generated/assets/images/authors/alexcouturebeil-240-8935b6224.jpg 240w" type="image/jpeg"><img src="/blog/generated/assets/images/authors/alexcouturebeil-240-8935b6224.jpg" alt="Alex Couture-Beil %"></picture>

          &nbsp;	&nbsp;
          Alex Couture-Beil
      </div>
      
    </span>
  </p>


        </header>
      
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#step-0-creating-a-simple-hello-world-program">Step 0: Creating a Simple Hello World Program</a></li><li><a href="#step-1-creating-a-rpm-package">Step 1: Creating a rpm Package</a></li><li><a href="#step-2-creating-a-yum-repository">Step 2: Creating a yum Repository</a></li><li><a href="#step-3-testing-the-repository">Step 3: Testing the Repository</a></li><li><a href="#appendix-a-a-complete-example-using-earthly">Appendix A: A Complete Example using Earthly</a></li></ul>

            </nav>
          </aside>
        
        <div class="narrow-code">
<p>This tutorial is a follow up to <a href="/blog/creating-and-hosting-your-own-deb-and-apt-repo">creating and hosting your own deb and apt repo</a>, but is written for creating rpm packages for redhat-based Linux distributions such as Fedora, CentOS, and Rocky Linux.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This tutorial assumes you are using CentOS 8, and that the following packages are installed:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum install <span class="at">-y</span> createrepo rpm-build rpm-sign wget gcc python3 yum-utils</span></code></pre></div>
<div class="notice--info">
<p>If you don’t have a CentOS machine, you can still follow along using docker, just run</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-ti</span> <span class="at">--rm</span> centos:8 /bin/bash</span></code></pre></div>
<p>to create a temporary CentOS environment to follow along with.</p>
</div>
<h2 id="step-0-creating-a-simple-hello-world-program">Step 0: Creating a Simple Hello World Program</h2>
<p>We will be using the same basic hello world program that was used in the <a href="/blog/creating-and-hosting-your-own-deb-and-apt-repo">previous tutorial</a>. In this tutorial, we will assume you have a binary located under <code>~/example/hello-world-program/hello-world</code>.</p>
<p>To quickly create a hello world binary using C, run:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/example/hello-world-program</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&#39;#include &lt;stdio.h&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">int main() {</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">    printf(&quot;Hello World!\\n&quot;);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">    return 0;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">}&#39;</span> <span class="kw">|</span> <span class="fu">gcc</span> <span class="at">-o</span> ~/example/hello-world-program/hello-world <span class="at">-x</span> c <span class="at">-</span></span></code></pre></div>
<p>This tutorial will only cover distributing binaries in rpm packages and will not cover creating source-based <code>rpm</code>s. There’s other <a href="https://www.thegeekstuff.com/2015/02/rpm-build-package-example/">tutorials</a> that cover creating spec files – the main goal of this tutorial is to document how to package a pre-compiled binary, and show how to generate your own self-hosted yum repository.</p>
<h2 id="step-1-creating-a-rpm-package">Step 1: Creating a <code>rpm</code> Package</h2>
<p>Redhat-based Linux distributions use <code>.rpm</code> packages to package and distribute programs.</p>
<p>let’s start by making a directory to work out of:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/example/rpm-work-dir</span></code></pre></div>
<p>Inside this directory, we will create a <code>spec</code> file which contains package metadata such as the name, and summary of the package:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/example/rpm-work-dir</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;Summary: A simple program that prints hello</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="st">Name: hello-world</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="st">Version: 1.0.0</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="st">Release: 1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="st">URL: https://example.com</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="st">Group: System</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="st">License: example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="st">Packager: Example Team</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="st">Requires: bash</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="st">BuildRoot: ~/example/rpm-work-dir # this should be replaced with your working directory where the spec is saved</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="st">%description</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="st">An example package containing a hello-world binary</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="st">%install</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">mkdir -p %{buildroot}/usr/bin/</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="st">cp ~/example/hello-world-program/hello-world %{buildroot}/usr/bin/hello-world</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="st">%files</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="st">/usr/bin/hello-world</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="st">%changelog</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="st">* Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="st">- initial example</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> hello-world.spec</span></code></pre></div>
<p>Next, we will use <code>rpmbuild</code> to produce the <code>rpm</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rpmbuild</span> <span class="at">--target</span> <span class="st">&quot;x86_64&quot;</span> <span class="at">-bb</span> hello-world.spec</span></code></pre></div>
<p>This will output an rpm under <code>/root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm</code>.</p>
<p>We can inspect the contents with:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rpm</span> <span class="at">-qpivl</span> <span class="at">--changelog</span> <span class="at">--nomanifest</span> /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm</span></code></pre></div>
<p>which will output something similar to:</p>
<pre><code>Name        : hello-world
Version     : 1.0.0
Release     : 1
Architecture: x86_64
Install Date: (not installed)
Group       : System
Size        : 10832
License     : example # https://fedoraproject.org/wiki/Licensing:Main?rd=Licensing#Software_License_List
Signature   : (none)
Source RPM  : hello-world-1.0.0-1.src.rpm
Build Date  : Fri 18 Jun 2021 09:21:39 PM UTC
Build Host  : 83f4a9d4e295
Relocations : (not relocatable)
Packager    : Example Team
URL         : https://example.com
Summary     : A simple program that prints hello
Description :
An example package containing a hello-world binary
* Thu Jun 17 2021 alex &lt;alex@earthly.dev&gt;
- initial example

-rwxr-xr-x    1 root    root                    10832 Jun 18 21:21 /usr/bin/hello-world
drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id
drwxr-xr-x    2 root    root                        0 Jun 18 21:21 /usr/lib/.build-id/b9
lrwxrwxrwx    1 root    root                       31 Jun 18 21:21 /usr/lib/.build-id/b9/fea765874fcd0863841bc8f5d1aa1d65396751 -&gt; ../../../../usr/bin/hello-world</code></pre>
<div class="notice--info">
<p>You can also inspect the content via <code>less /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm</code>. Under the hood <code>less</code> will invoke <code>/usr/bin/lesspipe.sh</code>. You can perform a global regular expression print (grep) against the script to find the same command being used:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> rpm /usr/bin/lesspipe.sh</span></code></pre></div>
<p>This should print the line where the same <code>rpm -qpivl ...</code> command is being invoked:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">*.rpm</span><span class="er">)</span> <span class="ex">rpm</span> <span class="at">-qpivl</span> <span class="at">--changelog</span> <span class="at">--nomanifest</span> <span class="at">--</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span><span class="kw">;</span> <span class="bu">exit</span> <span class="va">$?</span> <span class="kw">;;</span></span></code></pre></div>
</div>
<p>Next, we can install our <code>rpm</code> via:</p>
<pre><code>yum install -y /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm</code></pre>
<p>Then finally, we can test it was installed by running</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hello-world</span></span></code></pre></div>
<p>which should print</p>
<pre><code>Hello World!</code></pre>
<h2 id="step-2-creating-a-yum-repository">Step 2: Creating a <code>yum</code> Repository</h2>
<p>Next we’re going to create a yum repository which can be uploaded to a server to make it easier to share your package with other users.</p>
<p>Our first step will be to import a pgp key which we will be using to sign our rpm packages and repo, to allow our users to verify the packages have not been tampered. Creating pgp keys was covered in our <a href="/blog/creating-and-hosting-your-own-deb-and-apt-repo">previous tutorial</a>; in particular, we will assume you have public and private keys stored under <code>~/example/pgp-key.public</code> and <code>~/example/pgp-key.private</code> respectively.</p>
<p>First let’s import our private key, so we have access to it for signing the repo:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gpg</span> <span class="at">--import</span> ~/example/pgp-key.private</span></code></pre></div>
<p>This should output something similar to:</p>
<pre><code>gpg: directory &#39;/root/.gnupg&#39; created
gpg: keybox &#39;/root/.gnupg/pubring.kbx&#39; created
gpg: /root/.gnupg/trustdb.gpg: trustdb created
gpg: key E1933532750E9EEF: public key &quot;example &lt;example@example.com&gt;&quot; imported
gpg: key E1933532750E9EEF: secret key imported
gpg: Total number processed: 1
gpg:               imported: 1
gpg:       secret keys read: 1
gpg:   secret keys imported: 1</code></pre>
<p>We will then configure the rpm tools to use this key for signing our packages and repository:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;%_signature gpg</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="st">%_gpg_name E1933532750E9EEF&quot;</span> <span class="op">&gt;</span> /root/.rpmmacros</span></code></pre></div>
<div class="notice--info">
<p>Don’t forget to replace <code>E1933532750E9EEF</code> with your key’s ID.</p>
</div>
<p>Let’s create a directory for our packages:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> ~/example/packages/</span></code></pre></div>
<p>Then copy our rpm(s) into this directory:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /root/rpmbuild/RPMS/x86_64/hello-world-1.0.0-1.x86_64.rpm ~/example/packages/.</span></code></pre></div>
<p>Since we didn’t configure a key in step 1, the rpm we created was not signed. We can add a signature to it by running:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">rpm</span> <span class="at">--addsign</span> ~/example/packages/<span class="pp">*</span>.rpm</span></code></pre></div>
<div class="notice--info">
<p>If you forgot to create <code>/root/.rpmmacros</code>, or forgot to update the key ID, you might see an error such as <code>You must set "%_gpg_name" in your macro file</code> or <code>gpg: signing failed: No secret key</code>.</p>
</div>
<p>Once all the packages are signed, we will use <code>createrepo</code> to create the repository:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/example/packages/</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">createrepo</span> .</span></code></pre></div>
<p>Finally, we will sign the repodata metadata by running:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">gpg</span> <span class="at">--detach-sign</span> <span class="at">--armor</span> repodata/repomd.xml</span></code></pre></div>
<h2 id="step-3-testing-the-repository">Step 3: Testing the Repository</h2>
<p>We are going to use python to temporarily create a web server to serve the contents of our repository:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/example</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> <span class="at">-m</span> http.server</span></code></pre></div>
<p>We will create a config for this server:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;[example-repo]</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="st">name=Example Repo</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="st">baseurl=http://127.0.0.1:8000/packages</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="st">enabled=1</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="st">gpgcheck=1</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="st">gpgkey=http://127.0.0.1:8000/pgp-key.public&quot;</span> <span class="op">&gt;</span> ~/example/example.repo</span></code></pre></div>
<p>Next let’s configure our machine to use this new repository:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yum-config-manager</span> <span class="at">--add-repo</span> http://127.0.0.1:8000/example.repo</span></code></pre></div>
<p>Then we can install our package from the self-hosted repository with:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">yum</span> install <span class="at">-y</span> hello-world</span></code></pre></div>
<div class="notice--info">
<p>In this example, we were hosting the entire contents of <code>~/example</code>, which may include your private key if you followed this tutorial completely and created it under <code>~/example/pgp-key.private</code>. In practice, you would never serve a directory containing your private key.</p>
</div>
<h2 id="appendix-a-a-complete-example-using-earthly">Appendix A: A Complete Example using Earthly</h2>
<p>A complete example has been created under <a href="https://github.com/earthly/example-yum-repo/blob/main/Earthfile">github.com/earthly/example-yum-repo/Earthfile</a>.</p>
<p>This Earthfile contains all the above steps from this tutorial in a single location, which can be run directly in a single shot with:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">earthly</span> <span class="at">-P</span> github.com/earthly/example-yum-repo:main+test</span></code></pre></div>
<p>Alternatively, you can clone the repo and run <code>+test</code> directly.</p>
</div>

        
      </section>

      


<div itemscope itemtype="https://schema.org/Person">
  <!-- <h5>About The Author</h5> -->

  
    <div class="author__avatar">
      
        <picture class="image-author"><source srcset="/blog/generated/assets/images/authors/alexcouturebeil-240-5d6b0185c.webp 240w" type="image/webp"><source srcset="/blog/generated/assets/images/authors/alexcouturebeil-240-8935b6224.jpg 240w" type="image/jpeg"><img src="/blog/generated/assets/images/authors/alexcouturebeil-240-8935b6224.jpg" alt="Alex Couture-Beil %"></picture>

      
    </div>
  

  <div class="author__content">
    
      <h4 class="author__name" itemprop="name">
        Alex Couture-Beil
    
    
    </h4>
    
      <div class="author__bio" itemprop="description">
        <p>Alex enjoys writing code, growing vegetables, and the great outdoors.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <!-- <button class="btn btn--inverse">Follow</button> -->
    <ul class="author__urls social-icons">
      

     

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

      <footer class="page__meta">
        
        



  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/blog/categories/tutorials" class="page__taxonomy-item" rel="tag">Tutorials</a>
    
    </span>
  </p>



        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-06-24T00:00:00-04:00">June 24, 2021</time></p>


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/blog/15-minute-project/" class="pagination--pager" title="The 15-Minute Project
">Previous</a>
    
    
      <a href="/blog/markdown-lint/" class="pagination--pager" title="Linting Markdown And Documentation
">Next</a>
    
  </nav>

    </div>
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          










<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <picture><source srcset="/blog/generated/assets/images/example/teaser-600-fc9eab451.webp 600w, /blog/generated/assets/images/example/teaser-800-fc9eab451.webp 800w" type="image/webp"><source srcset="/blog/generated/assets/images/example/teaser-600-b449882ef.jpg 600w, /blog/generated/assets/images/example/teaser-800-b449882ef.jpg 800w" type="image/jpeg"><img src="/blog/generated/assets/images/example/teaser-800-b449882ef.jpg"></picture>

      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/example/" rel="permalink">Example Post
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">

This post is in the future, and won’t show up in the published site


Image without figure


An image with the alt text hidden.





An image with alt text...</p>
  </article>
</div>

        
          










<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <picture><source srcset="/blog/generated/assets/images/python-matplotlib-docker/header-600-e56f7fb32.webp 600w, /blog/generated/assets/images/python-matplotlib-docker/header-800-e56f7fb32.webp 800w" type="image/webp"><source srcset="/blog/generated/assets/images/python-matplotlib-docker/header-600-976d74d44.jpg 600w, /blog/generated/assets/images/python-matplotlib-docker/header-800-976d74d44.jpg 800w" type="image/jpeg"><img src="/blog/generated/assets/images/python-matplotlib-docker/header-800-976d74d44.jpg"></picture>

      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/blog/python-matplotlib-docker/" rel="permalink">Install <code>matplotlib</code> In A Docker Container
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
matplotlib is an excellent library for creating graphs and visualizations in Python. For example, I used it to generate the performance graphs in my merging...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/earthlytech" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/earthly/earthly" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
    

    
      <li><a href="/blog/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 <a href="https://earthly.dev/">Earthly</a>. </div>

      </footer>
    </div>

    <script src="/blog/assets/js/vendor/jquery/jquery-3.5.1.js"></script>
<script src="/blog/assets/js/plugins/jquery.fitvids.js"></script>
<script src="/blog/assets/js/plugins/smooth-scroll.js"></script>
<script src="/blog/assets/js/plugins/gumshoe.js"></script>
<script src="/blog/assets/js/plugins/jquery.magnific-popup.js"></script>
<script src="/blog/assets/js/main.min.js"></script>

  <script> // minified version of https://earthly.dev/assets/js/analytics.js
    function setCookie(e,t,r){var i="";if(r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3),i="; expires="+o.toUTCString()}document.cookie=e+"="+(t||"")+i+"; path=/"}function getCookie(e){for(var t=e+"=",r=document.cookie.split(";"),i=0;i<r.length;i++){for(var o=r[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}function getAnalyticCookie(){cookieName="earthlyID";var e=getCookie(cookieName);return null==e&&(e=uuidv4()),setCookie(cookieName,e,36500),e}jQuery.ajax({type:"POST",url:"https://api.earthly.dev/analytics",data:JSON.stringify({key:"website",url:window.location.href,referrer:document.referrer,earthlyID:getAnalyticCookie()})});
</script>




  </body>
</html>
