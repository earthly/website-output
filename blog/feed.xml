<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="https://earthly.dev/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://earthly.dev/blog/" rel="alternate" type="text/html" /><updated>2021-05-08T08:51:31-04:00</updated><id>https://earthly.dev/blog/feed.xml</id><title type="html">Earthly Blog</title><subtitle>Build automation for the container era.</subtitle><entry><title type="html">Understanding Docker Networking</title><link href="https://earthly.dev/blog/docker-networking/" rel="alternate" type="text/html" title="Understanding Docker Networking" /><published>2021-05-05T00:00:00-04:00</published><updated>2021-05-05T00:00:00-04:00</updated><id>https://earthly.dev/blog/docker-networking</id><content type="html" xml:base="https://earthly.dev/blog/docker-networking/">&lt;p&gt;Docker is the de facto model for building and running containers at scale in most enterprise organizations today. At a very high level, Docker is a combination of CLI and a daemon process that solves common software problems like installing, publishing, removing, and managing containers. It’s perfect for microservices, where you have many services handling a typical business functionality; Docker makes the packaging easier, enabling you to encapsulate those services in containers.&lt;/p&gt;
&lt;p&gt;Once the application is inside a container, it’s easier to scale and even runs on different cloud platforms, like AWS, GCP, and Azure. In this article, let’s focus on the &lt;a href=&quot;https://docs.docker.com/network/&quot;&gt;networking aspect of Docker&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;what-is-a-docker-network&quot;&gt;What Is a Docker Network?&lt;/h2&gt;
&lt;p&gt;Networking is about communication among processes, and Docker’s networking is no different. Docker networking is primarily used to establish communication between Docker containers and the outside world via the host machine where the Docker daemon is running.&lt;/p&gt;
&lt;p&gt;Docker supports different types of networks, each fit for certain use cases. We’ll be exploring the network drivers supported by Docker in general, along with some coding examples.&lt;/p&gt;
&lt;p&gt;Docker networking differs from virtual machine (VM) or physical machine networking in a few ways:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Virtual machines are more flexible in some ways as they can support configurations like &lt;a href=&quot;https://superuser.com/questions/227505/what-is-the-difference-between-nat-bridged-host-only-networking&quot;&gt;NAT and host networking&lt;/a&gt;. Docker typically uses a bridge network, and while it can support host networking, that option is &lt;a href=&quot;https://docs.docker.com/network/host/&quot;&gt;only available on Linux&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;When using Docker containers, network isolation is achieved using a network namespace, not an entirely separate networking stack.&lt;/li&gt;
&lt;li&gt;You can run hundreds of containers on a single-node Docker host, so it’s required that the host can support networking at this scale. VMs usually don’t run into these network limits as they typically run fewer processes per VM.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;what-are-docker-network-drivers&quot;&gt;What Are Docker Network Drivers?&lt;/h2&gt;
&lt;p&gt;Docker handles communication between containers by creating a default bridge network, so you often don’t have to deal with networking and can instead focus on creating and running containers. This default bridge network works in most cases, but it’s not the only option you have.&lt;/p&gt;
&lt;p&gt;Docker allows you to create three different types of network drivers out-of-the-box: bridge, host, and none. However, they may not fit every use case, so we’ll also explore user-defined networks such as overlay and macvlan. Let’s take a closer look at each one.&lt;/p&gt;
&lt;h3 id=&quot;the-bridge-driver&quot;&gt;The Bridge Driver&lt;/h3&gt;
&lt;p&gt;This is the default. Whenever you start Docker, a bridge network gets created and all newly started containers will connect automatically to the default bridge network.&lt;/p&gt;
&lt;p&gt;You can use this whenever you want your containers running in isolation to connect and communicate with each other. Since containers run in isolation, the bridge network solves the port conflict problem. Containers running in the same bridge network can communicate with each other, and Docker &lt;a href=&quot;https://docs.docker.com/network/iptables/&quot;&gt;uses iptables&lt;/a&gt; on the host machine to prevent access outside of the bridge.&lt;/p&gt;
&lt;p&gt;Let’s look at some examples of how a bridge network driver works.&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Check the available network by running the &lt;code&gt;docker network ls&lt;/code&gt; command&lt;/li&gt;
&lt;li&gt;Start two &lt;a href=&quot;https://hub.docker.com/_/busybox&quot;&gt;busybox&lt;/a&gt; containers named &lt;code&gt;busybox1&lt;/code&gt; and &lt;code&gt;busybox2&lt;/code&gt; in detached mode by passing the &lt;code&gt;-dit&lt;/code&gt; flag.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker network ls           &lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;NETWORK&lt;/span&gt; ID     NAME      DRIVER    SCOPE&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;5077a7b25ae6&lt;/span&gt;   bridge    bridge    local&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;7e25f334b07f&lt;/span&gt;   host      host      local&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;475e50be0fe0&lt;/span&gt;   none      null      local&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker run -dit --name busybox1 busybox /bin/sh
$ docker run -dit --name busybox2 busybox /bin/sh&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;3&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Run the &lt;code&gt;docker ps&lt;/code&gt; command to verify that containers are up and running.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker ps
CONTAINER ID   IMAGE     COMMAND     CREATED          STATUS          PORTS     NAMES
9e6464e82c4c   busybox   &amp;quot;/bin/sh&amp;quot;   5 seconds ago    Up 5 seconds              busybox2
7fea14032748   busybox   &amp;quot;/bin/sh&amp;quot;   26 seconds ago   Up 26 seconds             busybox1&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;4&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Verify that the containers are attached to the bridge network.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network inspect bridge                                                       
[
    {
        &amp;quot;Name&amp;quot;: &amp;quot;bridge&amp;quot;,
        &amp;quot;Id&amp;quot;: &amp;quot;5077a7b25ae67abd46cff0fde160303476c8a9e2e1d52ad01ba2b4bf04acc0e0&amp;quot;,
        &amp;quot;Created&amp;quot;: &amp;quot;2021-03-05T03:25:58.232446444Z&amp;quot;,
        &amp;quot;Scope&amp;quot;: &amp;quot;local&amp;quot;,
        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,
        &amp;quot;EnableIPv6&amp;quot;: false,
        &amp;quot;IPAM&amp;quot;: {
            &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,
            &amp;quot;Options&amp;quot;: null,
            &amp;quot;Config&amp;quot;: [
                {
                    &amp;quot;Subnet&amp;quot;: &amp;quot;172.17.0.0/16&amp;quot;,
                    &amp;quot;Gateway&amp;quot;: &amp;quot;172.17.0.1&amp;quot;
                }
            ]
        },
        &amp;quot;Internal&amp;quot;: false,
        &amp;quot;Attachable&amp;quot;: false,
        &amp;quot;Ingress&amp;quot;: false,
        &amp;quot;ConfigFrom&amp;quot;: {
            &amp;quot;Network&amp;quot;: &amp;quot;&amp;quot;
        },
        &amp;quot;ConfigOnly&amp;quot;: false,
        &amp;quot;Containers&amp;quot;: {
            &amp;quot;7fea140327487b57c3cf31d7502cfaf701e4ea4314621f0c726309e396105885&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;busybox1&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;05f216032784786c3315e30b3d54d50a25c1efc7d2030dc664716dda38056326&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:11:00:02&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.17.0.2/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            },
            &amp;quot;9e6464e82c4ca647b9fb60a85ca25e71370330982ea497d51c1238d073148f63&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;busybox2&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;3dcc24e927246c44a2063b5be30b5f5e1787dcd4d53864c6ff2bb3c561519115&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:11:00:03&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.17.0.3/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            }
        },
        &amp;quot;Options&amp;quot;: {
            &amp;quot;com.docker.network.bridge.default_bridge&amp;quot;: &amp;quot;true&amp;quot;,
            &amp;quot;com.docker.network.bridge.enable_icc&amp;quot;: &amp;quot;true&amp;quot;,
            &amp;quot;com.docker.network.bridge.enable_ip_masquerade&amp;quot;: &amp;quot;true&amp;quot;,
            &amp;quot;com.docker.network.bridge.host_binding_ipv4&amp;quot;: &amp;quot;0.0.0.0&amp;quot;,
            &amp;quot;com.docker.network.bridge.name&amp;quot;: &amp;quot;docker0&amp;quot;,
            &amp;quot;com.docker.network.driver.mtu&amp;quot;: &amp;quot;1500&amp;quot;
        },
        &amp;quot;Labels&amp;quot;: {}
    }
]
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;5&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Under the container’s key, you can observe that two containers (&lt;code&gt;busybox1&lt;/code&gt; and &lt;code&gt;busybox2&lt;/code&gt;) are listed with information about IP addresses. Since containers are running in the background, attach to the &lt;code&gt;busybox1&lt;/code&gt; container and try to ping to &lt;code&gt;busybox2&lt;/code&gt; with its IP address.&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker attach busybox1
/ # whoami
root
/ # hostname -i
172.17.0.2
/ # ping 172.17.0.3
PING 172.17.0.3 (172.17.0.3): 56 data bytes
64 bytes from 172.17.0.3: seq=0 ttl=64 time=2.083 ms
64 bytes from 172.17.0.3: seq=1 ttl=64 time=0.144 ms
/ # ping busybox2
ping: bad address &amp;#39;busybox2&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;6&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Observe that the ping works by passing the IP address of &lt;code&gt;busybox2&lt;/code&gt; but fails when the container name is passed instead.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The downside with the bridge driver is that it’s not recommended for production; the containers communicate via IP address instead of automatic service discovery to resolve an IP address to the container name. Every time you run a container, a different IP address gets assigned to it. It may work well for local development or CI/CD, but it’s definitely not a sustainable approach for applications running in production.&lt;/p&gt;
&lt;p&gt;Another reason not to use it in production is that it will allow unrelated containers to communicate with each other, which could be a security risk. I’ll cover how you can create custom bridge networks later.&lt;/p&gt;
&lt;h3 id=&quot;the-host-driver&quot;&gt;The Host Driver&lt;/h3&gt;
&lt;p&gt;As the name suggests, host drivers use the networking provided by the host machine. And it removes network isolation between the container and the host machine where Docker is running. For example, If you run a container that binds to port 80 and uses host networking, the container’s application is available on port 80 on the host’s IP address. You can use the host network if you don’t want to rely on Docker’s networking but instead rely on the host machine networking.&lt;/p&gt;
&lt;p&gt;One limitation with the host driver is that it doesn’t work on Docker desktop: you need a Linux host to use it. This article focuses on Docker desktop, but I’ll show you the commands required to work with the Linux host.&lt;/p&gt;
&lt;p&gt;The following command will start an NGINX image and listen to port 80 on the host machine:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker run --rm -d --network host --name my_nginx nginx
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can access NGINX by hitting the &lt;code&gt;http://localhost:80/ url&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The downside with the host network is that you can’t run multiple containers on the same host having the same port. Ports are shared by all containers on the host machine network.&lt;/p&gt;
&lt;h3 id=&quot;the-none-driver&quot;&gt;The None Driver&lt;/h3&gt;
&lt;p&gt;The none network driver does not attach containers to any network. Containers do not access the external network or communicate with other containers. You can use it when you want to disable the networking on a container.&lt;/p&gt;
&lt;h3 id=&quot;the-overlay-driver&quot;&gt;The Overlay Driver&lt;/h3&gt;
&lt;p&gt;The Overlay driver is for multi-host network communication, as with &lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;Docker Swarm&lt;/a&gt; or &lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt;. It allows containers across the host to communicate with each other without worrying about the setup. Think of an overlay network as a distributed virtualized network that’s built on top of an existing computer network.&lt;/p&gt;
&lt;p&gt;To create an overlay network for Docker Swarm services, use the following command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ docker network create -d overlay my-overlay-network&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To create an overlay network so that standalone containers can communicate with each other, use this command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ docker network create -d overlay --attachable my-attachable-overlay&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;the-macvlan-driver&quot;&gt;The Macvlan Driver&lt;/h3&gt;
&lt;p&gt;This driver connects Docker containers directly to the physical host network. As per &lt;a href=&quot;https://docs.docker.com/network/#network-drivers&quot;&gt;the Docker documentation&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“Macvlan networks allow you to assign a MAC address to a container, making it appear as a physical device on your network. The Docker daemon routes traffic to containers by their MAC addresses. Using the &lt;code&gt;macvlan&lt;/code&gt; driver is sometimes the best choice when dealing with legacy applications that expect to be directly connected to the physical network, rather than routed through the Docker host’s network stack.”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Macvlan networks are best for legacy applications that need to be modernized by containerizing them and running them on the cloud because they need to be attached to a physical network for performance reasons. &lt;a href=&quot;https://github.com/docker/for-mac/issues/3926&quot;&gt;A macvlan network is also not supported on Docker desktop for macOS&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;basic-docker-networking-commands&quot;&gt;Basic Docker Networking Commands&lt;/h2&gt;
&lt;p&gt;To see which commands list, create, connect, disconnect, inspect, or remove a Docker network, use the &lt;code&gt;docker network help&lt;/code&gt; command.&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network help

Usage:  docker network COMMAND

Manage networks

Commands:
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container from a network
  inspect     Display detailed information on one or more networks
  ls          List networks
  prune       Remove all unused networks
  rm          Remove one or more networks&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s run through some examples of each command, starting with &lt;code&gt;docker network connect&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&quot;connecting-a-container-to-a-network&quot;&gt;Connecting a Container to a Network&lt;/h3&gt;
&lt;p&gt;Let’s try to connect a container to the &lt;code&gt;mynetwork&lt;/code&gt; we have created. First, we would need a running container that can connect to &lt;code&gt;mynetwork&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker run -it ubuntu bash   
root@0f8d7a833f42:/# &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we have an Ubuntu Linux image and started a login shell as root inside it. We have the container running in interactive mode with the help of the &lt;code&gt;-it&lt;/code&gt; flags.&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker ps     
CONTAINER ID   IMAGE     COMMAND   CREATED         STATUS         PORTS     NAMES
0f8d7a833f42   ubuntu    &amp;quot;bash&amp;quot;    9 seconds ago   Up 7 seconds             wizardly_greider&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Run the &lt;code&gt;docker network connect 0f8d7a833f42&lt;/code&gt; command to connect the container named &lt;code&gt;wizardly_greider&lt;/code&gt; with &lt;code&gt;mynetwork&lt;/code&gt;. To verify that this container is connected to &lt;code&gt;mynetwork&lt;/code&gt;, use the &lt;code&gt;docker inspect&lt;/code&gt; command.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode json&quot;&gt;&lt;code class=&quot;sourceCode json&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;er&quot;&gt;&amp;quot;mynetwork&amp;quot;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-2&quot;&gt;&lt;a href=&quot;#cb12-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;IPAMConfig&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{},&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-3&quot;&gt;&lt;a href=&quot;#cb12-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;Links&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-4&quot;&gt;&lt;a href=&quot;#cb12-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;Aliases&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;[&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-5&quot;&gt;&lt;a href=&quot;#cb12-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                        &lt;span class=&quot;st&quot;&gt;&amp;quot;0f8d7a833f42&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-6&quot;&gt;&lt;a href=&quot;#cb12-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;ot&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-7&quot;&gt;&lt;a href=&quot;#cb12-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;NetworkID&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;97a158252c995d3632560852c62bd140984769c8714b1f990c8133a5c8ae65d3&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-8&quot;&gt;&lt;a href=&quot;#cb12-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;EndpointID&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;db21f395ca781523c115706b11063ebe879cf5ef246c24fd128fe621a582cade&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-9&quot;&gt;&lt;a href=&quot;#cb12-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;Gateway&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;172.20.0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-10&quot;&gt;&lt;a href=&quot;#cb12-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;IPAddress&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;172.20.0.2&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-11&quot;&gt;&lt;a href=&quot;#cb12-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;IPPrefixLen&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-12&quot;&gt;&lt;a href=&quot;#cb12-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;IPv6Gateway&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-13&quot;&gt;&lt;a href=&quot;#cb12-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;GlobalIPv6Address&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-14&quot;&gt;&lt;a href=&quot;#cb12-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;GlobalIPv6PrefixLen&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-15&quot;&gt;&lt;a href=&quot;#cb12-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;MacAddress&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;02:42:ac:14:00:02&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-16&quot;&gt;&lt;a href=&quot;#cb12-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;dt&quot;&gt;&amp;quot;DriverOpts&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-17&quot;&gt;&lt;a href=&quot;#cb12-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;creating-a-network&quot;&gt;Creating a Network&lt;/h3&gt;
&lt;p&gt;You can use &lt;code&gt;docker network create mynetwork&lt;/code&gt; to create a Docker network. Here, we’ve created a network named &lt;code&gt;mynetwork&lt;/code&gt;. Let’s run &lt;code&gt;docker network ls&lt;/code&gt; to verify that the network is created successfully.&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network ls
NETWORK ID     NAME        DRIVER    SCOPE
b995772ac197   bridge      bridge    local
7e25f334b07f   host        host      local
97a158252c99   mynetwork   bridge    local
475e50be0fe0   none        null      local&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we have a new custom network named &lt;code&gt;mynetwork&lt;/code&gt;, and its type is bridge.&lt;/p&gt;
&lt;h3 id=&quot;disconnecting-a-container-from-the-network&quot;&gt;Disconnecting a Container from the Network&lt;/h3&gt;
&lt;p&gt;This command disconnects a Docker container from the custom &lt;code&gt;mynetwork&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network disconnect mynetwork 0f8d7a833f42&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;inspecting-the-network&quot;&gt;Inspecting the Network&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;docker network inspect&lt;/code&gt; command displays detailed information on one or more networks.&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network inspect mynetwork
[
    {
        &amp;quot;Name&amp;quot;: &amp;quot;mynetwork&amp;quot;,
        &amp;quot;Id&amp;quot;: &amp;quot;97a158252c995d3632560852c62bd140984769c8714b1f990c8133a5c8ae65d3&amp;quot;,
        &amp;quot;Created&amp;quot;: &amp;quot;2021-03-02T17:36:30.090173896Z&amp;quot;,
        &amp;quot;Scope&amp;quot;: &amp;quot;local&amp;quot;,
        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,
        &amp;quot;EnableIPv6&amp;quot;: false,
        &amp;quot;IPAM&amp;quot;: {
            &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,
            &amp;quot;Options&amp;quot;: {},
            &amp;quot;Config&amp;quot;: [
                {
                    &amp;quot;Subnet&amp;quot;: &amp;quot;172.20.0.0/16&amp;quot;,
                    &amp;quot;Gateway&amp;quot;: &amp;quot;172.20.0.1&amp;quot;
                }
            ]
        },
        &amp;quot;Internal&amp;quot;: false,
        &amp;quot;Attachable&amp;quot;: false,
        &amp;quot;Ingress&amp;quot;: false,
        &amp;quot;ConfigFrom&amp;quot;: {
            &amp;quot;Network&amp;quot;: &amp;quot;&amp;quot;
        },
        &amp;quot;ConfigOnly&amp;quot;: false,
        &amp;quot;Containers&amp;quot;: {
            &amp;quot;0f8d7a833f4283202e905e621e6fd5b29a8e3d4eccc6be6ea0f209f5cb3ca81c&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;wizardly_greider&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;db21f395ca781523c115706b11063ebe879cf5ef246c24fd128fe621a582cade&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:14:00:02&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.20.0.2/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            }
        },
        &amp;quot;Options&amp;quot;: {},
        &amp;quot;Labels&amp;quot;: {}
    }
]
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;list-available-networks&quot;&gt;List Available Networks&lt;/h3&gt;
&lt;p&gt;Docker installation comes with three networks: none, bridge, and host. You can verify this by running the command &lt;code&gt;docker network ls&lt;/code&gt;:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
b995772ac197   bridge    bridge    local
7e25f334b07f   host      host      local
475e50be0fe0   none      null      local&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;removing-a-network&quot;&gt;Removing a Network&lt;/h3&gt;
&lt;p&gt;The following are the Docker commands to remove a specific or all available networks:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network rm mynetwork
mynetwork
$ docker network ls
NETWORK ID     NAME      DRIVER    SCOPE
b995772ac197   bridge    bridge    local
7e25f334b07f   host      host      local
475e50be0fe0   none      null      local&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network prune                            
WARNING! This will remove all custom networks not used by at least one container.
Are you sure you want to continue? [y/N] &lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;public-networking&quot;&gt;Public Networking&lt;/h2&gt;
&lt;p&gt;Let’s talk about how to publish a container port and IP addresses to the outside world. When you start a container using the &lt;code&gt;docker run&lt;/code&gt; command, none of its ports are exposed. Your Docker container can connect to the outside world, but the outside world cannot connect to the container. To make the ports accessible for external use or with other containers not on the same network, you will have to use the &lt;code&gt;-P&lt;/code&gt; (publish all available ports) or &lt;code&gt;-p&lt;/code&gt; (publish specific ports) flag.&lt;/p&gt;
&lt;p&gt;For example, here we’ve mapped the TCP port 80 of the container to port 8080 on the Docker host:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker run -it --rm nginx -p 8080:80&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here, we’ve mapped container TCP port 80 to port 8080 on the Docker host for connections to host IP 192.168.1.100:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker run -p 192.168.1.100:8085:80 nginx&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can verify this by running the following curl command:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ curl 192.168.1.100:8085
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;title&amp;gt;Welcome to nginx!&amp;lt;/title&amp;gt;
&amp;lt;style&amp;gt;
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
&amp;lt;/style&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1&amp;gt;Welcome to nginx!&amp;lt;/h1&amp;gt;
&amp;lt;p&amp;gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;For online documentation and support please refer to
&amp;lt;a href=&amp;quot;http://nginx.org/&amp;quot;&amp;gt;nginx.org&amp;lt;/a&amp;gt;.&amp;lt;br/&amp;gt;
Commercial support is available at
&amp;lt;a href=&amp;quot;http://nginx.com/&amp;quot;&amp;gt;nginx.com&amp;lt;/a&amp;gt;.&amp;lt;/p&amp;gt;

&amp;lt;p&amp;gt;&amp;lt;em&amp;gt;Thank you for using nginx.&amp;lt;/em&amp;gt;&amp;lt;/p&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let me briefly mention DNS configuration for containers. Docker provides your containers with the ability to make basic name resolutions:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker exec busybox2 ping www.google.com
PING www.google.com (216.58.216.196): 56 data bytes
64 bytes from 216.58.216.196: seq=0 ttl=37 time=9.672 ms
64 bytes from 216.58.216.196: seq=1 ttl=37 time=6.110 ms
$ ping www.google.com
PING www.google.com (216.58.216.196): 56 data bytes
64 bytes from 216.58.216.196: icmp_seq=0 ttl=118 time=4.722 ms&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Docker containers inherit DNS settings from the host when using a bridge network, so the container will resolve DNS names just like the host by default. To add custom host records to your container, you’ll need to use the &lt;a href=&quot;https://docs.docker.com/config/containers/container-networking/#dns-services&quot;&gt;relevant &lt;code&gt;--dns*&lt;/code&gt; flags outlined here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;docker-compose-networking&quot;&gt;Docker Compose Networking&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/compose/&quot;&gt;Docker Compose&lt;/a&gt; is a tool for running multi-container applications on Docker, which are defined using the compose YAML file. You can start your applications with a single command: &lt;code&gt;docker-compose up&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;By default, Docker Compose creates a single network for each container defined in the compose file. All the containers defined in the compose file connect and communicate through the default network.&lt;/p&gt;
&lt;p&gt;If you’re not sure about the commands supported with Docker Compose, you can run the following:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker compose help
Docker Compose

Usage:
  docker compose [command]

Available Commands:
  build       Build or rebuild services
  convert     Converts the compose file to a cloud format (default: cloudformation)
  down        Stop and remove containers, networks
  logs        View output from containers
  ls          List running compose projects
  ps          List containers
  pull        Pull service images
  push        Push service images
  run         Run a one-off command on a service.
  up          Create and start containers

Flags:
  -h, --help   help for compose

Global Flags:
      --config DIRECTORY   Location of the client config files DIRECTORY (default &amp;quot;/Users/ashish/.docker&amp;quot;)
  -c, --context string     context
  -D, --debug              Enable debug output in the logs
  -H, --host string        Daemon socket(s) to connect to

Use &amp;quot;docker compose [command] --help&amp;quot; for more information about a command.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s understand this with an example. In the following &lt;code&gt;docker-compose.yaml&lt;/code&gt; file, we have a WordPress and a MySQL image.&lt;/p&gt;
&lt;p&gt;When deploying this setup, &lt;code&gt;docker-compose&lt;/code&gt; maps the WordPress container port 80 to port 80 of the host as specified in the compose file. We haven’t defined any custom network, so it should create one for you. Run &lt;code&gt;docker-compose up -d&lt;/code&gt; to bring up the services defined in the YAML file:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;version: &amp;#39;3.7&amp;#39;
services:
  db:
    image: mysql:8.0.19
    command: &amp;#39;--default-authentication-plugin=mysql_native_password&amp;#39;
    restart: always
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    environment:
      - MYSQL_ROOT_PASSWORD=somewordpress
      - MYSQL_DATABASE=wordpress
      - MYSQL_USER=wordpress
      - MYSQL_PASSWORD=wordpress
  wordpress:
    image: wordpress:latest
    ports:
      - 80:80
    restart: always
    environment:
      - WORDPRESS_DB_HOST=db
      - WORDPRESS_DB_USER=wordpress
      - WORDPRESS_DB_PASSWORD=wordpress
      - WORDPRESS_DB_NAME=wordpress
volumes:
  db_data:&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see in the following output, a network named &lt;code&gt;downloads_default&lt;/code&gt; is created for you:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker-compose up -d
Creating network &amp;quot;downloads_default&amp;quot; with the default driver
Creating volume &amp;quot;downloads_db_data&amp;quot; with default driver
Pulling db (mysql:8.0.19)...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Verify that we have two containers up and running with the &lt;code&gt;docker ps&lt;/code&gt; command:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker ps
CONTAINER ID   IMAGE              COMMAND                  CREATED         STATUS         PORTS                 NAMES
f68265cd6219   wordpress:latest   &amp;quot;docker-entrypoint.s…&amp;quot;   6 minutes ago   Up 6 minutes   0.0.0.0:80-&amp;gt;80/tcp    downloads_wordpress_1
2838f5586c73   mysql:8.0.19       &amp;quot;docker-entrypoint.s…&amp;quot;   6 minutes ago   Up 6 minutes   3306/tcp, 33060/tcp   downloads_db_1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Navigate to &lt;code&gt;http://localhost:80&lt;/code&gt; in your web browser to access WordPress.&lt;/p&gt;
&lt;p&gt;Now let’s inspect this network with the &lt;code&gt;docker network inspect&lt;/code&gt; command. The following is the output:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network inspect downloads_default
[
    {
        &amp;quot;Name&amp;quot;: &amp;quot;downloads_default&amp;quot;,
        &amp;quot;Id&amp;quot;: &amp;quot;717ea814aae357ceca3972342a64335a0c910455abf160ed820018b8d6690383&amp;quot;,
        &amp;quot;Created&amp;quot;: &amp;quot;2021-03-05T03:43:42.541707419Z&amp;quot;,
        &amp;quot;Scope&amp;quot;: &amp;quot;local&amp;quot;,
        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,
        &amp;quot;EnableIPv6&amp;quot;: false,
        &amp;quot;IPAM&amp;quot;: {
            &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,
            &amp;quot;Options&amp;quot;: null,
            &amp;quot;Config&amp;quot;: [
                {
                    &amp;quot;Subnet&amp;quot;: &amp;quot;172.18.0.0/16&amp;quot;,
                    &amp;quot;Gateway&amp;quot;: &amp;quot;172.18.0.1&amp;quot;
                }
            ]
        },
        &amp;quot;Internal&amp;quot;: false,
        &amp;quot;Attachable&amp;quot;: true,
        &amp;quot;Ingress&amp;quot;: false,
        &amp;quot;ConfigFrom&amp;quot;: {
            &amp;quot;Network&amp;quot;: &amp;quot;&amp;quot;
        },
        &amp;quot;ConfigOnly&amp;quot;: false,
        &amp;quot;Containers&amp;quot;: {
            &amp;quot;2838f5586c735894051498c8ed0e5e103209cd22ee5718cbb29e8c6d169c9bf8&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;downloads_db_1&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;10033e064387892253d69ac5813be6bc820a95df1a3e19f84eff99a8d55af1bd&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:12:00:02&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.18.0.2/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            },
            &amp;quot;f68265cd6219fb60491c7ebbdae2d7f4c5ea4a74aec9987f5a5082c13b1ec025&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;downloads_wordpress_1&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;a4a673479ab3d812713955d461cc4d7032aba3806b49f50dd783a8083588aec5&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:12:00:03&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.18.0.3/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            }
        },
        &amp;quot;Options&amp;quot;: {},
        &amp;quot;Labels&amp;quot;: {
            &amp;quot;com.docker.compose.network&amp;quot;: &amp;quot;default&amp;quot;,
            &amp;quot;com.docker.compose.project&amp;quot;: &amp;quot;downloads&amp;quot;,
            &amp;quot;com.docker.compose.version&amp;quot;: &amp;quot;1.27.4&amp;quot;
        }
    }
]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the container sections, you can see that two containers (&lt;code&gt;downloads_db_1&lt;/code&gt; and &lt;code&gt;downloads_wordpress_1&lt;/code&gt;) are attached to the default &lt;code&gt;downloads_default&lt;/code&gt; network driver, which is the bridge type. Run the following commands to clean up everything:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker-compose down
Stopping downloads_wordpress_1 ... done
Stopping downloads_db_1        ... done
Removing downloads_wordpress_1 ... done
Removing downloads_db_1        ... done
Removing network downloads_default&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can observe that the network created by Compose is deleted, too:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker-compose down -v
Removing network downloads_default
WARNING: Network downloads_default not found.
Removing volume downloads_db_data&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The volume created earlier is deleted, and since the network is already deleted after running the previous command, it shows a warning that the default network is not found. That’s fine.&lt;/p&gt;
&lt;p&gt;The example we’ve looked at so far covers the default network created by Compose, but what if we want to create our custom network and connect services to it? You will define the user-defined networks using the Compose file. The following is the &lt;code&gt;docker-compose&lt;/code&gt; YAML file:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;version: &amp;#39;3.7&amp;#39;
services:
  db:
    image: mysql:8.0.19
    command: &amp;#39;--default-authentication-plugin=mysql_native_password&amp;#39;
    restart: always
    volumes:
      - db_data:/var/lib/mysql
    restart: always
    networks:
      - mynetwork
    environment:
      - MYSQL_ROOT_PASSWORD=somewordpress
      - MYSQL_DATABASE=wordpress
      - MYSQL_USER=wordpress
      - MYSQL_PASSWORD=wordpress
  wordpress:
    image: wordpress:latest
    ports:
      - 80:80
    networks:
      - mynetwork
    restart: always
    environment:
      - WORDPRESS_DB_HOST=db
      - WORDPRESS_DB_USER=wordpress
      - WORDPRESS_DB_PASSWORD=wordpress
      - WORDPRESS_DB_NAME=wordpress
volumes:
  db_data:
networks:
  mynetwork:&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I’ve defined a user-defined network under the top-level networks section at the end of the file and called the network &lt;code&gt;mynetwork&lt;/code&gt;. It’s a bridge type, meaning it’s a network on the host machine separated from the rest of the host network stack. Following each service, I added the network key to specify that these services should connect to &lt;code&gt;mynetwork&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Let’s bring up the services again after the changing the Docker Compose YAML file:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker-compose up -d                    
Creating network &amp;quot;downloads_mynetwork&amp;quot; with the default driver
Creating volume &amp;quot;downloads_db_data&amp;quot; with default driver
Creating downloads_wordpress_1 ... done
Creating downloads_db_1        ... done&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see, Docker Compose has created the new custom &lt;code&gt;mynetwork&lt;/code&gt;, started the containers, and connected them to the custom network. You can inspect it by using the Docker inspect command:&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;&lt;code&gt;$ docker network inspect downloads_mynetwork
[
    {
        &amp;quot;Name&amp;quot;: &amp;quot;downloads_mynetwork&amp;quot;,
        &amp;quot;Id&amp;quot;: &amp;quot;cb24ed3832dfdd34ca6fdcfcf0065c8e0df6b9b72f7b29a2aaada74970835dd1&amp;quot;,
        &amp;quot;Created&amp;quot;: &amp;quot;2021-03-05T04:23:14.354570267Z&amp;quot;,
        &amp;quot;Scope&amp;quot;: &amp;quot;local&amp;quot;,
        &amp;quot;Driver&amp;quot;: &amp;quot;bridge&amp;quot;,
        &amp;quot;EnableIPv6&amp;quot;: false,
        &amp;quot;IPAM&amp;quot;: {
            &amp;quot;Driver&amp;quot;: &amp;quot;default&amp;quot;,
            &amp;quot;Options&amp;quot;: null,
            &amp;quot;Config&amp;quot;: [
                {
                    &amp;quot;Subnet&amp;quot;: &amp;quot;172.19.0.0/16&amp;quot;,
                    &amp;quot;Gateway&amp;quot;: &amp;quot;172.19.0.1&amp;quot;
                }
            ]
        },
        &amp;quot;Internal&amp;quot;: false,
        &amp;quot;Attachable&amp;quot;: true,
        &amp;quot;Ingress&amp;quot;: false,
        &amp;quot;ConfigFrom&amp;quot;: {
            &amp;quot;Network&amp;quot;: &amp;quot;&amp;quot;
        },
        &amp;quot;ConfigOnly&amp;quot;: false,
        &amp;quot;Containers&amp;quot;: {
            &amp;quot;334bd5bf1689b067fa24705af0b6ab444976b288d25846349ce5b8f6914d8c19&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;downloads_wordpress_1&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;10674d2ddd9feb67c98e3c08fcf451f32bda58e96c9c256aee70a0487f6a4496&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:13:00:03&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.19.0.3/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            },
            &amp;quot;9ffc94adab6896620648a1d08d215ba3d9423fee934b905b7bc2a44dd30bd74c&amp;quot;: {
                &amp;quot;Name&amp;quot;: &amp;quot;downloads_db_1&amp;quot;,
                &amp;quot;EndpointID&amp;quot;: &amp;quot;927943a0202bfb69692bc172a5c26e05676df6961236596eba3c3464cacbd1ab&amp;quot;,
                &amp;quot;MacAddress&amp;quot;: &amp;quot;02:42:ac:13:00:02&amp;quot;,
                &amp;quot;IPv4Address&amp;quot;: &amp;quot;172.19.0.2/16&amp;quot;,
                &amp;quot;IPv6Address&amp;quot;: &amp;quot;&amp;quot;
            }
        },
        &amp;quot;Options&amp;quot;: {},
        &amp;quot;Labels&amp;quot;: {
            &amp;quot;com.docker.compose.network&amp;quot;: &amp;quot;mynetwork&amp;quot;,
            &amp;quot;com.docker.compose.project&amp;quot;: &amp;quot;downloads&amp;quot;,
            &amp;quot;com.docker.compose.version&amp;quot;: &amp;quot;1.27.4&amp;quot;
        }
    }
]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Inspecting the network, you can see there are now two containers connected to the custom network.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In this article, we’ve covered the what and how of Docker networking in detail, starting with Docker’s network drivers available out-of-the-box and then some advanced concepts such as overlay and macvlan. We ran through some examples of the most common Docker network commands, and then discussed some common use cases and general pitfalls of the available network drivers. We also covered port publishing, which allows the outside world to connect with containers, and how Docker resolves DNS names. Finally, we explored Docker Compose networking with some examples.&lt;/p&gt;
&lt;p&gt;That should provide you with a decent overview of how Docker networking provides different modes of network drivers so that your containers can communicate on a single or multi-host setup. With this knowledge, you can pick and choose a network driver that fits your use case.&lt;/p&gt;</content><author><name>Ashish Choudhary</name></author><category term="Tutorials" /><summary type="html">Docker is the de facto model for building and running containers at scale in most enterprise organizations today. At a very high level, Docker is a combination of CLI and a daemon process that solves common software problems like installing, publishing, removing, and managing containers. It’s perfect for microservices, where you have many services handling a typical business functionality; Docker makes the packaging easier, enabling you to encapsulate those services in containers.</summary></entry><entry><title type="html">Green Vs. Brown Programming Languages</title><link href="https://earthly.dev/blog/brown-green-language/" rel="alternate" type="text/html" title="Green Vs. Brown Programming Languages" /><published>2021-04-22T00:00:00-04:00</published><updated>2021-04-22T00:00:00-04:00</updated><id>https://earthly.dev/blog/brown-green-language</id><content type="html" xml:base="https://earthly.dev/blog/brown-green-language/">&lt;h2 id=&quot;the-data&quot;&gt;The Data&lt;/h2&gt;
&lt;p&gt;The Stack Overflow Developer Survey&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; results are a great source of information about how developers work. I was looking at the 2020 results for some ideas on what programming languages we should add to our &lt;a href=&quot;https://docs.earthly.dev/basics/part-1-a-simple-earthfile&quot;&gt;documentation&lt;/a&gt; on containerized builds, and I noticed something interesting about the types of programming languages people like. It’s something that doesn’t seem to come up in various discussions of programming language preferences.&lt;/p&gt;
&lt;p&gt;The survey results have rankings for &lt;strong&gt;The Most Dreaded Programming Languages&lt;/strong&gt; and &lt;strong&gt;The Most Loved Programming Langauge&lt;/strong&gt;. Both rankings come from this question:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Which programming, scripting, and markup languages have you done extensive development work in over the past year, and which do you want to work in over the next year? (If you both worked with the language and want to continue to do so, please check both boxes in that row.)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A dreaded language is one you work with extensively in the current year but don’t want to continue to use. A loved language you use extensively and wish to continue using. The results are interesting because they reflect the opinions of people who are using the languages extensively. There should be no I-heard-X-is-cool effect, where people rank highly things they don’t use because they heard it is the new hotness. The inverse should also be true: People who put something on the &lt;strong&gt;Dreaded&lt;/strong&gt; list are using it. They are not dreading a language because they heard it was complex, but because they have to work it and feel real pain.&lt;/p&gt;
&lt;div class=&quot;notice--warning notice--big&quot;&gt;
&lt;p&gt;&lt;strong&gt;The TOP 15 Dreaded Programming Languages:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;VBA, Objective-C, Perl, Assembly, C, PHP, Ruby, C++, Java, R, Haskell, Scala, HTML, Shell, and SQL.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;notice--success notice--big&quot;&gt;
&lt;p&gt;&lt;strong&gt;The TOP 15 Loved Programming Languages:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Rust, TypeScript, Python, Kotlin, Go, Julia, Dart, C#, Swift, JavaScript, SQL, Shell, HTML, Scala, and Haskell.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;There is a pattern in this list. Can you see what it is?&lt;/p&gt;
&lt;h2 id=&quot;code-written-before-i-joined-is-the-worst&quot;&gt;Code Written Before I Joined Is the Worst&lt;/h2&gt;
&lt;p&gt;Old code is the worst. Find me a file in a codebase that has been under active development for more than three years, and it will be hard to follow. What starts as a straightforward file access layer develops special cases and performance optimizations and various branches controlled by configuration options. Real-world code evolves to fits its niche, and as it does so, it becomes more complex and harder to understand. The reason for this is simple, and I first heard about it from Joel Spolsky.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The reason that [ developers ] think the old code is a mess is because of a cardinal, fundamental law of programming: &lt;strong&gt;It’s harder to read code than to write it.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Joel Spolsky - &lt;a href=&quot;https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/&quot;&gt;Things you should never do&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Let’s call this Joel’s Law. A lot of things follow from this premise. Why do most developers think the code they inherited is a mess and want to throw it out and start again? It’s because writing something new is cognitively less demanding than the hard work of understanding an existing codebase, at least initially. Why are many rewrites doomed to fail? Because much of what makes the code seem messy are vital little improvements that accreted over time. Without some plan for simplifying them, you will end up back where you started.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/brown-green-language/dt140812.gif&quot; alt=&quot;Scott Adams Understood&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Scott Adams Understood&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;It’s easy to understand code as you are writing it. You are executing it and refining it as you go. But it’s hard to understand code just by reading it after the fact. If you return to old code you wrote and find it hard to follow, it could be because you have grown as a developer and would write it better today. But its also possible that the code is inherently complex, and you are interpreting the pain of understanding that complexity as a code quality problem. Could this be why growing PR backlogs are a persistent problem? PR Reviews are a read-only activity, and they are hard to do well if you don’t already have a working model of the code in your head.&lt;/p&gt;
&lt;h2 id=&quot;this-is-why-you-dread-it&quot;&gt;This is Why You Dread It&lt;/h2&gt;
&lt;p&gt;If much real-world code is unfairly considered a mess, could programming languages also be unfairly judged? If you build new things in Go but have to maintain a sprawling 20-year-old C++ codebase, can you rank them fairly? I think this is actually what the survey question is measuring: dreaded languages are likely to be used in existing brown-field projects. Loved languages are more often used in new green-field projects. Let’s test this.&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;measuring-brown-vs.-green-languages&quot;&gt;Measuring Brown vs. Green Languages&lt;/h2&gt;
&lt;p&gt;The TIOBE index claims to measure “the number of skilled engineers, courses and jobs worldwide” for programming languages. There are probably some problems with how they measure this, but it’s accurate enough for our purposes. We use the July 2016 TIOBE &lt;a href=&quot;https://web.archive.org/web/20160801213334/https://www.tiobe.com/tiobe-index/&quot;&gt;index&lt;/a&gt;, the oldest available in way back machine, as a proxy for a language having accumulated lots of code to maintain. If something was big in 2016, it’s more likely people are maintaining code written in it than if it wasn’t popular in 2016.&lt;/p&gt;
&lt;p&gt;The top 20 programming languages on their list as of July 2016 are Java, C, C++, Python, C#, PHP, JavaScript, VB.NET, Perl, Assembly, Ruby, Pascal, Swift, Objective-C, MATLAB, R, SQL, COBOL, and Groovy. We can use this as our list of languages more likely to be used in maintenance work. Let’s call them brown languages. Languages not in the top 20 in 2016 are more likely to be used in new projects. We will refer to these as green languages.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/assets/images/brown-green-language/graph1.svg&quot; alt=&quot;Out of 22 Languages in the combined dreaded/loved list, 63% are Brown&quot; /&gt; &lt;!-- ```
import matplotlib.pyplot as plt

labels = 'Brown', 'Green'
dreaded_sizes = [10, 2]
overall_languages = [14, 8]
overall_total = 22
dreaded_total = 12
loved_sizes = [6, 7]
loved_total = 13
explode = (0.1, 0)
colors = [&quot;burlywood&quot;, &quot;green&quot;]

fig, ax1 = plt.subplots()
ax1.set_title('Green Vs Brown')
ax1.pie(overall_languages, explode=explode, labels=labels, 
        autopct=lambda p: '{:.0f}'.format(p * overall_total / 100),
        shadow=True, 
        startangle=90, 
        colors=colors)
ax1.axis('equal') 

``` --&gt;&lt;/p&gt;
&lt;figcaption&gt;
Out of 22 Languages in the combined dreaded/loved list, 63% are Brown
&lt;/figcaption&gt;
&lt;div class=&quot;notice--warning notice--big&quot;&gt;
&lt;p&gt;&lt;strong&gt;Brown Language:&lt;/strong&gt; A language that you are more likely to use in existing software maintenance (i.e. brown-field projects).&lt;/p&gt;
&lt;p&gt;Java, C, C++, C#, Python, PHP, JavaScript, Swift, Perl, Ruby, Assembly, R, Objective-C, SQL&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;notice--success notice--big&quot;&gt;
&lt;p&gt;&lt;strong&gt;Green Language:&lt;/strong&gt; A language that you are more likely to use in a new project (i.e. a green-field project).&lt;/p&gt;
&lt;p&gt;Go, Rust, TypeScript, Kotlin, Julia, Dart, Scala, and Haskell&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;TIOBE and StackOverflow have different ideas of what a programming language is. To overcome this, we have to normalize the two lists by removing HTML/CSS, Shell Scripts, and VBA.&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;Removed Language:&lt;/strong&gt; Not measured the same by TIOBE and StackOverflow&lt;/p&gt;
&lt;p&gt;VBA, Shell, HTML/CSS&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;There are many nuances that a simple green / brown split misses - I expect that more green-field projects start with Swift than with Objective-C, but it does seem sufficient to capture what we need. There are far more brown languages in this list than green, but that is what I would expect given that year-on-year turn-over in programming languages is relatively low.&lt;/p&gt;
&lt;p&gt;Now we can answer the question: Do people love and dread the languages they state or are they just dreading legacy code? Or to put it another way: If Java and Ruby appeared today, without piles of old rails apps and old enterprise Java applications to maintain, would they still be dreaded or would they be more likely to show up on the loved list?&lt;/p&gt;
&lt;h2 id=&quot;the-dreaded-brown-programming-languages&quot;&gt;The Dreaded Brown Programming Languages&lt;/h2&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/brown-green-language/graph2.svg&quot; alt=&quot;Dreaded Languages: 83% Brown&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Dreaded Languages: 83% Brown&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;!-- ```
import matplotlib.pyplot as plt

labels = 'Brown', 'Green'
dreaded_sizes = [10, 2]
overall_languages = [14, 8]
overall_total = 22
dreaded_total = 12
loved_sizes = [6, 7]
loved_total = 13
explode = (0.1, 0)
colors = [&quot;burlywood&quot;, &quot;green&quot;]

# Graph one
fig, ax1 = plt.subplots()
ax1.set_title('Dreaded Languages')
ax1.pie(dreaded_sizes, explode=explode, labels=labels, 
        autopct=lambda p: '{:.0f}'.format(p * dreaded_total / 100),
        shadow=True, 
        startangle=90, 
        colors=colors)
ax1.axis('equal') 

```
&lt;figcaption&gt;
Dreaded Languages: 83% Brown
&lt;/figcaption&gt; --&gt;
&lt;p&gt;The Top Dreaded languages are almost all are brown languages. 68% of the languages in our complete list are brown, while 83% of the dreaded languages are brown, which is higher than we would expect by chance.&lt;/p&gt;
&lt;h2 id=&quot;the-loved-green-programming-languages&quot;&gt;The Loved Green Programming Languages&lt;/h2&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/brown-green-language/graph3.svg&quot; alt=&quot;Loved Languages 54% Green&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Loved Languages 54% Green&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;!-- ```
import matplotlib.pyplot as plt

labels = 'Brown', 'Green'
dreaded_sizes = [10, 2]
loved_sizes = [5, 8]
explode = (0.1, 0)
colors = [&quot;burlywood&quot;, &quot;green&quot;]
total = 13


# Graph two
fig, ax2 = plt.subplots()
ax2.set_title('Loved Languages')
ax2.pie(loved_sizes, explode=explode, labels=labels, 
        autopct=lambda p: '{:.0f}'.format(p * total / 100),
        shadow=True, 
        startangle=90, 
        colors=colors)
ax2.axis('equal') 

```
&lt;figcaption&gt;
Loved Languages 54% Green
&lt;/figcaption&gt; --&gt;
&lt;p&gt;In the top loved languages, 54% are green. Only 36% of the languages in our list are green, and every single green language showed up somewhere in the loved list.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Another flaw in the human character is that everybody wants to build and nobody wants to do maintenance.&lt;/p&gt;
&lt;p&gt;― Kurt Vonnegut&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This probably isn’t quite enough evidence to say for sure that having to use a language in a maintenance project causes dread, but it certainly looks like it is a factor. Many of the languages people love are too new or too historically unpopular to have many big big-ball-of-mud projects to maintain.&lt;/p&gt;
&lt;p&gt;In other words, Rust, Kotlin, and the other green languages may still be in a honeymoon phase. People’s love for working with them may have as much to do with not working in 20-year-old codebases as it does with the particular languages.&lt;/p&gt;
&lt;h2 id=&quot;overcoming-bias&quot;&gt;Overcoming Bias&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/brown-green-language/angel-devil-wide-600-402d4be31.png&quot; srcset=&quot;/blog/generated/assets/images/brown-green-language/angel-devil-wide-400-402d4be31.png 400w, /blog/generated/assets/images/brown-green-language/angel-devil-wide-600-402d4be31.png 600w&quot;&gt;&lt;/p&gt;
&lt;p&gt;Some newer or historically less popular programming languages might be better than older or more mainstream languages, but our ability to judge seems quite biased. In particular, developers are giving a halo to languages that are newer or were not used commonly in the past, and they are giving horns to languages that have been around longer. I think this is because nobody likes maintaining someone else’s code. And also, because of Joel’s Law: reading real-world is code hard. Building something new is fun, and new languages are used for that more often.&lt;/p&gt;
&lt;h2 id=&quot;the-lifecycle-of-programming-language-hype&quot;&gt;The Lifecycle of Programming Language Hype&lt;/h2&gt;
&lt;p&gt;I originally started digging into these numbers to establish a ranking for what languages were most used and loved by software developers. I was going to use this to guide adding more examples to our &lt;a href=&quot;https://docs.earthly.dev/&quot;&gt;docs&lt;/a&gt; and our &lt;a href=&quot;https://github.com/earthly/earthly/tree/main/examples&quot;&gt;build examples&lt;/a&gt;. What I came away with instead was the idea of a programming language life cycle: loved programming languages get used a lot, which leads to code maintenance, which causes people to dislike them, which leads to people looking for greener pastures and trying out a newer language. Popular frameworks probably follow this lifecycle as well.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/brown-green-language/hype-wide-800-83ae14a13.png&quot; alt=&quot;A graph showing hype decreasing overtime for a langauge&quot; srcset=&quot;/blog/generated/assets/images/brown-green-language/hype-wide-400-83ae14a13.png 400w, /blog/generated/assets/images/brown-green-language/hype-wide-600-83ae14a13.png 600w, /blog/generated/assets/images/brown-green-language/hype-wide-800-83ae14a13.png 800w, /blog/generated/assets/images/brown-green-language/hype-wide-900-83ae14a13.png 900w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
The lifecycle of programming language hype
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;I don’t have data for this, but I distinctly remember Ruby being the hottest language back in 2007, and although it does have more competition today, Ruby is a better language now than it was then. Yet now it is dreaded. Part of the difference, it seems to me, is that now people have 14 years’ worth of rails apps to maintain. That makes Ruby is a lot less fun than when it was all new projects. So watch out Rust and Kotlin and Julia and Go: you too will eventually lose your halo.&lt;a href=&quot;#fn4&quot; class=&quot;footnote-ref&quot; id=&quot;fnref4&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;4&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;section class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;2020 &lt;a href=&quot;https://insights.stackoverflow.com/survey/2020&quot;&gt;Graphical&lt;/a&gt; and &lt;a href=&quot;https://drive.google.com/file/d/1dfGerWeWkcyQ9GX9x20rdSGj7WtEpzBB/view&quot;&gt;Raw&lt;/a&gt; results.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;I came up with the criteria first. I didn’t hunt for data to back up my original idea.&lt;/p&gt;
&lt;p&gt;I did consider using language creation date to determine green vs. brown status, but some languages have been around for some time but only found usage relatively recently.&lt;/p&gt;
&lt;p&gt;TIOBE is measured like &lt;a href=&quot;https://www.tiobe.com/tiobe-index/programming-languages-definition/&quot;&gt;this&lt;/a&gt; and their historical data is only available if you pay, so I am using the Wayback Machine.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;TIOBE doesn’t include HTML/CSS because it doesn’t consider them turning complete and therefore not a programming language. Shell scripts are measured separately by TIOBE, and VBA is not in the list of languages measured at all, as far as I can see.&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn4&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;Not all brown languages are dreaded however: Python, C#, Swift, JavaScript and SQL remain loved and I would love to hear if anyone has theories on why. Also Scala and Haskell, two languages I have a soft spot for, are the only green languages on the dreaded list. Is this just noise or is there something else going on there?&lt;a href=&quot;#fnref4&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Articles" /><summary type="html">I've noticed something interesting about the types of programming languages people like. It's something that doesn't seem to come up in various discussions of programming language preferences.</summary></entry><entry><title type="html">Building a Real-Time Application in the Phoenix Framework with Elixir</title><link href="https://earthly.dev/blog/real-time-phoenix-elixir/" rel="alternate" type="text/html" title="Building a Real-Time Application in the Phoenix Framework with Elixir" /><published>2021-04-21T00:00:00-04:00</published><updated>2021-04-21T00:00:00-04:00</updated><id>https://earthly.dev/blog/real-time-phoenix-elixir</id><content type="html" xml:base="https://earthly.dev/blog/real-time-phoenix-elixir/">&lt;p&gt;The Elixir language, along with the &lt;a href=&quot;https://phoenixframework.org/&quot;&gt;Phoenix framework&lt;/a&gt;, has been growing in popularity at a quick pace, and with good reason. Phoenix offers productivity levels comparable to frameworks like Ruby on Rails while being one of the &lt;a href=&quot;https://github.com/mroth/phoenix-showdown/blob/master/RESULTS_v3.md&quot;&gt;fastest web frameworks&lt;/a&gt; available.&lt;/p&gt;
&lt;p&gt;If you’re currently working with a web framework like Ruby on Rails or even Laravel, you should definitely give Phoenix some attention due to the performance gains it promises. Additionally, Phoenix also has the capability to build highly responsive real-time applications.&lt;/p&gt;
&lt;h2 id=&quot;introducing-phoenix-liveview&quot;&gt;Introducing Phoenix LiveView&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/phoenixframework/phoenix_live_view&quot;&gt;Phoenix LiveView&lt;/a&gt; is a relatively new library added to the Phoenix stack. Developers can build rich, real-time user experience with purely server-rendered HTML.&lt;/p&gt;
&lt;p&gt;Phoenix LiveView adds bi-directional communication via WebSockets between the server and the client, without needing dedicated JavaScript code on the frontend. This allows you to implement real-time functionality on your applications with ease.&lt;/p&gt;
&lt;h2 id=&quot;explaining-todays-tutorial&quot;&gt;Explaining Today’s Tutorial&lt;/h2&gt;
&lt;p&gt;For this tutorial, we are going to be building a crowdfunding application that will leverage the real-time capabilities of Phoenix LiveView. Our application will allow users to support a funding goal in real-time and see the funding goal update as other users also commit to a specific amount. We’ll call it Phoenix Fund.&lt;/p&gt;
&lt;p&gt;The goal of this application is not to build a fully-featured crowdfunding platform but to get your feet wet with LiveView:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How LiveView views works and renders&lt;/li&gt;
&lt;li&gt;How Phoenix leverages WebSockets for communication&lt;/li&gt;
&lt;li&gt;How to implement real-time updates on your application&lt;/li&gt;
&lt;li&gt;How the LiveView life cycle works&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here’s a sample of how the final application will work:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/q0L1xth.gif&quot; alt=&quot;The Crowdfunding App&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;The Crowdfunding App&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2 id=&quot;prebuild-setup&quot;&gt;Prebuild Setup&lt;/h2&gt;
&lt;p&gt;For this tutorial, make sure you have a good working Elixir environment. The easiest way to do this is to follow the &lt;a href=&quot;https://elixir-lang.org/install.html&quot;&gt;official Elixir instructions&lt;/a&gt;, which will give you a couple of options for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Local installation on Linux, Windows, and macOS&lt;/li&gt;
&lt;li&gt;Dockerized versions of Elixir&lt;/li&gt;
&lt;li&gt;Package manager versions setups&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I would recommend focusing on the local install for this tutorial, as it might be the easiest one to get started. Additionally, you will need to have &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;npm&lt;/a&gt; installed locally and a running version of PostgreSQL.&lt;/p&gt;
&lt;h3 id=&quot;npm&quot;&gt;npm&lt;/h3&gt;
&lt;p&gt;You can easily install Node.js from their &lt;a href=&quot;https://nodejs.org/en/&quot;&gt;official instructions&lt;/a&gt;, but in most cases, it’s possible your system might already have Node preinstalled.&lt;/p&gt;
&lt;h3 id=&quot;postgres&quot;&gt;Postgres&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.postgresql.org/&quot;&gt;Postgres&lt;/a&gt; can be a little tricky to install depending on the operating system you’re using. For this tutorial, you can leverage Docker and get a local version running by taking the following steps:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Create a folder to persist the DB data.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; mkdir &lt;span class=&quot;va&quot;&gt;${HOME}&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;/phoenix-postgres-data/&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Run a Docker container with the Postgres image.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker run &lt;span class=&quot;at&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;at&quot;&gt;--name&lt;/span&gt; phoenix-psql &lt;span class=&quot;dt&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;at&quot;&gt;-e&lt;/span&gt; POSTGRES_PASSWORD=Phoenix1234 &lt;span class=&quot;dt&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;at&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;${HOME}&lt;/span&gt;/phoenix-postgres-data/:/var/lib/postgresql/data &lt;span class=&quot;dt&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;at&quot;&gt;-p&lt;/span&gt; 5432:5432 &lt;span class=&quot;dt&quot;&gt;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    postgres&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Validate that the container is running.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; docker &lt;span class=&quot;fu&quot;&gt;ps&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;CONTAINER&lt;/span&gt; ID   IMAGE      COMMAND                  CREATED         STATUS        PORTS                                  NAMES&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;11cbe1d2bc2f&lt;/span&gt;   postgres   &lt;span class=&quot;st&quot;&gt;&amp;quot;docker-entrypoint.s…&amp;quot;&lt;/span&gt;   6 seconds ago   Up 5 seconds  5432/tcp, 0.0.0.0:5432-&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;5432/tcp       phoenix-psql&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;I&lt;/span&gt; can&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;that&lt;/span&gt; was&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;4&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Validate PostgreSQL is up and running.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; docker &lt;span class=&quot;bu&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-it&lt;/span&gt; phoenix-psql bash&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;root@11cbe1d2bc2f:/#&lt;/span&gt; psql &lt;span class=&quot;at&quot;&gt;-h&lt;/span&gt; localhost &lt;span class=&quot;at&quot;&gt;-U&lt;/span&gt; postgres&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;psql&lt;/span&gt; &lt;span class=&quot;er&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;13.2&lt;/span&gt; &lt;span class=&quot;er&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;Debian&lt;/span&gt; 13.2-1.pgdg100+1&lt;span class=&quot;kw&quot;&gt;))&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;help&amp;quot;&lt;/span&gt; for help.&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;va&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;# &lt;span class=&quot;ex&quot;&gt;\l&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-9&quot;&gt;&lt;a href=&quot;#cb4-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;                                 &lt;span class=&quot;ex&quot;&gt;List&lt;/span&gt; of databases&lt;/span&gt;
&lt;span id=&quot;cb4-10&quot;&gt;&lt;a href=&quot;#cb4-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;ex&quot;&gt;Name&lt;/span&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;ex&quot;&gt;Owner&lt;/span&gt;   &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;Encoding&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;ex&quot;&gt;Collate&lt;/span&gt;   &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;ex&quot;&gt;Ctype&lt;/span&gt;    &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;ex&quot;&gt;Access&lt;/span&gt; privileges   &lt;/span&gt;
&lt;span id=&quot;cb4-11&quot;&gt;&lt;a href=&quot;#cb4-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;-----------+----------+----------+------------+------------+-----------------------&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-12&quot;&gt;&lt;a href=&quot;#cb4-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;ex&quot;&gt;postgres&lt;/span&gt;  &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;postgres&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;UTF8&lt;/span&gt;     &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;en_US.utf8&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;en_US.utf8&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;setting-up-phoenix&quot;&gt;Setting Up Phoenix&lt;/h2&gt;
&lt;p&gt;Now that you have the necessary dependencies, go ahead and install the Phoenix application generator and create your first Phoenix app. The Phoenix generator is distributed as a &lt;code&gt;mix archive&lt;/code&gt; and can be installed by running the following command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; mix &lt;span class=&quot;ex&quot;&gt;archive.&lt;/span&gt; install hex phx_new 1.5.8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;mix-archives&quot;&gt;Mix Archives&lt;/h3&gt;
&lt;p&gt;Mix archives are essentially &lt;code&gt;.zip&lt;/code&gt; files of an Elixir project following the &lt;a href=&quot;http://erlang.org/doc/man/code.html&quot;&gt;Erlang Archive Format&lt;/a&gt;. Simply put, archives give us a way to distribute projects and use them as a regular command tool.&lt;/p&gt;
&lt;h3 id=&quot;creating-a-new-project&quot;&gt;Creating a New Project&lt;/h3&gt;
&lt;p&gt;Now that the Phoenix archive is installed locally if you run &lt;code&gt;mix help&lt;/code&gt;, you should see a new set of mix commands available in your system:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx                   &lt;span class=&quot;co&quot;&gt;# Prints Phoenix help information&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.digest            &lt;span class=&quot;co&quot;&gt;# Digests and compresses static files&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.digest.clean      &lt;span class=&quot;co&quot;&gt;# Removes old versions of static assets&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.cert          &lt;span class=&quot;co&quot;&gt;# Generates a self-signed certificate for HTTPS testing&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.channel       &lt;span class=&quot;co&quot;&gt;# Generates a Phoenix channel&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.context       &lt;span class=&quot;co&quot;&gt;# Generates a context with functions around an Ecto schema&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-7&quot;&gt;&lt;a href=&quot;#cb6-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.embedded      &lt;span class=&quot;co&quot;&gt;# Generates an embedded Ecto schema file&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-8&quot;&gt;&lt;a href=&quot;#cb6-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.html          &lt;span class=&quot;co&quot;&gt;# Generates controller, views, and context for an HTML resource&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-9&quot;&gt;&lt;a href=&quot;#cb6-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.json          &lt;span class=&quot;co&quot;&gt;# Generates controller, views, and context for a JSON resource&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-10&quot;&gt;&lt;a href=&quot;#cb6-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.live          &lt;span class=&quot;co&quot;&gt;# Generates LiveView, templates, and context for a resource&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-11&quot;&gt;&lt;a href=&quot;#cb6-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.presence      &lt;span class=&quot;co&quot;&gt;# Generates a Presence tracker&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-12&quot;&gt;&lt;a href=&quot;#cb6-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.schema        &lt;span class=&quot;co&quot;&gt;# Generates an Ecto schema and migration file&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-13&quot;&gt;&lt;a href=&quot;#cb6-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.gen.secret        &lt;span class=&quot;co&quot;&gt;# Generates a secret&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-14&quot;&gt;&lt;a href=&quot;#cb6-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.new               &lt;span class=&quot;co&quot;&gt;# Creates a new Phoenix v1.5.4 application&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-15&quot;&gt;&lt;a href=&quot;#cb6-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.new.ecto          &lt;span class=&quot;co&quot;&gt;# Creates a new Ecto project within an umbrella project&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-16&quot;&gt;&lt;a href=&quot;#cb6-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.new.web           &lt;span class=&quot;co&quot;&gt;# Creates a new Phoenix web project within an umbrella project&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-17&quot;&gt;&lt;a href=&quot;#cb6-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.routes            &lt;span class=&quot;co&quot;&gt;# Prints all routes&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-18&quot;&gt;&lt;a href=&quot;#cb6-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.server            &lt;span class=&quot;co&quot;&gt;# Starts applications and their servers&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Running &lt;code&gt;mix phx.new&lt;/code&gt; from any directory will create a new Phoenix application. But before you dive in, it’s crucial that you understand the options available when making a Phoenix project. Let’s take a look by running the following command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; mix &lt;span class=&quot;bu&quot;&gt;help&lt;/span&gt; phx.new&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-3&quot;&gt;&lt;a href=&quot;#cb7-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-4&quot;&gt;&lt;a href=&quot;#cb7-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-5&quot;&gt;&lt;a href=&quot;#cb7-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--live&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; include Phoenix.LiveView to make it easier than ever to build&lt;/span&gt;
&lt;span id=&quot;cb7-6&quot;&gt;&lt;a href=&quot;#cb7-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;interactive,&lt;/span&gt; real-time applications&lt;/span&gt;
&lt;span id=&quot;cb7-7&quot;&gt;&lt;a href=&quot;#cb7-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--umbrella&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; generate an umbrella project, with one application for&lt;/span&gt;
&lt;span id=&quot;cb7-8&quot;&gt;&lt;a href=&quot;#cb7-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;your&lt;/span&gt; domain and a second application for the web interface&lt;/span&gt;
&lt;span id=&quot;cb7-9&quot;&gt;&lt;a href=&quot;#cb7-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--app&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; the name of the OTP application&lt;/span&gt;
&lt;span id=&quot;cb7-10&quot;&gt;&lt;a href=&quot;#cb7-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--module&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; the name of the base module in the generated skeleton&lt;/span&gt;
&lt;span id=&quot;cb7-11&quot;&gt;&lt;a href=&quot;#cb7-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--database&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; specify the database adapter for Ecto. One of:&lt;/span&gt;
&lt;span id=&quot;cb7-12&quot;&gt;&lt;a href=&quot;#cb7-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; postgres &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; via https://github.com/elixir-ecto/postgrex&lt;/span&gt;
&lt;span id=&quot;cb7-13&quot;&gt;&lt;a href=&quot;#cb7-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; mysql &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; via https://github.com/elixir-ecto/myxql&lt;/span&gt;
&lt;span id=&quot;cb7-14&quot;&gt;&lt;a href=&quot;#cb7-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; mssql &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; via https://github.com/livehelpnow/tds&lt;/span&gt;
&lt;span id=&quot;cb7-15&quot;&gt;&lt;a href=&quot;#cb7-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-16&quot;&gt;&lt;a href=&quot;#cb7-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;Please&lt;/span&gt; check the driver docs for more information and requirements.&lt;/span&gt;
&lt;span id=&quot;cb7-17&quot;&gt;&lt;a href=&quot;#cb7-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;Defaults&lt;/span&gt; to &lt;span class=&quot;st&quot;&gt;&amp;quot;postgres&amp;quot;&lt;/span&gt;.&lt;/span&gt;
&lt;span id=&quot;cb7-18&quot;&gt;&lt;a href=&quot;#cb7-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-19&quot;&gt;&lt;a href=&quot;#cb7-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--no-webpack&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; do not generate webpack files for static asset building.&lt;/span&gt;
&lt;span id=&quot;cb7-20&quot;&gt;&lt;a href=&quot;#cb7-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;When&lt;/span&gt; choosing this option, you will need to manually handle JavaScript&lt;/span&gt;
&lt;span id=&quot;cb7-21&quot;&gt;&lt;a href=&quot;#cb7-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ex&quot;&gt;dependencies&lt;/span&gt; if building HTML apps&lt;/span&gt;
&lt;span id=&quot;cb7-22&quot;&gt;&lt;a href=&quot;#cb7-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--no-ecto&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; do not generate Ecto files&lt;/span&gt;
&lt;span id=&quot;cb7-23&quot;&gt;&lt;a href=&quot;#cb7-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--no-html&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; do not generate HTML views&lt;/span&gt;
&lt;span id=&quot;cb7-24&quot;&gt;&lt;a href=&quot;#cb7-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--no-gettext&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; do not generate gettext files&lt;/span&gt;
&lt;span id=&quot;cb7-25&quot;&gt;&lt;a href=&quot;#cb7-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--no-dashboard&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; do not include Phoenix.LiveDashboard&lt;/span&gt;
&lt;span id=&quot;cb7-26&quot;&gt;&lt;a href=&quot;#cb7-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--binary-id&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; use binary_id as primary key type in Ecto schemas&lt;/span&gt;
&lt;span id=&quot;cb7-27&quot;&gt;&lt;a href=&quot;#cb7-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ex&quot;&gt;•&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--verbose&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-&lt;/span&gt; use verbose output&lt;/span&gt;
&lt;span id=&quot;cb7-28&quot;&gt;&lt;a href=&quot;#cb7-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb7-29&quot;&gt;&lt;a href=&quot;#cb7-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;...&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s pay attention to the first option, &lt;code&gt;--live&lt;/code&gt;. As mentioned at the beginning of this tutorial, you’ll be building a fundraising application, so make sure to set up your Phoenix application to allow for real-time functionality from the get-go:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; mix &lt;span class=&quot;ex&quot;&gt;phx.new&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--live&lt;/span&gt; phoenix_fund&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; creating phoenix_fund/lib/phoenix_fund_web/router.ex&lt;/span&gt;
&lt;span id=&quot;cb8-5&quot;&gt;&lt;a href=&quot;#cb8-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; creating phoenix_fund/lib/phoenix_fund_web/telemetry.ex&lt;/span&gt;
&lt;span id=&quot;cb8-6&quot;&gt;&lt;a href=&quot;#cb8-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; creating phoenix_fund/lib/phoenix_fund_web.ex&lt;/span&gt;
&lt;span id=&quot;cb8-7&quot;&gt;&lt;a href=&quot;#cb8-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; creating phoenix_fund/mix.exs&lt;/span&gt;
&lt;span id=&quot;cb8-8&quot;&gt;&lt;a href=&quot;#cb8-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; creating phoenix_fund/README.md&lt;/span&gt;
&lt;span id=&quot;cb8-9&quot;&gt;&lt;a href=&quot;#cb8-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-10&quot;&gt;&lt;a href=&quot;#cb8-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-11&quot;&gt;&lt;a href=&quot;#cb8-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; creating phoenix_fund/assets/static/robots.txt&lt;/span&gt;
&lt;span id=&quot;cb8-12&quot;&gt;&lt;a href=&quot;#cb8-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-13&quot;&gt;&lt;a href=&quot;#cb8-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Fetch&lt;/span&gt; and install dependencies&lt;span class=&quot;pp&quot;&gt;?&lt;/span&gt; [Yn] &lt;/span&gt;
&lt;span id=&quot;cb8-14&quot;&gt;&lt;a href=&quot;#cb8-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; running mix deps.get&lt;/span&gt;
&lt;span id=&quot;cb8-15&quot;&gt;&lt;a href=&quot;#cb8-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; running mix deps.compile&lt;/span&gt;
&lt;span id=&quot;cb8-16&quot;&gt;&lt;a href=&quot;#cb8-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;*&lt;/span&gt; running cd assets &lt;span class=&quot;kw&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;npm&lt;/span&gt; install &lt;span class=&quot;kw&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;node&lt;/span&gt; node_modules/webpack/bin/webpack.js &lt;span class=&quot;at&quot;&gt;--mode&lt;/span&gt; development&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;mix phx.new&lt;/code&gt; will create the basic skeleton for your new Phoenix LiveView app and download all the dependencies on the Elixir and Node.js side of things.&lt;/p&gt;
&lt;p&gt;Next, provision your database and start the local Phoenix server:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; mix &lt;span class=&quot;ex&quot;&gt;ecto.create&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;mix&lt;/span&gt; phx.server&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If everything is working correctly, you should be able to visit &lt;a href=&quot;http://localhost:4000&quot;&gt;localhost:4000&lt;/a&gt; and see the default Phoenix livewire homepage:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/0N5VpNv.png&quot; alt=&quot;Out of the box installation&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Out of the box installation&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Now the app generated has the default Phoenix styling and setup, but let’s add a little polish for this exercise. You’re going to add &lt;a href=&quot;https://tailwindcss.com/&quot;&gt;TailwindCSS&lt;/a&gt; and some premade boilerplate CSS.&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;First, add the following dependencies to your &lt;code&gt;assets/package.json&lt;/code&gt; file, to install Tailwind and the necessary node libraries:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode json&quot;&gt;&lt;code class=&quot;sourceCode json&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;er&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;er&quot;&gt;&amp;quot;devDependencies&amp;quot;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;er&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-4&quot;&gt;&lt;a href=&quot;#cb10-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;postcss&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;^8.1.10&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-5&quot;&gt;&lt;a href=&quot;#cb10-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;postcss-import&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;^13.0.0&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-6&quot;&gt;&lt;a href=&quot;#cb10-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;postcss-loader&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;^4.1.0&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-7&quot;&gt;&lt;a href=&quot;#cb10-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;postcss-nested&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;^4.2.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-8&quot;&gt;&lt;a href=&quot;#cb10-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;tailwindcss&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;^2.0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-9&quot;&gt;&lt;a href=&quot;#cb10-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;er&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-10&quot;&gt;&lt;a href=&quot;#cb10-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Next, make sure to install your new dependencies:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;npm&lt;/span&gt; install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Copy &lt;a href=&quot;https://gist.github.com/amacgregor/1369927cb4555803fa359c5ad9104fa9&quot;&gt;the webpack and Tailwind configuration from here&lt;/a&gt; into your assets directory:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;assets/tailwind.config.js
assets/webpack.config.js
assets/postcss.config.js&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;4&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Copy &lt;a href=&quot;https://gist.github.com/amacgregor/66c7fd76b55332c77bbdb21c5f62940b&quot;&gt;these CSS files&lt;/a&gt; into the following locations:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;assets/css/app.css
assets/csss/custom.css&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&quot;5&quot; type=&quot;1&quot;&gt;
&lt;li&gt;Finally change your application to use regular CSS instead of Sass by updating the &lt;code&gt;assets/js/app.js&lt;/code&gt; to:&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;import &amp;quot;../css/app.css&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;adding-your-auction-route&quot;&gt;Adding Your Auction Route&lt;/h2&gt;
&lt;p&gt;Now that you have a project up with the base styling, you can start working on adding the routes and logic to show the auctions. Open your &lt;code&gt;lib/phoenix_fund_web/router.ex&lt;/code&gt; file and look for the following chunk of code:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  scope &lt;span class=&quot;st&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    pipe_through &lt;span class=&quot;va&quot;&gt;:browser&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-4&quot;&gt;&lt;a href=&quot;#cb15-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    live &lt;span class=&quot;st&quot;&gt;&amp;quot;/&amp;quot;&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;PageLive&lt;/span&gt;, &lt;span class=&quot;va&quot;&gt;:index&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-5&quot;&gt;&lt;a href=&quot;#cb15-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the scaffold code that was generated when you generated the application. You want to add a new route for your actions, and you can do that easily by using the &lt;code&gt;live&lt;/code&gt; macro:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb16&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb16-1&quot;&gt;&lt;a href=&quot;#cb16-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-2&quot;&gt;&lt;a href=&quot;#cb16-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    live &lt;span class=&quot;st&quot;&gt;&amp;quot;/auction&amp;quot;&lt;/span&gt;, &lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s important to highlight that &lt;code&gt;AuctionLive&lt;/code&gt; is not a Phoenix controller. Rather, it’s a long-running LiveView process in charge of managing and tracking the state for that particular route.&lt;/p&gt;
&lt;p&gt;Go ahead and define your new module under &lt;code&gt;lib/phoenix_fund_web/live/auction_live.ex&lt;/code&gt;. By convention, the LiveView modules are placed under the &lt;code&gt;live&lt;/code&gt; directory.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb17&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb17-1&quot;&gt;&lt;a href=&quot;#cb17-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb17-2&quot;&gt;&lt;a href=&quot;#cb17-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;im&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;, &lt;span class=&quot;va&quot;&gt;:live_view&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb17-3&quot;&gt;&lt;a href=&quot;#cb17-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb17-4&quot;&gt;&lt;a href=&quot;#cb17-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; mount(params, session, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb17-5&quot;&gt;&lt;a href=&quot;#cb17-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        {&lt;span class=&quot;va&quot;&gt;:ok&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)}&lt;/span&gt;
&lt;span id=&quot;cb17-6&quot;&gt;&lt;a href=&quot;#cb17-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb17-7&quot;&gt;&lt;a href=&quot;#cb17-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the core of a LiveView module. &lt;code&gt;mount/3&lt;/code&gt; is the entry point for each LiveView, and it will be invoked twice:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Once on the initial page load&lt;/li&gt;
&lt;li&gt;Once to establish a live socket&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It expects three parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;params&lt;/code&gt;: A map of string keys with the query params&lt;/li&gt;
&lt;li&gt;&lt;code&gt;session&lt;/code&gt;: The connection session&lt;/li&gt;
&lt;li&gt;&lt;code&gt;socket&lt;/code&gt;: The LiveView socket struct&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In your &lt;code&gt;mount/3&lt;/code&gt; function, assign the initial status for your LiveView so it can be rendered. Next, define a &lt;code&gt;render/1&lt;/code&gt; function that will render your LiveView HTML.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb18-2&quot;&gt;&lt;a href=&quot;#cb18-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-3&quot;&gt;&lt;a href=&quot;#cb18-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; render(assigns) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-4&quot;&gt;&lt;a href=&quot;#cb18-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;op&quot;&gt;~&lt;/span&gt;L&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-5&quot;&gt;&lt;a href=&quot;#cb18-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;          &amp;lt;h1&amp;gt;Cabinet of Curiosities&amp;lt;/h1&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-6&quot;&gt;&lt;a href=&quot;#cb18-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;          &amp;lt;div id=&amp;quot;auction&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-7&quot;&gt;&lt;a href=&quot;#cb18-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;div class=&amp;quot;meter&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-8&quot;&gt;&lt;a href=&quot;#cb18-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;                &amp;lt;span style=&amp;quot;width: &amp;lt;%= @raised %&amp;gt;%&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-9&quot;&gt;&lt;a href=&quot;#cb18-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;                  $&amp;lt;%= @raised %&amp;gt; USD&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-10&quot;&gt;&lt;a href=&quot;#cb18-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;                &amp;lt;/span&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-11&quot;&gt;&lt;a href=&quot;#cb18-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-12&quot;&gt;&lt;a href=&quot;#cb18-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;        &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-13&quot;&gt;&lt;a href=&quot;#cb18-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-14&quot;&gt;&lt;a href=&quot;#cb18-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-15&quot;&gt;&lt;a href=&quot;#cb18-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For now, you’ll provide the HTML directly on your function. Note that the &lt;code&gt;~L&lt;/code&gt; is a special syntax called a sigil; it’s used to represent Live EEx content.&lt;/p&gt;
&lt;p&gt;Start your Phoenix server and let’s try to load &lt;a href=&quot;http://localhost:4000/auction&quot;&gt;/auction&lt;/a&gt;. If everything was set up correctly, you should see the following:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/6gnnM9k.png&quot; alt=&quot;Auction View&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Auction View&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Excellent! Your new route is now being rendered by your LiveView. Now it’s time to make it do something useful by adding a couple of buttons to allow people to donate.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb19&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb19-1&quot;&gt;&lt;a href=&quot;#cb19-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;```elixir &lt;/span&gt;
&lt;span id=&quot;cb19-2&quot;&gt;&lt;a href=&quot;#cb19-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb19-3&quot;&gt;&lt;a href=&quot;#cb19-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-4&quot;&gt;&lt;a href=&quot;#cb19-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; render(assigns) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-5&quot;&gt;&lt;a href=&quot;#cb19-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;op&quot;&gt;~&lt;/span&gt;L&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-6&quot;&gt;&lt;a href=&quot;#cb19-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;          &amp;lt;h1&amp;gt;Cabinet of Curiosities&amp;lt;/h1&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-7&quot;&gt;&lt;a href=&quot;#cb19-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;          &amp;lt;div id=&amp;quot;auction&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-8&quot;&gt;&lt;a href=&quot;#cb19-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;div class=&amp;quot;meter&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-9&quot;&gt;&lt;a href=&quot;#cb19-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;                &amp;lt;span style=&amp;quot;width: &amp;lt;%= @raised %&amp;gt;%&amp;quot;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-10&quot;&gt;&lt;a href=&quot;#cb19-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;                  $&amp;lt;%= @raised %&amp;gt; USD&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-11&quot;&gt;&lt;a href=&quot;#cb19-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;                &amp;lt;/span&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-12&quot;&gt;&lt;a href=&quot;#cb19-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-13&quot;&gt;&lt;a href=&quot;#cb19-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-14&quot;&gt;&lt;a href=&quot;#cb19-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;button phx-click=&amp;quot;donate-1&amp;quot;&amp;gt; $1 &amp;lt;/button&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-15&quot;&gt;&lt;a href=&quot;#cb19-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;button phx-click=&amp;quot;donate-5&amp;quot;&amp;gt; $5 &amp;lt;/button&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-16&quot;&gt;&lt;a href=&quot;#cb19-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;button phx-click=&amp;quot;donate-10&amp;quot;&amp;gt; $10 &amp;lt;/button&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-17&quot;&gt;&lt;a href=&quot;#cb19-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;              &amp;lt;button phx-click=&amp;quot;donate-100&amp;quot;&amp;gt; $100 &amp;lt;/button&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-18&quot;&gt;&lt;a href=&quot;#cb19-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;        &amp;lt;/div&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-19&quot;&gt;&lt;a href=&quot;#cb19-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-20&quot;&gt;&lt;a href=&quot;#cb19-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-21&quot;&gt;&lt;a href=&quot;#cb19-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The page should look as follows:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/kI2Zchu.png&quot; alt=&quot;Buttons added&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Buttons added&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;However, if you try to click any of your new buttons, you’re going to get an error like so:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
[error] GenServer #PID&amp;lt;0.935.0&amp;gt; terminating
** (FunctionClauseError) no function clause matching in PhoenixFundWeb.AuctionLive.handle_event/3
    (phoenix_fund 0.1.0) lib/phoenix_fund_web/live/auction_live.ex:26: PhoenixFundWeb.AuctionLive.handle_event(&amp;quot;donate-5&amp;quot;, %{&amp;quot;value&amp;quot; =&amp;gt; &amp;quot;&amp;quot;}, #Phoenix.LiveView.Socket&amp;lt;assigns: %{flash: %{}, live_action: nil, live_module: PhoenixFundWeb.AuctionLive, raised: 34}, changed: %{}, endpoint: PhoenixFundWeb.Endpoint, id: &amp;quot;phx-FmnbLK6vHaXG9gIk&amp;quot;, parent_pid: nil, root_pid: #PID&amp;lt;0.935.0&amp;gt;, router: PhoenixFundWeb.Router, view: PhoenixFundWeb.AuctionLive, ...&amp;gt;)
    (phoenix_live_view 0.13.0) lib/phoenix_live_view/channel.ex:102: Phoenix.LiveView.Channel.handle_info/2
    (stdlib 3.14) gen_server.erl:689: :gen_server.try_dispatch/4
    (stdlib 3.14) gen_server.erl:765: :gen_server.handle_msg/6
    (stdlib 3.14) proc_lib.erl:226: :proc_lib.init_p_do_apply/3
Last message: %Phoenix.Socket.Message{event: &amp;quot;event&amp;quot;, join_ref: &amp;quot;4&amp;quot;, payload: %{&amp;quot;event&amp;quot; =&amp;gt; &amp;quot;donate-5&amp;quot;, &amp;quot;type&amp;quot; =&amp;gt; &amp;quot;click&amp;quot;, &amp;quot;value&amp;quot; =&amp;gt; %{&amp;quot;value&amp;quot; =&amp;gt; &amp;quot;&amp;quot;}}, ref: &amp;quot;39&amp;quot;, topic: &amp;quot;lv:phx-FmnbLK6vHaXG9gIk&amp;quot;}
State: %{components: {%{}, %{}, 0}, join_ref: &amp;quot;4&amp;quot;, serializer: Phoenix.Socket.V2.JSONSerializer, socket: #Phoenix.LiveView.Socket&amp;lt;assigns: %{flash: %{}, live_action: nil, live_module: PhoenixFundWeb.AuctionLive, raised: 34}, changed: %{}, endpoint: PhoenixFundWeb.Endpoint, id: &amp;quot;phx-FmnbLK6vHaXG9gIk&amp;quot;, parent_pid: nil, root_pid: #PID&amp;lt;0.935.0&amp;gt;, router: PhoenixFundWeb.Router, view: PhoenixFundWeb.AuctionLive, ...&amp;gt;, topic: &amp;quot;lv:phx-FmnbLK6vHaXG9gIk&amp;quot;, transport_pid: #PID&amp;lt;0.929.0&amp;gt;}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;handling-events&quot;&gt;Handling Events&lt;/h2&gt;
&lt;p&gt;As you can see from the error, the Auction LiveView doesn’t currently know how to handle an event. As part of your button code, you added &lt;code&gt;phx-click&lt;/code&gt;; this is a &lt;strong&gt;binding&lt;/strong&gt; that sends a particular event like &lt;code&gt;donate-1&lt;/code&gt; back to your LiveView.&lt;/p&gt;
&lt;p&gt;Your next step is adding a new definition of &lt;code&gt;handle_event/3&lt;/code&gt; for each one of your events. Go ahead and add the first function definition to the handle of the $1 donation button event:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb21&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb21-1&quot;&gt;&lt;a href=&quot;#cb21-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb21-2&quot;&gt;&lt;a href=&quot;#cb21-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb21-3&quot;&gt;&lt;a href=&quot;#cb21-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-1&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb21-4&quot;&gt;&lt;a href=&quot;#cb21-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb21-5&quot;&gt;&lt;a href=&quot;#cb21-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb21-6&quot;&gt;&lt;a href=&quot;#cb21-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb21-7&quot;&gt;&lt;a href=&quot;#cb21-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;handle_event/3&lt;/code&gt; function takes three parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The name of the event, in this case &lt;code&gt;donate-1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;metadata&lt;/code&gt; about the event, that you can safely ignore for now&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;socket&lt;/code&gt;, which, if you remember, holds the state of your LiveView process&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inside your &lt;code&gt;handle_event/3&lt;/code&gt;, you’re doing two things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Retrieving the current &lt;code&gt;raised&lt;/code&gt; value from the &lt;code&gt;socket.assigns&lt;/code&gt; and increment it by &lt;code&gt;1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Assigning the new value back to the socket&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you reload your page and click on the $1 donation button, you should see the value correctly incrementing.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/WA1gHtv.gif&quot; alt=&quot;Button working&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Button working&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Make sure to add the following code to handle the remaining events:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb22&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb22-1&quot;&gt;&lt;a href=&quot;#cb22-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt; &lt;/span&gt;
&lt;span id=&quot;cb22-2&quot;&gt;&lt;a href=&quot;#cb22-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-3&quot;&gt;&lt;a href=&quot;#cb22-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-5&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-4&quot;&gt;&lt;a href=&quot;#cb22-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-5&quot;&gt;&lt;a href=&quot;#cb22-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb22-6&quot;&gt;&lt;a href=&quot;#cb22-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-7&quot;&gt;&lt;a href=&quot;#cb22-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-8&quot;&gt;&lt;a href=&quot;#cb22-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-10&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-9&quot;&gt;&lt;a href=&quot;#cb22-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-10&quot;&gt;&lt;a href=&quot;#cb22-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb22-11&quot;&gt;&lt;a href=&quot;#cb22-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-12&quot;&gt;&lt;a href=&quot;#cb22-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-13&quot;&gt;&lt;a href=&quot;#cb22-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-100&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-14&quot;&gt;&lt;a href=&quot;#cb22-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-15&quot;&gt;&lt;a href=&quot;#cb22-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb22-16&quot;&gt;&lt;a href=&quot;#cb22-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;  &lt;/span&gt;
&lt;span id=&quot;cb22-17&quot;&gt;&lt;a href=&quot;#cb22-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;understanding-the-liveview-life-cycle&quot;&gt;Understanding the LiveView Life Cycle&lt;/h2&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/rk4dJHg.png&quot; alt=&quot;LiveView Life Cycle&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;LiveView Life Cycle&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Let’s recap what you’ve done so far to better understand the LiveView life cycle:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Your application receives a request for a LiveView route.&lt;/li&gt;
&lt;li&gt;Your app will invoke that view &lt;code&gt;mount/2&lt;/code&gt; function and set the initial socket state.&lt;/li&gt;
&lt;li&gt;Next, it will call &lt;code&gt;render/1&lt;/code&gt; to render the static HTML to send back to the client.&lt;/li&gt;
&lt;li&gt;Opening a LiveView socket will pass the rendered HTML.&lt;/li&gt;
&lt;li&gt;The socket will remain open to receive events and handle updates on the LiveView process state.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;It is in this life cycle where one of the more powerful and interesting features of LiveView lies. As mentioned, LiveView is listening to your socket for updates but &lt;em&gt;it will only rerender the portions of the page that needed updating&lt;/em&gt;. In the case of this tutorial, the meter is the only piece that gets an update.&lt;/p&gt;
&lt;p&gt;This is one of the key features that makes Phoenix and LiveView extremely well suited for real-time applications.&lt;/p&gt;
&lt;h2 id=&quot;broadcasting-with-pubsub&quot;&gt;Broadcasting with PubSub&lt;/h2&gt;
&lt;p&gt;So far, you’ve built an app that can leverage Phoenix LiveView to allow users to donate in real time, but so far, there’s a caveat: updates are not shared across users or even tabs. Wouldn’t it be nice to get the donations to show in real time for everyone who has the page open?&lt;/p&gt;
&lt;p&gt;Next, you’ll leverage &lt;a href=&quot;https://github.com/phoenixframework/phoenix_pubsub&quot;&gt;PubSub&lt;/a&gt; to broadcast real-time updates to all LiveView clients, not just the one that triggers the event.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“Publish-subscribe is a messaging pattern where senders of messages, called publishers, do not program the messages to be sent directly to specific receivers, called subscribers, but instead categorize published messages into classes without knowledge of which subscribers, if any, there may be. Similarly, subscribers express interest in one or more classes and only receive messages that are of interest, without knowledge of which publishers, if any, there are.” –&lt;a href=&quot;https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In short, PubSub is a messaging pattern that will allow us to implement real-time asynchronous communication with any clients listening for events in our application. In the case of this tutorial, that will be every user with a fundraising page open.&lt;/p&gt;
&lt;h3 id=&quot;configure-phoenix-pubsub&quot;&gt;Configure Phoenix PubSub&lt;/h3&gt;
&lt;p&gt;First, you need to configure your app endpoint to use the &lt;code&gt;Phoenix.PubSub.PG2&lt;/code&gt; adapter. Add the following configuration to your &lt;code&gt;lib/phoenix_fund/application.ex&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb23&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb23-1&quot;&gt;&lt;a href=&quot;#cb23-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;{&lt;span class=&quot;cn&quot;&gt;Phoenix&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;PubSub&lt;/span&gt;, [&lt;span class=&quot;va&quot;&gt;name:&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFund&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;PubSub&lt;/span&gt;, &lt;span class=&quot;va&quot;&gt;adapter:&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;Phoenix&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;PubSub&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;PG2&lt;/span&gt;]},&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;subscribing-to-a-topic&quot;&gt;Subscribing to a Topic&lt;/h3&gt;
&lt;p&gt;Next, tell your LiveView process to subscribe to a specific topic when the LiveView mounts. You can leverage &lt;code&gt;Phoenix.PubSub.subscribe/3&lt;/code&gt; for that:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb24&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb24-1&quot;&gt;&lt;a href=&quot;#cb24-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;defmodule&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;AuctionLive&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-2&quot;&gt;&lt;a href=&quot;#cb24-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;im&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;, &lt;span class=&quot;va&quot;&gt;:live_view&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-3&quot;&gt;&lt;a href=&quot;#cb24-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb24-4&quot;&gt;&lt;a href=&quot;#cb24-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;auction&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-5&quot;&gt;&lt;a href=&quot;#cb24-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-6&quot;&gt;&lt;a href=&quot;#cb24-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; mount(params, session, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-7&quot;&gt;&lt;a href=&quot;#cb24-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Endpoint&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;subscribe(&lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb24-8&quot;&gt;&lt;a href=&quot;#cb24-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:ok&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)}&lt;/span&gt;
&lt;span id=&quot;cb24-9&quot;&gt;&lt;a href=&quot;#cb24-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-10&quot;&gt;&lt;a href=&quot;#cb24-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb24-11&quot;&gt;&lt;a href=&quot;#cb24-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You’ll use a generic &lt;code&gt;auction&lt;/code&gt; topic, as you’re only dealing with a single auction.&lt;/p&gt;
&lt;h3 id=&quot;broadcasting-to-all-subscribers&quot;&gt;Broadcasting to All Subscribers&lt;/h3&gt;
&lt;p&gt;Your next step is to modify each of your &lt;code&gt;handle_event/3&lt;/code&gt; definitions to broadcast. The updated code looks like:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb25&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb25-1&quot;&gt;&lt;a href=&quot;#cb25-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-1&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-2&quot;&gt;&lt;a href=&quot;#cb25-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-3&quot;&gt;&lt;a href=&quot;#cb25-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Endpoint&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;broadcast_from(self(), &lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;donate_event&amp;quot;&lt;/span&gt;, raised)&lt;/span&gt;
&lt;span id=&quot;cb25-4&quot;&gt;&lt;a href=&quot;#cb25-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb25-5&quot;&gt;&lt;a href=&quot;#cb25-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-6&quot;&gt;&lt;a href=&quot;#cb25-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-7&quot;&gt;&lt;a href=&quot;#cb25-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-5&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-8&quot;&gt;&lt;a href=&quot;#cb25-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-9&quot;&gt;&lt;a href=&quot;#cb25-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Endpoint&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;broadcast_from(self(), &lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;donate_event&amp;quot;&lt;/span&gt;, raised)&lt;/span&gt;
&lt;span id=&quot;cb25-10&quot;&gt;&lt;a href=&quot;#cb25-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb25-11&quot;&gt;&lt;a href=&quot;#cb25-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-12&quot;&gt;&lt;a href=&quot;#cb25-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-13&quot;&gt;&lt;a href=&quot;#cb25-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-10&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-14&quot;&gt;&lt;a href=&quot;#cb25-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-15&quot;&gt;&lt;a href=&quot;#cb25-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Endpoint&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;broadcast_from(self(), &lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;donate_event&amp;quot;&lt;/span&gt;, raised)&lt;/span&gt;
&lt;span id=&quot;cb25-16&quot;&gt;&lt;a href=&quot;#cb25-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb25-17&quot;&gt;&lt;a href=&quot;#cb25-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-18&quot;&gt;&lt;a href=&quot;#cb25-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-19&quot;&gt;&lt;a href=&quot;#cb25-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_event(&lt;span class=&quot;st&quot;&gt;&amp;quot;donate-100&amp;quot;&lt;/span&gt;, _, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-20&quot;&gt;&lt;a href=&quot;#cb25-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    raised &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; socket&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;assigns&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;raised &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-21&quot;&gt;&lt;a href=&quot;#cb25-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cn&quot;&gt;PhoenixFundWeb&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;cn&quot;&gt;Endpoint&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;broadcast_from(self(), &lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;donate_event&amp;quot;&lt;/span&gt;, raised)&lt;/span&gt;
&lt;span id=&quot;cb25-22&quot;&gt;&lt;a href=&quot;#cb25-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb25-23&quot;&gt;&lt;a href=&quot;#cb25-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You’re using the &lt;code&gt;Phoenix.PubSub.broadcast_from/4&lt;/code&gt; function, which allows you to broadcast a message describing a new socket state to all the LiveView clients that are subscribed to a topic. Notice that you’re not triggering the click event on the other clients, just letting them know that the socket state has changed.&lt;/p&gt;
&lt;p&gt;Finally, now that you’re broadcasting the socket updates, you need to tell your LiveView process how to handle the incoming broadcasts. For this, add a &lt;code&gt;handle_info/2&lt;/code&gt; that will pattern match against the broadcast struct:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb26&quot;&gt;&lt;pre class=&quot;sourceCode elixir&quot;&gt;&lt;code class=&quot;sourceCode elixir&quot;&gt;&lt;span id=&quot;cb26-1&quot;&gt;&lt;a href=&quot;#cb26-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; handle_info(%{&lt;span class=&quot;va&quot;&gt;topic:&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;@topic&lt;/span&gt;, &lt;span class=&quot;va&quot;&gt;payload:&lt;/span&gt; raised}, socket) &lt;span class=&quot;kw&quot;&gt;do&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb26-2&quot;&gt;&lt;a href=&quot;#cb26-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    {&lt;span class=&quot;va&quot;&gt;:noreply&lt;/span&gt;, assign(socket, &lt;span class=&quot;va&quot;&gt;:raised&lt;/span&gt;, raised)}&lt;/span&gt;
&lt;span id=&quot;cb26-3&quot;&gt;&lt;a href=&quot;#cb26-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;end&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you start up your application and open two browser windows side by side, you should see the donation meter updating on all windows as soon anyone clicks any of the donation buttons.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/real-time-phoenix-elixir/tiqB8O5.gif&quot; alt=&quot;Broadcast in real time&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Broadcast in real time&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2 id=&quot;in-summary&quot;&gt;In Summary&lt;/h2&gt;
&lt;p&gt;As you’ve learned, Phoenix offers a powerful set of libraries, making it relatively easy to create real-time applications with very little code and, even more surprisingly, no JavaScript at all. With LiveView, you can create fully fledged real-time features using only server-side code, and when you add Phoenix PubSub, you can open those same features to all app users in real time.&lt;/p&gt;
&lt;p&gt;Of course, we’ve only begun to scratch the surface here of what you can do with Phoenix, LiveView, and PubSub. If you want to keep going with this project, I would recommend tackling adding persistence next, and the ability to create multiple auctions with &lt;a href=&quot;https://hexdocs.pm/ecto/getting-started.html&quot;&gt;Ecto&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Both Ecto and the Phoenix project use &lt;a href=&quot;https://earthly.dev&quot;&gt;Earthly&lt;/a&gt; for defining their continuous integration process, so examining &lt;a href=&quot;https://github.com/elixir-ecto/ecto/blob/master/Earthfile&quot;&gt;those&lt;/a&gt; &lt;a href=&quot;https://github.com/phoenixframework/phoenix/blob/master/Earthfile&quot;&gt;projects&lt;/a&gt; can be a great way to learn more about Earthly.&lt;/p&gt;
&lt;h3 id=&quot;additional-resources&quot;&gt;Additional Resources&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://pragmaticstudio.com/phoenix-liveview&quot;&gt;The Pragmatic Studio: Phoenix LiveView Course&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://pragprog.com/titles/liveview/programming-phoenix-liveview/&quot;&gt;&lt;em&gt;Programming Phoenix LiveView&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/amacgregor/phoenix_fund&quot;&gt;Full source code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Allan MacGregor</name></author><category term="Tutorials" /><summary type="html">The Elixir language, along with the Phoenix framework, has been growing in popularity at a quick pace, and with good reason. Phoenix offers productivity levels comparable to frameworks like Ruby on Rails while being one of the fastest web frameworks available.</summary></entry><entry><title type="html">Welcoming Wes McKinney as an advisor to Earthly</title><link href="https://earthly.dev/blog/wes-mckinney/" rel="alternate" type="text/html" title="Welcoming Wes McKinney as an advisor to Earthly" /><published>2021-04-15T00:00:00-04:00</published><updated>2020-04-15T00:00:00-04:00</updated><id>https://earthly.dev/blog/wes-mckinney</id><content type="html" xml:base="https://earthly.dev/blog/wes-mckinney/">&lt;p&gt;In our journey to bring repeatable builds to the world, we have had the pleasure to talk to a number of industry veterans about the challenges surrounding CIs today. One person that was particularly excited about our mission is &lt;a href=&quot;https://en.wikipedia.org/wiki/Wes_McKinney&quot;&gt;Wes McKinney&lt;/a&gt;, the author of &lt;a href=&quot;https://www.oreilly.com/library/view/python-for-data/9781449323592/&quot;&gt;Python for Data Analysis&lt;/a&gt;, the creator of the very popular &lt;a href=&quot;https://github.com/pandas-dev/pandas&quot;&gt;pandas&lt;/a&gt; Python package, co-creator of &lt;a href=&quot;https://arrow.apache.org/&quot;&gt;Apache Arrow&lt;/a&gt;, and CEO of &lt;a href=&quot;https://ursacomputing.com/&quot;&gt;Ursa Computing&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Wes immediately recognized the issues of modern builds, including the need for better and more scalable tooling for monorepos, the need for reducing duplication, and the need to improve build speeds through the use of distributed compute and distributed caching.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I’ve seen the many ways that a large project’s CI/CD systems can hit a scalability wall and bring down the productivity of the whole development team. In Apache Arrow, with its many programming languages and the need to test a wide variety of integrations in a reproducible way, we created a complex homegrown CI framework to meet our needs. Building and maintaining this system has almost been a full-time job. When I learned about Earthly, I was excited to see innovative work happening in containerized build and testing automation. I’m hopeful that complex projects like ours will be able to save time in the future by building on better off-the-shelf tools like Earthly.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p style=&quot;text-align: right&quot;&gt;
– Wes McKinney
&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/assets/images/wes-mckinney/Wes_McKinney_Headshot.jpg&quot; alt=&quot;Wes McKinney&quot; width=&quot;250px&quot; style=&quot;float: left; margin: 30px;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Wes will be helping us better understand the challenges of software builds in data engineering communities and also will help Earthly be successful in these circles.&lt;/p&gt;
&lt;p&gt;We are grateful and proud to have Wes McKinney onboard as an advisor. The world of software engineering is vast and industry veterans such as Wes allow us to tune our technology to the needs of the various communities out there. The more we connect with great minds in tech, the more Earthly gets better for everyone else.&lt;/p&gt;
&lt;p&gt;If you are an Earthly user, please join me in welcoming Wes to the Earthly family! &lt;a href=&quot;https://twitter.com/wesmckinn&quot;&gt;Follow Wes on Twitter&lt;/a&gt; and let him know why you’re excited about Earthly. If you aren’t a user yet, you’re missing out! ;-) Come give Earthly a try at &lt;a href=&quot;https://earthly.dev&quot;&gt;earthly.dev&lt;/a&gt;.&lt;/p&gt;</content><author><name>Vlad A. Ionescu</name></author><category term="News" /><category term="advisor" /><category term="data-engineering" /><summary type="html">&quot;When I learned about Earthly, I was excited to see innovative work happening in containerized build and testing automation.&quot;</summary></entry><entry><title type="html">Addressing Slow Performance in Jenkins</title><link href="https://earthly.dev/blog/slow-performance-in-jenkins/" rel="alternate" type="text/html" title="Addressing Slow Performance in Jenkins" /><published>2021-04-12T00:00:00-04:00</published><updated>2021-04-12T00:00:00-04:00</updated><id>https://earthly.dev/blog/slow-performance-in-jenkins</id><content type="html" xml:base="https://earthly.dev/blog/slow-performance-in-jenkins/">&lt;p&gt;There’s nothing more frustrating than a sluggish continuous integration system. It slows down feedback loops and prevents code from reaching production quickly. While quick fixes like using a bigger CI server can buy you time, you ultimately have to invest in maintaining the performance of your continuous integration workflow.&lt;/p&gt;
&lt;p&gt;Jenkins is one of the most popular CI/CD tools out there, but its users often &lt;a href=&quot;https://issues.jenkins.io/browse/JENKINS-56243?page=com.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel&quot;&gt;experience lagging and responsiveness issues over time&lt;/a&gt;. In this guide, I’ll share an overview of some of the biggest Jenkins performance issues and some tips for significantly improving performance without necessarily upgrading your hardware.&lt;/p&gt;
&lt;h2 id=&quot;why-is-jenkins-such-a-popular-option-for-cicd&quot;&gt;Why Is Jenkins Such a Popular Option for CI/CD?&lt;/h2&gt;
&lt;p&gt;Jenkins is a Java-based, open-source tool that is leveraged by &lt;a href=&quot;https://www.businesswire.com/news/home/20181024005509/en/Jenkins-Community-Achieves-Record-Growth-Driven-by-Major-Innovation&quot;&gt;tens of thousands&lt;/a&gt; of developers on hundreds of thousands of installations, making it the most popular automation server. This widespread use means that it’s easy to find support and tips for Jenkins, but that’s not the only reason it’s so widely used.&lt;/p&gt;
&lt;p&gt;Jenkins brought a lot of interesting paradigms to CI workflows, including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Faster deployment.&lt;/strong&gt; Gone are the days when a build was tested and deployed once after all the developers committed their code. With Jenkins’ automated CI/CD pipeline, whenever a developer commits code, it’s built and tested throughout the day across multiple cycles.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.jenkins.io/doc/book/scaling/architecting-for-scale/&quot;&gt;Scalable master-agent architecture&lt;/a&gt;.&lt;/strong&gt; When it comes to managing distributed builds at scale, Jenkins can be a good choice. Jenkins’ primary server is the master that schedules build jobs and assigns them to agents (formerly, slaves) for execution. This pattern allows you to run Jenkins on one or hundreds of servers to speed up your builds.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Thousands of plugins:&lt;/strong&gt; Being an open-source platform, Jenkins provides a plethora of plugins for continuous integration built by other developers. This allows you to extend the base functionality without writing or maintaining much extra code in-house.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;overcoming-common-jenkins-performance-issues&quot;&gt;Overcoming Common Jenkins Performance Issues&lt;/h2&gt;
&lt;p&gt;Over time, increased build frequency, multiple jobs running in parallel, and increasing build complexity can lead to performance issues in Jenkins. Your experience will likely vary based on your use case, but some common issues include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;“Hangups” where the build seems “stuck” on a specific step each time it runs.&lt;/li&gt;
&lt;li&gt;Hitting memory limits on individual machines or the master node.&lt;/li&gt;
&lt;li&gt;CPU bottlenecks that slow down specific parts of a build.&lt;/li&gt;
&lt;li&gt;Bugs or inefficient code in plugins or scripts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Since these issues can be caused by a wide variety of root causes, it’s hard to generalize the solutions, but there are a few things that Jenkins users might want to look into. Here are some of the most universal ways you can improve your Jenkins build performance and limit the frequency of issues like those above.&lt;/p&gt;
&lt;h3 id=&quot;avoid-complex-groovy-script-in-your-pipelines&quot;&gt;1. Avoid Complex Groovy Script In Your Pipelines&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&quot;https://www.jenkins.io/doc/book/managing/script-console/&quot;&gt;Jenkins Groovy script console&lt;/a&gt; is executed on the master node and directly uses master resources such as CPU and memory. Therefore, it’s recommended that you reduce the number as well as the complexity of Groovy scripts in your pipelines and instead favor plugins that can be run on each agent directly.&lt;/p&gt;
&lt;p&gt;The most common Groovy methods to avoid in Jenkins are JsonSlurper, Jenkins.getInstance, and HttpRequest. Jenkins has more suggestions for &lt;a href=&quot;https://www.jenkins.io/blog/2017/02/01/pipeline-scalability-best-practice/&quot;&gt;scalable pipeline code and the operations to avoid on its blog&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;keep-builds-minimal-at-the-master-node&quot;&gt;2. Keep Builds Minimal at the Master Node&lt;/h3&gt;
&lt;p&gt;Jenkins’ master node sits at the epicenter of the whole CI/CD process, where the application runs. Hence, the number of builds on the master node significantly affects resource usage. Keeping fewer builds on the master node will leave enough CPU and memory for agent nodes to schedule and trigger jobs.&lt;/p&gt;
&lt;p&gt;You can use the “&lt;a href=&quot;https://stackoverflow.com/questions/13946929/ci-with-jenkins-how-to-force-building-happen-on-slaves-instead-of-master&quot;&gt;Restrict where project can be run&lt;/a&gt;” option in your job. While Jenkins will still run &lt;a href=&quot;https://support.cloudbees.com/hc/en-us/articles/360012808951-Pipeline-Difference-between-flyweight-and-heavyweight-Executors&quot;&gt;a flyweight executor&lt;/a&gt; on the master node, your heavyweight executors will run on the agent nodes.&lt;/p&gt;
&lt;p&gt;Think of the master node as the brain of your Jenkins. Unlike agents, the master node can’t be purged or replaced. So, to ensure optimum CI/CD functioning, consider doing some performance tuning on your Jenkins and free up the master node from unnecessary tasks. This will leave you with ample memory and CPU for effective scheduling and build triggers over agents.&lt;/p&gt;
&lt;h3 id=&quot;dont-bloat-the-jenkins-master-installation&quot;&gt;3. Don’t Bloat the Jenkins Master Installation&lt;/h3&gt;
&lt;p&gt;DevOps professionals often work across multiple teams and projects for CI/CD-related tasks. If that’s your situation, take care not to burden a single Jenkins master. Instead, create multiple masters. Multiple masters will ensure project-specific resource allocation to masters, and you’ll also avoid plugin collision.&lt;/p&gt;
&lt;p&gt;Moreover, rather than setting up a long build that might fail anywhere in the cycle, remember to break your build into multiple smaller jobs.&lt;/p&gt;
&lt;h3 id=&quot;make-agent-management-effortless&quot;&gt;4. Make Agent Management Effortless&lt;/h3&gt;
&lt;p&gt;While setting up Jenkins, it’s important to set up the agents correctly. You want to make sure that when the time comes, you can add new agents or replace existing ones easily. To achieve this, consider creating a virtual machine image for the agent. You might also consider running Jenkins inside a &lt;a href=&quot;https://devopscube.com/docker-containers-as-build-slaves-jenkins/&quot;&gt;Docker container&lt;/a&gt; in a scalable cluster like Kubernetes or Amazon EKS where scaling agents is simple.&lt;/p&gt;
&lt;p&gt;It’s also a good idea to make agents generic and versatile; an agent should run multiple different jobs and utilize resources to the fullest extent.&lt;/p&gt;
&lt;h3 id=&quot;remove-older-builds&quot;&gt;5. Remove Older Builds&lt;/h3&gt;
&lt;p&gt;After a while, Jenkins builds can pile up, and disk consumption may get out of hand. Developers often overlook Jenkins’ &lt;a href=&quot;https://plugins.jenkins.io/discard-old-build/&quot;&gt;Discard Old Builds&lt;/a&gt; option. Set metrics, such as the number of builds and days to keep builds and artifacts are under the Jenkins Log Rotation menu.&lt;/p&gt;
&lt;p&gt;Rather than letting old builds accumulate and consume a file system, developers can enable &lt;em&gt;Discard Old Builds&lt;/em&gt; and enjoy automated resource usage cleanup once a Jenkins job finishes. You can also use the &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/g1_gc.html&quot;&gt;G1 garbage collector&lt;/a&gt; instead of Java 8’s default &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/parallel.html&quot;&gt;Parallel GC&lt;/a&gt; since the former is a server-style garbage collector with a lower GC pause time.&lt;/p&gt;
&lt;p&gt;Builds can also be removed &lt;a href=&quot;https://superuser.com/a/1418896/92661&quot;&gt;manually&lt;/a&gt; via the Jenkins command line or using a &lt;a href=&quot;https://opensource.com/article/17/11/how-use-cron-linux&quot;&gt;cron job&lt;/a&gt; that periodically cleans up old builds. You can find other options for discarding old build data &lt;a href=&quot;https://support.cloudbees.com/hc/en-us/articles/215549798-Deleting-Old-Builds-Best-Strategy-for-Cleanup-and-disk-space-management&quot;&gt;in this reference post&lt;/a&gt;.&lt;/p&gt;
&lt;h5 id=&quot;prevent-resource-collision-in-parallel-jobs&quot;&gt;Prevent Resource Collision in Parallel Jobs&lt;/h5&gt;
&lt;p&gt;Jobs running in parallel might want exclusive access to ports or resources. This may cause a collision, fail a build and further slow down your Jenkins pipeline. For example, if you run multiple builds in parallel, there’s a high chance they might collide while accessing a resource, say, Postgres’s database port 5432.&lt;/p&gt;
&lt;p&gt;Jenkins offers the &lt;a href=&quot;https://plugins.jenkins.io/throttle-concurrents/&quot;&gt;Throttle Concurrent Builds&lt;/a&gt; plugin to help regulate the number of concurrent builds on Jenkins nodes:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// Throttle a single operation
throttle([&amp;#39;test_1&amp;#39;]) {
    node() {
        sh &amp;quot;sleep 100&amp;quot;
        echo &amp;quot;Done&amp;quot;
    }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You’ll need to do some testing to see how many parallel builds your system can handle, but knowing how to set this limit and modify it will help you get started.&lt;/p&gt;
&lt;h3 id=&quot;lower-heap-size&quot;&gt;6. Lower Heap Size&lt;/h3&gt;
&lt;p&gt;Do you want to create CI/CD pipelines that are performance-oriented and never fail with a memory leak or out-of-memory errors? Pay attention to the &lt;em&gt;heap size&lt;/em&gt;. As the number of Jenkins builds grows, the default heap size can be a limiting factor leading to out-of-memory errors if not attended to.&lt;/p&gt;
&lt;p&gt;A majority of modern Java applications start with the maximum heap size configuration during startup. For Jenkins to run smoothly, lower the maximum heap size property to a maximum of &lt;a href=&quot;https://docs.cloudbees.com/docs/admin-resources/latest/jvm-troubleshooting/#_heap_size&quot;&gt;4 GB&lt;/a&gt; for starters. You can increase the heap size over time, depending on the Jenkins builds.&lt;/p&gt;
&lt;p&gt;To set the heap size to 4 GB:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Refer to &lt;code&gt;/etc/default/jenkins&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Pass &lt;code&gt;JAVA_ARGS=&quot;-Xmx4096m&quot;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;avoid-plugin-overload&quot;&gt;7. Avoid Plugin Overload&lt;/h3&gt;
&lt;p&gt;With over a thousand plugins available, Jenkins offers its users many capabilities for empowering their CI/CD pipelines. However, keep performance in mind when adding plugins and external services to your pipeline. Integrating Jenkins with external services will often slow down the Jenkins UI and lead to adverse effects, like dropped agents or disconnections.&lt;/p&gt;
&lt;p&gt;In order to determine if a plugin is causing your builds to slow down, you can try running your builds with all or some plugins disabled. Gradually add each back to determine which is causing the bottleneck. Once you find the plugin (or combination of plugins) causing the performance issue, you have a few options:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;&lt;strong&gt;Find a replacement plugin&lt;/strong&gt; by searching the &lt;a href=&quot;https://plugins.jenkins.io/&quot;&gt;Jenkins Plugin Index&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;See if Jenkins has added native support&lt;/strong&gt; for this feature by checking &lt;a href=&quot;https://www.jenkins.io/changelog/&quot;&gt;the changelog&lt;/a&gt;. You may have to upgrade Jenkins to get the latest features, but this is generally a good idea for performance anyway.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Replace the plugin with a custom script&lt;/strong&gt; bearing in mind that this could introduce new performance issues. Still, if you install a complex plugin, but only use one or two small features, a script might be more efficient.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Remove the plugin&lt;/strong&gt; if you can live without it. Sometimes this is a worthwhile tradeoff.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;tracking-jenkins-performance&quot;&gt;Tracking Jenkins Performance&lt;/h2&gt;
&lt;p&gt;As you start tuning your Jenkins performance, you might be interested in adding a plugin to help monitor and improve performance. For example, you can leverage the &lt;a href=&quot;https://plugins.jenkins.io/monitoring/&quot;&gt;Jenkins Monitoring plugin&lt;/a&gt; to get deep insights into your CI/CD pipeline, including:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Errors and logs&lt;/li&gt;
&lt;li&gt;Charts for CPU, memory, and average system load&lt;/li&gt;
&lt;li&gt;Reports on HTTP sessions and HTTP response time&lt;/li&gt;
&lt;li&gt;Detailed statistics for build time and build steps&lt;/li&gt;
&lt;li&gt;Aggregated heap histogram for all nodes&lt;/li&gt;
&lt;/ul&gt;
&lt;figure&gt;
&lt;img src=&quot;https://i.imgur.com/mE6fSdy.png&quot; alt=&quot;Jenkins Performance Monitoring Tool&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Jenkins Performance Monitoring Tool&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This can help you assess the effectiveness of your performance tweaks and guide you as you continue to improve your Jenkins installation.&lt;/p&gt;
&lt;h2 id=&quot;wrapping-it-up&quot;&gt;Wrapping It Up&lt;/h2&gt;
&lt;p&gt;Jenkins’ responsiveness issues are common, especially when dealing with heavier builds. Broken Jenkins CI/CD pipelines can stall your development teams and create unnecessary dependencies. The tips discussed in this article should help you boost the performance of your Jenkins CI/CD pipeline significantly.&lt;/p&gt;
&lt;p&gt;Looking to make your builds more repeatable? &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt; replaces clunky bash scripts and makefiles by giving you a single understandable, consistent definition for your CI/CD builds and it works great with Jekyll. Learn more &lt;a href=&quot;https://earthly.dev/&quot;&gt;at Earthly.dev&lt;/a&gt;.&lt;/p&gt;</content><author><name>Milan Bhardwaj</name></author><category term="Tutorials" /><summary type="html">There’s nothing more frustrating than a sluggish continuous integration system. It slows down feedback loops and prevents code from reaching production quickly. While quick fixes like using a bigger CI server can buy you time, you ultimately have to invest in maintaining the performance of your continuous integration workflow.</summary></entry><entry><title type="html">Understanding Bash</title><link href="https://earthly.dev/blog/understanding-bash/" rel="alternate" type="text/html" title="Understanding Bash" /><published>2021-04-01T00:00:00-04:00</published><updated>2021-04-01T00:00:00-04:00</updated><id>https://earthly.dev/blog/understanding-bash</id><content type="html" xml:base="https://earthly.dev/blog/understanding-bash/">&lt;p&gt;Bash scripts give you the ability to turn a tedious series of commands into an easily runnable and repeatable script. With many real-world use cases, like using a bash script to run a continuous deployment process, create a series of files in a folder, or download the contents of several URLs, it’s worth your time to make sure bash scripting is in your programming toolbox.&lt;/p&gt;
&lt;p&gt;When you’re done with this article, you’ll not only be able to write bash scripts, but you’ll be able to write them using today’s accepted best practices.&lt;/p&gt;
&lt;h2 id=&quot;use-the-right-shebang&quot;&gt;Use the Right Shebang&lt;/h2&gt;
&lt;p&gt;The very first thing you’ll see at the top of every (well-written) bash script is what’s called a &lt;a href=&quot;https://www.in-ulm.de/~mascheck/various/shebang/&quot;&gt;&lt;em&gt;shebang&lt;/em&gt;&lt;/a&gt;. I’ll walk you through a couple of them here.&lt;/p&gt;
&lt;h3 id=&quot;binbash&quot;&gt;#!/bin/bash&lt;/h3&gt;
&lt;p&gt;The most common shebang is the one referring to the &lt;code&gt;bash&lt;/code&gt; executable:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Essentially it tells your terminal that when you run the script it should use &lt;code&gt;bash&lt;/code&gt; to execute it. It can be vital since you may be using a different shell in your machine (&lt;code&gt;zsh&lt;/code&gt;, &lt;code&gt;fish&lt;/code&gt;, &lt;code&gt;sh&lt;/code&gt;, etc.), but you designed the script to work specifically with bash. In many cases, it doesn’t matter what shell you’re using, but there can be some very noteworthy differences in how they work, leading a script to work in &lt;code&gt;bash&lt;/code&gt; but not &lt;code&gt;sh&lt;/code&gt;, for example.&lt;/p&gt;
&lt;h3 id=&quot;userbinenv-bash&quot;&gt;#!/user/bin/env bash&lt;/h3&gt;
&lt;p&gt;If you use the previous shebang, it’s crucial that you give the executable’s absolute path. You should be aware of this since there is an alternative, where you use the &lt;code&gt;bash&lt;/code&gt; executable found in the &lt;code&gt;$PATH&lt;/code&gt;. You can do so by writing:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/user/bin/env bash&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Some people like to customize their systems, either their personal system or production servers, resulting in the &lt;code&gt;bash&lt;/code&gt; executable not being located in &lt;code&gt;/bin/bash&lt;/code&gt; every time. Use the above line if you can’t be sure that the &lt;code&gt;bash&lt;/code&gt; executable will be located in the same path when this script is run.&lt;/p&gt;
&lt;h2 id=&quot;understand-common-sets&quot;&gt;Understand Common Sets&lt;/h2&gt;
&lt;p&gt;When you run a bash script, it will always run in a new &lt;em&gt;subshell&lt;/em&gt;. This means that any unique configurations you have in your current setup will not be used within the script execution. It also means that you can customize the environment that the script is running in without worrying about how your terminal will be affected.&lt;/p&gt;
&lt;p&gt;One way to change this environment is to use the &lt;code&gt;set&lt;/code&gt; command. I’ll go over the four most common ones and where they’re useful. I’ll show the short form for these sets in the examples throughout this article, but keep in mind that there are also long-form versions. I’ll mention those briefly.&lt;/p&gt;
&lt;h3 id=&quot;set--u&quot;&gt;set -u&lt;/h3&gt;
&lt;p&gt;By default, bash doesn’t do a lot of error handling. That’s left up to you. So if you want to have your script exit at a certain point, you have to define it. For example, you may have the following script:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;$TEST&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello World&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you run the script as shown above, it’ll give you the following output:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hello&lt;/span&gt; World&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See how it doesn’t complain that the &lt;code&gt;$TEST&lt;/code&gt; variable is not set? You can change that. Setting the &lt;code&gt;set -u&lt;/code&gt; (short form of &lt;code&gt;set -o nounset&lt;/code&gt;) command initially, you’re telling bash that you want it to fail if a variable is not set.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Script:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-u&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;$TEST&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello World&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Output:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;line&lt;/span&gt; 3: TEST: unbound variable&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Without &lt;code&gt;set -u&lt;/code&gt;, bash will use an empty string instead of the unset variable. When running &lt;code&gt;echo $TEST&lt;/code&gt;, that isn’t too dangerous. However, you may be running a command like &lt;code&gt;rm -rf /$TEST&lt;/code&gt; to define a path you want to delete. In this case, without &lt;code&gt;set -u&lt;/code&gt;, you would end up deleting your entire file system (which there’s no way to recover by default).&lt;/p&gt;
&lt;h3 id=&quot;set--x&quot;&gt;set -x&lt;/h3&gt;
&lt;p&gt;You’ll likely at some point have a big script where it’s tough to keep track of not just which commands are running what, but also which commands are outputting what. This is where &lt;code&gt;set -x&lt;/code&gt; comes to the rescue. Alternatively, you can write this as its long form, &lt;code&gt;set -o xtrace&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;When using &lt;code&gt;set -x&lt;/code&gt;, you get the following script and output.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Script:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-x&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-3&quot;&gt;&lt;a href=&quot;#cb7-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hi&lt;/span&gt;
&lt;span id=&quot;cb7-4&quot;&gt;&lt;a href=&quot;#cb7-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello World&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Output:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;+&lt;/span&gt; echo Hi&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hi&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;+&lt;/span&gt; echo Hello World&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hello&lt;/span&gt; World&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;set--e&quot;&gt;set -e&lt;/h3&gt;
&lt;p&gt;Sometimes you want to make sure that the entire script fails if one of the commands fails. This is not the default behavior in bash. You can see &lt;a href=&quot;https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html&quot;&gt;here&lt;/a&gt; that without any set options, bash is running without much error handling.&lt;/p&gt;
&lt;p&gt;To make sure the script fails, you should use &lt;code&gt;set -e&lt;/code&gt; (also known as &lt;code&gt;set -o errexit&lt;/code&gt;), probably the most common one.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Script:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-e&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-3&quot;&gt;&lt;a href=&quot;#cb9-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;foo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-4&quot;&gt;&lt;a href=&quot;#cb9-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello World&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Output:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;line&lt;/span&gt; 3: foo: command not found&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;set--eo-pipefail&quot;&gt;set -eo pipefail&lt;/h3&gt;
&lt;p&gt;Finally, we can make the script fail if a command in a pipeline fails. Usually, bash only looks for the exit code from the last command in a pipeline. If that’s 0, it’ll continue just fine. Exit code 0 is what we want, since in bash that means success.&lt;/p&gt;
&lt;p&gt;Let’s use the following script as an example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello World&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;set -eo pipefail&lt;/code&gt; will turn the output from:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hello&lt;/span&gt; World&lt;/span&gt;
&lt;span id=&quot;cb12-2&quot;&gt;&lt;a href=&quot;#cb12-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;line&lt;/span&gt; 2: foo: command not found&lt;/span&gt;
&lt;span id=&quot;cb12-3&quot;&gt;&lt;a href=&quot;#cb12-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hi&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;into:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hello&lt;/span&gt; World&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;line&lt;/span&gt; 2: foo: command not found&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The reason you may want the script to fail if a pipeline fails is the same as earlier with &lt;code&gt;set -u&lt;/code&gt;. Let’s modify the scenario a bit. You have the following in your script:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;va&quot;&gt;FILE_PATH&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;cat&lt;/span&gt; /tmp/path.txt &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sed&lt;/span&gt; ‘s/_/-/g&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-rf&lt;/span&gt; /&lt;span class=&quot;va&quot;&gt;$FILE_PATH&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note: &lt;code&gt;sed&lt;/code&gt; is a search-and-replace command. In this case it replaces underscores with dashes.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The intention is that &lt;code&gt;/tmp/path.txt&lt;/code&gt; contains &lt;code&gt;tmp_file.txt&lt;/code&gt;. Assume that the file &lt;code&gt;/tmp-file.txt&lt;/code&gt; exists on the system. In this case the script will work perfectly and delete &lt;code&gt;/tmp-file.txt&lt;/code&gt;. But what if &lt;code&gt;/tmp/path.txt&lt;/code&gt; doesn’t exist? &lt;code&gt;cat /tmp/path.txt&lt;/code&gt; will fail, but the script won’t. Now you’ve deleted your entire filesystem, but &lt;code&gt;set -eo pipefail&lt;/code&gt; will prevent this.&lt;/p&gt;
&lt;h3 id=&quot;sets-in-summary&quot;&gt;Sets in Summary&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Set&lt;/th&gt;
&lt;th&gt;Long form&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;set -u&lt;/td&gt;
&lt;td&gt;set -o nounset&lt;/td&gt;
&lt;td&gt;Exits script on undefined variables&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;set -x&lt;/td&gt;
&lt;td&gt;set -o xtrace&lt;/td&gt;
&lt;td&gt;Shows command currently executing&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;set -e&lt;/td&gt;
&lt;td&gt;set -o errexit&lt;/td&gt;
&lt;td&gt;Exits script on error&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;set -eo pipefail&lt;/td&gt;
&lt;td&gt;set -eo pipefail&lt;/td&gt;
&lt;td&gt;Exits script on pipeline fail&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&quot;use-error-checking-tools&quot;&gt;Use Error Checking Tools&lt;/h2&gt;
&lt;p&gt;Although you may be familiar with all the best practices, it can be tough to remember them all when your script is coming to life. Luckily there are tools available to help, like &lt;a href=&quot;https://www.shellcheck.net/#&quot;&gt;ShellCheck&lt;/a&gt;. ShellCheck has both a browser version and a command-line tool, but for this article, let’s work with the command-line version. You can find &lt;a href=&quot;https://github.com/koalaman/shellcheck#installing&quot;&gt;installation instructions here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We’ll use the following script as an example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;What&amp;#39;s your name?&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;NAME&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello &lt;span class=&quot;va&quot;&gt;$NAME&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By saving this in a script in a file called &lt;code&gt;greeting.sh&lt;/code&gt; and running &lt;code&gt;shellcheck greeting.sh&lt;/code&gt;, you get the following output in your terminal:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;In greeting.sh line 1:
echo &amp;quot;What&amp;#39;s your name?&amp;quot;
^-- SC2148: Tips depend on target shell and yours is unknown. Add a shebang or a &amp;#39;shell&amp;#39; directive.


In greeting.sh line 2:
read NAME
^--^ SC2162: read without -r will mangle backslashes.


In greeting.sh line 3:
echo Hello $NAME
           ^---^ SC2086: Double quote to prevent globbing and word splitting.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see, &lt;code&gt;shellcheck&lt;/code&gt; doesn’t just tell you what you need to change, but also why it needs to be changed. This is a valuable resource, not just for improving your scripts, but also to get better at writing them in the first place.&lt;/p&gt;
&lt;p&gt;With these tips, you’ll end up with the following script:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb17&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb17-1&quot;&gt;&lt;a href=&quot;#cb17-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb17-2&quot;&gt;&lt;a href=&quot;#cb17-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; “What’s your name&lt;span class=&quot;pp&quot;&gt;?&lt;/span&gt;”&lt;/span&gt;
&lt;span id=&quot;cb17-3&quot;&gt;&lt;a href=&quot;#cb17-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-r&lt;/span&gt; &lt;span class=&quot;va&quot;&gt;NAME&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb17-4&quot;&gt;&lt;a href=&quot;#cb17-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; Hello “&lt;span class=&quot;va&quot;&gt;$NAME&lt;/span&gt;”&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;understand-variable-naming-and-declaration&quot;&gt;Understand Variable Naming and Declaration&lt;/h2&gt;
&lt;p&gt;As you saw earlier, we tried to use the &lt;code&gt;$TEST&lt;/code&gt; variable. Variables can open up a whole world of opportunities, but they can also be tricky to work with. Let’s go over some of the common scenarios for working with variables.&lt;/p&gt;
&lt;h3 id=&quot;assigning-variables&quot;&gt;Assigning Variables&lt;/h3&gt;
&lt;p&gt;Assigning a variable in bash is reasonably straightforward, using the &lt;code&gt;=&lt;/code&gt; symbol. Here’s an example of assigning “Hello World” to a &lt;code&gt;$TEST&lt;/code&gt; variable:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; MSG=&lt;span class=&quot;st&quot;&gt;&amp;quot;Hello world!&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-2&quot;&gt;&lt;a href=&quot;#cb18-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; echo &lt;span class=&quot;va&quot;&gt;$MSG&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-3&quot;&gt;&lt;a href=&quot;#cb18-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Hello&lt;/span&gt; world!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;using-variables-inside-strings&quot;&gt;Using Variables Inside Strings&lt;/h3&gt;
&lt;p&gt;There are multiple ways to use a variable that you’ve assigned a value. As an example, we’ve assigned &lt;code&gt;foo=uname&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&quot;double-quotes&quot;&gt;Double Quotes&lt;/h4&gt;
&lt;p&gt;If you want to echo the contents of a variable, then use double quotes. It will expand what’s inside the variable and print that to the screen.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb19&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb19-1&quot;&gt;&lt;a href=&quot;#cb19-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; foo=”uname”&lt;/span&gt;
&lt;span id=&quot;cb19-2&quot;&gt;&lt;a href=&quot;#cb19-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; echo &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$foo&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-3&quot;&gt;&lt;a href=&quot;#cb19-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;uname&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;single-quotes&quot;&gt;Single Quotes&lt;/h4&gt;
&lt;p&gt;In some cases, you don’t want to output a variable’s contents, but maybe write an explanation of what that variable is used for. To avoid expansion, use single quotes:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb20&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb20-1&quot;&gt;&lt;a href=&quot;#cb20-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; foo=”uname”&lt;/span&gt;
&lt;span id=&quot;cb20-2&quot;&gt;&lt;a href=&quot;#cb20-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; echo &lt;span class=&quot;st&quot;&gt;&amp;#39;$foo&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-3&quot;&gt;&lt;a href=&quot;#cb20-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;va&quot;&gt;$foo&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This also means that you don’t have to manually escape the &lt;code&gt;$&lt;/code&gt; symbol, which you otherwise would need to in the case of double quotes.&lt;/p&gt;
&lt;h4 id=&quot;backticks&quot;&gt;Backticks&lt;/h4&gt;
&lt;p&gt;The third option for using a variable is backticks. Use this when you want the contents of the variable to be run as a shell command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb21&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb21-1&quot;&gt;&lt;a href=&quot;#cb21-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; foo=”uname”&lt;/span&gt;
&lt;span id=&quot;cb21-2&quot;&gt;&lt;a href=&quot;#cb21-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; echo &lt;span class=&quot;kw&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$foo&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb21-3&quot;&gt;&lt;a href=&quot;#cb21-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Linux&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;using-curly-brackets&quot;&gt;Using Curly Brackets&lt;/h3&gt;
&lt;p&gt;You can get away with merely referring to a variable by writing &lt;code&gt;$FOO&lt;/code&gt;. However, you may want to refer to a variable inside a string or concatenate it with another. Take a look at the following example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb22&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb22-1&quot;&gt;&lt;a href=&quot;#cb22-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; FOO=&lt;span class=&quot;st&quot;&gt;&amp;quot;Hel&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-2&quot;&gt;&lt;a href=&quot;#cb22-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; echo &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$FOOlo&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; world&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this case, bash would try to find the variable &lt;code&gt;$FOOlo&lt;/code&gt;, but we just wanted to print “Hello world.” To make this work, you will have to do the following:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb23&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb23-1&quot;&gt;&lt;a href=&quot;#cb23-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; FOO=&lt;span class=&quot;st&quot;&gt;&amp;quot;Hel&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-2&quot;&gt;&lt;a href=&quot;#cb23-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; echo &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;${FOO}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;lo world&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is most likely useful when you want to use a variable to define a path, like &lt;code&gt;/opt/${ENVIRONMENT}_build.txt&lt;/code&gt;. Without curly brackets, the script would try to look up &lt;code&gt;$ENVIRONMENT_build&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;properly-set-permissions&quot;&gt;Properly Set Permissions&lt;/h2&gt;
&lt;p&gt;One of the pitfalls that I remember running into time and time again when I started making bash scripts was remembering that &lt;a href=&quot;https://www.guru99.com/file-permissions.html&quot;&gt;permissions&lt;/a&gt; had to be set right. See, when you make a file with, for example, &lt;code&gt;touch&lt;/code&gt;, it gives read/write permissions to the owner and read rights to everyone else. This means that you’ll get a &lt;code&gt;permission denied&lt;/code&gt; error when you try to run the script.&lt;/p&gt;
&lt;p&gt;Luckily this is easily fixed. Run &lt;code&gt;chmod +x script.sh&lt;/code&gt;, and now everyone is allowed to run the script.&lt;/p&gt;
&lt;p&gt;However, do be aware that changing permissions can impose security risks. Read more about &lt;a href=&quot;https://www.linux.com/training-tutorials/understanding-linux-file-permissions/&quot;&gt;Linux file permissions&lt;/a&gt; before you start changing permissions blindly.&lt;/p&gt;
&lt;h2 id=&quot;ensure-readability&quot;&gt;Ensure Readability&lt;/h2&gt;
&lt;p&gt;One of the biggest pitfalls that newcomers run into is forgetting about readability. It’s easy to get caught up in wanting to have a working script, and maybe you’re even used to running everything manually in the terminal, where you want to type as little as possible.&lt;/p&gt;
&lt;p&gt;When it comes to scripts, you want to make sure that you can still easily remember what’s happening six months down the line. An easy way to do this is by using more extended options (&lt;code&gt;--quiet&lt;/code&gt; instead of &lt;code&gt;-q&lt;/code&gt;), using longer variable names (&lt;code&gt;MESSAGE&lt;/code&gt; instead of &lt;code&gt;MSG&lt;/code&gt;), and writing comments.&lt;/p&gt;
&lt;p&gt;You can write commands using a hash mark, after which you can write your comment, like so:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Below line will echo “Hello World!”
echo “Hello World!”&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;understand-your-script-in-relation-to-cli&quot;&gt;Understand Your Script in Relation to CLI&lt;/h2&gt;
&lt;p&gt;When reading this article, you may have noticed that many code examples are being run straight in the terminal rather than written as a bash script. There’s a good reason for that! You can write everything you write in a bash script directly in the terminal.&lt;/p&gt;
&lt;p&gt;There is one significant difference between executing a script and typing the commands in your terminal. When you run a script, it’ll start up a new, clean shell in which the script will run. This means that no variables set in your terminal will interfere with your script.&lt;/p&gt;
&lt;p&gt;For example, if you set &lt;code&gt;TEST=”hello”&lt;/code&gt; in your shell and run &lt;code&gt;echo $TEST&lt;/code&gt; inside a script, it will print nothing to your screen.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;At this point, you should be ready to venture into the exciting world of bash scripting. You’ve learned about common shebangs, what &lt;code&gt;set&lt;/code&gt; does, and how it can improve the error handling of your scripts, as well as understanding some general pitfalls developers run into with bash.&lt;/p&gt;
&lt;p&gt;So go ahead and automate those annoying commands you’ve been typing out every day. Tired of manually going into your browser and finding the git repo you’re working on? Make a script to parse the remote git URL and open it automatically. Maybe you have to rename a bunch of files. Make a script that can loop through them and rename them. The world is your oyster.&lt;/p&gt;</content><author><name>Kasper Siig</name></author><category term="Tutorials" /><summary type="html">Bash scripts give you the ability to turn a tedious series of commands into an easily runnable and repeatable script. With many real-world use cases, like using a bash script to run a continuous deployment process, create a series of files in a folder, or download the contents of several URLs, it’s worth your time to make sure bash scripting is in your programming toolbox.</summary></entry><entry><title type="html">Compiling Containers - Dockerfiles, LLVM, and BuildKit</title><link href="https://earthly.dev/blog/compiling-containers-dockerfiles-llvm-and-buildkit/" rel="alternate" type="text/html" title="Compiling Containers - Dockerfiles, LLVM, and BuildKit" /><published>2021-03-17T00:00:00-04:00</published><updated>2021-03-17T00:00:00-04:00</updated><id>https://earthly.dev/blog/compiling-containers-dockerfiles-llvm-and-buildkit</id><content type="html" xml:base="https://earthly.dev/blog/compiling-containers-dockerfiles-llvm-and-buildkit/">&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;How are containers made? Usually, from a series of statements like &lt;code&gt;RUN&lt;/code&gt;, &lt;code&gt;FROM&lt;/code&gt;, and &lt;code&gt;COPY&lt;/code&gt;, which are put into a Dockerfile and built. But how are those commands turned into a container image and then a running container? We can build up an intuition for how this works by understanding the phases involved and creating a container image ourselves. We will create an image programmatically and then develop a trivial syntactic frontend and use it to build an image.&lt;/p&gt;
&lt;h3 id=&quot;game-plan&quot;&gt;Game Plan&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;☑️ Intro&lt;/li&gt;
&lt;li&gt;☐️ Background&lt;/li&gt;
&lt;li&gt;&lt;input type=&quot;checkbox&quot; disabled=&quot;&quot; /&gt;
Understanding Compiler Stages and BuildKit&lt;/li&gt;
&lt;li&gt;&lt;input type=&quot;checkbox&quot; disabled=&quot;&quot; /&gt;
Programmatically Creating an Image&lt;/li&gt;
&lt;li&gt;&lt;input type=&quot;checkbox&quot; disabled=&quot;&quot; /&gt;
Building a Frontend for BuildKit&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;on-docker-build&quot;&gt;On &lt;code&gt;Docker Build&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;We can create container images in several ways. We can use Buildpacks, we can use build tools like Bazel or sbt, but by far, the most common way images are built is using &lt;code&gt;docker build&lt;/code&gt; with a Dockerfile. The familiar base images Alpine, Ubuntu, and Debian are all created this way.&lt;/p&gt;
&lt;p&gt;Here is an example Dockerfile:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot; data-startFrom=&quot;100&quot;&gt;&lt;pre class=&quot;sourceCode numberSource dockerfile numberLines&quot;&gt;&lt;code class=&quot;sourceCode dockerfile&quot; style=&quot;counter-reset: source-line 99;&quot;&gt;&lt;span id=&quot;cb1-100&quot;&gt;&lt;a href=&quot;#cb1-100&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; alpine&lt;/span&gt;
&lt;span id=&quot;cb1-101&quot;&gt;&lt;a href=&quot;#cb1-101&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;COPY&lt;/span&gt; README.md README.md&lt;/span&gt;
&lt;span id=&quot;cb1-102&quot;&gt;&lt;a href=&quot;#cb1-102&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;RUN&lt;/span&gt; echo &lt;span class=&quot;st&quot;&gt;&amp;quot;standard docker build&amp;quot;&lt;/span&gt; &amp;gt; /built.txt&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We will be using variations on this Dockerfile throughout this tutorial.&lt;/p&gt;
&lt;p&gt;We can build it like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker build . -t test&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;But what is happening when you call &lt;code&gt;docker build&lt;/code&gt;? To understand that, we will need a little background.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;p&gt;A docker image is made up of layers. Those layers form an immutable filesystem. A container image also has some descriptive data, such as the start-up command, the ports to expose, and volumes to mount. When you &lt;code&gt;docker run&lt;/code&gt; an image, it starts up inside a container runtime.&lt;/p&gt;
&lt;p&gt;I like to think about images and containers by analogy. If an image is like an executable, then a container is like a process. You can run multiple containers from one image, and a running image isn’t an image at all but a container.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/1-2.png&quot; title=&quot;fig:&quot; alt=&quot;An image is like an executable&quot; /&gt;
&lt;/div&gt;
&lt;p&gt;Continuing our analogy, &lt;a href=&quot;https://github.com/moby/buildkit&quot;&gt;BuildKit&lt;/a&gt; is a compiler, just like &lt;a href=&quot;https://en.wikipedia.org/wiki/LLVM&quot;&gt;LLVM&lt;/a&gt;. But whereas a compiler takes source code and libraries and produces an executable, BuildKit takes a Dockerfile and a file path and creates a container image.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/099.png&quot; alt=&quot;BuildKit is like a compiler for Docker images&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;BuildKit is like a compiler for Docker images&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;Docker build uses BuildKit, to turn a Dockerfile into a docker image, OCI image, or another image format. In this walk-through, we will primarily use BuildKit directly.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/buildctl-2.png&quot; alt=&quot;Docker Daemon with BuildKit Daemon inside it&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Docker Daemon with BuildKit Daemon inside it&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;This &lt;a href=&quot;https://earthly.dev/blog/what-is-buildkit-and-what-can-i-do-with-it/&quot;&gt;primer on using buildkit&lt;/a&gt; supplies some helpful background on using BuildKit, &lt;code&gt;buildkitd&lt;/code&gt;, and &lt;code&gt;buildctl&lt;/code&gt; via the command-line. However, the only prerequisite for today is running &lt;code&gt;brew install buildkit&lt;/code&gt; or the appropriate OS &lt;a href=&quot;https://github.com/moby/buildkit#quick-start&quot;&gt;equivalent&lt;/a&gt; steps.&lt;/p&gt;
&lt;h2 id=&quot;how-do-compilers-work&quot;&gt;How Do Compilers Work?&lt;/h2&gt;
&lt;p&gt;A traditional compiler takes code in a high-level language and lowers it to a lower-level language. In most conventional ahead-of-time compilers, the final target is machine code. Machine code is a low-level programming language that your CPU understands&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Fun Fact: Machine Code VS. Assembly&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Machine code is written in binary. This makes it hard for a human to understand. Assembly code is a plain-text representation of machine code that is designed to be somewhat human-readable. There is generally a 1-1 mapping between instructions the machine understands (in machine code) and the OpCodes in Assembly&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Compiling the classic c “Hello, World” into x86 assembly code using the CLANG frontend for LLVM looks like this:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/compilingc.png&quot; alt=&quot;Compiling Hello World to X86 assembly&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Compiling Hello World to X86 assembly&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;Creating an image from a dockerfile works a similar way:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/build-an-image.png&quot; alt=&quot;Compiling Docker Image&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Compiling Docker Image&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;BuildKit is passed the Dockerfile and the build context, which is the present working directory in the above diagram. In simplified terms, each line in the dockerfile is turned into a layer in the resulting image. One significant way image building differs from compiling is this build context. A compiler’s input is limited to source code, whereas &lt;code&gt;docker build&lt;/code&gt; takes a reference to the host filesystem as an input and uses it to perform actions such as &lt;code&gt;COPY&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;there-is-a-catch&quot;&gt;There Is a Catch&lt;/h2&gt;
&lt;p&gt;The earlier diagram of compiling “Hello, World” in a single step missed a vital detail. Computer hardware is not a singular thing. If every compiler were a hand-coded mapping from a high-level language to x86 machine code, then moving to the Apple M1 processor would be quite challenging because it has a different instruction set.&lt;/p&gt;
&lt;p&gt;Compiler authors have overcome this challenge by splitting compilation into phases. The traditional phases are the frontend, the backend, and the middle. The middle phase is sometimes called the optimizer, and it deals primarily with an internal representation (IR).&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/3stagebuild.png&quot; alt=&quot;Three stage build process&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Three stage build process&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;This staged approach means you don’t need a new compiler for each new machine architecture. Instead, you just need a new backend. Here is an example of what that looks like in &lt;a href=&quot;https://llvm.org/&quot;&gt;LLVM&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/backends.png&quot; alt=&quot;Backends of LLVM&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Backends of LLVM&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&quot;intermediate-representations&quot;&gt;Intermediate Representations&lt;/h2&gt;
&lt;p&gt;This multiple backend approach allows LLVM to target ARM, X86, and many other machine architectures using LLVM Intermediate Representation (IR) as a standard protocol. LLVM IR is a human-readable programming language that backends need to be able to take as input. To create a new backend, you need to write a translator from LLVM IR to your target machine code. That translation is the primary job of each backend.&lt;/p&gt;
&lt;p&gt;Once you have this IR, you have a protocol that various phases of the compiler can use as an interface, and you can build not just many backends but many frontends as well. LLVM has frontends for numerous languages, including C++, Julia, Objective-C, Rust, and Swift.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/frontends-2.png&quot; alt=&quot;One compiler, with many frontend and backends&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;One compiler, with many frontend and backends&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;If you can write a translation from your language to LLVM IR, LLVM can translate that IR into machine code for all the backends it supports. This translation function is the primary job of a compiler frontend.&lt;/p&gt;
&lt;p&gt;In practice, there is much more to it than that. Frontends need to tokenize and parse input files, and they need to return pleasant errors. Backends often have target-specific optimizations to perform and heuristics to apply. But for this tutorial, the critical point is that having a standard representation ends up being a bridge that connects many front ends with many backends. This shared interface removes the need to create a compiler for every combination of language and machine architecture. It is a simple but very empowering trick!&lt;/p&gt;
&lt;h2 id=&quot;buidkit&quot;&gt;BuidKit&lt;/h2&gt;
&lt;p&gt;Images, unlike executables, have their own isolated filesystem. Nevertheless, the task of building an image looks very similar to compiling an executable. They can have varying syntax (dockerfile1.0, dockerfile1.2), and the result must target several machine architectures (arm64 vs. x86_64).&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“LLB is to Dockerfile what LLVM IR is to C” - &lt;a href=&quot;https://github.com/moby/buildkit/blob/master/README.md&quot;&gt;BuildKit Readme&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This similarity was not lost on the BuildKit creators. BuildKit has its own intermediate representation, LLB. And where LLVM IR has things like function calls and garbage-collection strategies, LLB has mounting filesystems and executing statements.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/LLBIR-fixed.png&quot; alt=&quot;LLVM IR VS. LLB&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;LLVM IR VS. LLB&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/moby/buildkit/blob/ebd98bcbe600c662a72ce9725417540f277be4d6/solver/pb/ops.proto&quot;&gt;LLB&lt;/a&gt; is defined as a protocol buffer, and this means that BuildKit frontends can make GRPC requests against buildkitd to build a container directly.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/Send-LLB.png&quot; alt=&quot;LLVM IR VS. LLB&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;LLVM IR VS. LLB&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;h2 id=&quot;programmatically-making-an-image&quot;&gt;Programmatically Making An Image&lt;/h2&gt;
Alright, enough background. Let’s programmatically generate the LLB for an image and then build an image.&lt;br /&gt;

&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;ℹ️ Using Go&lt;/p&gt;
&lt;p&gt;In this example, we will be using Go which lets us leverage existing BuildKit libraries, but it’s possible to accomplish this in any language with Protocol Buffer support.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Import LLB defintions:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import (
    &amp;quot;github.com/moby/buildkit/client/llb&amp;quot;
)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Create LLB for an Alpine image:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;func createLLBState() llb.State {
    return llb.Image(&amp;quot;docker.io/library/alpine&amp;quot;).
        File(llb.Copy(llb.Local(&amp;quot;context&amp;quot;), &amp;quot;README.md&amp;quot;, &amp;quot;README.md&amp;quot;)).
        Run(llb.Args([]string{&amp;quot;/bin/sh&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;echo \&amp;quot;programmatically built\&amp;quot; &amp;gt; /built.txt&amp;quot;})).
    Root()
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We are accomplishing the equivalent of a &lt;code&gt;FROM&lt;/code&gt; by using &lt;code&gt;llb.Image&lt;/code&gt;. Then, we copy a file from the local file system into the image using &lt;code&gt;File&lt;/code&gt; and &lt;code&gt;Copy&lt;/code&gt;. Finally, we &lt;code&gt;RUN&lt;/code&gt; a command to echo some text to a file. LLB has many more operations, but you can recreate many standard images with these three building blocks.&lt;/p&gt;
&lt;p&gt;The final thing we need to do is turn this into protocol-buffer and emit it to standard out:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;func main() {

    dt, err := createLLBState().Marshal(context.TODO(), llb.LinuxAmd64)
    if err != nil {
        panic(err)
    }
    llb.WriteTo(dt, os.Stdout)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s look at the what this generates using the &lt;code&gt;dump-llb&lt;/code&gt; option of buildctl:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; go run ./writellb/writellb.go | \
 buildctl debug dump-llb | \
 jq .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We get this JSON formatted LLB:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{
  &amp;quot;Op&amp;quot;: {
    &amp;quot;Op&amp;quot;: {
      &amp;quot;source&amp;quot;: {
        &amp;quot;identifier&amp;quot;: &amp;quot;local://context&amp;quot;,
        &amp;quot;attrs&amp;quot;: {
          &amp;quot;local.unique&amp;quot;: &amp;quot;s43w96rwjsm9tf1zlxvn6nezg&amp;quot;
        }
      }
    },
    &amp;quot;constraints&amp;quot;: {}
  },
  &amp;quot;Digest&amp;quot;: &amp;quot;sha256:c3ca71edeaa161bafed7f3dbdeeab9a5ab34587f569fd71c0a89b4d1e40d77f6&amp;quot;,
  &amp;quot;OpMetadata&amp;quot;: {
    &amp;quot;caps&amp;quot;: {
      &amp;quot;source.local&amp;quot;: true,
      &amp;quot;source.local.unique&amp;quot;: true
    }
  }
}
{
  &amp;quot;Op&amp;quot;: {
    &amp;quot;Op&amp;quot;: {
      &amp;quot;source&amp;quot;: {
        &amp;quot;identifier&amp;quot;: &amp;quot;docker-image://docker.io/library/alpine:latest&amp;quot;
      }
    },
    &amp;quot;platform&amp;quot;: {
      &amp;quot;Architecture&amp;quot;: &amp;quot;amd64&amp;quot;,
      &amp;quot;OS&amp;quot;: &amp;quot;linux&amp;quot;
    },
    &amp;quot;constraints&amp;quot;: {}
  },
  &amp;quot;Digest&amp;quot;: &amp;quot;sha256:665ba8b2cdc0cb0200e2a42a6b3c0f8f684089f4cd1b81494fbb9805879120f7&amp;quot;,
  &amp;quot;OpMetadata&amp;quot;: {
    &amp;quot;caps&amp;quot;: {
      &amp;quot;source.image&amp;quot;: true
    }
  }
}
{
  &amp;quot;Op&amp;quot;: {
    &amp;quot;inputs&amp;quot;: [
      {
        &amp;quot;digest&amp;quot;: &amp;quot;sha256:665ba8b2cdc0cb0200e2a42a6b3c0f8f684089f4cd1b81494fbb9805879120f7&amp;quot;,
        &amp;quot;index&amp;quot;: 0
      },
      {
        &amp;quot;digest&amp;quot;: &amp;quot;sha256:c3ca71edeaa161bafed7f3dbdeeab9a5ab34587f569fd71c0a89b4d1e40d77f6&amp;quot;,
        &amp;quot;index&amp;quot;: 0
      }
    ],
    &amp;quot;Op&amp;quot;: {
      &amp;quot;file&amp;quot;: {
        &amp;quot;actions&amp;quot;: [
          {
            &amp;quot;input&amp;quot;: 0,
            &amp;quot;secondaryInput&amp;quot;: 1,
            &amp;quot;output&amp;quot;: 0,
            &amp;quot;Action&amp;quot;: {
              &amp;quot;copy&amp;quot;: {
                &amp;quot;src&amp;quot;: &amp;quot;/README.md&amp;quot;,
                &amp;quot;dest&amp;quot;: &amp;quot;/README.md&amp;quot;,
                &amp;quot;mode&amp;quot;: -1,
                &amp;quot;timestamp&amp;quot;: -1
              }
            }
          }
        ]
      }
    },
    &amp;quot;platform&amp;quot;: {
      &amp;quot;Architecture&amp;quot;: &amp;quot;amd64&amp;quot;,
      &amp;quot;OS&amp;quot;: &amp;quot;linux&amp;quot;
    },
    &amp;quot;constraints&amp;quot;: {}
  },
  &amp;quot;Digest&amp;quot;: &amp;quot;sha256:ba425dda86f06cf10ee66d85beda9d500adcce2336b047e072c1f0d403334cf6&amp;quot;,
  &amp;quot;OpMetadata&amp;quot;: {
    &amp;quot;caps&amp;quot;: {
      &amp;quot;file.base&amp;quot;: true
    }
  }
}
{
  &amp;quot;Op&amp;quot;: {
    &amp;quot;inputs&amp;quot;: [
      {
        &amp;quot;digest&amp;quot;: &amp;quot;sha256:ba425dda86f06cf10ee66d85beda9d500adcce2336b047e072c1f0d403334cf6&amp;quot;,
        &amp;quot;index&amp;quot;: 0
      }
    ],
    &amp;quot;Op&amp;quot;: {
      &amp;quot;exec&amp;quot;: {
        &amp;quot;meta&amp;quot;: {
          &amp;quot;args&amp;quot;: [
            &amp;quot;/bin/sh&amp;quot;,
            &amp;quot;-c&amp;quot;,
            &amp;quot;echo \&amp;quot;programmatically built\&amp;quot; &amp;gt; /built.txt&amp;quot;
          ],
          &amp;quot;cwd&amp;quot;: &amp;quot;/&amp;quot;
        },
        &amp;quot;mounts&amp;quot;: [
          {
            &amp;quot;input&amp;quot;: 0,
            &amp;quot;dest&amp;quot;: &amp;quot;/&amp;quot;,
            &amp;quot;output&amp;quot;: 0
          }
        ]
      }
    },
    &amp;quot;platform&amp;quot;: {
      &amp;quot;Architecture&amp;quot;: &amp;quot;amd64&amp;quot;,
      &amp;quot;OS&amp;quot;: &amp;quot;linux&amp;quot;
    },
    &amp;quot;constraints&amp;quot;: {}
  },
  &amp;quot;Digest&amp;quot;: &amp;quot;sha256:d2d18486652288fdb3516460bd6d1c2a90103d93d507a9b63ddd4a846a0fca2b&amp;quot;,
  &amp;quot;OpMetadata&amp;quot;: {
    &amp;quot;caps&amp;quot;: {
      &amp;quot;exec.meta.base&amp;quot;: true,
      &amp;quot;exec.mount.bind&amp;quot;: true
    }
  }
}
{
  &amp;quot;Op&amp;quot;: {
    &amp;quot;inputs&amp;quot;: [
      {
        &amp;quot;digest&amp;quot;: &amp;quot;sha256:d2d18486652288fdb3516460bd6d1c2a90103d93d507a9b63ddd4a846a0fca2b&amp;quot;,
        &amp;quot;index&amp;quot;: 0
      }
    ],
    &amp;quot;Op&amp;quot;: null
  },
  &amp;quot;Digest&amp;quot;: &amp;quot;sha256:fda9d405d3c557e2bd79413628a435da0000e75b9305e52789dd71001a91c704&amp;quot;,
  &amp;quot;OpMetadata&amp;quot;: {
    &amp;quot;caps&amp;quot;: {
      &amp;quot;constraints&amp;quot;: true,
      &amp;quot;platform&amp;quot;: true
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Looking through the output, we can see how our code maps to LLB.&lt;/p&gt;
&lt;p&gt;Here is our &lt;code&gt;Copy&lt;/code&gt; as part of a FileOp:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;    &amp;quot;Action&amp;quot;: {
              &amp;quot;copy&amp;quot;: {
                &amp;quot;src&amp;quot;: &amp;quot;/README.md&amp;quot;,
                &amp;quot;dest&amp;quot;: &amp;quot;/README.md&amp;quot;,
                &amp;quot;mode&amp;quot;: -1,
                &amp;quot;timestamp&amp;quot;: -1
              }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here is mapping our build context for use in our &lt;code&gt;COPY&lt;/code&gt; command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  &amp;quot;Op&amp;quot;: {
      &amp;quot;source&amp;quot;: {
        &amp;quot;identifier&amp;quot;: &amp;quot;local://context&amp;quot;,
        &amp;quot;attrs&amp;quot;: {
          &amp;quot;local.unique&amp;quot;: &amp;quot;s43w96rwjsm9tf1zlxvn6nezg&amp;quot;
        }
      }&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Similarly, the output contains LLB that corresponds to our &lt;code&gt;RUN&lt;/code&gt; and &lt;code&gt;FROM&lt;/code&gt; commands.&lt;/p&gt;
&lt;h3 id=&quot;building-our-llb&quot;&gt;Building Our LLB&lt;/h3&gt;
&lt;p&gt;To build our image, we must first start &lt;code&gt;buildkitd&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker run --rm --privileged -d --name buildkit moby/buildkit
export BUILDKIT_HOST=docker-container://buildkit&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can then build our image like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;go run ./writellb/writellb.go | \
buildctl build \
--local context=. \
--output type=image,name=docker.io/agbell/test,push=true&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The output flag lets us specify what backend we want BuildKit to use. We will ask it to build an OCI image and push it to docker.io.&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;ℹ️ Real-World Usage&lt;/p&gt;
&lt;p&gt;In the real-world tool, we might want to programmatically make sure &lt;code&gt;buildkitd&lt;/code&gt; is running and send the RPC request directly to it, as well as provide friendly error messages. For tutorial purposes, we will skip all that.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We can run it like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; docker run -it --pull always agbell/test:latest /bin/sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And we can then see the results of our programmatic &lt;code&gt;COPY&lt;/code&gt; and &lt;code&gt;RUN&lt;/code&gt; commands:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/ # cat built.txt 
programmatically built
/ # ls README.md
README.md&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There we go! The &lt;a href=&quot;https://github.com/agbell/compiling-containers/blob/main/writellb/writellb.go&quot;&gt;full code example&lt;/a&gt; can be a great starting place for your own programmatic docker image building.&lt;/p&gt;
&lt;h2 id=&quot;a-true-frontend-for-buildkit&quot;&gt;A True Frontend for BuildKit&lt;/h2&gt;
&lt;p&gt;A true compiler front end does more than just emit hardcoded IR. A proper frontend takes in files, tokenizes them, parses them, generates a syntax tree, and then lowers that syntax tree into the internal representation. &lt;a href=&quot;https://matt-rickard.com/building-a-new-dockerfile-frontend/&quot;&gt;Mockerfiles&lt;/a&gt; are an example of such a frontend:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#syntax=r2d4/mocker
apiVersion: v1alpha1
images:
- name: demo
  from: ubuntu:16.04
  package:
    install:
    - curl
    - git
    - gcc&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And because Docker build supports the &lt;code&gt;#syntax&lt;/code&gt; command we can even build a Mockerfiles directly with &lt;code&gt;docker build&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker build -f mockerfile.yaml&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To support the #syntax command, all that is needed is to put the frontend in a docker image that accepts a GRPC request in the correct format, publish that image somewhere. At that point, anyone can use your frontend &lt;code&gt;docker build&lt;/code&gt; by just using &lt;code&gt;#syntax=yourimagename&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;building-our-own-example-frontend-for-docker-build&quot;&gt;Building Our Own Example Frontend for &lt;code&gt;Docker build&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;Building a tokenizer and a parser as a GRPC service is beyond the scope of this article. But we can get our feet wet by extracting and modifying an existing frontend. The standard &lt;a href=&quot;https://github.com/moby/buildkit/tree/master/frontend/dockerfile&quot;&gt;dockerfile frontend&lt;/a&gt; is easy to disentangle from the moby project. I’ve pulled the relevant parts out into a &lt;a href=&quot;https://github.com/agbell/compiling-containers/tree/main/ickfile&quot;&gt;stand-alone repo&lt;/a&gt;. Let’s make some trivial modifications to it and test it out.&lt;/p&gt;
&lt;p&gt;So far, we’ve only used the docker commands &lt;code&gt;FROM&lt;/code&gt;, &lt;code&gt;RUN&lt;/code&gt; and &lt;code&gt;COPY&lt;/code&gt;. At a surface level, with its capitalized commands, Dockerfile syntax looks a lot like the programming language &lt;a href=&quot;https://earthly.dev/blog/intercal-yaml-and-other-horrible-programming-languages/&quot;&gt;INTERCAL&lt;/a&gt;. Let change these commands to their INTERCAL equivalent and develop our own Ickfile format &lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Dockerfile&lt;/th&gt;
&lt;th style=&quot;text-align: center;&quot;&gt;Ickfile&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;FROM&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;COME FROM&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;RUN&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;PLEASE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;COPY&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;STASH&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;The modules in the dockerfile frontend split the parsing of the input file into several discreet steps, with execution flowing this way:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/compiling-containers-dockerfiles-llvm-and-buildkit/controlflow.png&quot; alt=&quot;ControlFlow from main.go to Dockerfile2LLB to Parser to Command.go&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;ControlFlow from main.go to Dockerfile2LLB to Parser to Command.go&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;For this tutorial, we are only going to make trivial changes to the frontend. We will leave all the stages intact and focus on customizing the existing commands to our tastes. To do this, all we need to do is change &lt;code&gt;command.go&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package command

// Define constants for the command strings
const (
    Copy        = &amp;quot;stash&amp;quot;
    Run         = &amp;quot;please&amp;quot;
    From        = &amp;quot;come_from&amp;quot;
    ...
)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we build our image:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;docker build . -t agbell/ick&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And we can use this image as a BuildKit frontend and build images with it like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#syntax=agbell/ick
COME_FROM alpine
STASH README.md README.md
PLEASE echo &amp;quot;custom frontend built&amp;quot; &amp;gt; /built.txt&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;DOCKER_BUILDKIT=1 docker build . -f ./Ickfile -t ick &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And we can run it just like any other image:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; docker run -it ick /bin/sh&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And we can then see results of our &lt;code&gt;STASH&lt;/code&gt; and &lt;code&gt;PLEASE&lt;/code&gt; commands:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;/ # cat built.txt 
custom frontend built
/ # ls README.md
README.md&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I’ve pushed this image to dockerhub. Anyone can start building images using our &lt;code&gt;ickfile&lt;/code&gt; format by adding &lt;code&gt;#syntax=agbell/ick&lt;/code&gt; to an existing Dockerfile. No manual installation is required!&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;ℹ️ Enabling BuildKit&lt;/p&gt;
&lt;p&gt;BuildKit is included but not enabled by default in the current version of Docker (&lt;code&gt;version 20.10.2&lt;/code&gt;). To instruct &lt;code&gt;docker build&lt;/code&gt; to use BuildKit set the following environment variable &lt;code&gt;DOCKER_BUILDKIT=1&lt;/code&gt;. This will not be necessary once BuildKit reaches general availability.&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We have learned that a three-phased structure borrowed from compilers powers building images, that an intermediate representation called LLB is the key to that structure. Empowered by the knowledge, we have produced two frontends for building images.&lt;/p&gt;
&lt;p&gt;This deep dive on frontends still leaves much to explore. If you want to learn more, I suggest looking into BuildKit workers. Workers do the actual building and are the secret behind &lt;code&gt;docker buildx&lt;/code&gt;, and &lt;a href=&quot;https://docs.docker.com/buildx/working-with-buildx/&quot;&gt;multi-archtecture builds&lt;/a&gt;. &lt;code&gt;docker build&lt;/code&gt; also has support for remote workers and cache mounts, both of which can lead to faster builds.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt; uses BuildKit internally for its repeatable build syntax. Without it, our containerized Makefile-like syntax would not be possible. If you want a saner CI process, then &lt;a href=&quot;https://earthly.dev/&quot;&gt;you should check it out&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;There is also much more to explore about how modern compilers work. Modern compilers often have many stages and more than one intermediate representation, and they are often able to do very sophisticated optimizations.&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The difference between the two is murky, but I like to think of a transpiler as something that translates from one human-readable text-based programming language to another. The java compiler translates Java code to java byte code, which is a binary format. Meanwhile, PureScript, which translates to JavaScript, is regarded as a transpiler because JavaScript is text-based.&lt;/p&gt;
&lt;section class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;Fun Fact: You may have heard the term transpiler or transcompiler in the past. Transpilers are compilers that transform one programming language into another. If all compilers translate from one language to another, then what makes something a transpiler?&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;Ick is the name of the INTERCAL compiler. Therefore Ickfile can be its Dockerfile equivalent.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;If you want to learn more about optimizing compilers, Matt Godbolt’s article on &lt;a href=&quot;https://queue.acm.org/detail.cfm?id=3372264&quot;&gt;C++ Optimizations&lt;/a&gt; is a great place to start. The book &lt;a href=&quot;https://www.amazon.com/Building-Optimizing-Compiler-Bob-Morgan/dp/155558179X&quot;&gt;Building an Optimizing Compiler&lt;/a&gt; is also often recommended online.&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Tutorials" /><summary type="html">How are containers made? Usually, from a series of statements like RUN, FROM, and COPY, which are put into a Dockerfile and built. But how are those commands turned into a container image and then a running container?</summary></entry><entry><title type="html">On YAML Discussions</title><link href="https://earthly.dev/blog/on-yaml-discussions/" rel="alternate" type="text/html" title="On YAML Discussions" /><published>2021-03-12T00:00:00-05:00</published><updated>2021-03-12T00:00:00-05:00</updated><id>https://earthly.dev/blog/on-yaml-discussions</id><content type="html" xml:base="https://earthly.dev/blog/on-yaml-discussions/">&lt;p&gt;My article about how &lt;a href=&quot;https://earthly.dev/blog/intercal-yaml-and-other-horrible-programming-languages/&quot;&gt;YAML makes a bad programming language&lt;/a&gt; &lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; generated a lot of great discussions online.&lt;/p&gt;
&lt;p&gt;Here are some highlights, lightly edited:&lt;/p&gt;
&lt;h2 id=&quot;config-traps&quot;&gt;Config Traps&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://news.ycombinator.com/item?id=26276420&quot;&gt;dkarl&lt;/a&gt; pointed out that putting things in config files that shouldn’t be there happens for many reasons:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Reason:&lt;/strong&gt; Pride in creating a “generic” system that can be configured to do all kinds of new things “without touching the code.”&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reality check:&lt;/strong&gt; only one or two programmers understand how to modify the config file, and changes have to go through the same life cycle as a code change, so you haven’t gained anything. You’ve only made it harder to onboard new programmers to the project.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reason:&lt;/strong&gt; Hope that if certain logic is encoded in config files, then it can never get complicated.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reality check:&lt;/strong&gt; Product requirements do not magically become simpler because of your implementation decisions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reason:&lt;/strong&gt; Hope that you can get non-programmers to code review your business logic.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Reality check:&lt;/strong&gt; the DSL you embedded in your config file isn’t as “human readable” as you think it is.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;dhall-is-strange&quot;&gt;DHALL is Strange&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://lobste.rs/s/1nxt6g/intercal_yaml_other_horrible#c_pc0dt6&quot;&gt;AndyC&lt;/a&gt; thought that Dhall was not the right answer to the YAML problem:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I agree with the problem, but disagree with the solution. Total languages don’t give you any useful engineering properties, but lack of side effects do (and Dhall also offers that).&lt;/p&gt;
&lt;p&gt;From the surface, it seems like HCL, jsonnet, and Cue, are just as suitable as Dhall, and probably more familiar (to varying degrees).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is an excellent point. &lt;a href=&quot;https://github.com/hashicorp/hcl&quot;&gt;HCL&lt;/a&gt; does look a bit less strange to outsiders, and Hashicorp already has mindshare in the DevOps community, and it certainly beats config templates.&lt;/p&gt;
&lt;h2 id=&quot;dsl-creation-story&quot;&gt;DSL Creation Story&lt;/h2&gt;
&lt;p&gt;Reddit user &lt;a href=&quot;https://www.reddit.com/r/programming/comments/ls6tgm/intercal_yaml_and_other_horrible_programming/gopf8fj/?utm_source=reddit&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;XANi_&lt;/a&gt; explained how DSL’s embedded in YAML keep getting created: &amp;gt; The vicious cycle of &amp;gt; * We don’t want config to be turing complete, we just need to declare some initial setup &amp;gt; &amp;gt; * Oops, we need to add some conditions. Just code it as data, changing config format is too much work &amp;gt; &amp;gt; * Oops, we need to add some templates. Just use &amp;lt;primary language’s popular templating library&amp;gt;, changing config format is too much work. &amp;gt; &amp;gt; * And congratulations, you have now written a DSL &amp;gt; &amp;gt;If you need conditions and flexibility, picking existing language is by FAR superior choice.&lt;/p&gt;
&lt;h2 id=&quot;rake-webpack-and-groovy&quot;&gt;Rake, Webpack, and Groovy&lt;/h2&gt;
&lt;p&gt;Many readers pointed out that their development community skipped right by this DSL dead end by using a full programming language for build and config needs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I always thought it was weird that a lot of web technologies take config files that are executable javascript. (Thinking of webpack). But it makes a lot of sense now, and I much prefer that approach. - &lt;a href=&quot;https://www.reddit.com/r/programming/comments/ls6tgm/intercal_yaml_and_other_horrible_programming/gopq0uv/?utm_source=reddit&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;Bunny&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;It’s fairly common in Pythonland [ to just use Python] …&lt;/p&gt;
&lt;p&gt;It’s an ideal solution for technically-savvy users in non-security sensitive contexts. - &lt;a href=&quot;https://www.reddit.com/r/programming/comments/ls6tgm/intercal_yaml_and_other_horrible_programming/gopy30z/?utm_source=reddit&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;&lt;strong&gt;crakers&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;I’m not convinced that just using programming language for your configuration files is actually that bad. For instance, with node, if you just use JS files that export an object instead of. JSON files, you end up with a lot more programmable and flexible thing. I don’t actually see the problem. - &lt;a href=&quot;https://www.reddit.com/r/programming/comments/ls6tgm/intercal_yaml_and_other_horrible_programming/goqm3z0/?utm_source=reddit&amp;amp;utm_medium=web2x&amp;amp;context=3&quot;&gt;light24bulbs&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;writing-a-parser&quot;&gt;Writing a Parser&lt;/h2&gt;
&lt;p&gt;Hillel Wayne wrote a &lt;a href=&quot;https://buttondown.email/hillelwayne/archive/a3fe2688-464d-4f98-ae6b-207e7b5a1255&quot;&gt;great newsletter&lt;/a&gt; on YAML, and the ways it’s abused. He pointed out that the main competition for embedding your DSL into YAML is writing a parser, and using YAML is just easier.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[YAML] preparses the content for us. This isn’t a big enough draw to YAMLize complex programming languages, but it’s a huge huge deal for small DSLs. I suspect that’s the main reason why semgrep uses YAML for its rules and why so many technologies jury-rig it into a configuration language&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;You can see the full commentary on the orginal article on &lt;a href=&quot;https://www.reddit.com/r/programming/comments/ls6tgm/intercal_yaml_and_other_horrible_programming/&quot;&gt;Reddit&lt;/a&gt;, on &lt;a href=&quot;https://news.ycombinator.com/item?id=26271582&quot;&gt;Hacker News&lt;/a&gt; and on &lt;a href=&quot;https://lobste.rs/s/1nxt6g/intercal_yaml_other_horrible&quot;&gt;Lobste.rs&lt;/a&gt;.&lt;/p&gt;
&lt;section class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;To clarify, YAML, when used as the syntax frontend for a domain-specific, vendor-specific, programming language is a bad idea. I am aware YAML is not a programming language itself.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Articles" /><category term="news" /><summary type="html">My article about how YAML makes a bad programming language 1 generated a lot of great discussions online. To clarify, YAML, when used as the syntax frontend for a domain-specific, vendor-specific, programming language is a bad idea. I am aware YAML is not a programming language itself.↩︎</summary></entry><entry><title type="html">Build Your Own Ngrok Clone With AWS</title><link href="https://earthly.dev/blog/build-your-own-ngrok-clone/" rel="alternate" type="text/html" title="Build Your Own Ngrok Clone With AWS" /><published>2021-03-11T00:00:00-05:00</published><updated>2021-03-11T00:00:00-05:00</updated><id>https://earthly.dev/blog/build-your-own-ngrok-clone</id><content type="html" xml:base="https://earthly.dev/blog/build-your-own-ngrok-clone/">&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://ngrok.com/&quot;&gt;Ngrok&lt;/a&gt; is a tool that allows you to create secure, publically accessible URLs for your locally running code. Just a simple &lt;code&gt;./ngrok http 3000&lt;/code&gt;, and your tunnel is up and running! It also comes with an inspector for all traffic traveling over its tunnels. Pretty slick right? However, for a stable domain it costs &lt;em&gt;at least&lt;/em&gt; $5/month, and it only goes up from there. Additionally, you’re limited in the number of connections and tunnels that you can make.&lt;/p&gt;
&lt;p&gt;However, it can be hard to trust fancy tools like &lt;code&gt;ngrok&lt;/code&gt; until you experience how the sausage is made; at least once. It may also be hard to explan yet &lt;em&gt;another&lt;/em&gt; recurring charge on the credit card to your partner. So, here is a tutorial to build yourself a DIY &lt;code&gt;ngrok&lt;/code&gt; for free (at least 12 months, after that its very cheap), using the &lt;a href=&quot;https://aws.amazon.com/free/&quot;&gt;AWS Free Tier&lt;/a&gt;, &lt;a href=&quot;https://www.nginx.com/&quot;&gt;NGINX&lt;/a&gt;, and (of course) &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt;. The result is a decent approximation that won’t break the bank.&lt;/p&gt;
&lt;h2 id=&quot;so-how-does-ngrok-work&quot;&gt;So, How Does &lt;code&gt;ngrok&lt;/code&gt; Work?&lt;/h2&gt;
&lt;p&gt;To understand why &lt;code&gt;ngrok&lt;/code&gt; is so cool, you’ll need to first understand how you would normally get traffic from the broader internet into your local machine. A typical flow would be something like this:&lt;/p&gt;
&lt;div class=&quot;wide&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/assets/images/build-your-own-ngrok-clone/without_ngrok.png&quot; alt=&quot;Diagram showing the flow of traffic from a users web browser, through the internet, a home router, and finally the users computer. It points out that the user controls the DNS lookup, router, and their machine.&quot; /&gt;&lt;br /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;This flow is normal for most of the machines on the internet today, but it has its downsides for local development. For instance, most home and non-commerical internet connections do not have a &lt;a href=&quot;https://whatismyipaddress.com/dynamic-static&quot;&gt;Static IP&lt;/a&gt; - which means you need to double-check your IP address before sending it out, or (more often) install and configure additional software to keep your DNS records up to date.&lt;/p&gt;
&lt;p&gt;Additionally, you’ll need to configure your router to forward that traffic to your machine. This configuration is typically fairly annoying to set up, and should also be turned off each time you arent using it, otherwise you are keeping your computer exposed to the internet at large! Its like putting a giant welcome mat out for hackers during their automated scans.&lt;/p&gt;
With this foundation, you can now understand why &lt;code&gt;ngrok&lt;/code&gt; (and our DIY one) is so cool! It removes the need for all this additional configuration, while also providing better security. All you need to do is add an extra computer into the mix, like this:
&lt;div class=&quot;wide&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/assets/images/build-your-own-ngrok-clone/with_ngrok.png&quot; alt=&quot;Diagram showing the flow of traffic from a users web browser, through the internet, a home router, and finally the users computer. It points out that the user controls the DNS lookup, router, and their machine.&quot; /&gt;&lt;br /&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Because you are using a &lt;a href=&quot;https://en.wikipedia.org/wiki/Reverse_proxy&quot;&gt;Reverse Proxy&lt;/a&gt; to get the traffic from the extra computer to yours, no additional configuration is required on your end. And, when you are done, you can simply shut down the extra machine, and there are no loose ends or open ports left to close!&lt;/p&gt;
&lt;p&gt;As mentioned above, this tutorial uses AWS to create the proxy. Other cloud providers will work just as well, but the commands and samples in this document will be for AWS only. &lt;a href=&quot;https://github.com/earthly/example-diy-ngrok&quot;&gt;Pull requests are welcome&lt;/a&gt;, if you want to contribute specific scripts for your cloud provider of choice!&lt;/p&gt;
&lt;p&gt;One elephant in the room to address before moving on is the inevitable “Why not (Terraform/Pulumi/Cloud Formation/My Favorite IAAS tool…)?” question. These tools are, in fact, made for setting up and tearing down insfrastructure exactly like this! However, using fewer tools helps keep this tutorial simple and accessible, so only the AWS CLI will be used throughout.&lt;/p&gt;
&lt;h2 id=&quot;lets-build-it&quot;&gt;Lets Build It&lt;/h2&gt;
&lt;p&gt;You will need the following to complete the rest of this tutorial:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;An active AWS account &lt;a href=&quot;https://portal.aws.amazon.com/billing/signup#/start&quot;&gt;(If you don’t have one, you can sign up here)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html&quot;&gt;Installed the AWS CLI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html&quot;&gt;Configured AWS credentials&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Optionally, you may also want to install:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://stedolan.github.io/jq/&quot;&gt;jq&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With those in hand, it’s time to get started!&lt;/p&gt;
&lt;h3 id=&quot;where-will-the-instance-live&quot;&gt;Where will the instance live?&lt;/h3&gt;
&lt;p&gt;Before creating anything in the cloud, you’ll need to make sure that you have some information about the VPC and subnet the instance will be assigned to. This information can be found in the console, or on the command-line via &lt;code&gt;aws ec2 describe-subnets&lt;/code&gt;. It will list all your subnets, and the VPCs they belong to.&lt;/p&gt;
&lt;p&gt;If your cloud is like most peoples, you likely have quite a few of these lying around, which makes it difficult to find the one you want to place your proxy in. I like to add &lt;code&gt;jq&lt;/code&gt; into the mix to make it easier to parse, like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ aws ec2 describe-subnets \
    | jq -r &amp;#39;.Subnets[] \
    | &amp;quot;\(.AvailabilityZone)\t\(.CidrBlock)\t\(.SubnetId)\t\(.VpcId)&amp;quot;&amp;#39; \
    | sort&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When selecting a subnet, ensure that the one you choose assigns public IP addresses, as you will need to accept traffic from the general internet later.&lt;/p&gt;
&lt;h3 id=&quot;ssh-keypair&quot;&gt;SSH Keypair&lt;/h3&gt;
&lt;p&gt;The first thing to create is your EC2 SSH keypair. This is simple to do, especially because the &lt;code&gt;aws&lt;/code&gt; tool can generate on for you.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ aws ec2 create-key-pair \
    --key-name proxy-key-pair \
    &amp;gt; key-output.json&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ About the AWS CLI output&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Note the &lt;code&gt;&amp;gt; key-output.json&lt;/code&gt; at the end. The &lt;code&gt;aws&lt;/code&gt; CLI tool will always &lt;a href=&quot;https://docs.aws.amazon.com/cli/latest/userguide/cliv2-migration.html#cliv2-migration-output-pager&quot;&gt;invoke your system pager with some kind of JSON output as the result of any calls&lt;/a&gt;. Because you don’t want to lose the key generated by &lt;code&gt;aws&lt;/code&gt; for our yet-to-be-created instance, capture it here. It’s a running trend that you will see throughout this tutorial.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;You can get the key directly with &lt;code&gt;jq&lt;/code&gt; by &lt;code&gt;jq -r .KeyPairId key-output.json&lt;/code&gt;, or via your preferred means.&lt;/p&gt;
&lt;h3 id=&quot;security-group&quot;&gt;Security Group&lt;/h3&gt;
&lt;p&gt;Now that you have a key pair, you will also need to create a security group for the instance to reside in. To oversimplify, a security group is essentially a firewall for your instance, constraining what ports traffic is allowed to enter or leave on. &lt;a href=&quot;https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#VPCSecurityGroups&quot;&gt;You can read more about security groups here, for a longer and more complete explanation.&lt;/a&gt; Getting this right is important, so your proxy is less likely to be compromised.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ aws ec2 create-security-group \
    --group-name reverse-proxy \
    --description reverse-proxy \
    --vpc-id $VPC_ID \
    &amp;gt; sg-output.json&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Don’t Forget&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Make sure you replace &lt;code&gt;$VPC_ID&lt;/code&gt; with the ID for the &lt;a href=&quot;#where-will-the-instance-live&quot;&gt;VPC you identified earlier&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;By default, AWS security groups are configured to disallow all traffic coming in (ingress), and to allow all traffic out (egress). While an instance that doesn’t allow traffic in is fairly secure, it also doesn’t do you much good. You will need to open up port 22 (ssh) for traffic from our current IP only, and port 80 (http) for traffic from the internet at large. By restricting SSH to your current IP address, you prevent external entities from attempting to SSH into your proxy.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ aws ec2 authorize-security-group-ingress \
    --group-id $SG_ID \
    --protocol tcp \
    --port 22 \
    --cidr $IP/32 \
    --no-cli-pager

❯ aws ec2 authorize-security-group-ingress \
    --group-id $SG_ID \
    --protocol tcp \
    --port 80 \
    --cidr 0.0.0.0/0 \
    --no-cli-pager&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Find your public IP from the command line&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;AWS has a public service that returns your IP to you. It’s super handy for scripting, because its much clearer to read than the most popular &lt;code&gt;dig&lt;/code&gt;-based examples passed around on the internet. You can use it like this: &lt;code&gt;curl -s https://checkip.amazonaws.com&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;notice--warning&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Don’t Forget&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Make sure you replace &lt;code&gt;$SG_ID&lt;/code&gt; with the ID for the security group you created earlier. If you saved the output like the sample earlier, you can get it by running &lt;code&gt;jq -r .GroupId sg-output.json&lt;/code&gt;. Also, make sure you replace &lt;code&gt;$IP&lt;/code&gt; with your &lt;em&gt;public&lt;/em&gt; IP address.&lt;/p&gt;
&lt;/div&gt;
&lt;h3 id=&quot;ec2-instance&quot;&gt;EC2 Instance&lt;/h3&gt;
&lt;p&gt;Now that you have keys, and a security group configured in AWS, you’re finally ready to create your EC2 instance! Its easiest for this kind of work to use a &lt;code&gt;t2.micro&lt;/code&gt;, since that is available on AWS’ free tier. If your account is older than 1 year, this instance is still among the cheapest to provision. If a &lt;code&gt;t2.micro&lt;/code&gt; is too expensive, you may want to size down to a &lt;code&gt;t2.nano&lt;/code&gt;, or consider &lt;a href=&quot;https://aws.amazon.com/ec2/spot/&quot;&gt;spot instances&lt;/a&gt;, which are beyond the scope of this tutorial. The instance will be provisioned with an AMI using Amazon Linux 2, to keep things as simple as possible.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ aws ec2 run-instances \
    --image-id resolve:ssm:/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2 \
    --count 1 \
    --instance-type t2.micro \
    --key-name $KEY_NAME \
    --security-group-ids $SG_ID \
    --subnet-id $SUBNET_ID \
    &amp;gt; ec2-output.json&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice--warning&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Don’t Forget&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Make sure you replace &lt;code&gt;$KEY_NAME&lt;/code&gt; with the name (&lt;em&gt;not id&lt;/em&gt;) of the keypair you created earlier (&lt;code&gt;proxy-key-pair&lt;/code&gt;). Also make sure you replace &lt;code&gt;$SG_ID&lt;/code&gt; with the ID for the security group you created earlier, and &lt;code&gt;$SUBNET_ID&lt;/code&gt; with the subnet you identified before you began.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;notice&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ EC2 is fast, but not instant&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Although AWS can provision instances very quickly, it can &lt;em&gt;still&lt;/em&gt; take a couple minutes for the instance to come up, so be patient! You can wait for the instance on the CLI (if desired) by running the following command: &lt;code&gt;aws ec2 wait instance-status-ok --instance-ids $EC2_ID&lt;/code&gt;, where &lt;code&gt;$EC2_ID&lt;/code&gt; is the instance ID from the prior step.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Creating the instance isn’t the end of our work, however. You’ll still need to configure it to actually reverse proxy the traffic coming in from the internet to our local development machine. To that end, NGINX is a fantastic,battle-tested option. As soon the instance is ready, SSH into the box and install NGINX.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ sudo amazon-linux-extras install nginx1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;NGINX needs to be configured to use the AWS-assigned public DNS name, and proxy traffic from port 80 to you. Heres a sample config you can use:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;upstream tunnel {
  server 127.0.0.1:8080;
}

server {
  server_name PUBLIC_DNS;
  
  location / {
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_redirect off;
    
    proxy_pass http://tunnel;
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice--warning&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Don’t Forget&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Be sure to replace &lt;code&gt;PUBLIC_DNS&lt;/code&gt; with the AWS public DNS name. This is &lt;em&gt;not&lt;/em&gt; in the initial output from AWS, because the DNS name is not granted until the machine enters a running state. You can find itby running &lt;code&gt;aws ec2 describe-instances --instance-ids $EC2_ID&lt;/code&gt;, where &lt;code&gt;$EC2_ID&lt;/code&gt; is the ID of the machine you provisioned earlier. This ID &lt;em&gt;can&lt;/em&gt; be found in the outputwhen you created the instance by running &lt;code&gt;jq -r '.Instances[0].InstanceId' ec2-output.json&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Save the completed configuration as &lt;code&gt;/etc/nginx/conf.d/server.conf&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Additionally, NGINX doesn’t quite handle the lengthy public DNS names that AWS hands out, so you’ll need to increase &lt;code&gt;server_names_hash_bucket_size&lt;/code&gt; to the next power of 2, which is &lt;code&gt;128&lt;/code&gt;. To do this, add &lt;code&gt;server_names_hash_bucket_size 128&lt;/code&gt; to &lt;code&gt;/etc/nginx/nginx.conf&lt;/code&gt;, in the &lt;code&gt;http&lt;/code&gt; section.&lt;/p&gt;
&lt;p&gt;Now that NGINX is configured, start it, and exit your SSH session.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ sudo service nginx start

...

❯ exit&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;using-the-proxy&quot;&gt;Using the Proxy&lt;/h3&gt;
&lt;p&gt;Now that the instance is configured, all you will need to do to allow the internet at large to connect to a service running on your local box is to use an &lt;code&gt;ssh&lt;/code&gt; reverse proxy to get data from AWS to your local machine! Start one up like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ ssh -i key.pem -R 8080:localhost:$LOCAL_PORT ec2-user@$PUBLIC_DNS&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice--warning&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Don’t Forget&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Replace &lt;code&gt;$LOCAL_PORT&lt;/code&gt; with the port your application is running on, and &lt;code&gt;$PUBLIC_DNS&lt;/code&gt; with the AWS-assigned public DNS name, like you did for the NGINX config.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Once that is up, all you need to do is simply share the AWS public DNS name with anybody you want to allow into your locally-hosted website!&lt;/p&gt;
&lt;h2 id=&quot;teardown&quot;&gt;Teardown&lt;/h2&gt;
&lt;p&gt;Although you can leave the proxy up for as long as you like, you’ll likely need to tear it down eventually. If you have AWS console access, simply terminate the instance, delete the security group, and delete the keypair. If you saved the IDs of these resources (they are in the JSON responses from earlier), you can also do it via the command line:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ aws ec2 terminate-instances --no-cli-pager --instance-ids $EC2_ID &amp;gt; /dev/null

❯ aws ec2 delete-key-pair --no-cli-pager --key-pair-id $KEY_ID &amp;amp;&amp;amp; \
  aws ec2 delete-security-group --no-cli-pager --group-id $SG_ID&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note that the instance could take a couple minutes to finish terminating. You will not be able to remove the key or security group before the instance has been terminated.&lt;/p&gt;
&lt;h2 id=&quot;create-using-earthly&quot;&gt;Create using Earthly&lt;/h2&gt;
&lt;p&gt;If you don’t want to deal with manual setup or teardown, we’ve created an &lt;code&gt;Earthfile&lt;/code&gt; that should automate all of this for you. It can create a proxy just like this, from scratch, in under five minutes! To start up a proxy using &lt;code&gt;earthly&lt;/code&gt;, execute this &lt;em&gt;single&lt;/em&gt; command.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;❯ earthly \
  --secret-file config=/home/user/.aws/config \
  --secret-file credentials=/home/dchw/.aws/credentials \
  --build-arg AWS_REGION=my_region \
  --build-arg SUBNET_ID=my_subnet \
  github.com/earthly/example-diy-ngrok:main+build-proxy&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;notice&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ AWS Credentials&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The reason you’ll need to pass the credentials, is so that our scripts can use them to construct the proxy. If you are uncomfortable passing credentials to a remote target, feel free to clone and inspect the repository before using it. You could also simplify this by trying out Earthly’s experimental &lt;a href=&quot;https://docs.earthly.dev/guides/cloud-secrets&quot;&gt;cloud-based secrets.&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&quot;notice--warning&quot; data-markdown=&quot;1&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Don’t Forget&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Replace the following:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/home/user&lt;/code&gt; with the directory of the AWS configuration directory (&lt;code&gt;.aws&lt;/code&gt;)&lt;br /&gt;
&lt;code&gt;my-region&lt;/code&gt; with the AWS region you use.&lt;br /&gt;
&lt;code&gt;my-subnet&lt;/code&gt; with the ID of the subnet you would like to use.&lt;/p&gt;
&lt;p&gt;If you need to use temporary role-based credentials, add &lt;code&gt;--build-arg AWS_PROFILE=my_profile&lt;/code&gt;, where the profile is the one to assume when creating the resources.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Building this container will construct a proxy in the same manner detailed earlier, but with a few extra benefits:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Allows you to retrieve the generated SSH key&lt;/li&gt;
&lt;li&gt;Automated teardown of the constructed proxy&lt;/li&gt;
&lt;li&gt;Sample SSH Command for proxying&lt;/li&gt;
&lt;li&gt;A list of all IDs for all resources created&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To see everything it can do, run &lt;code&gt;docker run proxy:latest&lt;/code&gt; for a list.&lt;/p&gt;
&lt;h2 id=&quot;shortcomings&quot;&gt;Shortcomings&lt;/h2&gt;
&lt;p&gt;This approach to a free, simple ngrok alternative isn’t without its shortcomings. For instance, it can’t do &lt;code&gt;https&lt;/code&gt; without a self-signed certificate, because issuers like Let’s Encrypt won’t issue certificates for AWS public DNS names. Also, it can’t handle a ton of traffic since its a small &lt;code&gt;t2.micro&lt;/code&gt; capped at low bandwidth.&lt;/p&gt;
&lt;p&gt;It also requires non-trivial IAM permissions in AWS to setup and teardown. If you don’t have that kind of access to an account, you may end up waiting on others to set it up for you.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Turns out it’s pretty simple to get something basic up and running, just like &lt;code&gt;ngrok&lt;/code&gt; does. But, if you find yourself relying on this kind of tooling every day, it may be better to pay for a service that can do it better.&lt;/p&gt;
&lt;p&gt;Thanks for following along with us! &lt;a href=&quot;https://github.com/earthly/example-diy-ngrok&quot;&gt;Visit the example repository, with all scripts avaliable here.&lt;/a&gt;&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content><author><name>Corey Larson</name></author><category term="Tutorials" /><summary type="html">Ngrok is a tool that allows you to create secure, publically accessible URLs for your locally running code.</summary></entry><entry><title type="html">Understanding Docker Logging and Log Files</title><link href="https://earthly.dev/blog/understanding-docker-logging-and-log-files/" rel="alternate" type="text/html" title="Understanding Docker Logging and Log Files" /><published>2021-03-10T00:00:00-05:00</published><updated>2021-03-10T00:00:00-05:00</updated><id>https://earthly.dev/blog/understanding-docker-logging-and-log-files</id><content type="html" xml:base="https://earthly.dev/blog/understanding-docker-logging-and-log-files/">&lt;p&gt;Docker logging and its management are an important part of the containerization of your application. Once you’ve deployed your application, logging is one of the best tools to help reveal errors, aid in debugging, and optimize your application’s performance.&lt;/p&gt;
&lt;p&gt;With that in mind, let’s dive into Docker logging and its log files.&lt;/p&gt;
&lt;h2 id=&quot;introduction-to-docker-logging&quot;&gt;Introduction to Docker Logging&lt;/h2&gt;
&lt;p&gt;Developers, DevOps professionals, and product stakeholders all apply knowledge gained from logging to improve a system’s performance and reliability. Much of what an application, server, or OS does should be recorded in the logs and aggregated in an easily accessible location. A &lt;a href=&quot;https://www.sumologic.com/glossary/log-analysis/&quot;&gt;log analysis&lt;/a&gt; then uses all the log events and audit trails to help chalk out a clear picture of events that happen across your application.&lt;/p&gt;
&lt;p&gt;In &lt;a href=&quot;https://www.docker.com/&quot;&gt;Docker&lt;/a&gt;, containers are isolated and bundled with software, libraries, and configuration files. In a traditional single-server setup log analysis is centralized on a single node, but with a stateless containerized setup logging becomes more complex. Why? Two reasons:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Containers are transient.&lt;/strong&gt; When a Docker container broadcasts logs, it sends them to the application’s &lt;code&gt;stdout&lt;/code&gt; and &lt;code&gt;stderr&lt;/code&gt; output streams. The underlying container logging driver can start accessing these streams, and the logs are stored on the Docker host in JSON files (&lt;a href=&quot;https://docs.docker.com/config/containers/logging/json-file/&quot;&gt;&lt;code&gt;json-file&lt;/code&gt; is the default logging driver used by Docker&lt;/a&gt;). It writes JSON-formatted logs to a file on the host where the container is running. Any logs stored in the container will be deleted when it is terminated or shut down.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Containers are multileveled.&lt;/strong&gt; There are two levels of aggregation in Docker logging. One refers to the logs from inside the container in your Dockerized application, and the second refers to the logs from the host servers (eg, system logs, Docker daemon logs), which are generally located in &lt;code&gt;/var/log&lt;/code&gt;. A log aggregator that has access to the host pulls application log files and accesses the file system inside the container to collect the logs. Later, you’d need to correlate these log events for analysis.&lt;/p&gt;
&lt;p&gt;In this article, you’ll learn about different logging strategies you can use in a Dockerized application—how you can access logs and understand Docker logging commands, drivers, configuration, and management to build a highly performant and reliable infrastructure.&lt;/p&gt;
&lt;h2 id=&quot;docker-logging-commands&quot;&gt;Docker Logging Commands&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;docker logs&lt;/code&gt; is a command that shows all the information logged by a running container. The &lt;code&gt;docker service logs&lt;/code&gt; command shows information logged by all the containers participating in a service. By default, the output of these commands, as it would appear if you run the command in a terminal, opens up three I/O streams: STDIN, STDOUT, and STDERR. And the default is set to show only STDOUT and STDERR.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;STDIN is the command’s input stream, which may include input from the keyboard or input from another command.&lt;/li&gt;
&lt;li&gt;STDOUT is usually a command’s normal output.&lt;/li&gt;
&lt;li&gt;STDERR is typically used to output error messages.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;code&gt;docker logs&lt;/code&gt; command may not be useful in cases when a logging driver is configured to send logs to a file, database, or an external host/backend, or if the image is configured to send logs to a file instead of STDOUT and STDERR. With &lt;code&gt;docker logs &amp;lt;CONTAINER_ID&amp;gt;&lt;/code&gt;, you can see all the logs broadcasted by a specific container identified by a unique ID.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker run &lt;span class=&quot;at&quot;&gt;--name&lt;/span&gt; test &lt;span class=&quot;at&quot;&gt;-d&lt;/span&gt; busybox sh &lt;span class=&quot;at&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;while true; do &lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;bu&quot;&gt;echo&lt;/span&gt; date&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;; sleep 1; done&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; date&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Tue&lt;/span&gt; 06 Feb 2020 00:00:00 UTC&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker logs &lt;span class=&quot;at&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--until&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;2s test&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Tue&lt;/span&gt; 06 Feb 2020 00:00:00 UTC&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Tue&lt;/span&gt; 06 Feb 2020 00:00:01 UTC&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;Tue&lt;/span&gt; 06 Feb 2020 00:00:02 UTC&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;docker logs&lt;/code&gt; works a bit differently in community and enterprise versions. In Docker Enterprise, &lt;code&gt;docker logs&lt;/code&gt; read logs created by any logging driver, but in Docker CE, it can only read logs created by the json-file, local, and journald drivers.&lt;/p&gt;
&lt;p&gt;For example, here’s the JSON log created by the &lt;a href=&quot;https://hub.docker.com/_/hello-world&quot;&gt;hello-world&lt;/a&gt; Docker image using the json-file driver:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;dt&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;log&amp;quot;&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;Hello from Docker!\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;stream&amp;quot;&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;stdout&amp;quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;time&amp;quot;&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;2021-02-10T00:00:00.000000000Z&amp;quot;&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, the log follows a pattern of printing:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Log’s origin&lt;/li&gt;
&lt;li&gt;Either &lt;code&gt;stdout&lt;/code&gt; or &lt;code&gt;stderr&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;A timestamp&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can find this log in your Docker host at:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; /var/lib/docker/containers/&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;/&lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;-json.log  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These Docker logs are stored in a host container and will build up over time. To address that, you can implement log rotation, which will remove a chunk of logs at specified intervals, and a log aggregator, which can be used to push them into a centralized location for a permanent log repository. You can use this repository for further analysis and improvements in the system down the road.&lt;/p&gt;
&lt;p&gt;To find &lt;code&gt;container_id&lt;/code&gt;, run the &lt;code&gt;docker ps&lt;/code&gt; command. It’ll list all the running containers.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker ps&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;CONTAINER&lt;/span&gt; ID   IMAGE       COMMAND             CREATED             STATUS              PORTS     NAMES&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;cg95e1yqk810&lt;/span&gt;   bar_image  &lt;span class=&quot;st&quot;&gt;&amp;quot;node index.js&amp;quot;&lt;/span&gt;     Y min ago           Up Y min            80/tcp     bar_app&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, the &lt;code&gt;docker logs container_id&lt;/code&gt; lists the logs for a particular container.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker logs &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container_id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want to follow the Docker container logs:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker logs &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container_id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; -f&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want to see the last N log lines:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker logs &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container_id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; --tail N&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you only want to see any specific logs, use &lt;code&gt;grep&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker logs &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container_id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;grep&lt;/span&gt; node&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want to check errors:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker logs &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;container_id&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-i&lt;/span&gt; error&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;logging-drivers-supported-by-docker&quot;&gt;Logging Drivers Supported by Docker&lt;/h2&gt;
&lt;p&gt;Logging drivers, or log-drivers, are mechanisms for getting information from running containers and services, and Docker has lots of them available for you. Every Docker daemon has a default logging driver, which each container uses. Docker uses the json-file logging driver as its default driver.&lt;/p&gt;
&lt;p&gt;Currently, Docker supports the following logging drivers:&lt;/p&gt;
&lt;table&gt;
&lt;colgroup&gt;
&lt;col style=&quot;width: 43%&quot; /&gt;
&lt;col style=&quot;width: 56%&quot; /&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th style=&quot;text-align: center;&quot;&gt;Driver&lt;/th&gt;
&lt;th style=&quot;text-align: center;&quot;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;none&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;No logs are available for the container and Docker logs do not return any output.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/local/&quot;&gt;local&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Logs are stored in a custom format designed for minimal overhead.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/json-file/&quot;&gt;json-file&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Logs are formatted as JSON. The default logging driver for Docker.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/syslog/&quot;&gt;syslog&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes logging messages to the Syslog facility. The Syslog daemon must be running on the host machine.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/journald/&quot;&gt;journald&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to journald. The journald daemon must be running on the host machine.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/gcplogs/&quot;&gt;gcplogs&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to Google Cloud Platform (GCP) logging.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/awslogs/&quot;&gt;awslogs&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to Amazon CloudWatch logs.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/splunk/&quot;&gt;splunk&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to Splunk using the HTTP Event Collector.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/gelf/&quot;&gt;gelf&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to a Graylog Extended Log Format (GELF) endpoint, such as Graylog or Logstash.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/fluentd/&quot;&gt;fluentd&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to fluentd (forward input). The fluentd daemon must be running on the host machine.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/etwlogs/&quot;&gt;etwlogs&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages as Event Tracing for Windows (ETW) events. Only available on Windows platforms.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;&lt;strong&gt;&lt;a href=&quot;https://docs.docker.com/config/containers/logging/logentries/&quot;&gt;logentries&lt;/a&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Writes log messages to Rapid7 Logentries.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&quot;configuring-the-logging-driver&quot;&gt;Configuring the Logging Driver&lt;/h3&gt;
&lt;p&gt;To configure the Docker daemon to a logging driver, you need to set the value of &lt;code&gt;log-driver&lt;/code&gt; to the name of the logging driver in the daemon.json configuration file. Then you need to restart Docker for the changes to take effect for all the newly created containers. All the existing containers will remain as they are.&lt;/p&gt;
&lt;p&gt;For example, let’s set up a default logging driver with some additional options.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode json&quot;&gt;&lt;code class=&quot;sourceCode json&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;dt&quot;&gt;&amp;quot;log-driver&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;json-file&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;dt&quot;&gt;&amp;quot;log-opts&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-4&quot;&gt;&lt;a href=&quot;#cb10-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;max-size&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;25m&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-5&quot;&gt;&lt;a href=&quot;#cb10-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;max-file&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-6&quot;&gt;&lt;a href=&quot;#cb10-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;labels&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;production_bind&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-7&quot;&gt;&lt;a href=&quot;#cb10-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;env&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;os,customer&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-8&quot;&gt;&lt;a href=&quot;#cb10-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-9&quot;&gt;&lt;a href=&quot;#cb10-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To find the current logging driver for the Docker daemon:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker info &lt;span class=&quot;at&quot;&gt;--format&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;#39;{{.LoggingDriver}}&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;json-file&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can override the default driver by adding the &lt;code&gt;--log-driver&lt;/code&gt; option to the docker run command that creates a container.&lt;/p&gt;
&lt;p&gt;The following command will start using the Splunk driver:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;docker&lt;/span&gt; run &lt;span class=&quot;at&quot;&gt;--log-driver&lt;/span&gt; splunk httpd&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Modify the &lt;code&gt;daemon.json&lt;/code&gt; file, to pass the address of the splunk host to the driver:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode json&quot;&gt;&lt;code class=&quot;sourceCode json&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;log-driver&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;splunk&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-3&quot;&gt;&lt;a href=&quot;#cb13-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;log-opts&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-4&quot;&gt;&lt;a href=&quot;#cb13-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;dt&quot;&gt;&amp;quot;splunk-url&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;172.1.1.1:11111&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-5&quot;&gt;&lt;a href=&quot;#cb13-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-6&quot;&gt;&lt;a href=&quot;#cb13-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker inspect &lt;span class=&quot;at&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;#39;{{.HostConfig.LogConfig.Type}}&amp;#39;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt;CONTAINER&lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-3&quot;&gt;&lt;a href=&quot;#cb14-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-4&quot;&gt;&lt;a href=&quot;#cb14-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;splunk&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;choosing-the-delivery-mode-of-log-messages-from-container-to-log-driver&quot;&gt;Choosing the Delivery Mode of Log Messages From Container to Log Driver&lt;/h3&gt;
&lt;p&gt;Docker provides two modes for delivering log messages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Blocking (default):&lt;/strong&gt; The container interrupts the application every time it needs to deliver a message to the driver. This will add latency in the performance of your application (for some drivers), but it’ll guarantee that all the messages will be sent to the driver. Case in point, the json-file driver writes logs very quickly, therefore it’s unlikely to cause latency. But drivers like &lt;code&gt;gcplogs&lt;/code&gt; and &lt;code&gt;awslogs&lt;/code&gt; open a connection to a remote server and so are more likely to block and cause latency.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Non-Blocking:&lt;/strong&gt; The container writes and stores its logs to an in-memory ring buffer until the logging driver is available to process them. This ensures that a high rate of logging will not affect application performance. It does not guarantee that all the messages will be sent to the driver. In cases where log broadcasts are faster than the driver processor, the ring buffer will soon run out of space. As a result, buffered logs are deleted to make space for the next set of incoming logs. The default value for &lt;code&gt;max-buffer-size&lt;/code&gt; is 1 MB.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To change the mode:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode json&quot;&gt;&lt;code class=&quot;sourceCode json&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;log-driver&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;splunk&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;dt&quot;&gt;&amp;quot;log-opts&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-4&quot;&gt;&lt;a href=&quot;#cb15-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;dt&quot;&gt;&amp;quot;splunk-url&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;172.1.1.1:11111&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-5&quot;&gt;&lt;a href=&quot;#cb15-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;dt&quot;&gt;&amp;quot;mode&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;non-blocking&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-6&quot;&gt;&lt;a href=&quot;#cb15-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-7&quot;&gt;&lt;a href=&quot;#cb15-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;understanding-logging-strategies&quot;&gt;Understanding Logging Strategies&lt;/h2&gt;
&lt;p&gt;Docker logging effectively means logging the events of an application, host OS, and the respective Docker service. There are a few defined logging strategies you should keep in mind when working with containerized apps.&lt;/p&gt;
&lt;h3 id=&quot;application-logging&quot;&gt;1. Application Logging&lt;/h3&gt;
&lt;p&gt;In this logging strategy, the application running in the containers will have its own logging framework. For example, a Node.js app could use a &lt;a href=&quot;https://www.npmjs.com/package/winston&quot;&gt;&lt;code&gt;winston&lt;/code&gt;&lt;/a&gt; library to format and send the logs. With this approach, you have complete control over the logging event.&lt;/p&gt;
&lt;p&gt;If you have multiple containers, you need to add an identifier at each container level, so you can uniquely determine the container and its respective logs. But as the size of the logs increases, this will start creating a load on the application process. Due to the transient nature of containers, the logs will be wiped out when a container is terminated or shut down.&lt;/p&gt;
&lt;p&gt;To address this, you have two options: - Configure steady storage to hold these logs, i.e. disks/data volumes. - Forward these logs to a log management solution.&lt;/p&gt;
&lt;h3 id=&quot;data-volumes&quot;&gt;2. Data Volumes&lt;/h3&gt;
&lt;p&gt;In this logging strategy, your container’s directory gets links to one of the host machine directories that will hold all the data for you. Containers can now be terminated or shut down, and access logs from multiple containers.&lt;/p&gt;
&lt;p&gt;A regular backup is a good idea in order to prevent data corruption or loss in case of a failure. But if you want to shift the containers on different hosts without loss of data, then the data volumes strategy will make that difficult.&lt;/p&gt;
&lt;h3 id=&quot;docker-logging-driver&quot;&gt;3. Docker Logging Driver&lt;/h3&gt;
&lt;p&gt;Docker has a bunch of logging drivers that can be used in your logging strategy. The configured driver reads the data broadcast by the container’s &lt;code&gt;stdout&lt;/code&gt; or &lt;code&gt;stderr&lt;/code&gt; streams and writes it to a file on the host machine. By default, the host machine holds the log files, but you can forward these events using the available drivers, like fluentd, Splunk, and awslogs.&lt;/p&gt;
&lt;p&gt;Note that the &lt;code&gt;docker log&lt;/code&gt; command will not work if you use anything other than the &lt;code&gt;json-file&lt;/code&gt; driver. And if log forwarding over a TCP connection fails or becomes unreachable, the containers will shut down.&lt;/p&gt;
&lt;h3 id=&quot;dedicated-logging-container&quot;&gt;4. Dedicated Logging Container&lt;/h3&gt;
&lt;p&gt;Here, you need to set up a dedicated container whose only job is to collect and manage logs within a Docker ecosystem. It’ll aggregate, monitor, and analyze logs from containers and forward them to a central repository. The log dependency on the host machine is no longer an issue, and it’s best suited for microservices architecture.&lt;/p&gt;
&lt;p&gt;This strategy gives you the freedom to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Move containers between the hosts.&lt;/li&gt;
&lt;li&gt;Scale up by just adding a new container.&lt;/li&gt;
&lt;li&gt;Tie up all the various streams of log events.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;sidecar-logging-container&quot;&gt;5. Sidecar Logging Container&lt;/h3&gt;
&lt;p&gt;This logging strategy is similar to dedicated logging in that you have a container to hold logs, but here, each application has its own dedicated logging container (note that the application and its log container can be considered as a single unit). This opens up the flexibility of app-level logging customization. By adding custom identifiers, you can identify the specific container that broadcasts the log.&lt;/p&gt;
&lt;p&gt;This is best suited for a complex system where each entity customizes the logs, making it popular in microservices deployment. Maintaining a container per application level will require additional resources for management and setup, so it’s complex to implement. Also, you may end up losing data when a container from the unit becomes unserviceable.&lt;/p&gt;
&lt;h3 id=&quot;third-party-logging-services&quot;&gt;6. Third-party Logging Services&lt;/h3&gt;
&lt;p&gt;There are a lot of third-party logging services you can use according to your infrastructure and application needs, enabling you to aggregate, manage, and analyze logs and take proactive preventative actions as a result.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://www.splunk.com/&quot;&gt;Splunk&lt;/a&gt;:&lt;/strong&gt; Splunk is built to scale from a single server to multiple data centers. It has built-in alerting and reporting, real-time search, analysis, and visualization, which helps you take action against malfunctions faster. It comes with a Splunk Enterprise on-premise deployment and Splunk Cloud. The free plan comes with 500 MB data per day, and the paid plan starts from $150 a month for a GB.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://github.com/elastic/logstash&quot;&gt;Logstash&lt;/a&gt;:&lt;/strong&gt; Logstash is part of the &lt;a href=&quot;https://www.elastic.co/products&quot;&gt;Elastic Stack&lt;/a&gt; along with Beats, Elasticsearch, and Kibana. It’s a server-side data processing pipeline that ingests data from a multitude of sources simultaneously, transforms it, and then sends it to your favourite “stash.” Logstash has over 200 plugins for input, filter/transform, and output. It’s free and open source.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;http://www.fluentd.org/&quot;&gt;Fluentd&lt;/a&gt;:&lt;/strong&gt; Fluentd is an open-source data collector. Its performance has been well proven, handling 5 TB of daily data, 50,000 messages/sec at peak time. The main reason to use it would be performance. It’s free and open source.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.papertrail.com/&quot;&gt;PaperTrail&lt;/a&gt;:&lt;/strong&gt; PaperTrail is a simple and user-friendly service that provides a terminal-like experience. Once the data is sent over the syslog, you can perform tail and search operations with the PaperTrail UI. It’s affordable for low volumes but becomes expensive for higher volume. It comes with a free 50 MB/month plan, and paid plans start at $7/month for 1 GB per month.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.loggly.com/&quot;&gt;Loggly&lt;/a&gt;:&lt;/strong&gt; Loggly focuses on simplicity and ease of use for a DevOps audience. It’s one of the more robust log analyzers. Primary use cases are for troubleshooting and customer support scenarios, and it provides richer visualizations and more parsing functionality than PaperTrail. It comes with a free 200 MB/day, and paid plans start at $79 a month for 1 GB per day ingestion with a 2 weeks retention.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;limitations-and-challenges-of-docker-logging&quot;&gt;Limitations and Challenges of Docker Logging&lt;/h2&gt;
&lt;p&gt;Docker makes containerized application deployment easier, faster, and streamlines it with limited resources. Log management and analysis are handled differently with Docker as compared to a traditional system, which introduces a new set of challenges and limitations. From storing logs in a file system to forwarding them to a central repository, Docker logging has some pain points you’ll need to overcome with a deeper understanding of Docker capability.&lt;/p&gt;
&lt;h3 id=&quot;the-only-compatible-driver-is-json-file&quot;&gt;The Only Compatible Driver Is json-file&lt;/h3&gt;
&lt;p&gt;The json-file driver is the only one that works with the &lt;code&gt;docker logs&lt;/code&gt; command, a limitation of Docker logs. When you start using any other logging drivers, such as Fluentd or Splunk, the &lt;code&gt;docker logs&lt;/code&gt; command shows an error and the Docker logs API calls will fail. Also, you won’t be able to check the container logs in this situation.&lt;/p&gt;
&lt;h3 id=&quot;docker-syslog-impacts-container-deployment&quot;&gt;Docker Syslog Impacts Container Deployment&lt;/h3&gt;
&lt;p&gt;The reliable way to deliver logs is via Docker Syslog with TCP or TLS. But this driver needs an established TCP connection to the Syslog server whenever a container starts up. And the container will fail ife a connection is not made.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb16&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb16-1&quot;&gt;&lt;a href=&quot;#cb16-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; docker: Error response from daemon: Failed to initialize logging driver: dial tcp&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your container deployment will be affected if you face network problems or latency issues. And it’s not recommended that you restart the Syslog server because this will drop all the connections from the containers to a central Syslog server.&lt;/p&gt;
&lt;h3 id=&quot;potential-loss-of-logs-with-docker-syslog-driver&quot;&gt;Potential Loss of Logs with Docker Syslog Driver&lt;/h3&gt;
&lt;p&gt;The Docker syslog driver needs an established TCP or TLS connection to deliver logs. Note that when the connection is down or not reachable, you’ll start losing the logs until the connection reestablished.&lt;/p&gt;
&lt;h3 id=&quot;multiline-logs-not-supported&quot;&gt;Multiline Logs Not Supported&lt;/h3&gt;
&lt;p&gt;Generally, either of two patterns is followed for logging: single-line per log or multiple lines with extended information per log, like stack traces or exceptions. But with Docker logging, this is a moot point, because containers always broadcast logs to the same output: &lt;code&gt;stdout&lt;/code&gt;. ### Multiple Logging Drivers Not Supported It’s mandatory that you use only a single driver for all of your logging needs. Scenarios where you can store logs locally and push it to remote servers are not supported.&lt;/p&gt;
&lt;h3 id=&quot;logs-can-miss-or-skip&quot;&gt;Logs Can Miss or Skip&lt;/h3&gt;
&lt;p&gt;There’s a rate limitation setting at the Docker end for journald drivers that takes care of the rate that logs get pushed. If it exceeds, then the driver might skip some logs. To prevent such issues, increase the rate limitation settings according to your logging needs.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;While Docker containerization allows developers to encapsulate a program and its file system into a single portable package, that certainly doesn’t mean containerization is free of maintenance. Docker Logging is a bit more complex than traditional methods, so teams using Docker must familiarize themselves with the Docker logging to support full-stack visibility, troubleshooting, performance improvements, root cause analysis, etc.&lt;/p&gt;
&lt;p&gt;As we have seen in this post, to facilitate logging, Docker offers logging drivers and commands in the platform which gives you the mechanisms for accessing the performance data and also provides plugins to integrate with third-party logging tools as well. To maximize the logging capabilities there are several methods and strategies which help in designing your logging infrastructure, but each comes with its advantages and disadvantages.&lt;/p&gt;
&lt;p&gt;With this understanding of logging, containerization can be a powerful tool. Earthly is a containerized &lt;a href=&quot;https://earthly.dev/&quot;&gt;continuous integration tool&lt;/a&gt;. If you’ve ever had to deal with flaky builds you should &lt;a href=&quot;https://earthly.dev/&quot;&gt;check it out&lt;/a&gt;.&lt;/p&gt;</content><author><name>Sanket Makhija</name></author><category term="Tutorials" /><category term="docker" /><category term="tutorials" /><summary type="html">Docker logging and its management are an important part of the containerization of your application. Once you’ve deployed your application, logging is one of the best tools to help reveal errors, aid in debugging, and optimize your application’s performance.</summary></entry></feed>