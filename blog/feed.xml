<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.1.1">Jekyll</generator><link href="https://earthly.dev/blog/feed.xml" rel="self" type="application/atom+xml" /><link href="https://earthly.dev/blog/" rel="alternate" type="text/html" /><updated>2021-07-29T16:40:13-04:00</updated><id>https://earthly.dev/blog/feed.xml</id><title type="html">Earthly Blog</title><subtitle>Build automation for the container era.</subtitle><entry><title type="html">Building in Visual Studio Code with a Makefile</title><link href="https://earthly.dev/blog/vscode-make/" rel="alternate" type="text/html" title="Building in Visual Studio Code with a Makefile" /><published>2021-07-28T00:00:00-04:00</published><updated>2021-07-28T00:00:00-04:00</updated><id>https://earthly.dev/blog/vscode-make</id><content type="html" xml:base="https://earthly.dev/blog/vscode-make/">&lt;p&gt;Microsoft announced &lt;a href=&quot;https://devblogs.microsoft.com/cppblog/now-announcing-makefile-support-in-visual-studio-code/&quot;&gt;recently&lt;/a&gt; a new Visual Studio Code extension to handle Makefiles. This extension provides a set of commands to the editor that will facilitate working with projects that rely on a Makefile to speed up the build.&lt;/p&gt;
&lt;p&gt;In this tutorial, you’ll set up a simple C++ project that depends on a well-known Python library to produce some sample charts. This is not a deep tutorial about &lt;a href=&quot;/blog/g++-makefile/&quot;&gt;make and Makefiles&lt;/a&gt;, but to get the most out of the extension you will need to have some concepts clear.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Make&lt;/em&gt; is one of the most used tools to build software projects, for good reason:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You can get an implementation for almost any major operating system (POSIX/Windows/MacOS)&lt;/li&gt;
&lt;li&gt;It’s technology agnostic. You can use it to build projects on any programming language (here’s an example for &lt;a href=&quot;https://medium.com/lithictech/makefile-javascript-26731fb26867&quot;&gt;JavaScript&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Its task runner capabilities provide a multipurpose tool for almost any task.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;A &lt;em&gt;Makefile&lt;/em&gt; is a simple text file that defines rules to be executed. The usual purpose for Makefile in C++ projects is to recompile and link necessary files based on the modifications done to dependencies. However, Makefile and make are far more useful than that. The rules defined in a Makefile combine concepts like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Shell scripting&lt;/li&gt;
&lt;li&gt;Regular expressions&lt;/li&gt;
&lt;li&gt;Target notation&lt;/li&gt;
&lt;li&gt;Project structure&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To illustrate this power, the &lt;a href=&quot;https://github.com/nickmancol/vscode_makefile&quot;&gt;sample project&lt;/a&gt; contains a single C++ source code file. The source code for the example is pretty simple —- it flips a coin as many times as the &lt;code&gt;iters&lt;/code&gt; argument is passed, and then prints the number of heads and tails counted from each flip.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode cpp&quot;&gt;&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;cstdio&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;cstdlib&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;assert.h&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;time.h&amp;gt;&lt;/span&gt;&lt;span class=&quot;pp&quot;&gt;  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; flip_coins&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; iters&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  srand &lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;NULL&lt;span class=&quot;op&quot;&gt;));&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; heads&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; tails &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt; iters&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;i&lt;span class=&quot;op&quot;&gt;++){&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;rand&lt;span class=&quot;op&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;?&lt;/span&gt; heads&lt;span class=&quot;op&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;:&lt;/span&gt; tails&lt;span class=&quot;op&quot;&gt;++;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  printf&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; Heads, &lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;%d&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; Tails&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;heads&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; tails&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-16&quot;&gt;&lt;a href=&quot;#cb1-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; abs&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;tails&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;heads&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-17&quot;&gt;&lt;a href=&quot;#cb1-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-18&quot;&gt;&lt;a href=&quot;#cb1-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-19&quot;&gt;&lt;a href=&quot;#cb1-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; main&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; argc&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; argv&lt;span class=&quot;op&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-20&quot;&gt;&lt;a href=&quot;#cb1-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;ot&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;argc &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-21&quot;&gt;&lt;a href=&quot;#cb1-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; iters &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; atoi&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;argv&lt;span class=&quot;op&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;]);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-22&quot;&gt;&lt;a href=&quot;#cb1-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; diff &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; flip_coins&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;iters&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-23&quot;&gt;&lt;a href=&quot;#cb1-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;&lt;/span&gt; iters&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-24&quot;&gt;&lt;a href=&quot;#cb1-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      printf&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;With enough trials Heads should be equal to Tails&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-25&quot;&gt;&lt;a href=&quot;#cb1-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-26&quot;&gt;&lt;a href=&quot;#cb1-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This code will be compiled and linked with a simple Makefile that also will provide a couple of other standard rules for cleaning the compiled code and run a simple test.&lt;/p&gt;
&lt;h2 id=&quot;creating-c-projects-with-vs-code&quot;&gt;Creating C++ Projects with VS Code&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=ms-vscode.makefile-tools&quot;&gt;VS Code extension &lt;strong&gt;Makefile Tools&lt;/strong&gt;&lt;/a&gt; is still in preview but is actively developed. The installation process is similar to any other extension in VS Code:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9360.png&quot; alt=&quot;Makefile VSCode extension&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Makefile VSCode extension&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;After installing the extension, verify the availability of the &lt;code&gt;make&lt;/code&gt; command in the system.&lt;/p&gt;
&lt;p&gt;The most common implementation is &lt;a href=&quot;https://www.gnu.org/software/make/&quot;&gt;GNU Make&lt;/a&gt;, which includes some non-standard extensions. If your installation of &lt;code&gt;make&lt;/code&gt; is not available in the default path, you can configure it in VS Code at &lt;strong&gt;File &amp;gt; Preferences &amp;gt; Settings &amp;gt; Extensions makefile&lt;/strong&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9380.png&quot; alt=&quot;Make path&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Make path&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;To compile and link the project, you can add a Makefile to the root of the project folder. It will be detected automatically by the extension. If you have a different structure, with a Makefile in another location, you can configure it at &lt;strong&gt;File &amp;gt; Preferences &amp;gt; Settings &amp;gt; Extensions &amp;gt; makefile&lt;/strong&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9450.png&quot; alt=&quot;Makefile path&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Makefile path&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;This sample Makefile defines five simple rules:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;all&lt;/code&gt;: Cleans the compiled files from the target folder, then compiles and run the test code.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;default&lt;/code&gt;: Delegates to &lt;code&gt;CoinFlipper.cpp&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CoinFlipper.cpp&lt;/code&gt;: Compiles the single source file.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;test&lt;/code&gt;: Delegates to &lt;code&gt;CoinFlipper.cpp&lt;/code&gt;, then runs the output main function passing an argument.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;clean&lt;/code&gt;: Deletes compiled files.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# A simple makefile for compiling a c++ project&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;SRC&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;./src&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;./target&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;GCC &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; g++&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;CFLAGS &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; -o &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/CoinFlipper.out&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;ARGS &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; 101&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;RM &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; rm -rf&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; clean default test&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;default:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; CoinFlipper.cpp&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-15&quot;&gt;&lt;a href=&quot;#cb2-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;CoinFlipper.cpp:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-16&quot;&gt;&lt;a href=&quot;#cb2-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;GCC&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;CFLAGS&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;SRC&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;/main/CoinFlipper.cpp&lt;/span&gt;
&lt;span id=&quot;cb2-17&quot;&gt;&lt;a href=&quot;#cb2-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-18&quot;&gt;&lt;a href=&quot;#cb2-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;test:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; CoinFlipper.cpp&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-19&quot;&gt;&lt;a href=&quot;#cb2-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;/CoinFlipper.out &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;ARGS&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-20&quot;&gt;&lt;a href=&quot;#cb2-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-21&quot;&gt;&lt;a href=&quot;#cb2-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-22&quot;&gt;&lt;a href=&quot;#cb2-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;RM&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;TARGET&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;/*.out&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The Makefile Tools Extension provides a new “perspective” to the Visual Studio Code IDE. This contains three different commands and three different project configurations to run the Makefile:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9480.png&quot; alt=&quot;Makefile tools perspective&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Makefile tools perspective&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The &lt;code&gt;Configuration:[Default]&lt;/code&gt; refers to the make command configurations defined in the &lt;code&gt;.vscode/settings.json&lt;/code&gt; file. This configuration is used to pass arguments to the make utility.&lt;/p&gt;
&lt;p&gt;In the following example, two configurations are defined:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Default&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Print make version&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;Print make versions&lt;/code&gt; adds the &lt;code&gt;--version&lt;/code&gt; argument to the make utility every time the project is built using the Makefile extension. This argument is not especially useful but you can explore different arguments to fit your case.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode json&quot;&gt;&lt;code class=&quot;sourceCode json&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;dt&quot;&gt;&amp;quot;makefile.configurations&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;[&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;dt&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Default&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;dt&quot;&gt;&amp;quot;makeArgs&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;[]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;fu&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;dt&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Print make version&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;,&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;dt&quot;&gt;&amp;quot;makeArgs&amp;quot;&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;ot&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;--version&amp;quot;&lt;/span&gt;&lt;span class=&quot;ot&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-10&quot;&gt;&lt;a href=&quot;#cb3-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-11&quot;&gt;&lt;a href=&quot;#cb3-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;ot&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-12&quot;&gt;&lt;a href=&quot;#cb3-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The second configuration is the default build target rule for the make utility, which is equivalent to running &lt;code&gt;make [target]&lt;/code&gt; directly. The IDE will let show you a list of target rules defined in the Makefile configured for the project:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9540.png&quot; alt=&quot;config build target&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;config build target&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Finally, the third configuration available in the perspective is the &lt;code&gt;Launch target&lt;/code&gt;. This shows you a list of compiled files that can be run from the perspective using the commands &lt;code&gt;Debug&lt;/code&gt; and &lt;code&gt;Run&lt;/code&gt;. This is useful if you want to debug your source code with GDB or LLDB debuggers.&lt;/p&gt;
&lt;p&gt;In this example, the only file runnable is &lt;code&gt;CoinFlipper.out&lt;/code&gt;, compiled from the source code.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9560.png&quot; alt=&quot;make launch target&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;make launch target&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The commands in the Makefile are self-explanatory:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Build&lt;/code&gt; runs make with the target configured previously.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;all&lt;/code&gt; instead of &lt;code&gt;default&lt;/code&gt; passes no arguments to the make utility.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Debug&lt;/code&gt; and &lt;code&gt;Run in terminal&lt;/code&gt; commands launch the target (&lt;code&gt;CoinFlipper.out&lt;/code&gt; in the example) with/without the debug support.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once you build the project, the terminal view shows the result of the execution:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Building target &amp;quot;all&amp;quot; with command: &amp;quot;make all&amp;quot;
rm -rf ./target/*.out
g++ -o ./target/CoinFlipper.out ./src/main/CoinFlipper.cpp
./target/CoinFlipper.out 101
50 Heads, 51 Tails
With enough trials Heads should be equal to Tails
Target all built successfully.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see from the previous image, the target was built successfully after cleaning, compiling, and running the compiled program. The extension also provides commands to run other targets easily without changing the configurations in the perspective.&lt;/p&gt;
&lt;p&gt;The following image shows the commands available for the Makefile in the sample project:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9630.png&quot; alt=&quot;The makefile commands palette.&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;The makefile commands palette.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2 id=&quot;building-complex-projects&quot;&gt;Building Complex Projects&lt;/h2&gt;
&lt;p&gt;Makefiles are more complex than this. Many projects have several levels of dependencies, configurations, and quirks that make supports easily. For example, the &lt;a href=&quot;https://github.com/FFmpeg/FFmpeg&quot;&gt;FFmpeg&lt;/a&gt; project is a collection of libraries to work with audio, video, and subtitles among other utilities. To build it, you can download the source from GitHub and examine the Makefile:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9680.png&quot; alt=&quot;The makefile for FFmpeg.&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;The makefile for FFmpeg.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;The &lt;a href=&quot;https://trac.ffmpeg.org/wiki/CompilationGuide/Generic&quot;&gt;developer documentation&lt;/a&gt; for the project states that before building the source code with the provided Makefile, you need to run the &lt;a href=&quot;/blog/autoconf/&quot;&gt;&lt;code&gt;configure&lt;/code&gt;&lt;/a&gt; script located at the root of the project’s source code. Fortunately, the Makefile Tools Extension provides a setting to define the preconfiguration files required to run before executing the make commands, again in &lt;strong&gt;File &amp;gt; Preferences &amp;gt; Settings&lt;/strong&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/vscode-make/9730.png&quot; alt=&quot;The makefile preconfiguration.&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;The makefile preconfiguration.&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;In the &lt;strong&gt;Commands&lt;/strong&gt; section of the Makefile Tools Extension perspective, you can run the preconfigure command. This will run the configure script, and then you’re ready to experiment with the Makefile through the extension.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Large codebase projects need a build system to keep them under the development team’s control, and Makefiles are one the most ubiquitous and flexible ways to define building these complex software projects.&lt;/p&gt;
&lt;p&gt;With the new &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=ms-vscode.makefile-tools&quot;&gt;Makefile Tools Extension&lt;/a&gt;, Visual Studio Code greatly simplifies access for new developers. Though it is still tagged as in preview, this extension has been thoroughly tested by the Microsoft Team, building over seventy open-source projects written in different languages (including C, C++, and Python) successfully.&lt;/p&gt;
&lt;p&gt;If you want to learn about the power of make and Makefile, consider checking out the &lt;a href=&quot;https://makefiletutorial.com/#include-makefiles&quot;&gt;Makefile Tutorial&lt;/a&gt;, and if you want the simplicity of a Makefile with the isolation of containers take a look at &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt;.&lt;/p&gt;</content><author><name>Nicolas Bohorquez</name></author><category term="Tutorials" /><summary type="html">Microsoft announced recently a new Visual Studio Code extension to handle Makefiles. This extension provides a set of commands to the editor that will facilitate working with projects that rely on a Makefile to speed up the build. In this tutorial, you’ll set up a simple C++ project that depends on a well-known Python library to produce some sample charts. This is not a deep tutorial about make and Makefiles, but to get the most out of the extension you will need to have some concepts clear. Make is one of the most used tools to build software projects, for good reason: You can get an implementation for almost any major operating system (POSIX/Windows/MacOS) It’s technology agnostic. You can use it to build projects on any programming language (here’s an example for JavaScript. Its task runner capabilities provide a multipurpose tool for almost any task. A Makefile is a simple text file that defines rules to be executed. The usual purpose for Makefile in C++ projects is to recompile and link necessary files based on the modifications done to dependencies. However, Makefile and make are far more useful than that. The rules defined in a Makefile combine concepts like: Shell scripting Regular expressions Target notation Project structure To illustrate this power, the sample project contains a single C++ source code file. The source code for the example is pretty simple —- it flips a coin as many times as the iters argument is passed, and then prints the number of heads and tails counted from each flip. #include &amp;lt;cstdio&amp;gt; #include &amp;lt;cstdlib&amp;gt; #include &amp;lt;stdlib.h&amp;gt; #include &amp;lt;assert.h&amp;gt; #include &amp;lt;time.h&amp;gt; int flip_coins(int iters) { srand (time(NULL)); int heads, tails = 0; for(int i=0;i &amp;lt; iters;i++){ (rand() % 10 + 1) &amp;lt;= 5 ? heads++ : tails++; } printf(&amp;quot;%d Heads, %d Tails\n&amp;quot;,heads, tails); return abs(tails-heads); } int main(int argc,char* argv[]) { assert (argc == 2); int iters = atoi(argv[1]); int diff = flip_coins(iters); if(100 &amp;lt; iters) { printf(&amp;quot;With enough trials Heads should be equal to Tails\n&amp;quot;); } } This code will be compiled and linked with a simple Makefile that also will provide a couple of other standard rules for cleaning the compiled code and run a simple test. Creating C++ Projects with VS Code The VS Code extension Makefile Tools is still in preview but is actively developed. The installation process is similar to any other extension in VS Code: Makefile VSCode extension After installing the extension, verify the availability of the make command in the system. The most common implementation is GNU Make, which includes some non-standard extensions. If your installation of make is not available in the default path, you can configure it in VS Code at File &amp;gt; Preferences &amp;gt; Settings &amp;gt; Extensions makefile. Make path To compile and link the project, you can add a Makefile to the root of the project folder. It will be detected automatically by the extension. If you have a different structure, with a Makefile in another location, you can configure it at File &amp;gt; Preferences &amp;gt; Settings &amp;gt; Extensions &amp;gt; makefile. Makefile path This sample Makefile defines five simple rules: all: Cleans the compiled files from the target folder, then compiles and run the test code. default: Delegates to CoinFlipper.cpp. CoinFlipper.cpp: Compiles the single source file. test: Delegates to CoinFlipper.cpp, then runs the output main function passing an argument. clean: Deletes compiled files. # # A simple makefile for compiling a c++ project # SRC=./src TARGET=./target GCC = g++ CFLAGS = -o $(TARGET)/CoinFlipper.out ARGS = 101 RM = rm -rf all: clean default test default: CoinFlipper.cpp CoinFlipper.cpp: $(GCC) $(CFLAGS) $(SRC)/main/CoinFlipper.cpp test: CoinFlipper.cpp $(TARGET)/CoinFlipper.out $(ARGS) clean: $(RM) $(TARGET)/*.out The Makefile Tools Extension provides a new “perspective” to the Visual Studio Code IDE. This contains three different commands and three different project configurations to run the Makefile: Makefile tools perspective The Configuration:[Default] refers to the make command configurations defined in the .vscode/settings.json file. This configuration is used to pass arguments to the make utility. In the following example, two configurations are defined: Default Print make version Print make versions adds the --version argument to the make utility every time the project is built using the Makefile extension. This argument is not especially useful but you can explore different arguments to fit your case. { &amp;quot;makefile.configurations&amp;quot;: [ { &amp;quot;name&amp;quot;: &amp;quot;Default&amp;quot;, &amp;quot;makeArgs&amp;quot;: [] }, { &amp;quot;name&amp;quot;: &amp;quot;Print make version&amp;quot;, &amp;quot;makeArgs&amp;quot;: [&amp;quot;--version&amp;quot;] } ] } The second configuration is the default build target rule for the make utility, which is equivalent to running make [target] directly. The IDE will let show you a list of target rules defined in the Makefile configured for the project: config build target Finally, the third configuration available in the perspective is the Launch target. This shows you a list of compiled files that can be run from the perspective using the commands Debug and Run. This is useful if you want to debug your source code with GDB or LLDB debuggers. In this example, the only file runnable is CoinFlipper.out, compiled from the source code. make launch target The commands in the Makefile are self-explanatory: Build runs make with the target configured previously. all instead of default passes no arguments to the make utility. Debug and Run in terminal commands launch the target (CoinFlipper.out in the example) with/without the debug support. Once you build the project, the terminal view shows the result of the execution: Building target &amp;quot;all&amp;quot; with command: &amp;quot;make all&amp;quot; rm -rf ./target/*.out g++ -o ./target/CoinFlipper.out ./src/main/CoinFlipper.cpp ./target/CoinFlipper.out 101 50 Heads, 51 Tails With enough trials Heads should be equal to Tails Target all built successfully. As you can see from the previous image, the target was built successfully after cleaning, compiling, and running the compiled program. The extension also provides commands to run other targets easily without changing the configurations in the perspective. The following image shows the commands available for the Makefile in the sample project: The makefile commands palette. Building Complex Projects Makefiles are more complex than this. Many projects have several levels of dependencies, configurations, and quirks that make supports easily. For example, the FFmpeg project is a collection of libraries to work with audio, video, and subtitles among other utilities. To build it, you can download the source from GitHub and examine the Makefile: The makefile for FFmpeg. The developer documentation for the project states that before building the source code with the provided Makefile, you need to run the configure script located at the root of the project’s source code. Fortunately, the Makefile Tools Extension provides a setting to define the preconfiguration files required to run before executing the make commands, again in File &amp;gt; Preferences &amp;gt; Settings. The makefile preconfiguration. In the Commands section of the Makefile Tools Extension perspective, you can run the preconfigure command. This will run the configure script, and then you’re ready to experiment with the Makefile through the extension. Conclusion Large codebase projects need a build system to keep them under the development team’s control, and Makefiles are one the most ubiquitous and flexible ways to define building these complex software projects. With the new Makefile Tools Extension, Visual Studio Code greatly simplifies access for new developers. Though it is still tagged as in preview, this extension has been thoroughly tested by the Microsoft Team, building over seventy open-source projects written in different languages (including C, C++, and Python) successfully. If you want to learn about the power of make and Makefile, consider checking out the Makefile Tutorial, and if you want the simplicity of a Makefile with the isolation of containers take a look at Earthly.</summary></entry><entry><title type="html">Using Continuous Testing in DevOps Workflows</title><link href="https://earthly.dev/blog/continuous-testing-in-devops/" rel="alternate" type="text/html" title="Using Continuous Testing in DevOps Workflows" /><published>2021-07-27T00:00:00-04:00</published><updated>2021-07-27T00:00:00-04:00</updated><id>https://earthly.dev/blog/continuous-testing-in-devops</id><content type="html" xml:base="https://earthly.dev/blog/continuous-testing-in-devops/">&lt;p&gt;Automation testing is a crucial element to speed up your delivery process. It aims to flush out any potential regressions. The more you automate, the more confidence you gain in the quality of your software because the quality of each release of your application or library is measurable. Additionally, you reduce costs and save time and effort by reducing manual testing.&lt;/p&gt;
&lt;p&gt;The caveat is that automated tests have no value if they are not executed regularly alongside your continuous integration (CI) pipeline. CI refers to frequently merging developer code changes and building and creating an artifact that can later be tested and deployed.&lt;/p&gt;
&lt;p&gt;Extending the CI process by adding automated tests is referred to as continuous testing (CT). CT enables you to apply the fail-fast principle. You test each code change, build, and deployment against several layers of automated tests. Thus, it results in rapid feedback on the quality of your product and the state of the development process.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/actions&quot;&gt;GitHub Actions&lt;/a&gt; is a great first step for implementing CT. It’s flexible and powerful enough to bring every step of the CI/CT process into a single place. Your application, tests, and workflow configuration lives with your code in your repository. Furthermore, the learning curve for GitHub Actions is relatively smooth thanks to the &lt;a href=&quot;https://github.com/marketplace?type=actions&quot;&gt;Marketplace&lt;/a&gt; that provides thousands of Actions ready to use out of the box.&lt;/p&gt;
&lt;h2 id=&quot;what-does-it-take-to-implement-continuous-testing&quot;&gt;What Does It Take to Implement Continuous Testing?&lt;/h2&gt;
&lt;p&gt;A good CI/CT process always contains at least the following steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Build&lt;/li&gt;
&lt;li&gt;Deployment&lt;/li&gt;
&lt;li&gt;Integration tests&lt;/li&gt;
&lt;li&gt;End-to-end tests&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this tutorial, you will implement these four steps using GitHub Actions, as well as add performance tests.&lt;/p&gt;
&lt;p&gt;The Build steps include code compilation and unit tests. Also, note that it’s convenient to deploy your application in a &lt;code&gt;dev&lt;/code&gt; environment before running complex tests such as integration and end-to-end. However, you may also run your application in GitHub Actions for test purposes.&lt;/p&gt;
&lt;p&gt;In this article, I assume you’ll deploy to a &lt;code&gt;dev&lt;/code&gt; environment and focus on implementing different types of tests. Here is a visual of the final workflow for this tutorial:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/40nOj1F.png&quot; alt=&quot;Final GitHub Action Workflow&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Final GitHub Action Workflow&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Implementing continuous testing can be challenging. If you are on a team that is new to this fail-fast approach, it may be a frustrating transition. In addition, seeing builds or pipelines failing can be overwhelming at the beginning. I suggest prioritizing fixing tests over focusing on new features. This may also be a significant change.&lt;/p&gt;
&lt;p&gt;To remediate those challenges, you should rely on the five DevOps principles described by &lt;a href=&quot;https://twitter.com/jezhumble&quot;&gt;Jez Humble&lt;/a&gt; in &lt;em&gt;The DevOps Handbook&lt;/em&gt;:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Culture&lt;/li&gt;
&lt;li&gt;Automate&lt;/li&gt;
&lt;li&gt;Lean&lt;/li&gt;
&lt;li&gt;Measure&lt;/li&gt;
&lt;li&gt;Sharing&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Implementing continuous testing is first a change in &lt;strong&gt;culture&lt;/strong&gt;. Selecting the right tools for CI/CT can greatly improve collaboration.&lt;/p&gt;
&lt;p&gt;Keep your process &lt;strong&gt;lean&lt;/strong&gt;. Testing should not slow down your process. Instead, select the right amount of tests at the right time in the process. Monitor your &lt;a href=&quot;https://docs.github.com/en/actions/managing-workflow-runs/viewing-job-execution-time&quot;&gt;job execution time&lt;/a&gt;, prefer small tasks that can fail fast, and provide rapid feedback instead of long-running ones.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Automate&lt;/strong&gt; as much and as early as possible because it helps validate that the integration is successful. Delaying test implementation is counterproductive.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Measure&lt;/strong&gt; your improvement and build a baseline for the quality of your software. For example, collect your code coverage, number of successful vs. failed tests, and performance metric.&lt;/p&gt;
&lt;p&gt;Don’t forget to encourage knowledge &lt;strong&gt;sharing&lt;/strong&gt;. Test automation is not a single person’s job: everyone on the team should know how the test suites work and learn how to fix simple errors when the workflows fail.&lt;/p&gt;
&lt;h2 id=&quot;implementing-cict-with-github-actions&quot;&gt;Implementing CI/CT With GitHub Actions&lt;/h2&gt;
&lt;p&gt;Now that you know the basics of CT, it’s time to see how to implement the first step by creating a GitHub Actions workflow that builds and runs your unit tests.&lt;/p&gt;
&lt;h3 id=&quot;build-a-github-actions-workflow-with-unit-tests&quot;&gt;Build a GitHub Actions Workflow with Unit Tests&lt;/h3&gt;
&lt;p&gt;The first thing you need to get started is an initial workflow. If you already committed your application to a GitHub repository, click &lt;strong&gt;Actions&lt;/strong&gt;. GitHub will automatically select and recommend a simple workflow that best suits your language.&lt;/p&gt;
&lt;p&gt;Select one of them by clicking &lt;strong&gt;Set up this workflow&lt;/strong&gt;, review the workflow steps, and commit.&lt;/p&gt;
&lt;p&gt;Right away, you should see your workflow starting to build and test your application. Many starting workflows also include linting that validates the formatting and detects potential errors.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/043P3GAA.png&quot; alt=&quot;Get Started with GitHub Action Workflow&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Get Started with GitHub Action Workflow&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;A GitHub Actions workflow contains three elements:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Triggers&lt;/strong&gt; (&lt;code&gt;on&lt;/code&gt;) specify when the workflow must be executed. The most common use case is to run a workflow on &lt;a href=&quot;https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#on&quot;&gt;push and pull-request on the &lt;code&gt;main&lt;/code&gt; branch&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Jobs&lt;/strong&gt; determine sets of actions composing your pipeline and are executed in parallel unless dependencies between jobs are specified.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Steps&lt;/strong&gt; are the individual components of a job and can be of two types: &lt;code&gt;Scripts&lt;/code&gt; or &lt;code&gt;Actions&lt;/code&gt;. Steps defining a &lt;code&gt;run&lt;/code&gt; attribute execute a command on the host defined by &lt;code&gt;runs-on&lt;/code&gt; at the beginning of a job. Steps containing &lt;code&gt;uses&lt;/code&gt; execute an &lt;a href=&quot;https://docs.github.com/en/actions/creating-actions&quot;&gt;Action&lt;/a&gt;, a reusable automation script.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It’s straightforward to extend a workflow once you understand those three concepts. Here’s a sample workflow for a Python application:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode yaml&quot;&gt;&lt;code class=&quot;sourceCode yaml&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Python application&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; main &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ubuntu-latest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/checkout@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Set up Python 3.9&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/setup-python@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-16&quot;&gt;&lt;a href=&quot;#cb1-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-17&quot;&gt;&lt;a href=&quot;#cb1-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;python-version&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;3.9&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-18&quot;&gt;&lt;a href=&quot;#cb1-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Install dependencies&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-19&quot;&gt;&lt;a href=&quot;#cb1-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;      run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-20&quot;&gt;&lt;a href=&quot;#cb1-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        python -m pip install --upgrade pip&lt;/span&gt;
&lt;span id=&quot;cb1-21&quot;&gt;&lt;a href=&quot;#cb1-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        pip install flake8 pytest&lt;/span&gt;
&lt;span id=&quot;cb1-22&quot;&gt;&lt;a href=&quot;#cb1-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi&lt;/span&gt;
&lt;span id=&quot;cb1-23&quot;&gt;&lt;a href=&quot;#cb1-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Lint with flake8&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-24&quot;&gt;&lt;a href=&quot;#cb1-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;      run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-25&quot;&gt;&lt;a href=&quot;#cb1-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        # stop the build if there are Python syntax errors or undefined names&lt;/span&gt;
&lt;span id=&quot;cb1-26&quot;&gt;&lt;a href=&quot;#cb1-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics&lt;/span&gt;
&lt;span id=&quot;cb1-27&quot;&gt;&lt;a href=&quot;#cb1-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide&lt;/span&gt;
&lt;span id=&quot;cb1-28&quot;&gt;&lt;a href=&quot;#cb1-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics&lt;/span&gt;
&lt;span id=&quot;cb1-29&quot;&gt;&lt;a href=&quot;#cb1-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Test with pytest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-30&quot;&gt;&lt;a href=&quot;#cb1-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;      run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-31&quot;&gt;&lt;a href=&quot;#cb1-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        pytest&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This what a basic workflow looks like:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/KVnFfF4.png&quot; alt=&quot;Most basic GitHub Actions workflow&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Most basic GitHub Actions workflow&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h3 id=&quot;add-code-coverage-reports&quot;&gt;Add Code Coverage Reports&lt;/h3&gt;
&lt;p&gt;On GitHub, most users rely on third parties to get coverage reports (such as &lt;a href=&quot;https://www.sonarqube.org/&quot;&gt;SonarQube&lt;/a&gt; or &lt;a href=&quot;https://about.codecov.io/&quot;&gt;Codecov&lt;/a&gt;). Integrating those SaaS into your workflow is simple, thanks to the GitHub Actions Marketplace. Most third parties providing code coverage reports have created an Action to make the integration seamless.&lt;/p&gt;
&lt;p&gt;But let’s not rely on a third party yet. Instead, generate a badge to display in your &lt;code&gt;Readme.md&lt;/code&gt;. You’re putting in place the first step toward tracking code quality.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Edit your existing &lt;code&gt;Test with xxx&lt;/code&gt; step to generate a coverage report.&lt;/li&gt;
&lt;li&gt;Save the coverage report as an artifact. &lt;a href=&quot;https://docs.github.com/en/actions/guides/storing-workflow-data-as-artifacts&quot;&gt;Storing workflow data as artifacts&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Create a new job called &lt;code&gt;gating&lt;/code&gt; and download the coverage report. This job must be executed after &lt;code&gt;build&lt;/code&gt;; therefore, you must declare &lt;code&gt;needs: build&lt;/code&gt; in your configuration.&lt;/li&gt;
&lt;li&gt;Parse the coverage report to extract the coverage value. I provided a small script that does just that.&lt;/li&gt;
&lt;li&gt;Generate the badge and add it to your README. Follow the setup step in the documentation of &lt;a href=&quot;https://github.com/Schneegans/dynamic-badges-action&quot;&gt;schneegans/dynamic-badges-action@v1.1.0&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode yml&quot;&gt;&lt;code class=&quot;sourceCode yaml&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# This workflow will install Python dependencies, run tests, and lint with a single version of Python&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Python application&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; main &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; main &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ubuntu-latest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-15&quot;&gt;&lt;a href=&quot;#cb2-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-16&quot;&gt;&lt;a href=&quot;#cb2-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/checkout@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-17&quot;&gt;&lt;a href=&quot;#cb2-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Set up Python 3.9&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-18&quot;&gt;&lt;a href=&quot;#cb2-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/setup-python@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-19&quot;&gt;&lt;a href=&quot;#cb2-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-20&quot;&gt;&lt;a href=&quot;#cb2-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;python-version&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;3.9&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-21&quot;&gt;&lt;a href=&quot;#cb2-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Install dependencies&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-22&quot;&gt;&lt;a href=&quot;#cb2-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-23&quot;&gt;&lt;a href=&quot;#cb2-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Lint with flake8&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-24&quot;&gt;&lt;a href=&quot;#cb2-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-25&quot;&gt;&lt;a href=&quot;#cb2-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Test with pytest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-26&quot;&gt;&lt;a href=&quot;#cb2-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;      # Update the command to generate coverage report&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-27&quot;&gt;&lt;a href=&quot;#cb2-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; pytest --cov-report xml --cov=phonebook tests/&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-28&quot;&gt;&lt;a href=&quot;#cb2-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Upload pytest test coverage&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-29&quot;&gt;&lt;a href=&quot;#cb2-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;      # Upload the coverage result as an artifact&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-30&quot;&gt;&lt;a href=&quot;#cb2-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/upload-artifact@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-31&quot;&gt;&lt;a href=&quot;#cb2-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-32&quot;&gt;&lt;a href=&quot;#cb2-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; coverage-results&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-33&quot;&gt;&lt;a href=&quot;#cb2-33&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; coverage.xml&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-34&quot;&gt;&lt;a href=&quot;#cb2-34&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;      # Use always() to always run this step to publish test results when there are test failures&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-35&quot;&gt;&lt;a href=&quot;#cb2-35&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ${{ always() }}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-36&quot;&gt;&lt;a href=&quot;#cb2-36&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-37&quot;&gt;&lt;a href=&quot;#cb2-37&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;gating&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-38&quot;&gt;&lt;a href=&quot;#cb2-38&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ubuntu-latest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-39&quot;&gt;&lt;a href=&quot;#cb2-39&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; build&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-40&quot;&gt;&lt;a href=&quot;#cb2-40&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-41&quot;&gt;&lt;a href=&quot;#cb2-41&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-42&quot;&gt;&lt;a href=&quot;#cb2-42&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Download coverage report&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-43&quot;&gt;&lt;a href=&quot;#cb2-43&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/download-artifact@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-44&quot;&gt;&lt;a href=&quot;#cb2-44&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-45&quot;&gt;&lt;a href=&quot;#cb2-45&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; coverage-results&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-46&quot;&gt;&lt;a href=&quot;#cb2-46&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Get the Coverage&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-47&quot;&gt;&lt;a href=&quot;#cb2-47&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;shell&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; bash&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-48&quot;&gt;&lt;a href=&quot;#cb2-48&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;      run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-49&quot;&gt;&lt;a href=&quot;#cb2-49&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        regex=&amp;#39;&amp;lt;coverage.+line-rate=&amp;quot;([0-9).[0-9]+)&amp;quot;.+&amp;gt;&amp;#39;&lt;/span&gt;
&lt;span id=&quot;cb2-50&quot;&gt;&lt;a href=&quot;#cb2-50&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        line=$(grep -oP $regex coverage.xml)&lt;/span&gt;
&lt;span id=&quot;cb2-51&quot;&gt;&lt;a href=&quot;#cb2-51&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        [[ $line =~ $regex ]]&lt;/span&gt;
&lt;span id=&quot;cb2-52&quot;&gt;&lt;a href=&quot;#cb2-52&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        coverage=$( bc &amp;lt;&amp;lt;&amp;lt; ${BASH_REMATCH[1]}*100 )&lt;/span&gt;
&lt;span id=&quot;cb2-53&quot;&gt;&lt;a href=&quot;#cb2-53&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        if (( $(echo &amp;quot;$coverage &amp;gt; 80&amp;quot; |bc -l) )); then&lt;/span&gt;
&lt;span id=&quot;cb2-54&quot;&gt;&lt;a href=&quot;#cb2-54&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          COLOR=green&lt;/span&gt;
&lt;span id=&quot;cb2-55&quot;&gt;&lt;a href=&quot;#cb2-55&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        else&lt;/span&gt;
&lt;span id=&quot;cb2-56&quot;&gt;&lt;a href=&quot;#cb2-56&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          COLOR=red&lt;/span&gt;
&lt;span id=&quot;cb2-57&quot;&gt;&lt;a href=&quot;#cb2-57&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        fi&lt;/span&gt;
&lt;span id=&quot;cb2-58&quot;&gt;&lt;a href=&quot;#cb2-58&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        echo &amp;quot;COVERAGE=${coverage%.*}%&amp;quot; &amp;gt;&amp;gt; $GITHUB_ENV&lt;/span&gt;
&lt;span id=&quot;cb2-59&quot;&gt;&lt;a href=&quot;#cb2-59&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        echo &amp;quot;COLOR=$COLOR&amp;quot; &amp;gt;&amp;gt; $GITHUB_ENV&lt;/span&gt;
&lt;span id=&quot;cb2-60&quot;&gt;&lt;a href=&quot;#cb2-60&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Create the Badge&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-61&quot;&gt;&lt;a href=&quot;#cb2-61&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;      # save the badge configuration in a Gist&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-62&quot;&gt;&lt;a href=&quot;#cb2-62&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; schneegans/dynamic-badges-action@v1.1.0&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-63&quot;&gt;&lt;a href=&quot;#cb2-63&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-64&quot;&gt;&lt;a href=&quot;#cb2-64&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;auth&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ${{ secrets.GIST_SECRET }}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-65&quot;&gt;&lt;a href=&quot;#cb2-65&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;gistID&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ab3bde9504060bd1feb361555e79f51d&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-66&quot;&gt;&lt;a href=&quot;#cb2-66&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; coverage.json&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-67&quot;&gt;&lt;a href=&quot;#cb2-67&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; coverage&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-68&quot;&gt;&lt;a href=&quot;#cb2-68&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ${{ env.COVERAGE }}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-69&quot;&gt;&lt;a href=&quot;#cb2-69&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ${{ env.COLOR }}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is what your updated workflow looks like:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/1626877878.png&quot; alt=&quot;GitHub Action workflow including code coverage badge&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;GitHub Action workflow including code coverage badge&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;And you got a badge to decorate your &lt;code&gt;readme.md&lt;/code&gt;.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/1626878146.png&quot; alt=&quot;GitHub code coverage badge&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;GitHub code coverage badge&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2 id=&quot;extending-ct-with-other-types-of-testing&quot;&gt;Extending CT with Other Types of Testing&lt;/h2&gt;
&lt;p&gt;You have a basic CI workflow that includes unit tests and coverage reports. Now to obtain an excellent CT workflow, you need to expand with more layers of tests. You will add three new jobs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For API testing,&lt;/li&gt;
&lt;li&gt;For end-to-end testing&lt;/li&gt;
&lt;li&gt;For performance testing&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;add-api-testing&quot;&gt;Add API Testing&lt;/h3&gt;
&lt;p&gt;API testing is part of &lt;a href=&quot;/blog/unit-vs-integration&quot;&gt;integration testing&lt;/a&gt;. Integration testing aims to determine whether individual units meet your requirement when combined together. When performing integration testing, you target the boundary (or interfaces) of your system. In this specific case, you are aiming your test at a RESTful API. Having API tests ensures that sets of functionality meet your requirement and validates that your web server and connection to a database works properly.&lt;/p&gt;
&lt;p&gt;While you could write an API test in the same language as your application, you should also consider a tool like &lt;a href=&quot;https://blog.scottlogic.com/2020/02/04/GraduateGuideToAPITesting.html&quot;&gt;Postman/Newman&lt;/a&gt;. Postman lets you define a sequence of HTTPS calls and validate each of them using their JavaScript test framework. This makes it easy to share integration test suites. Other developers can use them to facilitate their development process, for instance, mobile developers working with a different stack than backend developers. Newman is the command-line interface that lets you run the Postman tests.&lt;/p&gt;
&lt;p&gt;Now that you have selected an API testing framework go to GitHub &lt;a href=&quot;https://github.com/marketplace?type=actions&quot;&gt;Actions Marketplace&lt;/a&gt; and look for an Action that meets your demands. For instance, &lt;a href=&quot;https://github.com/marketplace/actions/newman-action&quot;&gt;Newman Action&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now edit your workflow configuration:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add a new job that must be executed after the deployment using &lt;code&gt;needs: deploy&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Define the steps of your job:
&lt;ul&gt;
&lt;li&gt;Check out your repository using the Action &lt;code&gt;actions/checkout@master&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Run Newman using the Action you just found in the Marketplace.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Move the gating job at the end of the workflow by changing the &lt;code&gt;needs&lt;/code&gt; property.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode yaml&quot;&gt;&lt;code class=&quot;sourceCode yaml&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Python application&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; main &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-10&quot;&gt;&lt;a href=&quot;#cb3-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-11&quot;&gt;&lt;a href=&quot;#cb3-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;co&quot;&gt; # our deployment steps&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-12&quot;&gt;&lt;a href=&quot;#cb3-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tests_api&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-13&quot;&gt;&lt;a href=&quot;#cb3-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; deploy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-14&quot;&gt;&lt;a href=&quot;#cb3-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ubuntu-latest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-15&quot;&gt;&lt;a href=&quot;#cb3-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-16&quot;&gt;&lt;a href=&quot;#cb3-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/checkout@master&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-17&quot;&gt;&lt;a href=&quot;#cb3-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; matt-ball/newman-action@master&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-18&quot;&gt;&lt;a href=&quot;#cb3-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-19&quot;&gt;&lt;a href=&quot;#cb3-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;collection&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; tests_integration/postman_collection.json&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-20&quot;&gt;&lt;a href=&quot;#cb3-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; tests_integration/postman_environment.json&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-21&quot;&gt;&lt;a href=&quot;#cb3-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;gating&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-22&quot;&gt;&lt;a href=&quot;#cb3-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; tests_api&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-23&quot;&gt;&lt;a href=&quot;#cb3-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;co&quot;&gt; # we move the gating at the end of the workflow&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now your workflow should contain four sequential jobs:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/1626878353.png&quot; alt=&quot;GitHub Actions workflow including API tests&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;GitHub Actions workflow including API tests&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h3 id=&quot;add-end-to-end-testing&quot;&gt;Add End-to-End Testing&lt;/h3&gt;
&lt;p&gt;End-to-end testing (e2e) aims to test complete use cases from the user perspective. Think of e2e as replacing a human with a robot.&lt;/p&gt;
&lt;p&gt;When it comes to selecting an e2e framework, I recommend prioritizing one that supports the Gherkin language. Gherkin promotes writing tests in natural language (aka, plain English). With this approach, more people can understand test cases, including product owners and business analysts. As a result, you foster better collaboration within the team.&lt;/p&gt;
&lt;p&gt;Verbalizing tests also ensure that you are writing them from the user’s perspective and not making the mistake of testing the functions you just coded.&lt;/p&gt;
&lt;p&gt;I selected &lt;a href=&quot;https://robotframework.org/&quot;&gt;Robot Framework&lt;/a&gt; for this example. Robot Framework uses &lt;a href=&quot;https://www.selenium.dev/&quot;&gt;Selenium&lt;/a&gt; to control a web browser and thus replace a human by simulating clicks and text entries.&lt;/p&gt;
&lt;p&gt;Once again, you can go to &lt;a href=&quot;https://github.com/marketplace?type=actions&quot;&gt;GitHub Actions Marketplace&lt;/a&gt; and look for an Action meeting your needs. For instance, &lt;a href=&quot;https://github.com/marketplace/actions/robot-framework&quot;&gt;Robot Framework Docker Action&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Add a new job called &lt;code&gt;test_e2e&lt;/code&gt; to the workflow configuration. This job must be executed after deploy using &lt;code&gt;needs: deploy&lt;/code&gt;. You will notice that since &lt;code&gt;tests_api&lt;/code&gt; and &lt;code&gt;test_e2e&lt;/code&gt; both need &lt;code&gt;deploy&lt;/code&gt;, they will be executed in parallel after the deployment.&lt;/p&gt;
&lt;p&gt;Have a look at the result:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/1626878240.png&quot; alt=&quot;GitHub Actions workflow including end-to-end tests&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;GitHub Actions workflow including end-to-end tests&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;Your configuration should look along those lines to achieve this workflow:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode yaml&quot;&gt;&lt;code class=&quot;sourceCode yaml&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Python application&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; main &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-9&quot;&gt;&lt;a href=&quot;#cb4-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-10&quot;&gt;&lt;a href=&quot;#cb4-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tests_api&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-11&quot;&gt;&lt;a href=&quot;#cb4-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;test_e2e&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-12&quot;&gt;&lt;a href=&quot;#cb4-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ubuntu-latest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-13&quot;&gt;&lt;a href=&quot;#cb4-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; deploy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-14&quot;&gt;&lt;a href=&quot;#cb4-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Run Robot Framework Tests&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-15&quot;&gt;&lt;a href=&quot;#cb4-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-16&quot;&gt;&lt;a href=&quot;#cb4-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Checkout&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-17&quot;&gt;&lt;a href=&quot;#cb4-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/checkout@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-18&quot;&gt;&lt;a href=&quot;#cb4-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Create folder for reports&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-19&quot;&gt;&lt;a href=&quot;#cb4-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; mkdir reports&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-20&quot;&gt;&lt;a href=&quot;#cb4-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Robot Framework Test&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-21&quot;&gt;&lt;a href=&quot;#cb4-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        # &lt;/span&gt;&lt;span class=&quot;al&quot;&gt;NOTE&lt;/span&gt;&lt;span class=&quot;co&quot;&gt;: joonvena/robotframework-docker-action@v0.1 had permissions issue&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-22&quot;&gt;&lt;a href=&quot;#cb4-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        # This action is based on a Docker image. I had to fall back to that image&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-23&quot;&gt;&lt;a href=&quot;#cb4-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        # and use --user flag&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-24&quot;&gt;&lt;a href=&quot;#cb4-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;        run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-25&quot;&gt;&lt;a href=&quot;#cb4-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          docker run \&lt;/span&gt;
&lt;span id=&quot;cb4-26&quot;&gt;&lt;a href=&quot;#cb4-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            -v ${PWD}/reports:/opt/robotframework/reports:Z \&lt;/span&gt;
&lt;span id=&quot;cb4-27&quot;&gt;&lt;a href=&quot;#cb4-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            -v $/tests_e2e:/opt/robotframework/tests:Z \&lt;/span&gt;
&lt;span id=&quot;cb4-28&quot;&gt;&lt;a href=&quot;#cb4-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            --user $(id -u):$(id -g) \&lt;/span&gt;
&lt;span id=&quot;cb4-29&quot;&gt;&lt;a href=&quot;#cb4-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            -e BROWSER=chrome \&lt;/span&gt;
&lt;span id=&quot;cb4-30&quot;&gt;&lt;a href=&quot;#cb4-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            ppodgorsek/robot-framework:latest&lt;/span&gt;
&lt;span id=&quot;cb4-31&quot;&gt;&lt;a href=&quot;#cb4-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Upload test results&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-32&quot;&gt;&lt;a href=&quot;#cb4-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/upload-artifact@v1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-33&quot;&gt;&lt;a href=&quot;#cb4-33&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; always()&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-34&quot;&gt;&lt;a href=&quot;#cb4-34&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-35&quot;&gt;&lt;a href=&quot;#cb4-35&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; robotframework report&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-36&quot;&gt;&lt;a href=&quot;#cb4-36&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; reports&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-37&quot;&gt;&lt;a href=&quot;#cb4-37&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;gating&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-38&quot;&gt;&lt;a href=&quot;#cb4-38&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;tests_api&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; test_e2e&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-39&quot;&gt;&lt;a href=&quot;#cb4-39&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;co&quot;&gt; # move the gating at the end of the workflow&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;add-performance-testing&quot;&gt;Add Performance Testing&lt;/h3&gt;
&lt;p&gt;Performance testing is a broad topic because there are multiple types of performance testing. Most online sources agree on six types:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Load testing&lt;/li&gt;
&lt;li&gt;Stress testing&lt;/li&gt;
&lt;li&gt;Soak testing&lt;/li&gt;
&lt;li&gt;Spike testing&lt;/li&gt;
&lt;li&gt;Scalability testing&lt;/li&gt;
&lt;li&gt;Capacity testing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, I don’t recommend you try to include each of them. Instead, consider one of two ways to tackle performance testing:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;&lt;strong&gt;Identify bottlenecks.&lt;/strong&gt; Design an experiment that identifies bottlenecks and measures the limit of your system.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Benchmarking.&lt;/strong&gt; Identify critical elements of your application and measure its speed. The goal is to improve one performance metric over time; conversely, you want to be alerted in case of metric degradation and address the problem as soon as possible.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;As before, create a new job (called &lt;code&gt;test_performance&lt;/code&gt;). This time I did not find an Action on the Marketplace that fit my requirement. But I recommend &lt;a href=&quot;https://medium.com/nerd-for-tech/ci-build-performance-testing-with-github-action-e6b227097c83&quot;&gt;this Medium article&lt;/a&gt; to help you select your framework and implement the steps of the job yourself.&lt;/p&gt;
&lt;p&gt;Here is the workflow I came up with for my Python application:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode yml&quot;&gt;&lt;code class=&quot;sourceCode yaml&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Python application&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; main &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-6&quot;&gt;&lt;a href=&quot;#cb5-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-7&quot;&gt;&lt;a href=&quot;#cb5-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-8&quot;&gt;&lt;a href=&quot;#cb5-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-9&quot;&gt;&lt;a href=&quot;#cb5-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-10&quot;&gt;&lt;a href=&quot;#cb5-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tests_api&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-11&quot;&gt;&lt;a href=&quot;#cb5-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;test_e2e&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;at&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-12&quot;&gt;&lt;a href=&quot;#cb5-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;test_performances&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-13&quot;&gt;&lt;a href=&quot;#cb5-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Check performance regression.&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-14&quot;&gt;&lt;a href=&quot;#cb5-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; ubuntu-latest&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-15&quot;&gt;&lt;a href=&quot;#cb5-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; deploy&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-16&quot;&gt;&lt;a href=&quot;#cb5-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-17&quot;&gt;&lt;a href=&quot;#cb5-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/checkout@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-18&quot;&gt;&lt;a href=&quot;#cb5-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Set up Python 3.9&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-19&quot;&gt;&lt;a href=&quot;#cb5-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; actions/setup-python@v2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-20&quot;&gt;&lt;a href=&quot;#cb5-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-21&quot;&gt;&lt;a href=&quot;#cb5-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;python-version&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fl&quot;&gt;3.9&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-22&quot;&gt;&lt;a href=&quot;#cb5-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Install dependencies&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-23&quot;&gt;&lt;a href=&quot;#cb5-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;        run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;|&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-24&quot;&gt;&lt;a href=&quot;#cb5-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          python -m pip install --upgrade pip&lt;/span&gt;
&lt;span id=&quot;cb5-25&quot;&gt;&lt;a href=&quot;#cb5-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          pip install flake8 pytest&lt;/span&gt;
&lt;span id=&quot;cb5-26&quot;&gt;&lt;a href=&quot;#cb5-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi&lt;/span&gt;
&lt;span id=&quot;cb5-27&quot;&gt;&lt;a href=&quot;#cb5-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          if [ -f test-requirements.txt ]; then pip install -r test-requirements.txt; fi&lt;/span&gt;
&lt;span id=&quot;cb5-28&quot;&gt;&lt;a href=&quot;#cb5-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Run benchmark&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-29&quot;&gt;&lt;a href=&quot;#cb5-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; pytest tests_performances --benchmark-json output.json&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-30&quot;&gt;&lt;a href=&quot;#cb5-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;      &lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; Store benchmark result&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-31&quot;&gt;&lt;a href=&quot;#cb5-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; rhysd/github-action-benchmark@v1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-32&quot;&gt;&lt;a href=&quot;#cb5-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        # &lt;/span&gt;&lt;span class=&quot;al&quot;&gt;NOTE&lt;/span&gt;&lt;span class=&quot;co&quot;&gt;: this action only works for public repository&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-33&quot;&gt;&lt;a href=&quot;#cb5-33&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;        # A pull-request is open with a fix&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-34&quot;&gt;&lt;a href=&quot;#cb5-34&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-35&quot;&gt;&lt;a href=&quot;#cb5-35&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;tool&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39;pytest&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-36&quot;&gt;&lt;a href=&quot;#cb5-36&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;output-file-path&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; output.json&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-37&quot;&gt;&lt;a href=&quot;#cb5-37&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;          # Personal access token to deploy GitHub Pages branch&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-38&quot;&gt;&lt;a href=&quot;#cb5-38&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;github-token&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; $&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-39&quot;&gt;&lt;a href=&quot;#cb5-39&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;          # Push and deploy GitHub pages branch automatically&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-40&quot;&gt;&lt;a href=&quot;#cb5-40&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;auto-push&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;true&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-41&quot;&gt;&lt;a href=&quot;#cb5-41&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;          # Show alert with commit comment on detecting possible performance regression&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-42&quot;&gt;&lt;a href=&quot;#cb5-42&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;alert-threshold&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39;200%&amp;#39;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-43&quot;&gt;&lt;a href=&quot;#cb5-43&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;comment-on-alert&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;true&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-44&quot;&gt;&lt;a href=&quot;#cb5-44&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;fail-on-alert&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;true&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-45&quot;&gt;&lt;a href=&quot;#cb5-45&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;at&quot;&gt;          &lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;alert-comment-cc-users&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;at&quot;&gt; &lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;#39;@xNok&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Your final workflow must look like this:&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/continuous-testing-in-devops/1626878379.png&quot; alt=&quot;GitHub Actions workflow including performances tests&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;GitHub Actions workflow including performances tests&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Continuous testing is the next step after you successfully implement &lt;a href=&quot;/blog/continuous-integration&quot;&gt;continuous integration&lt;/a&gt;. It further improves the speed of your application development process and adds a quality control layer to it.&lt;/p&gt;
&lt;p&gt;Remember, there are three essential stages in a continuous testing workflow, each testing your system from a different perspective:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Unit tests validate the internal logic.&lt;/li&gt;
&lt;li&gt;Integration tests validate the response of the system from its boundary.&lt;/li&gt;
&lt;li&gt;End-to-end tests validate the system from the user’s perspective.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Adding performance tests can help you track important metrics and ensure that changes do not negatively impact your users.&lt;/p&gt;
&lt;p&gt;Finally, to succeed in implementing CT, remember that testing should become part of your team’s DNA and share the same five pillars as DevOps: culture, automation, lean, measurement, and sharing.&lt;/p&gt;
&lt;p&gt;As your CT process grows and becomes more ingrained in how you work, take a look at &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly’s&lt;/a&gt; ability to produce a repeatable build process. It can help make testing in GitHub Actions a more straightforward process.&lt;/p&gt;</content><author><name>Alexandre Couëdelo</name></author><category term="Tutorials" /><summary type="html">Automation testing is a crucial element to speed up your delivery process. It aims to flush out any potential regressions. The more you automate, the more confidence you gain in the quality of your software because the quality of each release of your application or library is measurable. Additionally, you reduce costs and save time and effort by reducing manual testing. The caveat is that automated tests have no value if they are not executed regularly alongside your continuous integration (CI) pipeline. CI refers to frequently merging developer code changes and building and creating an artifact that can later be tested and deployed. Extending the CI process by adding automated tests is referred to as continuous testing (CT). CT enables you to apply the fail-fast principle. You test each code change, build, and deployment against several layers of automated tests. Thus, it results in rapid feedback on the quality of your product and the state of the development process. GitHub Actions is a great first step for implementing CT. It’s flexible and powerful enough to bring every step of the CI/CT process into a single place. Your application, tests, and workflow configuration lives with your code in your repository. Furthermore, the learning curve for GitHub Actions is relatively smooth thanks to the Marketplace that provides thousands of Actions ready to use out of the box. What Does It Take to Implement Continuous Testing? A good CI/CT process always contains at least the following steps: Build Deployment Integration tests End-to-end tests In this tutorial, you will implement these four steps using GitHub Actions, as well as add performance tests. The Build steps include code compilation and unit tests. Also, note that it’s convenient to deploy your application in a dev environment before running complex tests such as integration and end-to-end. However, you may also run your application in GitHub Actions for test purposes. In this article, I assume you’ll deploy to a dev environment and focus on implementing different types of tests. Here is a visual of the final workflow for this tutorial: Final GitHub Action Workflow Implementing continuous testing can be challenging. If you are on a team that is new to this fail-fast approach, it may be a frustrating transition. In addition, seeing builds or pipelines failing can be overwhelming at the beginning. I suggest prioritizing fixing tests over focusing on new features. This may also be a significant change. To remediate those challenges, you should rely on the five DevOps principles described by Jez Humble in The DevOps Handbook: Culture Automate Lean Measure Sharing Implementing continuous testing is first a change in culture. Selecting the right tools for CI/CT can greatly improve collaboration. Keep your process lean. Testing should not slow down your process. Instead, select the right amount of tests at the right time in the process. Monitor your job execution time, prefer small tasks that can fail fast, and provide rapid feedback instead of long-running ones. Automate as much and as early as possible because it helps validate that the integration is successful. Delaying test implementation is counterproductive. Measure your improvement and build a baseline for the quality of your software. For example, collect your code coverage, number of successful vs. failed tests, and performance metric. Don’t forget to encourage knowledge sharing. Test automation is not a single person’s job: everyone on the team should know how the test suites work and learn how to fix simple errors when the workflows fail. Implementing CI/CT With GitHub Actions Now that you know the basics of CT, it’s time to see how to implement the first step by creating a GitHub Actions workflow that builds and runs your unit tests. Build a GitHub Actions Workflow with Unit Tests The first thing you need to get started is an initial workflow. If you already committed your application to a GitHub repository, click Actions. GitHub will automatically select and recommend a simple workflow that best suits your language. Select one of them by clicking Set up this workflow, review the workflow steps, and commit. Right away, you should see your workflow starting to build and test your application. Many starting workflows also include linting that validates the formatting and detects potential errors. Get Started with GitHub Action Workflow A GitHub Actions workflow contains three elements: Triggers (on) specify when the workflow must be executed. The most common use case is to run a workflow on push and pull-request on the main branch. Jobs determine sets of actions composing your pipeline and are executed in parallel unless dependencies between jobs are specified. Steps are the individual components of a job and can be of two types: Scripts or Actions. Steps defining a run attribute execute a command on the host defined by runs-on at the beginning of a job. Steps containing uses execute an Action, a reusable automation script. It’s straightforward to extend a workflow once you understand those three concepts. Here’s a sample workflow for a Python application: name: Python application on: pull_request: branches: [ main ] jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 - name: Set up Python 3.9 uses: actions/setup-python@v2 with: python-version: 3.9 - name: Install dependencies run: | python -m pip install --upgrade pip pip install flake8 pytest if [ -f requirements.txt ]; then pip install -r requirements.txt; fi - name: Lint with flake8 run: | # stop the build if there are Python syntax errors or undefined names flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics - name: Test with pytest run: | pytest This what a basic workflow looks like: Most basic GitHub Actions workflow Add Code Coverage Reports On GitHub, most users rely on third parties to get coverage reports (such as SonarQube or Codecov). Integrating those SaaS into your workflow is simple, thanks to the GitHub Actions Marketplace. Most third parties providing code coverage reports have created an Action to make the integration seamless. But let’s not rely on a third party yet. Instead, generate a badge to display in your Readme.md. You’re putting in place the first step toward tracking code quality. Edit your existing Test with xxx step to generate a coverage report. Save the coverage report as an artifact. Storing workflow data as artifacts. Create a new job called gating and download the coverage report. This job must be executed after build; therefore, you must declare needs: build in your configuration. Parse the coverage report to extract the coverage value. I provided a small script that does just that. Generate the badge and add it to your README. Follow the setup step in the documentation of schneegans/dynamic-badges-action@v1.1.0. # This workflow will install Python dependencies, run tests, and lint with a single version of Python # For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions name: Python application on: push: branches: [ main ] pull_request: branches: [ main ] jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 - name: Set up Python 3.9 uses: actions/setup-python@v2 with: python-version: 3.9 - name: Install dependencies [...] - name: Lint with flake8 [...] - name: Test with pytest # Update the command to generate coverage report run: pytest --cov-report xml --cov=phonebook tests/ - name: Upload pytest test coverage # Upload the coverage result as an artifact uses: actions/upload-artifact@v2 with: name: coverage-results path: coverage.xml # Use always() to always run this step to publish test results when there are test failures if: ${{ always() }} gating: runs-on: ubuntu-latest needs: build steps: - name: Download coverage report uses: actions/download-artifact@v2 with: name: coverage-results - name: Get the Coverage shell: bash run: | regex=&amp;#39;&amp;lt;coverage.+line-rate=&amp;quot;([0-9).[0-9]+)&amp;quot;.+&amp;gt;&amp;#39; line=$(grep -oP $regex coverage.xml) [[ $line =~ $regex ]] coverage=$( bc &amp;lt;&amp;lt;&amp;lt; ${BASH_REMATCH[1]}*100 ) if (( $(echo &amp;quot;$coverage &amp;gt; 80&amp;quot; |bc -l) )); then COLOR=green else COLOR=red fi echo &amp;quot;COVERAGE=${coverage%.*}%&amp;quot; &amp;gt;&amp;gt; $GITHUB_ENV echo &amp;quot;COLOR=$COLOR&amp;quot; &amp;gt;&amp;gt; $GITHUB_ENV - name: Create the Badge # save the badge configuration in a Gist uses: schneegans/dynamic-badges-action@v1.1.0 with: auth: ${{ secrets.GIST_SECRET }} gistID: ab3bde9504060bd1feb361555e79f51d filename: coverage.json label: coverage message: ${{ env.COVERAGE }} color: ${{ env.COLOR }} This is what your updated workflow looks like: GitHub Action workflow including code coverage badge And you got a badge to decorate your readme.md. GitHub code coverage badge Extending CT with Other Types of Testing You have a basic CI workflow that includes unit tests and coverage reports. Now to obtain an excellent CT workflow, you need to expand with more layers of tests. You will add three new jobs: For API testing, For end-to-end testing For performance testing Add API Testing API testing is part of integration testing. Integration testing aims to determine whether individual units meet your requirement when combined together. When performing integration testing, you target the boundary (or interfaces) of your system. In this specific case, you are aiming your test at a RESTful API. Having API tests ensures that sets of functionality meet your requirement and validates that your web server and connection to a database works properly. While you could write an API test in the same language as your application, you should also consider a tool like Postman/Newman. Postman lets you define a sequence of HTTPS calls and validate each of them using their JavaScript test framework. This makes it easy to share integration test suites. Other developers can use them to facilitate their development process, for instance, mobile developers working with a different stack than backend developers. Newman is the command-line interface that lets you run the Postman tests. Now that you have selected an API testing framework go to GitHub Actions Marketplace and look for an Action that meets your demands. For instance, Newman Action. Now edit your workflow configuration: Add a new job that must be executed after the deployment using needs: deploy. Define the steps of your job: Check out your repository using the Action actions/checkout@master. Run Newman using the Action you just found in the Marketplace. Move the gating job at the end of the workflow by changing the needs property. name: Python application on: push: branches: [ main ] jobs: build: [...] deploy: [...] # our deployment steps tests_api: needs: deploy runs-on: ubuntu-latest steps: - uses: actions/checkout@master - uses: matt-ball/newman-action@master with: collection: tests_integration/postman_collection.json environment: tests_integration/postman_environment.json gating: needs: tests_api [...] # we move the gating at the end of the workflow Now your workflow should contain four sequential jobs: GitHub Actions workflow including API tests Add End-to-End Testing End-to-end testing (e2e) aims to test complete use cases from the user perspective. Think of e2e as replacing a human with a robot. When it comes to selecting an e2e framework, I recommend prioritizing one that supports the Gherkin language. Gherkin promotes writing tests in natural language (aka, plain English). With this approach, more people can understand test cases, including product owners and business analysts. As a result, you foster better collaboration within the team. Verbalizing tests also ensure that you are writing them from the user’s perspective and not making the mistake of testing the functions you just coded. I selected Robot Framework for this example. Robot Framework uses Selenium to control a web browser and thus replace a human by simulating clicks and text entries. Once again, you can go to GitHub Actions Marketplace and look for an Action meeting your needs. For instance, Robot Framework Docker Action. Add a new job called test_e2e to the workflow configuration. This job must be executed after deploy using needs: deploy. You will notice that since tests_api and test_e2e both need deploy, they will be executed in parallel after the deployment. Have a look at the result: GitHub Actions workflow including end-to-end tests Your configuration should look along those lines to achieve this workflow: name: Python application on: push: branches: [ main ] jobs: build: [...] deploy: [...] tests_api: [...] test_e2e: runs-on: ubuntu-latest needs: deploy name: Run Robot Framework Tests steps: - name: Checkout uses: actions/checkout@v2 - name: Create folder for reports run: mkdir reports - name: Robot Framework Test # NOTE: joonvena/robotframework-docker-action@v0.1 had permissions issue # This action is based on a Docker image. I had to fall back to that image # and use --user flag run: | docker run \ -v ${PWD}/reports:/opt/robotframework/reports:Z \ -v $/tests_e2e:/opt/robotframework/tests:Z \ --user $(id -u):$(id -g) \ -e BROWSER=chrome \ ppodgorsek/robot-framework:latest - name: Upload test results uses: actions/upload-artifact@v1 if: always() with: name: robotframework report path: reports gating: needs: [tests_api, test_e2e] [...] # move the gating at the end of the workflow Add Performance Testing Performance testing is a broad topic because there are multiple types of performance testing. Most online sources agree on six types: Load testing Stress testing Soak testing Spike testing Scalability testing Capacity testing. However, I don’t recommend you try to include each of them. Instead, consider one of two ways to tackle performance testing: Identify bottlenecks. Design an experiment that identifies bottlenecks and measures the limit of your system. Benchmarking. Identify critical elements of your application and measure its speed. The goal is to improve one performance metric over time; conversely, you want to be alerted in case of metric degradation and address the problem as soon as possible. As before, create a new job (called test_performance). This time I did not find an Action on the Marketplace that fit my requirement. But I recommend this Medium article to help you select your framework and implement the steps of the job yourself. Here is the workflow I came up with for my Python application: name: Python application on: push: branches: [ main ] jobs: build: [...] deploy: [...] tests_api: [...] test_e2e: [...] test_performances: name: Check performance regression. runs-on: ubuntu-latest needs: deploy steps: - uses: actions/checkout@v2 - name: Set up Python 3.9 uses: actions/setup-python@v2 with: python-version: 3.9 - name: Install dependencies run: | python -m pip install --upgrade pip pip install flake8 pytest if [ -f requirements.txt ]; then pip install -r requirements.txt; fi if [ -f test-requirements.txt ]; then pip install -r test-requirements.txt; fi - name: Run benchmark run: pytest tests_performances --benchmark-json output.json - name: Store benchmark result uses: rhysd/github-action-benchmark@v1 # NOTE: this action only works for public repository # A pull-request is open with a fix with: tool: &amp;#39;pytest&amp;#39; output-file-path: output.json # Personal access token to deploy GitHub Pages branch github-token: $ # Push and deploy GitHub pages branch automatically auto-push: true # Show alert with commit comment on detecting possible performance regression alert-threshold: &amp;#39;200%&amp;#39; comment-on-alert: true fail-on-alert: true alert-comment-cc-users: &amp;#39;@xNok&amp;#39; Your final workflow must look like this: GitHub Actions workflow including performances tests Conclusion Continuous testing is the next step after you successfully implement continuous integration. It further improves the speed of your application development process and adds a quality control layer to it. Remember, there are three essential stages in a continuous testing workflow, each testing your system from a different perspective: Unit tests validate the internal logic. Integration tests validate the response of the system from its boundary. End-to-end tests validate the system from the user’s perspective. Adding performance tests can help you track important metrics and ensure that changes do not negatively impact your users. Finally, to succeed in implementing CT, remember that testing should become part of your team’s DNA and share the same five pillars as DevOps: culture, automation, lean, measurement, and sharing. As your CT process grows and becomes more ingrained in how you work, take a look at Earthly’s ability to produce a repeatable build process. It can help make testing in GitHub Actions a more straightforward process.</summary></entry><entry><title type="html">6 Command Line Tools for Productive Programmers</title><link href="https://earthly.dev/blog/command-line-tools/" rel="alternate" type="text/html" title="6 Command Line Tools for Productive Programmers" /><published>2021-07-23T00:00:00-04:00</published><updated>2021-07-23T00:00:00-04:00</updated><id>https://earthly.dev/blog/command-line-tools</id><content type="html" xml:base="https://earthly.dev/blog/command-line-tools/">&lt;p&gt;Lately, I’ve been doing a lot more things at the command line. I’m not a hard-core terminal guy – I use VSCode more than Vim – but I’m always surprised at the number of complex tasks that can be done using just the POSIX standard command-line tools like &lt;code&gt;grep&lt;/code&gt;, &lt;code&gt;cat&lt;/code&gt; and &lt;code&gt;sort&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Tools are powerful. A good tool makes work easier and faster, and a great tool unlocks new abilities: Previously impossible things become possible and sometimes easy.&lt;/p&gt;
&lt;p&gt;As I’ve learned more, I’ve been adding some new tools to my command-line toolbox, and in this article, I’d like to share some I’ve found valuable.&lt;/p&gt;
&lt;h2 id=&quot;broot&quot;&gt;&lt;code&gt;broot&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;I’m not sure how I came across &lt;code&gt;broot&lt;/code&gt;, but it’s pretty handy. If you are in a small directory and want to see the lay of the land, &lt;code&gt;tree&lt;/code&gt; is excellent.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;✗ tree
.
├── dartboard.png
├── header.jpg
├── opensign.png
├── quote1.png
└── trophy.png

0 directories, 5 files&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, if the directory has many files or sub-directories, &lt;code&gt;tree&lt;/code&gt; becomes much less helpful: you only see the last screen full of information as files scroll past you.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ tree 
&amp;lt; scrolling text for a long time &amp;gt;
├── banner.js
└── index.html

328 directories, 2028 files&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;broot&lt;/code&gt; solves this problem by being aware of the size of your terminal window and adapting its output to fit it.&lt;/p&gt;
&lt;div class=&quot;wide-code&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/command-line-tools/broot-800-39409e646.png&quot; srcset=&quot;/blog/generated/assets/images/command-line-tools/broot-400-39409e646.png 400w, /blog/generated/assets/images/command-line-tools/broot-600-39409e646.png 600w, /blog/generated/assets/images/command-line-tools/broot-800-39409e646.png 800w, /blog/generated/assets/images/command-line-tools/broot-1000-39409e646.png 1000w&quot;&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;You can navigate around using the arrow keys in &lt;code&gt;broot&lt;/code&gt; and it is also helpful for tracking down disk space usage by passing in the &lt;code&gt;-w&lt;/code&gt; flag (&lt;code&gt;broot -w&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&quot;wide-code&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/command-line-tools/broot2-800-84e520359.png&quot; srcset=&quot;/blog/generated/assets/images/command-line-tools/broot2-400-84e520359.png 400w, /blog/generated/assets/images/command-line-tools/broot2-600-84e520359.png 600w, /blog/generated/assets/images/command-line-tools/broot2-800-84e520359.png 800w, /blog/generated/assets/images/command-line-tools/broot2-1000-84e520359.png 1000w&quot;&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;It can do lots of other things, so take a look at the &lt;a href=&quot;https://github.com/Canop/broot&quot;&gt;GitHub guide&lt;/a&gt;, but for me, its just a better &lt;code&gt;tree&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Install BRoot&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Install on MacOS using &lt;code&gt;brew&lt;/code&gt; or follow &lt;a href=&quot;https://dystroy.org/broot/install/&quot;&gt;installation instructions&lt;/a&gt; for other environments.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;brew&lt;/span&gt; install broot&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&quot;funky&quot;&gt;Funky&lt;/h2&gt;
&lt;p&gt;If you live in the terminal, and you want to &lt;a href=&quot;https://blog.sanctum.geek.nz/unix-as-ide-files/&quot;&gt;use your terminal as an IDE&lt;/a&gt;, then it’s helpful to have your terminal change based on the current directory. There are many ways to do this. &lt;a href=&quot;https://direnv.net/&quot;&gt;&lt;code&gt;DirEnv&lt;/code&gt;&lt;/a&gt; loads and unloads &lt;code&gt;.env&lt;/code&gt; files as you enter directories. &lt;a href=&quot;https://github.com/cxreg/smartcd&quot;&gt;&lt;code&gt;smartcd&lt;/code&gt;&lt;/a&gt; is similar. It lets you run a shell script whenever you change to a particular path – you can start and stop services, change the prompt, or anything else you want.&lt;/p&gt;
&lt;p&gt;However, my favorite of this genre is the strangely named &lt;a href=&quot;https://github.com/bbugyi200/funky&quot;&gt;&lt;code&gt;funky&lt;/code&gt;&lt;/a&gt;, which “takes shell functions to the next level by making them easier to define, more flexible, and more interactive.”&lt;/p&gt;
&lt;p&gt;The way &lt;code&gt;funky&lt;/code&gt; works is simple: as you enter a directory, &lt;code&gt;funky&lt;/code&gt; looks for a &lt;code&gt;.funky&lt;/code&gt; file which contains a list of bash functions. It loads them, and when you leave, it unloads them.&lt;/p&gt;
&lt;p&gt;This means that when I’m in the directory for this Jekyll blog, I have aliases loaded for creating a new post, linting my markdown, pulling in images, and so on. I can list these by typing &lt;code&gt;funky&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;$&lt;/span&gt; funky&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;lint()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;ex&quot;&gt;markdownlint&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;--fix&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;./_posts/*.md&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;set-header()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;latest-image&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;image-folder&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/header.jpg&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;set-image()&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;latest-image&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;image-folder&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;fu&quot;&gt;date&lt;/span&gt; +%s&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;.png&amp;quot;&lt;/span&gt;&lt;span class=&quot;kw&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;funky&lt;/code&gt; can do more than this, though. It has features for interactively adding and editing functions and for registering global functions and aliases. What I like, though, is just being able to quickly give a command, in a specific context, a short alias.&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Install Funky&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Install Funky using pip&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;pip3&lt;/span&gt; install pyfunky&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then add hooks to your &lt;code&gt;.zshrc&lt;/code&gt;, &lt;code&gt;bashrc&lt;/code&gt; or equivalent:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;## find where funky.sh was installed by pip and source it&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;source&lt;/span&gt; /usr/local/lib/python3.9/site-packages/scripts/shell/funky.sh&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&quot;fuzzy-finder-fzf&quot;&gt;Fuzzy Finder (FZF)&lt;/h2&gt;
&lt;div class=&quot;wide-code&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/command-line-tools/1626788538-800-b7c54354e.png&quot; srcset=&quot;/blog/generated/assets/images/command-line-tools/1626788538-400-b7c54354e.png 400w, /blog/generated/assets/images/command-line-tools/1626788538-600-b7c54354e.png 600w, /blog/generated/assets/images/command-line-tools/1626788538-800-b7c54354e.png 800w, /blog/generated/assets/images/command-line-tools/1626788538-1000-b7c54354e.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
Using &lt;code&gt;fzf&lt;/code&gt; to locate the generated images for this post.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;If &lt;code&gt;funky&lt;/code&gt; and &lt;code&gt;broot&lt;/code&gt; improved my productivity, then more tools could only improve it more. So I headed over to &lt;a href=&quot;https://lobste.rs/s/yfgwjr/what_interesting_command_line_tools_do&quot;&gt;Lobste.rs&lt;/a&gt; and asked what other tools people were using. &lt;code&gt;FZF&lt;/code&gt; came up quite a bit, and I’ve started using it myself now.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/junegunn/fzf&quot;&gt;FZF&lt;/a&gt; is a command-line fuzzy finder. It’s fast, and it interactively lets you filter options down based on a fuzzy keyword match in many places where you need to input a value at the command-line.&lt;/p&gt;
&lt;p&gt;If you install the included shortcuts (&lt;code&gt;/usr/local/opt/fzf/install&lt;/code&gt;), you can use &lt;code&gt;**&lt;/code&gt; anywhere and get an interactive fuzzy finder to narrow down to the desired path. &lt;code&gt;FZF&lt;/code&gt; also makes searching your &lt;code&gt;history&lt;/code&gt; much faster.&lt;/p&gt;
&lt;p&gt;It’s a UNIX filter that reads in input, shows you an interactive list that you filter down, and then sends the selected item out the other side but describing that way undersells its usefulness.&lt;/p&gt;
&lt;p&gt;I recommend watching this video where Alexey Samoshkin walks through many possible uses for &lt;code&gt;FZF&lt;/code&gt; with a soothing piano playing in the background:&lt;/p&gt;
&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/qgG5Jhi_Els&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen&gt;
&lt;/iframe&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Install FZF&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Install FZF using your &lt;a href=&quot;https://github.com/junegunn/fzf#using-linux-package-managers&quot;&gt;package manager of choice&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;brew&lt;/span&gt; install fzf&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then add hooks to your &lt;code&gt;.zshrc&lt;/code&gt;, &lt;code&gt;bashrc&lt;/code&gt; or equivalent:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#ZSH&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;source&lt;/span&gt; ~/.fzf.zsh &lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;#BASH&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;source&lt;/span&gt; ~/.fzf.bash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&quot;mcfly&quot;&gt;McFly&lt;/h2&gt;
&lt;div class=&quot;wide-code&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/command-line-tools/1626788971-800-0b1e50ab8.png&quot; srcset=&quot;/blog/generated/assets/images/command-line-tools/1626788971-400-0b1e50ab8.png 400w, /blog/generated/assets/images/command-line-tools/1626788971-600-0b1e50ab8.png 600w, /blog/generated/assets/images/command-line-tools/1626788971-800-0b1e50ab8.png 800w, /blog/generated/assets/images/command-line-tools/1626788971-1000-0b1e50ab8.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
Using McFly to suggest common earthly commands in this path.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;FZF&lt;/code&gt; is excellent for filtering file paths in a command line when you want to open a file (&lt;code&gt;vim **&lt;/code&gt;), but for command-line completion, there is more information available than the raw history file. &lt;a href=&quot;https://github.com/cantino/mcfly/&quot;&gt;&lt;code&gt;McFly&lt;/code&gt;&lt;/a&gt; attempts to use this extra information to provide more relevant results.&lt;/p&gt;
&lt;p&gt;What extra information? To start with, McFly considers these options in its ranking heuristics:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The commands you typed before the command.&lt;/li&gt;
&lt;li&gt;How often you run the command.&lt;/li&gt;
&lt;li&gt;How recently have you run the command.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It tracks all this in a SQLite database where it also tracks and weighs suggestions by:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The command’s exit status.&lt;/li&gt;
&lt;li&gt;The directory you ran the command in.&lt;/li&gt;
&lt;li&gt;If you have selected it in McFly before.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Being suggested failed commands is a pet peeve of mine, but I never considered narrowing the choice based on the current directory or down-ranking items that are never selected.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;McFly&lt;/code&gt; uses a neural net to do its ranking, and one possible downside is the lag in coming up with suggestions if your SQLite database gets too large. However, &lt;code&gt;MCFLY_HISTORY_LIMIT&lt;/code&gt; is available to limit this growth.&lt;/p&gt;
&lt;p&gt;I’ve only been using it for a couple of days, so I can’t give a fair appraisal of it, but the concept makes me pretty hopeful: using extra information to customize tools towards real-world usage.&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Install McFly&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;You can install McFly &lt;a href=&quot;https://github.com/cantino/mcfly/#installation&quot;&gt;several ways&lt;/a&gt;. Here is brew: :&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;brew&lt;/span&gt; tap cantino/mcfly&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;brew&lt;/span&gt; install mcfly&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then add hooks to your &lt;code&gt;.zshrc&lt;/code&gt;, &lt;code&gt;bashrc&lt;/code&gt; or equivalent:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;mcfly&lt;/span&gt; init zsh&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The fact that the binary emits the init script rather than dumping an init script into my home directory is a nice touch. &lt;code&gt;zoxide&lt;/code&gt; - the following tool - does this as well.&lt;/p&gt;
&lt;p&gt;I found that &lt;code&gt;FZF&lt;/code&gt; was interfering with the &lt;code&gt;CTRL-R&lt;/code&gt; of McFly and had to comment out &lt;a href=&quot;https://github.com/junegunn/fzf/blob/764316a53d0eb60b315f0bbcd513de58ed57a876/shell/key-bindings.zsh#L109&quot;&gt;this line&lt;/a&gt; in the &lt;code&gt;FZF&lt;/code&gt; init script to get McFly working.&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;better-cd&quot;&gt;Better CD&lt;/h2&gt;
&lt;div class=&quot;wide-code&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/command-line-tools/1626789626-800-fe7102962.png&quot; srcset=&quot;/blog/generated/assets/images/command-line-tools/1626789626-400-fe7102962.png 400w, /blog/generated/assets/images/command-line-tools/1626789626-600-fe7102962.png 600w, /blog/generated/assets/images/command-line-tools/1626789626-800-fe7102962.png 800w, /blog/generated/assets/images/command-line-tools/1626789626-1000-fe7102962.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
Using &lt;code&gt;zoxide&lt;/code&gt; as a &lt;code&gt;cd&lt;/code&gt; replacement.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;FZF&lt;/code&gt; works nicely for some path completions, but I didn’t find it helpful when changing directories with &lt;code&gt;cd&lt;/code&gt;: After typing &lt;code&gt;cd **TAB&lt;/code&gt; from my home directory, it takes a while for &lt;code&gt;FZF&lt;/code&gt; to build up the full list options. It was much faster to use my existing ZSH completions of &lt;code&gt;cd TAB &amp;lt;choose a dir&amp;gt; TAB &amp;lt;choose a dir&amp;gt;&lt;/code&gt; to navigate to a folder.&lt;/p&gt;
&lt;p&gt;However, many tools exist which attempt to improve upon &lt;code&gt;cd&lt;/code&gt;. &lt;a href=&quot;https://github.com/wting/autojump&quot;&gt;&lt;code&gt;autojump&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://github.com/rupa/z&quot;&gt;&lt;code&gt;z&lt;/code&gt;&lt;/a&gt;, and &lt;a href=&quot;https://github.com/clvv/fasd&quot;&gt;&lt;code&gt;Fasd&lt;/code&gt;&lt;/a&gt; all track directory usage and give you a single key shortcut for changing to commonly accessed directories. &lt;a href=&quot;https://www.reddit.com/r/commandline/comments/4v5nlt/what_cd_tool_do_you_use_if_any_autojump_j_z_etc/&quot;&gt;&lt;code&gt;r/commandline&lt;/code&gt;&lt;/a&gt; has an detailed discussion of these various &lt;code&gt;cd&lt;/code&gt; replacements, but the one that has the most momentum is &lt;code&gt;zoxide&lt;/code&gt;. &lt;a href=&quot;https://github.com/ajeetdsouza/zoxide&quot;&gt;zoxide&lt;/a&gt; is a rewrite of z in Rust and promises improved speed.&lt;/p&gt;
&lt;p&gt;After you install it, you can use it just like &lt;code&gt;cd&lt;/code&gt; (&lt;code&gt;z ~/path/foo/bar&lt;/code&gt;), but you can also change directories based on ranked text matches of the path (&lt;code&gt;z bar&lt;/code&gt; ~= &lt;code&gt;cd ~/path/foo/bar&lt;/code&gt; ). Instead of needing to supply the full path to change locations, you can instead provide a unique sub-string of the path, and &lt;code&gt;zoxide&lt;/code&gt; will use its usage history to get you where you want.&lt;/p&gt;
&lt;p&gt;For ease of adoption, I’ve chosen to have &lt;code&gt;zoxide&lt;/code&gt; replace &lt;code&gt;cd&lt;/code&gt;, which is as simple as using the &lt;code&gt;--cmd&lt;/code&gt; flag when you add the initialization shell code (&lt;code&gt;eval &quot;$(zoxide init zsh --cmd cd)&quot;&lt;/code&gt;).&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Install zoxide&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;zoxide&lt;/code&gt; can be installed &lt;a href=&quot;https://github.com/ajeetdsouza/zoxide#step-1-install-zoxide&quot;&gt;several ways&lt;/a&gt;. Here is brew: :&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;brew&lt;/span&gt; install zoxide&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then add hooks to your &lt;code&gt;.zshrc&lt;/code&gt;, &lt;code&gt;bashrc&lt;/code&gt; or equivalent:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;va&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;ex&quot;&gt;zoxide&lt;/span&gt; init zsh &lt;span class=&quot;at&quot;&gt;--cmd&lt;/span&gt; cd&lt;span class=&quot;va&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&quot;gitupdate&quot;&gt;GitUpdate&lt;/h2&gt;
&lt;p&gt;This tool is another find from the &lt;a href=&quot;https://lobste.rs/s/yfgwjr/what_interesting_command_line_tools_do&quot;&gt;Lobste.rs&lt;/a&gt; thread. When working on a git branch, I like to commit my work frequently. For example, before I try to delete some huge block of text in a blog post, or before I attempt to refactor some piece of code, I commit my work. Of course, I’ll squash, or restructure, these commits later on, but for convenience, I have a git alias called &lt;code&gt;wip&lt;/code&gt; (’work in progress`) which gives me a low effort way to commit.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;git wip = !git add --all; git ci -m WIP&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/nikitavoloboev/gitupdate&quot;&gt;&lt;code&gt;gitupdate&lt;/code&gt;&lt;/a&gt; is a simple improvement on this idea. &lt;code&gt;gitupdate .&lt;/code&gt; commits your files but uses the file names (but not extensions) of the changed files to create a more meaningful commit message. It’s great for times when the commit message doesn’t matter.&lt;/p&gt;
&lt;div class=&quot;wide-code&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/command-line-tools/1626790555-800-65425229c.png&quot; srcset=&quot;/blog/generated/assets/images/command-line-tools/1626790555-400-65425229c.png 400w, /blog/generated/assets/images/command-line-tools/1626790555-600-65425229c.png 600w, /blog/generated/assets/images/command-line-tools/1626790555-800-65425229c.png 800w, /blog/generated/assets/images/command-line-tools/1626790555-1000-65425229c.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
GitUpdate generates a commit message, commits, and pushes.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;ℹ️ Install GitUpdate&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;git&lt;/span&gt; clone https://github.com/nikitavoloboev/gitupdate&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;go&lt;/span&gt; build&lt;/span&gt;
&lt;span id=&quot;cb14-3&quot;&gt;&lt;a href=&quot;#cb14-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;sudo&lt;/span&gt; cp gitupdate /usr/local/bin&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&quot;other-tools&quot;&gt;Other Tools&lt;/h2&gt;
&lt;p&gt;There are many other helpful command-line tools. More than can be covered well in a single article. JQ, &lt;a href=&quot;/blog/mitmproxy&quot;&gt;&lt;code&gt;mitmproxy&lt;/code&gt;&lt;/a&gt;, &lt;a href=&quot;https://pandoc.org/&quot;&gt;Pandoc&lt;/a&gt;, and &lt;a href=&quot;https://man7.org/linux/man-pages/man1/pstree.1.html&quot;&gt;PSTree&lt;/a&gt; are some I use frequently. There is also a whole class of Rust rewrites of common POSIX tools that warrant an article of their own.&lt;/p&gt;
&lt;p&gt;Of course, &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt; itself is a command-line tool, and one I constantly use for gluing together various development steps together. It, and the tools I use for &lt;a href=&quot;/blog/markdown-lint&quot;&gt;linting prose&lt;/a&gt;, have become a standard part of how I work.&lt;/p&gt;
&lt;p&gt;What less common command-line tools do you use? If you have tool suggestions, I’d love to hear them. You can find my Twitter account and email below, and I’d love to hear what you are using.&lt;/p&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Tutorials" /><summary type="html">Lately, I’ve been doing a lot more things at the command line. I’m not a hard-core terminal guy – I use VSCode more than Vim – but I’m always surprised at the number of complex tasks that can be done using just the POSIX standard command-line tools like grep, cat and sort. Tools are powerful. A good tool makes work easier and faster, and a great tool unlocks new abilities: Previously impossible things become possible and sometimes easy. As I’ve learned more, I’ve been adding some new tools to my command-line toolbox, and in this article, I’d like to share some I’ve found valuable. broot I’m not sure how I came across broot, but it’s pretty handy. If you are in a small directory and want to see the lay of the land, tree is excellent. ✗ tree . ├── dartboard.png ├── header.jpg ├── opensign.png ├── quote1.png └── trophy.png 0 directories, 5 files However, if the directory has many files or sub-directories, tree becomes much less helpful: you only see the last screen full of information as files scroll past you. $ tree &amp;lt; scrolling text for a long time &amp;gt; ├── banner.js └── index.html 328 directories, 2028 files broot solves this problem by being aware of the size of your terminal window and adapting its output to fit it. You can navigate around using the arrow keys in broot and it is also helpful for tracking down disk space usage by passing in the -w flag (broot -w): It can do lots of other things, so take a look at the GitHub guide, but for me, its just a better tree. ℹ️ Install BRoot Install on MacOS using brew or follow installation instructions for other environments. brew install broot Funky If you live in the terminal, and you want to use your terminal as an IDE, then it’s helpful to have your terminal change based on the current directory. There are many ways to do this. DirEnv loads and unloads .env files as you enter directories. smartcd is similar. It lets you run a shell script whenever you change to a particular path – you can start and stop services, change the prompt, or anything else you want. However, my favorite of this genre is the strangely named funky, which “takes shell functions to the next level by making them easier to define, more flexible, and more interactive.” The way funky works is simple: as you enter a directory, funky looks for a .funky file which contains a list of bash functions. It loads them, and when you leave, it unloads them. This means that when I’m in the directory for this Jekyll blog, I have aliases loaded for creating a new post, linting my markdown, pulling in images, and so on. I can list these by typing funky $ funky lint() { markdownlint --fix &amp;quot;./_posts/*.md&amp;quot;; } set-header() { cp &amp;quot;$(latest-image)&amp;quot; &amp;quot;$(image-folder)/header.jpg&amp;quot;; } set-image() { cp &amp;quot;$(latest-image)&amp;quot; &amp;quot;$(image-folder)/$(date +%s).png&amp;quot;; } funky can do more than this, though. It has features for interactively adding and editing functions and for registering global functions and aliases. What I like, though, is just being able to quickly give a command, in a specific context, a short alias. ℹ️ Install Funky Install Funky using pip pip3 install pyfunky Then add hooks to your .zshrc, bashrc or equivalent: ## find where funky.sh was installed by pip and source it source /usr/local/lib/python3.9/site-packages/scripts/shell/funky.sh Fuzzy Finder (FZF) Using fzf to locate the generated images for this post. If funky and broot improved my productivity, then more tools could only improve it more. So I headed over to Lobste.rs and asked what other tools people were using. FZF came up quite a bit, and I’ve started using it myself now. FZF is a command-line fuzzy finder. It’s fast, and it interactively lets you filter options down based on a fuzzy keyword match in many places where you need to input a value at the command-line. If you install the included shortcuts (/usr/local/opt/fzf/install), you can use ** anywhere and get an interactive fuzzy finder to narrow down to the desired path. FZF also makes searching your history much faster. It’s a UNIX filter that reads in input, shows you an interactive list that you filter down, and then sends the selected item out the other side but describing that way undersells its usefulness. I recommend watching this video where Alexey Samoshkin walks through many possible uses for FZF with a soothing piano playing in the background: ℹ️ Install FZF Install FZF using your package manager of choice: brew install fzf Then add hooks to your .zshrc, bashrc or equivalent: #ZSH source ~/.fzf.zsh #BASH source ~/.fzf.bash McFly Using McFly to suggest common earthly commands in this path. FZF is excellent for filtering file paths in a command line when you want to open a file (vim **), but for command-line completion, there is more information available than the raw history file. McFly attempts to use this extra information to provide more relevant results. What extra information? To start with, McFly considers these options in its ranking heuristics: The commands you typed before the command. How often you run the command. How recently have you run the command. It tracks all this in a SQLite database where it also tracks and weighs suggestions by: The command’s exit status. The directory you ran the command in. If you have selected it in McFly before. Being suggested failed commands is a pet peeve of mine, but I never considered narrowing the choice based on the current directory or down-ranking items that are never selected. McFly uses a neural net to do its ranking, and one possible downside is the lag in coming up with suggestions if your SQLite database gets too large. However, MCFLY_HISTORY_LIMIT is available to limit this growth. I’ve only been using it for a couple of days, so I can’t give a fair appraisal of it, but the concept makes me pretty hopeful: using extra information to customize tools towards real-world usage. ℹ️ Install McFly You can install McFly several ways. Here is brew: : brew tap cantino/mcfly brew install mcfly Then add hooks to your .zshrc, bashrc or equivalent: eval &amp;quot;$(mcfly init zsh)&amp;quot; The fact that the binary emits the init script rather than dumping an init script into my home directory is a nice touch. zoxide - the following tool - does this as well. I found that FZF was interfering with the CTRL-R of McFly and had to comment out this line in the FZF init script to get McFly working. Better CD Using zoxide as a cd replacement. FZF works nicely for some path completions, but I didn’t find it helpful when changing directories with cd: After typing cd **TAB from my home directory, it takes a while for FZF to build up the full list options. It was much faster to use my existing ZSH completions of cd TAB &amp;lt;choose a dir&amp;gt; TAB &amp;lt;choose a dir&amp;gt; to navigate to a folder. However, many tools exist which attempt to improve upon cd. autojump, z, and Fasd all track directory usage and give you a single key shortcut for changing to commonly accessed directories. r/commandline has an detailed discussion of these various cd replacements, but the one that has the most momentum is zoxide. zoxide is a rewrite of z in Rust and promises improved speed. After you install it, you can use it just like cd (z ~/path/foo/bar), but you can also change directories based on ranked text matches of the path (z bar ~= cd ~/path/foo/bar ). Instead of needing to supply the full path to change locations, you can instead provide a unique sub-string of the path, and zoxide will use its usage history to get you where you want. For ease of adoption, I’ve chosen to have zoxide replace cd, which is as simple as using the --cmd flag when you add the initialization shell code (eval &quot;$(zoxide init zsh --cmd cd)&quot;). ℹ️ Install zoxide zoxide can be installed several ways. Here is brew: : brew install zoxide Then add hooks to your .zshrc, bashrc or equivalent: eval &amp;quot;$(zoxide init zsh --cmd cd)&amp;quot; GitUpdate This tool is another find from the Lobste.rs thread. When working on a git branch, I like to commit my work frequently. For example, before I try to delete some huge block of text in a blog post, or before I attempt to refactor some piece of code, I commit my work. Of course, I’ll squash, or restructure, these commits later on, but for convenience, I have a git alias called wip (’work in progress`) which gives me a low effort way to commit. git wip = !git add --all; git ci -m WIP gitupdate is a simple improvement on this idea. gitupdate . commits your files but uses the file names (but not extensions) of the changed files to create a more meaningful commit message. It’s great for times when the commit message doesn’t matter. GitUpdate generates a commit message, commits, and pushes. ℹ️ Install GitUpdate git clone https://github.com/nikitavoloboev/gitupdate go build sudo cp gitupdate /usr/local/bin Other Tools There are many other helpful command-line tools. More than can be covered well in a single article. JQ, mitmproxy, Pandoc, and PSTree are some I use frequently. There is also a whole class of Rust rewrites of common POSIX tools that warrant an article of their own. Of course, Earthly itself is a command-line tool, and one I constantly use for gluing together various development steps together. It, and the tools I use for linting prose, have become a standard part of how I work. What less common command-line tools do you use? If you have tool suggestions, I’d love to hear them. You can find my Twitter account and email below, and I’d love to hear what you are using.</summary></entry><entry><title type="html">Install `matplotlib` In A Docker Container</title><link href="https://earthly.dev/blog/python-matplotlib-docker/" rel="alternate" type="text/html" title="Install `matplotlib` In A Docker Container" /><published>2021-07-16T00:00:00-04:00</published><updated>2021-07-16T00:00:00-04:00</updated><id>https://earthly.dev/blog/python-matplotlib-docker</id><content type="html" xml:base="https://earthly.dev/blog/python-matplotlib-docker/">&lt;p&gt;&lt;code&gt;matplotlib&lt;/code&gt; is an excellent library for creating graphs and visualizations in Python. For example, I used it to generate the performance graphs in &lt;a href=&quot;/blog/python-timsort-merge&quot;&gt;my merging article&lt;/a&gt;, and internally, we use it now and again for visualizing any metrics we produce. It is a bit hard to install inside a docker container, though.&lt;/p&gt;
&lt;h2 id=&quot;installing-matplotlib-in-alpine-linux&quot;&gt;Installing Matplotlib in Alpine Linux&lt;/h2&gt;
&lt;p&gt;On Alpine, or an Alpine-based docker image, it’s &lt;em&gt;possible&lt;/em&gt; to install &lt;code&gt;matplotlib&lt;/code&gt;; however it will involve compiling it from source as pip does not provide any pre-compiled binaries – this will take quite a bit of time. If you don’t mind compiling from source, you will need to have its dependencies in place to make this work:&lt;/p&gt;
&lt;pre class=&quot;docker&quot;&gt;&lt;code&gt; FROM python:3.6-alpine
 RUN apk add g++ jpeg-dev zlib-dev libjpeg make
 RUN pip3 install matplotlib&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;installing-matplotlib-in-ubuntu&quot;&gt;Installing Matplotlib in Ubuntu&lt;/h2&gt;
&lt;p&gt;On Ubuntu, or a Ubuntu-based docker image, the process is much simpler:&lt;/p&gt;
&lt;pre class=&quot;docker&quot;&gt;&lt;code&gt; FROM ubuntu:20.10
 RUN apt-get update &amp;amp;&amp;amp; apt-get install -y python3 python3-pip
 RUN pip3 install matplotlib&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In either case, after you’ve installed it, you can quickly generate great graphs and visualizations:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; np&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; scipy.interpolate &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; splprep, splev&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; matplotlib.pyplot &lt;span class=&quot;im&quot;&gt;as&lt;/span&gt; plt&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; matplotlib.path &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; Path&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; matplotlib.patches &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; PathPatch&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;N &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;400&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;t &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; np.linspace(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; np.pi, N)&lt;/span&gt;
&lt;span id=&quot;cb3-10&quot;&gt;&lt;a href=&quot;#cb3-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;r &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;fl&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; np.cos(t)&lt;/span&gt;
&lt;span id=&quot;cb3-11&quot;&gt;&lt;a href=&quot;#cb3-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;x, y &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; r &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; np.cos(t), r &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; np.sin(t)&lt;/span&gt;
&lt;span id=&quot;cb3-12&quot;&gt;&lt;a href=&quot;#cb3-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;fig, ax &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; plt.subplots()&lt;/span&gt;
&lt;span id=&quot;cb3-13&quot;&gt;&lt;a href=&quot;#cb3-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;ax.plot(x, y)&lt;/span&gt;
&lt;span id=&quot;cb3-14&quot;&gt;&lt;a href=&quot;#cb3-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plt.xlabel(&lt;span class=&quot;st&quot;&gt;&amp;quot;X value&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb3-15&quot;&gt;&lt;a href=&quot;#cb3-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plt.ylabel(&lt;span class=&quot;st&quot;&gt;&amp;quot;Y value&amp;quot;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb3-16&quot;&gt;&lt;a href=&quot;#cb3-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;plt.savefig(&lt;span class=&quot;st&quot;&gt;&amp;#39;1.png&amp;#39;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/blog/assets/images/python-matplotlib-docker/1.png&quot; alt=&quot;Simple Graph&quot; /&gt;&lt;br /&gt;
&lt;/p&gt;
&lt;h2 id=&quot;appendix-alpine-vs-ubuntu-pip-install&quot;&gt;Appendix: Alpine vs Ubuntu Pip Install&lt;/h2&gt;
&lt;p&gt;Why is the Ubuntu process fast and simple and the Alpine process slow? The reason is &lt;code&gt;glibc&lt;/code&gt;. The pip wheels for &lt;code&gt;matplotlib&lt;/code&gt; are compiled c/c++ programs that dynamically link to &lt;code&gt;glibc&lt;/code&gt; and Alpine does not have &lt;code&gt;glibc&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Alpine tries to stay small and so uses &lt;code&gt;musl-libc&lt;/code&gt; instead. Unfortunately, this means compiling from source on Alpine, which can be a lengthy process.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/49037742/why-does-it-take-ages-to-install-pandas-on-alpine-linux/58210701#58210701&quot;&gt;ThisGuyCantEven&lt;/a&gt; on Stack Overflow has more details:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Pip looks first for a wheel with the correct binaries, if it can’t find one, it tries to compile the binaries from the c/c++ source and links them against &lt;code&gt;musl&lt;/code&gt;. In many cases, this won’t even work unless you have the python headers from python3-dev or build tools like make.&lt;/p&gt;
&lt;p&gt;Now the silver lining, as others have mentioned, there are &lt;code&gt;apk&lt;/code&gt; packages with the proper binaries provided by the community, using these will save you the (sometimes lengthy) process of building the binaries.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Tutorials" /><summary type="html">matplotlib is an excellent library for creating graphs and visualizations in Python. For example, I used it to generate the performance graphs in my merging article, and internally, we use it now and again for visualizing any metrics we produce. It is a bit hard to install inside a docker container, though. Installing Matplotlib in Alpine Linux On Alpine, or an Alpine-based docker image, it’s possible to install matplotlib; however it will involve compiling it from source as pip does not provide any pre-compiled binaries – this will take quite a bit of time. If you don’t mind compiling from source, you will need to have its dependencies in place to make this work: FROM python:3.6-alpine RUN apk add g++ jpeg-dev zlib-dev libjpeg make RUN pip3 install matplotlib Installing Matplotlib in Ubuntu On Ubuntu, or a Ubuntu-based docker image, the process is much simpler: FROM ubuntu:20.10 RUN apt-get update &amp;amp;&amp;amp; apt-get install -y python3 python3-pip RUN pip3 install matplotlib In either case, after you’ve installed it, you can quickly generate great graphs and visualizations: import numpy as np from scipy.interpolate import splprep, splev import matplotlib.pyplot as plt from matplotlib.path import Path from matplotlib.patches import PathPatch N = 400 t = np.linspace(0, 3 * np.pi, N) r = 0.5 + np.cos(t) x, y = r * np.cos(t), r * np.sin(t) fig, ax = plt.subplots() ax.plot(x, y) plt.xlabel(&amp;quot;X value&amp;quot;) plt.ylabel(&amp;quot;Y value&amp;quot;) plt.savefig(&amp;#39;1.png&amp;#39;) Appendix: Alpine vs Ubuntu Pip Install Why is the Ubuntu process fast and simple and the Alpine process slow? The reason is glibc. The pip wheels for matplotlib are compiled c/c++ programs that dynamically link to glibc and Alpine does not have glibc. Alpine tries to stay small and so uses musl-libc instead. Unfortunately, this means compiling from source on Alpine, which can be a lengthy process. ThisGuyCantEven on Stack Overflow has more details: Pip looks first for a wheel with the correct binaries, if it can’t find one, it tries to compile the binaries from the c/c++ source and links them against musl. In many cases, this won’t even work unless you have the python headers from python3-dev or build tools like make. Now the silver lining, as others have mentioned, there are apk packages with the proper binaries provided by the community, using these will save you the (sometimes lengthy) process of building the binaries.</summary></entry><entry><title type="html">Creating a Golang Makefile</title><link href="https://earthly.dev/blog/golang-makefile/" rel="alternate" type="text/html" title="Creating a Golang Makefile" /><published>2021-07-15T00:00:00-04:00</published><updated>2021-07-15T00:00:00-04:00</updated><id>https://earthly.dev/blog/golang-makefile</id><content type="html" xml:base="https://earthly.dev/blog/golang-makefile/">&lt;div class=&quot;narrow-code&quot;&gt;
&lt;p&gt;Building and testing any large codebase is time-consuming, error-prone, and repetitive. Golang supports multi-platform builds, which is excellent, but it needs multiple commands to build the binaries for different platforms, which means more time-consuming and repetitive steps when building binaries. If that’s not enough, most projects have some dependencies that need to be installed before building the binary, and you probably want to run tests and ensure the code quality with linters and code coverage tools.&lt;/p&gt;
&lt;p&gt;If this is starting to sound like a nightmare, rest assured: there is an easier way. The utility tool &lt;a href=&quot;https://en.wikipedia.org/wiki/Make_(software)&quot;&gt;Make&lt;/a&gt; is used to automate tasks. It streamlines development and automates repetitive tasks with a single command. Make helps with testing, building, cleaning, and installing Go projects. In this tutorial, you will learn how you can leverage make and makefiles to automate all those frustrating and repetitive Golang tasks. You will learn how to build, clean, and test a Go sample project using make and a &lt;code&gt;Makefile&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;adding-a-makefile-to-your-project&quot;&gt;Adding a Makefile To Your Project&lt;/h2&gt;
&lt;p&gt;To start using make commands, you first need to create a &lt;code&gt;Makefile&lt;/code&gt; in the root directory of your project. Let’s create a simple &lt;code&gt;hello world&lt;/code&gt; project with a &lt;code&gt;Makefile&lt;/code&gt; in it.&lt;/p&gt;
&lt;h3 id=&quot;main.go&quot;&gt;&lt;code&gt;main.go&lt;/code&gt;&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode go&quot;&gt;&lt;code class=&quot;sourceCode go&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;package&lt;/span&gt; main&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;fmt&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;func&lt;/span&gt; main&lt;span class=&quot;op&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; fmt&lt;span class=&quot;op&quot;&gt;.&lt;/span&gt;Println&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;hello world&amp;quot;&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To run this project, you would normally need to build the project and run the binary:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;go&lt;/span&gt; build main.go&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you want a different binary name and also want to create a build for a specific OS, you can specify this during the build:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;va&quot;&gt;GOARCH&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;amd64 &lt;span class=&quot;va&quot;&gt;GOOS&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;darwin &lt;span class=&quot;ex&quot;&gt;go&lt;/span&gt; build &lt;span class=&quot;at&quot;&gt;-o&lt;/span&gt; hello-world main.go&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You may want the build to create binary for multiple OS. For that, you will need to run multiple commands:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;GOARCH=amd64 GOOS=darwin go build -o hello-world-darwin main.go
GOARCH=amd64 GOOS=linux go build -o hello-world-linux main.go
GOARCH=amd64 GOOS=window go build -o hello-world-windows main.go&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;go run hello-world&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The above commands can be simplified using Makefile. You can specify rules to a specific command and run a simple make command. You would not need to remember the commands and the flags or environment variables needed for executing it.&lt;/p&gt;
&lt;h3 id=&quot;makefile&quot;&gt;Makefile&lt;/h3&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;hello-world&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;build:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; GOARCH=amd64 GOOS=darwin go build -o &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-darwin main.go&lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; GOARCH=amd64 GOOS=linux go build -o &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-linux main.go&lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; GOARCH=amd64 GOOS=window go build -o &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-windows main.go&lt;/span&gt;
&lt;span id=&quot;cb6-7&quot;&gt;&lt;a href=&quot;#cb6-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-8&quot;&gt;&lt;a href=&quot;#cb6-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;run:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-9&quot;&gt;&lt;a href=&quot;#cb6-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; ./&lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-10&quot;&gt;&lt;a href=&quot;#cb6-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-11&quot;&gt;&lt;a href=&quot;#cb6-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;build_and_run:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; build run&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-12&quot;&gt;&lt;a href=&quot;#cb6-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-13&quot;&gt;&lt;a href=&quot;#cb6-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-14&quot;&gt;&lt;a href=&quot;#cb6-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; go clean&lt;/span&gt;
&lt;span id=&quot;cb6-15&quot;&gt;&lt;a href=&quot;#cb6-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-darwin&lt;/span&gt;
&lt;span id=&quot;cb6-16&quot;&gt;&lt;a href=&quot;#cb6-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-linux&lt;/span&gt;
&lt;span id=&quot;cb6-17&quot;&gt;&lt;a href=&quot;#cb6-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-windows&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now with these simple commands, you can build and run the Go project:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;make run
make build&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Or you can use a single command for both build and run:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;make build_and_run&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finally, you can run the clean command for the cleanup of binaries:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;make clean&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;These commands are very handy and help to streamline the development process. Now all of your team members can use the same command. This reduces inconsistency and helps to eliminate project build-related errors that can arise with inconsistent manual commands.&lt;/p&gt;
&lt;h2 id=&quot;improving-the-development-experience-with-makefiles&quot;&gt;Improving the Development Experience with Makefiles&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;make&lt;/code&gt; uses the Makefile as its source of commands to execute and these commands are defined as a &lt;em&gt;rules&lt;/em&gt; in the Makefile. A single rule defines target, dependencies, and the recipe of the Makefile.&lt;/p&gt;
&lt;h3 id=&quot;terminology&quot;&gt;Terminology&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Target:&lt;/strong&gt; Targets are the main component of a Makefile. The make command executes the recipe by its target name. As you saw in the last section, I used commands like &lt;code&gt;build&lt;/code&gt;, &lt;code&gt;run&lt;/code&gt;, and &lt;code&gt;build_and_clean&lt;/code&gt;. These are called &lt;em&gt;targets&lt;/em&gt;. Targets are the interface to the commands I want to execute.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Dependencies:&lt;/strong&gt; A target can have dependencies that need to be executed before running the target. For example, the &lt;code&gt;build_and_clean&lt;/code&gt; command has two dependencies: &lt;code&gt;build&lt;/code&gt; and &lt;code&gt;run&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Recipe:&lt;/strong&gt; Recipes are the actual commands that will be executed when the target is run. A recipe can be a single command or a collection of commands. You can specify multiple commands in a target using a line break. In the example above, the recipe for the run target is &lt;code&gt;./${BINARY_NAME}&lt;/code&gt;. A recipe should always contain a tab at the start.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;variables&quot;&gt;Variables&lt;/h3&gt;
&lt;p&gt;Variables are essential to any kind of script you write. So Makefiles also have a mechanism to use variables. These are useful when you want the same configs or outputs to be used for different targets. In the example above, I have added the &lt;code&gt;BINARY_NAME&lt;/code&gt; variable, which is reused across different targets.&lt;/p&gt;
&lt;p&gt;The variable can be substituted by enclosing it &lt;code&gt;${&amp;lt;variable_name&amp;gt;}&lt;/code&gt;. I have used the variable in the run command to execute the binary that was created from the build command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;hello-world&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;run:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-4&quot;&gt;&lt;a href=&quot;#cb10-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; ./&lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Variables can be defined either by using &lt;code&gt;=&lt;/code&gt; or &lt;code&gt;:=&lt;/code&gt;. &lt;code&gt;=&lt;/code&gt; will recursively expand the variable. This will replace the value at the point when it is substituted. For example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;x &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; foo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;y &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; bar&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;x &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; later&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-5&quot;&gt;&lt;a href=&quot;#cb11-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-6&quot;&gt;&lt;a href=&quot;#cb11-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; echo &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When you run the &lt;code&gt;all&lt;/code&gt; command, it will replace the value of &lt;code&gt;x&lt;/code&gt; with the last updated value. The value has been changed to &lt;code&gt;later&lt;/code&gt;, so it will print:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; later bar&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The other kind of variable assignment is &lt;code&gt;:=&lt;/code&gt;. These are &lt;em&gt;simple expanded&lt;/em&gt; variables. The variable is expanded at the first scan. So if you assign the variable using this operator, it will print the first value:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;x &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;:=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; foo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;y &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;:=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; bar&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-3&quot;&gt;&lt;a href=&quot;#cb13-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;x &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;:=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; later&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-4&quot;&gt;&lt;a href=&quot;#cb13-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-5&quot;&gt;&lt;a href=&quot;#cb13-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-6&quot;&gt;&lt;a href=&quot;#cb13-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; echo &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; foo bar&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&quot;some-useful-tips&quot;&gt;Some Useful Tips&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;To make comments in a Makefile, you can simply add a &lt;code&gt;#&lt;/code&gt; before any line.&lt;/li&gt;
&lt;li&gt;To disable printing the recipe while running the target command, use &lt;code&gt;@&lt;/code&gt; before the recipe.&lt;/li&gt;
&lt;li&gt;Use the &lt;code&gt;SHELL&lt;/code&gt; variable to define the shell to execute the recipe.&lt;/li&gt;
&lt;li&gt;Define the &lt;code&gt;.DEFAULT_GOAL&lt;/code&gt; with the name of the target.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can also define functions or loops in the Makefile. You can find more details on it &lt;a href=&quot;https://makefiletutorial.com&quot;&gt;in this make file tutorial&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;automating-tasks-using-makefile&quot;&gt;Automating Tasks Using Makefile&lt;/h2&gt;
&lt;p&gt;While developing a project, you will have a lot of repetitive tasks that you might like to automate. In Golang, some of those tasks are testing, running test coverage, linting, and managing dependencies. I will be creating a Makefile that contains all the rules to automate these tasks:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;hello-world&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;build:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-4&quot;&gt;&lt;a href=&quot;#cb15-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; GOARCH=amd64 GOOS=darwin go build -o &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-darwin main.go&lt;/span&gt;
&lt;span id=&quot;cb15-5&quot;&gt;&lt;a href=&quot;#cb15-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; GOARCH=amd64 GOOS=linux go build -o &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-linux main.go&lt;/span&gt;
&lt;span id=&quot;cb15-6&quot;&gt;&lt;a href=&quot;#cb15-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; GOARCH=amd64 GOOS=window go build -o &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-windows main.go&lt;/span&gt;
&lt;span id=&quot;cb15-7&quot;&gt;&lt;a href=&quot;#cb15-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-8&quot;&gt;&lt;a href=&quot;#cb15-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;run:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-9&quot;&gt;&lt;a href=&quot;#cb15-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; ./&lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-10&quot;&gt;&lt;a href=&quot;#cb15-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-11&quot;&gt;&lt;a href=&quot;#cb15-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;build_and_run:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; build run&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-12&quot;&gt;&lt;a href=&quot;#cb15-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-13&quot;&gt;&lt;a href=&quot;#cb15-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-14&quot;&gt;&lt;a href=&quot;#cb15-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; go clean&lt;/span&gt;
&lt;span id=&quot;cb15-15&quot;&gt;&lt;a href=&quot;#cb15-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-darwin&lt;/span&gt;
&lt;span id=&quot;cb15-16&quot;&gt;&lt;a href=&quot;#cb15-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-linux&lt;/span&gt;
&lt;span id=&quot;cb15-17&quot;&gt;&lt;a href=&quot;#cb15-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm &lt;span class=&quot;ch&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;BINARY_NAME&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;}&lt;/span&gt;-windows&lt;/span&gt;
&lt;span id=&quot;cb15-18&quot;&gt;&lt;a href=&quot;#cb15-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-19&quot;&gt;&lt;a href=&quot;#cb15-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;test:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-20&quot;&gt;&lt;a href=&quot;#cb15-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; go test ./...&lt;/span&gt;
&lt;span id=&quot;cb15-21&quot;&gt;&lt;a href=&quot;#cb15-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-22&quot;&gt;&lt;a href=&quot;#cb15-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;test_coverage:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-23&quot;&gt;&lt;a href=&quot;#cb15-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; go test ./... -coverprofile=coverage.out&lt;/span&gt;
&lt;span id=&quot;cb15-24&quot;&gt;&lt;a href=&quot;#cb15-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-25&quot;&gt;&lt;a href=&quot;#cb15-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;dep:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-26&quot;&gt;&lt;a href=&quot;#cb15-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; go mod download&lt;/span&gt;
&lt;span id=&quot;cb15-27&quot;&gt;&lt;a href=&quot;#cb15-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-28&quot;&gt;&lt;a href=&quot;#cb15-28&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;vet:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-29&quot;&gt;&lt;a href=&quot;#cb15-29&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; go vet&lt;/span&gt;
&lt;span id=&quot;cb15-30&quot;&gt;&lt;a href=&quot;#cb15-30&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-31&quot;&gt;&lt;a href=&quot;#cb15-31&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;lint:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-32&quot;&gt;&lt;a href=&quot;#cb15-32&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; golangci-lint run --enable-all&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this simple Makefile, you can now easily execute commands to run tasks:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;make test
make test_coverage
make dep
make vet
make lint&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; I am using an external package, &lt;a href=&quot;https://github.com/golangci/golangci-lint&quot;&gt;&lt;code&gt;golangci-lint&lt;/code&gt;&lt;/a&gt;, for linting. If you are using &lt;code&gt;go mod&lt;/code&gt;, make sure to add it to your &lt;code&gt;go.mod&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;Any CI/CD tool that you are using can now simply use these targets.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Golang is a popular language for developing large-scale projects. Larger projects have multiple developers and require continuous automation to scale. Streamlining the development process by automating the tasks that are required during development, testing, and release will pay off with a faster and more reliable development process and a easier release process.&lt;/p&gt;
&lt;p&gt;For next-level automation and to further improve the automation, tools like &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly.dev&lt;/a&gt; can be helpful. If you are also using Docker along with Makefile, Earthly can help make your development process smoother, taking some of the best ideas from Makefiles and Dockerfiles and combining them into one specification.&lt;/p&gt;
&lt;/div&gt;</content><author><name>Milap Neupane</name></author><category term="Tutorials" /><summary type="html">Building and testing any large codebase is time-consuming, error-prone, and repetitive. Golang supports multi-platform builds, which is excellent, but it needs multiple commands to build the binaries for different platforms, which means more time-consuming and repetitive steps when building binaries. If that’s not enough, most projects have some dependencies that need to be installed before building the binary, and you probably want to run tests and ensure the code quality with linters and code coverage tools. If this is starting to sound like a nightmare, rest assured: there is an easier way. The utility tool Make is used to automate tasks. It streamlines development and automates repetitive tasks with a single command. Make helps with testing, building, cleaning, and installing Go projects. In this tutorial, you will learn how you can leverage make and makefiles to automate all those frustrating and repetitive Golang tasks. You will learn how to build, clean, and test a Go sample project using make and a Makefile. Adding a Makefile To Your Project To start using make commands, you first need to create a Makefile in the root directory of your project. Let’s create a simple hello world project with a Makefile in it. main.go package main import &amp;quot;fmt&amp;quot; func main() { fmt.Println(&amp;quot;hello world&amp;quot;) } To run this project, you would normally need to build the project and run the binary: go build main.go If you want a different binary name and also want to create a build for a specific OS, you can specify this during the build: GOARCH=amd64 GOOS=darwin go build -o hello-world main.go You may want the build to create binary for multiple OS. For that, you will need to run multiple commands: GOARCH=amd64 GOOS=darwin go build -o hello-world-darwin main.go GOARCH=amd64 GOOS=linux go build -o hello-world-linux main.go GOARCH=amd64 GOOS=window go build -o hello-world-windows main.go go run hello-world The above commands can be simplified using Makefile. You can specify rules to a specific command and run a simple make command. You would not need to remember the commands and the flags or environment variables needed for executing it. Makefile BINARY_NAME=hello-world build: GOARCH=amd64 GOOS=darwin go build -o ${BINARY_NAME}-darwin main.go GOARCH=amd64 GOOS=linux go build -o ${BINARY_NAME}-linux main.go GOARCH=amd64 GOOS=window go build -o ${BINARY_NAME}-windows main.go run: ./${BINARY_NAME} build_and_run: build run clean: go clean rm ${BINARY_NAME}-darwin rm ${BINARY_NAME}-linux rm ${BINARY_NAME}-windows Now with these simple commands, you can build and run the Go project: make run make build Or you can use a single command for both build and run: make build_and_run Finally, you can run the clean command for the cleanup of binaries: make clean These commands are very handy and help to streamline the development process. Now all of your team members can use the same command. This reduces inconsistency and helps to eliminate project build-related errors that can arise with inconsistent manual commands. Improving the Development Experience with Makefiles make uses the Makefile as its source of commands to execute and these commands are defined as a rules in the Makefile. A single rule defines target, dependencies, and the recipe of the Makefile. Terminology Target: Targets are the main component of a Makefile. The make command executes the recipe by its target name. As you saw in the last section, I used commands like build, run, and build_and_clean. These are called targets. Targets are the interface to the commands I want to execute. Dependencies: A target can have dependencies that need to be executed before running the target. For example, the build_and_clean command has two dependencies: build and run. Recipe: Recipes are the actual commands that will be executed when the target is run. A recipe can be a single command or a collection of commands. You can specify multiple commands in a target using a line break. In the example above, the recipe for the run target is ./${BINARY_NAME}. A recipe should always contain a tab at the start. Variables Variables are essential to any kind of script you write. So Makefiles also have a mechanism to use variables. These are useful when you want the same configs or outputs to be used for different targets. In the example above, I have added the BINARY_NAME variable, which is reused across different targets. The variable can be substituted by enclosing it ${&amp;lt;variable_name&amp;gt;}. I have used the variable in the run command to execute the binary that was created from the build command: BINARY_NAME=hello-world run: ./${BINARY_NAME} Variables can be defined either by using = or :=. = will recursively expand the variable. This will replace the value at the point when it is substituted. For example: x = foo y = $(x) bar x = later all: echo $(y) When you run the all command, it will replace the value of x with the last updated value. The value has been changed to later, so it will print: &amp;gt; later bar The other kind of variable assignment is :=. These are simple expanded variables. The variable is expanded at the first scan. So if you assign the variable using this operator, it will print the first value: x := foo y := $(x) bar x := later all: echo $(y) &amp;gt; foo bar Some Useful Tips To make comments in a Makefile, you can simply add a # before any line. To disable printing the recipe while running the target command, use @ before the recipe. Use the SHELL variable to define the shell to execute the recipe. Define the .DEFAULT_GOAL with the name of the target. You can also define functions or loops in the Makefile. You can find more details on it in this make file tutorial. Automating Tasks Using Makefile While developing a project, you will have a lot of repetitive tasks that you might like to automate. In Golang, some of those tasks are testing, running test coverage, linting, and managing dependencies. I will be creating a Makefile that contains all the rules to automate these tasks: BINARY_NAME=hello-world build: GOARCH=amd64 GOOS=darwin go build -o ${BINARY_NAME}-darwin main.go GOARCH=amd64 GOOS=linux go build -o ${BINARY_NAME}-linux main.go GOARCH=amd64 GOOS=window go build -o ${BINARY_NAME}-windows main.go run: ./${BINARY_NAME} build_and_run: build run clean: go clean rm ${BINARY_NAME}-darwin rm ${BINARY_NAME}-linux rm ${BINARY_NAME}-windows test: go test ./... test_coverage: go test ./... -coverprofile=coverage.out dep: go mod download vet: go vet lint: golangci-lint run --enable-all With this simple Makefile, you can now easily execute commands to run tasks: make test make test_coverage make dep make vet make lint Note: I am using an external package, golangci-lint, for linting. If you are using go mod, make sure to add it to your go.mod file. Any CI/CD tool that you are using can now simply use these targets. Conclusion Golang is a popular language for developing large-scale projects. Larger projects have multiple developers and require continuous automation to scale. Streamlining the development process by automating the tasks that are required during development, testing, and release will pay off with a faster and more reliable development process and a easier release process. For next-level automation and to further improve the automation, tools like Earthly.dev can be helpful. If you are also using Docker along with Makefile, Earthly can help make your development process smoother, taking some of the best ideas from Makefiles and Dockerfiles and combining them into one specification.</summary></entry><entry><title type="html">Beating TimSort at Merging</title><link href="https://earthly.dev/blog/python-timsort-merge/" rel="alternate" type="text/html" title="Beating TimSort at Merging" /><published>2021-07-13T00:00:00-04:00</published><updated>2021-07-13T00:00:00-04:00</updated><id>https://earthly.dev/blog/python-timsort-merge</id><content type="html" xml:base="https://earthly.dev/blog/python-timsort-merge/">&lt;div class=&quot;narrow-code&quot;&gt;
&lt;p&gt;Here is a problem. You are tasked with improving the hot loop of a Python program: maybe it is an in-memory sequential index of some sort. The slow part is the updating, where you are adding a new sorted list of items to the already sorted index. You need to combine two sorted lists and keep the result sorted. How do you do that update?&lt;/p&gt;
&lt;p&gt;Yes, this sounds like a LeetCode problem, and maybe in the real-world you would reach for some existing &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/util/SortedSet.html&quot;&gt;sorted set&lt;/a&gt; &lt;a href=&quot;http://www.cplusplus.com/reference/set/set/&quot;&gt;data structure&lt;/a&gt;, but if you were working with python lists, you might do something like this&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; merge_sorted_lists(l1, l2):&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    sorted_list &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;while&lt;/span&gt; (l1 &lt;span class=&quot;kw&quot;&gt;and&lt;/span&gt; l2):&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; (l1[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;&amp;lt;=&lt;/span&gt; l2[&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;]): &lt;span class=&quot;co&quot;&gt;# Compare both heads&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            item &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; l1.pop(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;co&quot;&gt;# Pop from the head&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            sorted_list.append(item)&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            item &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; l2.pop(&lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;            sorted_list.append(item)&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;# Add the remaining of the lists&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    sorted_list.extend(l1 &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; l1 &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt; l2)&lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; sorted_list&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Python has a built-in method in &lt;a href=&quot;https://github.com/python/cpython/blob/3.7/Lib/heapq.py#L314&quot;&gt;&lt;code&gt;heapq.merge&lt;/code&gt;&lt;/a&gt; that does this. It takes advantage of the fact that our lists are already sorted, so we can get a new sorted list linear time rather than the &lt;code&gt;n*log(n)&lt;/code&gt; time it would take for combining and sorting two unsorted lists.&lt;/p&gt;
&lt;p&gt;Imagine my surprise then when I saw this performance graph from Stack Overflow:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;picture&gt;&lt;source srcset=&quot;/blog/generated/assets/images/python-timsort-merge/performance-sort1-800-629c946b4.webp 800w&quot; type=&quot;image/webp&quot;&gt;&lt;source srcset=&quot;/blog/generated/assets/images/python-timsort-merge/performance-sort1-800-84f6208b2.png 800w&quot; type=&quot;image/png&quot;&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/performance-sort1-800-84f6208b2.png&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;figcaption&gt;
Python’s sort is beating merge at merging sorted lists!
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;Sorting the list is faster than just merging the list in almost all cases! That doesn’t sound right, but I checked it, and it’s true. As Stack Overflow user &lt;a href=&quot;https://stackoverflow.com/users/4279/jfs&quot;&gt;JFS&lt;/a&gt; puts it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Long story short, unless &lt;code&gt;len(l1 + l2)&lt;/code&gt; &amp;gt;= 1,000,000 use sort&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The reason sort beats merge in most cases is because of a man named Tim Peters.&lt;/p&gt;
&lt;h2 id=&quot;timsort&quot;&gt;TimSort&lt;/h2&gt;
&lt;p&gt;Python’s &lt;code&gt;list.sort&lt;/code&gt; is the original implementation of a hybrid sorting algorithm called TimSort, named after its author, Tim Peters.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[Here is] stable, natural merge sort, modestly called Timsort (hey, I earned it &lt;wink&gt;). It has supernatural performance on many kinds of partially ordered arrays (less than lg(N!) comparisons needed, and as few as N-1), yet as fast as Python’s previous highly tuned sample sort hybrid on random arrays.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figcaption&gt;
Tim Peters explaining &lt;a href=&quot;https://github.com/python/cpython/commit/92f81f2e63b5eaa6d748d51a10e32108517bf3bf#diff-6d09fc0f0b57214c2e3a838d366425836c296fa931fe9dc430f604b7e3950c29&quot;&gt;TimSort&lt;/a&gt;
&lt;/figcaption&gt;
&lt;p&gt;Timsort is designed to find runs of sequential numbers and merge them together:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The main routine marches over the array once, left to right, alternately identifying the next run, then merging it into the previous runs “intelligently”. Everything else is complication for speed, and some hard-won measure of memory efficiency.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is why &lt;code&gt;(x + y).sort()&lt;/code&gt; can be surprisingly fast: once it finds the sequential runs of numbers, it functions like our merge algorithm: combining the two sorted lists in linear time.&lt;/p&gt;
&lt;p&gt;Timsort does have to do extra work, though. It needs to do a pass over the data to find these sequential runs, and &lt;code&gt;heapq.merge&lt;/code&gt; knows where the runs are ahead of time. Timsort overcomes this disadvantage by being written in C rather than Python. Or as ShawdowRanger on Stack Overflow explains it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;CPython’s &lt;code&gt;list.sort&lt;/code&gt; is implemented in C (avoiding interpreter overhead), while &lt;code&gt;heapq.merge&lt;/code&gt; is mostly implemented in Python, and optimizes for the “many iterables” case in a way that slows the “two iterables” case.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;This means that if I drop down to C and write a C extension I should be able to beat Timsort. This turned out to be easier than I thought it would be&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;the-c-extension&quot;&gt;The C Extension&lt;/h2&gt;
&lt;p&gt;The bulk of the C Extension, whose performance I’m going to cover in a minute, is just the pop the stack algorithm discussed before, but using an index to point to the head of the stack:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode c&quot;&gt;&lt;code class=&quot;sourceCode c&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;//New List&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; mergedList &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; PyList_New&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; n1 &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; n2 &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; i &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    elem1 &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; PyList_GetItem&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; listObj1&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; i1 &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    elem2 &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; PyList_GetItem&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; listObj2&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; i2 &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    result &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; PyObject_RichCompareBool&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; w&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; Py_LT&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; result &lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;co&quot;&gt;// List1 has smallest, Pop from list 1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;cf&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        PyList_SetItem&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; mergedList&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;++,&lt;/span&gt; elem1 &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        i1&lt;span class=&quot;op&quot;&gt;++;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-15&quot;&gt;&lt;a href=&quot;#cb2-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;cf&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-16&quot;&gt;&lt;a href=&quot;#cb2-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;co&quot;&gt;// List2 has smallest, Pop from list 2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-17&quot;&gt;&lt;a href=&quot;#cb2-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        PyList_SetItem&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; mergedList&lt;span class=&quot;op&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;++,&lt;/span&gt; elem2 &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-18&quot;&gt;&lt;a href=&quot;#cb2-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        i2&lt;span class=&quot;op&quot;&gt;++;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-19&quot;&gt;&lt;a href=&quot;#cb2-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;cf&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-20&quot;&gt;&lt;a href=&quot;#cb2-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-21&quot;&gt;&lt;a href=&quot;#cb2-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; i2 &lt;span class=&quot;op&quot;&gt;&amp;gt;=&lt;/span&gt; n2 &lt;span class=&quot;op&quot;&gt;||&lt;/span&gt; i1 &lt;span class=&quot;op&quot;&gt;&amp;gt;=&lt;/span&gt; n1 &lt;span class=&quot;op&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-22&quot;&gt;&lt;a href=&quot;#cb2-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;co&quot;&gt;//One list is empty, add remainder of other list to result&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-23&quot;&gt;&lt;a href=&quot;#cb2-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;op&quot;&gt;...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-24&quot;&gt;&lt;a href=&quot;#cb2-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-25&quot;&gt;&lt;a href=&quot;#cb2-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-26&quot;&gt;&lt;a href=&quot;#cb2-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-27&quot;&gt;&lt;a href=&quot;#cb2-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; mergedList&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;figcaption&gt;
C merge (&lt;a href=&quot;https://github.com/earthly/pymerge/blob/main/merge.c&quot;&gt;full and final version on GitHub&lt;/a&gt;)
&lt;/figcaption&gt;
&lt;p&gt;The nice thing about C extensions in Python is that they are easy to use. Once compiled, I can just &lt;code&gt;import merge&lt;/code&gt; and use my new merge method:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; merge&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# create some sorted lists&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;a &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1700&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;b &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1400&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1800&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# merge them&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;merge.merge(a, b)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;testing-it&quot;&gt;Testing It&lt;/h2&gt;
&lt;p&gt;Testing my new merge with a list of integers and floats, we can see that we are beating Timsort, especially for long lists:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; merge&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; timeit&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;a &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;op&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1700&lt;/span&gt;)) &lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;b &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;fl&quot;&gt;0.1&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;bu&quot;&gt;range&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;1400&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1800&lt;/span&gt;))&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; merge_test():&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   m1 &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; merge.merge(a, b)&lt;/span&gt;
&lt;span id=&quot;cb4-9&quot;&gt;&lt;a href=&quot;#cb4-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-10&quot;&gt;&lt;a href=&quot;#cb4-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; sort_test():&lt;/span&gt;
&lt;span id=&quot;cb4-11&quot;&gt;&lt;a href=&quot;#cb4-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   m2 &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; b&lt;/span&gt;
&lt;span id=&quot;cb4-12&quot;&gt;&lt;a href=&quot;#cb4-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;   m2.sort()&lt;/span&gt;
&lt;span id=&quot;cb4-13&quot;&gt;&lt;a href=&quot;#cb4-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-14&quot;&gt;&lt;a href=&quot;#cb4-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;sort_time &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;quot;sort_test()&amp;quot;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;from __main__ import sort_test&amp;quot;&lt;/span&gt;, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-15&quot;&gt;&lt;a href=&quot;#cb4-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;merge_time &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;quot;merge_test()&amp;quot;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;from __main__ import merge_test&amp;quot;&lt;/span&gt;,number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-16&quot;&gt;&lt;a href=&quot;#cb4-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-17&quot;&gt;&lt;a href=&quot;#cb4-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;ss&quot;&gt;f&amp;#39;timsort took &lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;sort_time&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt; seconds&amp;#39;&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-18&quot;&gt;&lt;a href=&quot;#cb4-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;ss&quot;&gt;f&amp;#39;merge took &lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{&lt;/span&gt;merge_time&lt;span class=&quot;sc&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt; seconds&amp;#39;&lt;/span&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;timsort&lt;/span&gt; took 3.9523325259999997 seconds&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;merge&lt;/span&gt; took 3.0547665259999994 seconds&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Graphing the performance we get this:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/beating-with-hetro1-800-f0ab30520.png&quot; srcset=&quot;/blog/generated/assets/images/python-timsort-merge/beating-with-hetro1-400-f0ab30520.png 400w, /blog/generated/assets/images/python-timsort-merge/beating-with-hetro1-600-f0ab30520.png 600w, /blog/generated/assets/images/python-timsort-merge/beating-with-hetro1-800-f0ab30520.png 800w, /blog/generated/assets/images/python-timsort-merge/beating-with-hetro1-1000-f0ab30520.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
We are beating Timsort with our merge
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;But if we switch to a list of only integers &lt;code&gt;sort&lt;/code&gt; is beating us for small lists and even on big lists our performance improvement is thin at best:&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/losing-with-homo-800-f3e6b8fd6.png&quot; srcset=&quot;/blog/generated/assets/images/python-timsort-merge/losing-with-homo-400-f3e6b8fd6.png 400w, /blog/generated/assets/images/python-timsort-merge/losing-with-homo-600-f3e6b8fd6.png 600w, /blog/generated/assets/images/python-timsort-merge/losing-with-homo-800-f3e6b8fd6.png 800w, /blog/generated/assets/images/python-timsort-merge/losing-with-homo-1000-f3e6b8fd6.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
With lists of all &lt;code&gt;int&lt;/code&gt; or all &lt;code&gt;float&lt;/code&gt; we lose our advantage.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;What is going on here?&lt;/p&gt;
&lt;h2 id=&quot;timsorts-special-comparisons&quot;&gt;Timsort’s Special Comparisons&lt;/h2&gt;
&lt;p&gt;It turns out that Timsort has some extra tricks up its sleeves in the case of a list of integers. In that initial pass over the list, it checks the types of the elements, and if they are all uniform it tries to use a cheaper comparison operation.&lt;/p&gt;
&lt;p&gt;Specifically, if your list is all &lt;a href=&quot;https://github.com/python/cpython/blob/main/Objects/listobject.c#L2085&quot;&gt;longs&lt;/a&gt;, &lt;a href=&quot;https://github.com/python/cpython/blob/main/Objects/listobject.c#L2113&quot;&gt;floats&lt;/a&gt;, or &lt;a href=&quot;https://github.com/python/cpython/blob/main/Objects/listobject.c#L2061&quot;&gt;Latin strings&lt;/a&gt; Timsort will save a lot of cycles on the comparison operations.&lt;/p&gt;
&lt;p&gt;Learning from Timsort we can bring in these comparison operations ourselves. We don’t want to do a full pass over the list, or we will lose our advantage, so we can just specialize our merge by offering separate calls for longs, floats, and Latin alphabet strings like so:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode c&quot;&gt;&lt;code class=&quot;sourceCode c&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;//Default comparison&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; merge&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*,&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;//Compare assuming ints&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; merge_int&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*,&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-7&quot;&gt;&lt;a href=&quot;#cb6-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;//Compare assuming floats&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-8&quot;&gt;&lt;a href=&quot;#cb6-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; merge_float&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*,&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-9&quot;&gt;&lt;a href=&quot;#cb6-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-10&quot;&gt;&lt;a href=&quot;#cb6-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;//Compare assuming latin&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-11&quot;&gt;&lt;a href=&quot;#cb6-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; merge_latin&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*,&lt;/span&gt; PyObject&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;figcaption&gt;
merge.h
&lt;/figcaption&gt;
&lt;h2 id=&quot;beating-timsort&quot;&gt;Beating TimSort&lt;/h2&gt;
&lt;p&gt;Doing that, we now can finally beat Timsort at merging sorted lists, not just when the list is a heterogeneous mix of elements, but also when it’s all integers, or floating-point numbers, or one byte per char strings.&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/summary1-int-800-b27eb2dbe.png&quot; srcset=&quot;/blog/generated/assets/images/python-timsort-merge/summary1-int-400-b27eb2dbe.png 400w, /blog/generated/assets/images/python-timsort-merge/summary1-int-600-b27eb2dbe.png 600w, /blog/generated/assets/images/python-timsort-merge/summary1-int-800-b27eb2dbe.png 800w, /blog/generated/assets/images/python-timsort-merge/summary1-int-1000-b27eb2dbe.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
merge vs TimSort for &lt;code&gt;int&lt;/code&gt;.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/summary2-float-800-28225b9ff.png&quot; srcset=&quot;/blog/generated/assets/images/python-timsort-merge/summary2-float-400-28225b9ff.png 400w, /blog/generated/assets/images/python-timsort-merge/summary2-float-600-28225b9ff.png 600w, /blog/generated/assets/images/python-timsort-merge/summary2-float-800-28225b9ff.png 800w, /blog/generated/assets/images/python-timsort-merge/summary2-float-1000-28225b9ff.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
merge vs TimSort for &lt;code&gt;float&lt;/code&gt;.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/summary3-latin-800-af4f97615.png&quot; srcset=&quot;/blog/generated/assets/images/python-timsort-merge/summary3-latin-400-af4f97615.png 400w, /blog/generated/assets/images/python-timsort-merge/summary3-latin-600-af4f97615.png 600w, /blog/generated/assets/images/python-timsort-merge/summary3-latin-800-af4f97615.png 800w, /blog/generated/assets/images/python-timsort-merge/summary3-latin-1000-af4f97615.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
merge vs TimSort for Latin alphabet strings.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;p&gt;&lt;img src=&quot;/blog/generated/assets/images/python-timsort-merge/summary4-else-800-34d33a495.png&quot; srcset=&quot;/blog/generated/assets/images/python-timsort-merge/summary4-else-400-34d33a495.png 400w, /blog/generated/assets/images/python-timsort-merge/summary4-else-600-34d33a495.png 600w, /blog/generated/assets/images/python-timsort-merge/summary4-else-800-34d33a495.png 800w, /blog/generated/assets/images/python-timsort-merge/summary4-else-1000-34d33a495.png 1000w&quot;&gt;&lt;/p&gt;
&lt;figcaption&gt;
merge vs TimSort for everything without a specialized compare.
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;The default &lt;code&gt;merge&lt;/code&gt; beats Timsort for heterogeneous lists, and the specialized versions are there for when you have uniform types in your list, and you need to go fast.&lt;/p&gt;
&lt;h2 id=&quot;timsort-is-good&quot;&gt;TimSort Is Good&lt;/h2&gt;
&lt;p&gt;There, I have beat Timsort for merging sorting lists, although I had to pull in some code from TimSort itself to get here. I’m not sure how valuable this is: if you need to go fast, you might not choose Python, but it was a fun learning project.&lt;/p&gt;
&lt;p&gt;Also, I learned that dropping down to C isn’t as scary as it sounds. The build steps are a bit more involved, but with the included &lt;a href=&quot;https://github.com/earthly/pymerge/blob/main/Earthfile&quot;&gt;Earthfile&lt;/a&gt;, the build is a one-liner and works cross-platform. You can find the code &lt;a href=&quot;https://github.com/earthly/pymerge&quot;&gt;on GitHub&lt;/a&gt; and an intro to &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt; on this very site, and with that example, you can build your own C extension reasonably quickly.&lt;/p&gt;
&lt;p&gt;The surprising thing, though, is how good Timsort still is. It wasn’t designed for merging sorted lists but for sorting real-world data. It turns out real-world data is often partially sorted, just like our use case.&lt;/p&gt;
&lt;p&gt;Timsort on partially sorted data shows us where Big O notation can misinform us. If your input always keeps you near the median or best-case performance, then the worst-case performance doesn’t matter much. It’s no wonder then that since its first creation, Timsort has spread from Python to JavaScript, Swift, and Rust. Thank you, Tim Peters!&lt;/p&gt;
&lt;/div&gt;
&lt;section class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;Practically, you might not want to use pop, but just track an index of where the head of the stack should be, like the C code shown later.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;It was easier because my teammate Alex has experience writing C extensions for Python, so by the time I had found the Python header files, Alex had already put together a prototype solution.&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Tutorials" /><summary type="html">Here is a problem. You are tasked with improving the hot loop of a Python program: maybe it is an in-memory sequential index of some sort. The slow part is the updating, where you are adding a new sorted list of items to the already sorted index. You need to combine two sorted lists and keep the result sorted. How do you do that update? Yes, this sounds like a LeetCode problem, and maybe in the real-world you would reach for some existing sorted set data structure, but if you were working with python lists, you might do something like this1: def merge_sorted_lists(l1, l2): sorted_list = [] while (l1 and l2): if (l1[0] &amp;lt;= l2[0]): # Compare both heads item = l1.pop(0) # Pop from the head sorted_list.append(item) else: item = l2.pop(0) sorted_list.append(item) # Add the remaining of the lists sorted_list.extend(l1 if l1 else l2) return sorted_list Python has a built-in method in heapq.merge that does this. It takes advantage of the fact that our lists are already sorted, so we can get a new sorted list linear time rather than the n*log(n) time it would take for combining and sorting two unsorted lists. Imagine my surprise then when I saw this performance graph from Stack Overflow: Python’s sort is beating merge at merging sorted lists! Sorting the list is faster than just merging the list in almost all cases! That doesn’t sound right, but I checked it, and it’s true. As Stack Overflow user JFS puts it: Long story short, unless len(l1 + l2) &amp;gt;= 1,000,000 use sort The reason sort beats merge in most cases is because of a man named Tim Peters. TimSort Python’s list.sort is the original implementation of a hybrid sorting algorithm called TimSort, named after its author, Tim Peters. [Here is] stable, natural merge sort, modestly called Timsort (hey, I earned it ). It has supernatural performance on many kinds of partially ordered arrays (less than lg(N!) comparisons needed, and as few as N-1), yet as fast as Python’s previous highly tuned sample sort hybrid on random arrays. Tim Peters explaining TimSort Timsort is designed to find runs of sequential numbers and merge them together: The main routine marches over the array once, left to right, alternately identifying the next run, then merging it into the previous runs “intelligently”. Everything else is complication for speed, and some hard-won measure of memory efficiency. This is why (x + y).sort() can be surprisingly fast: once it finds the sequential runs of numbers, it functions like our merge algorithm: combining the two sorted lists in linear time. Timsort does have to do extra work, though. It needs to do a pass over the data to find these sequential runs, and heapq.merge knows where the runs are ahead of time. Timsort overcomes this disadvantage by being written in C rather than Python. Or as ShawdowRanger on Stack Overflow explains it: CPython’s list.sort is implemented in C (avoiding interpreter overhead), while heapq.merge is mostly implemented in Python, and optimizes for the “many iterables” case in a way that slows the “two iterables” case. This means that if I drop down to C and write a C extension I should be able to beat Timsort. This turned out to be easier than I thought it would be2. The C Extension The bulk of the C Extension, whose performance I’m going to cover in a minute, is just the pop the stack algorithm discussed before, but using an index to point to the head of the stack: //New List PyObject* mergedList = PyList_New( n1 + n2 ); for( i = 0;; ) { elem1 = PyList_GetItem( listObj1, i1 ); elem2 = PyList_GetItem( listObj2, i2 ); result = PyObject_RichCompareBool(v, w, Py_LT); switch( result ) { // List1 has smallest, Pop from list 1 case 1: PyList_SetItem( mergedList, i++, elem1 ); i1++; break; case 0: // List2 has smallest, Pop from list 2 PyList_SetItem( mergedList, i++, elem2 ); i2++; break; } if( i2 &amp;gt;= n2 || i1 &amp;gt;= n1 )) { //One list is empty, add remainder of other list to result ... break; } } return mergedList; C merge (full and final version on GitHub) The nice thing about C extensions in Python is that they are easy to use. Once compiled, I can just import merge and use my new merge method: import merge # create some sorted lists a = list(range(-100, 1700)) b = list(range(1400, 1800)) # merge them merge.merge(a, b) Testing It Testing my new merge with a list of integers and floats, we can see that we are beating Timsort, especially for long lists: import merge import timeit a = list(range(-100, 1700)) b = [0.1] + list(range(1400, 1800)) def merge_test(): m1 = merge.merge(a, b) def sort_test(): m2 = a + b m2.sort() sort_time = timeit.timeit(&amp;quot;sort_test()&amp;quot;, setup=&amp;quot;from __main__ import sort_test&amp;quot;, number=100000) merge_time = timeit.timeit(&amp;quot;merge_test()&amp;quot;, setup=&amp;quot;from __main__ import merge_test&amp;quot;,number=100000) print(f&amp;#39;timsort took {sort_time} seconds&amp;#39;) print(f&amp;#39;merge took {merge_time} seconds&amp;#39;) timsort took 3.9523325259999997 seconds merge took 3.0547665259999994 seconds Graphing the performance we get this: We are beating Timsort with our merge But if we switch to a list of only integers sort is beating us for small lists and even on big lists our performance improvement is thin at best: With lists of all int or all float we lose our advantage. What is going on here? Timsort’s Special Comparisons It turns out that Timsort has some extra tricks up its sleeves in the case of a list of integers. In that initial pass over the list, it checks the types of the elements, and if they are all uniform it tries to use a cheaper comparison operation. Specifically, if your list is all longs, floats, or Latin strings Timsort will save a lot of cycles on the comparison operations. Learning from Timsort we can bring in these comparison operations ourselves. We don’t want to do a full pass over the list, or we will lose our advantage, so we can just specialize our merge by offering separate calls for longs, floats, and Latin alphabet strings like so: //Default comparison PyObject* merge( PyObject*, PyObject* ); //Compare assuming ints PyObject* merge_int( PyObject*, PyObject* ); //Compare assuming floats PyObject* merge_float( PyObject*, PyObject* ); //Compare assuming latin PyObject* merge_latin( PyObject*, PyObject* ) merge.h Beating TimSort Doing that, we now can finally beat Timsort at merging sorted lists, not just when the list is a heterogeneous mix of elements, but also when it’s all integers, or floating-point numbers, or one byte per char strings. merge vs TimSort for int. merge vs TimSort for float. merge vs TimSort for Latin alphabet strings. merge vs TimSort for everything without a specialized compare. The default merge beats Timsort for heterogeneous lists, and the specialized versions are there for when you have uniform types in your list, and you need to go fast. TimSort Is Good There, I have beat Timsort for merging sorting lists, although I had to pull in some code from TimSort itself to get here. I’m not sure how valuable this is: if you need to go fast, you might not choose Python, but it was a fun learning project. Also, I learned that dropping down to C isn’t as scary as it sounds. The build steps are a bit more involved, but with the included Earthfile, the build is a one-liner and works cross-platform. You can find the code on GitHub and an intro to Earthly on this very site, and with that example, you can build your own C extension reasonably quickly. The surprising thing, though, is how good Timsort still is. It wasn’t designed for merging sorted lists but for sorting real-world data. It turns out real-world data is often partially sorted, just like our use case. Timsort on partially sorted data shows us where Big O notation can misinform us. If your input always keeps you near the median or best-case performance, then the worst-case performance doesn’t matter much. It’s no wonder then that since its first creation, Timsort has spread from Python to JavaScript, Swift, and Rust. Thank you, Tim Peters! Practically, you might not want to use pop, but just track an index of where the head of the stack should be, like the C code shown later.↩︎ It was easier because my teammate Alex has experience writing C extensions for Python, so by the time I had found the Python header files, Alex had already put together a prototype solution.↩︎</summary></entry><entry><title type="html">Creating a Python Makefile</title><link href="https://earthly.dev/blog/python-makefile/" rel="alternate" type="text/html" title="Creating a Python Makefile" /><published>2021-07-08T00:00:00-04:00</published><updated>2021-07-08T00:00:00-04:00</updated><id>https://earthly.dev/blog/python-makefile</id><content type="html" xml:base="https://earthly.dev/blog/python-makefile/">&lt;p&gt;Even though Python is regarded as an interpreted language and the files need not be compiled separately, many developers are unaware that you can still use &lt;code&gt;make&lt;/code&gt; to automate different parts of developing a Python project, like running tests, cleaning builds, and installing dependencies. It’s honestly an underutilized function, and by integrating it into your routine, you can save time and avoid errors.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;make&lt;/code&gt; is a commonplace tool in the world of software development, especially compiled languages like C or C++. It is a tool which controls the generation of executable and other non-source files from a program’s source file. It can automate the process of building software by tracking its dependencies and compiling the program only when the dependencies change.&lt;/p&gt;
&lt;p&gt;The reason &lt;code&gt;make&lt;/code&gt; is very common with compiled languages is because the compilation commands for those languages can be long and complicated and difficult to remember. Also, you need to compile each file and link the resulting object files together. So, whenever one of the files changes, it becomes necessary to recompile it.&lt;/p&gt;
&lt;p&gt;In this tutorial, you will learn the basics of &lt;code&gt;make&lt;/code&gt; and how it can be used in a Python project.&lt;/p&gt;
&lt;h2 id=&quot;is-python-compiled-or-interpreted&quot;&gt;Is Python Compiled or Interpreted?&lt;/h2&gt;
&lt;p&gt;Usually, all the programming languages can be classified into compiled or interpreted languages. In simple words, in a compiled language, the program is converted from a high level language to machine language. Whereas, in case of interpreted language, the source code is read and executed one line at a time.&lt;/p&gt;
&lt;p&gt;Since in an interpreted language you cannot compile the source files independently beforehand, you cannot utilize &lt;code&gt;make&lt;/code&gt; like you would do for a compiled language. This makes &lt;code&gt;make&lt;/code&gt; relatively underutilized for an interpreted language.&lt;/p&gt;
&lt;p&gt;Now, Python is usually considered to be an interpreted language. When you run a Python code, the Python interpreter reads the file line-by-line and runs it.&lt;/p&gt;
&lt;p&gt;But behind-the-scenes, the source code is compiled into bytecode. These are similar to CPU instructions, but instead of being run by the actual CPU, these are executed by a software called a Virtual Machine (VM), which acts as a pseudo-microprocessor that runs the bytecodes. The advantage is that you can run Python on any platform as long as the VM is installed.&lt;/p&gt;
&lt;p&gt;When you run a Python code, the interpreter implicitly compiles the code into bytecode and interprets it with the VM. The reason Python is regarded to be an interpreted language is because the &lt;a href=&quot;/blog/compiling-containers-dockerfiles-llvm-and-buildkit&quot;&gt;compilation&lt;/a&gt; step is implicit. You don’t have to invoke a compiler manually.&lt;/p&gt;
&lt;p&gt;When you import a module into your code, Python compiles those modules into bytecode for caching purposes. These are stored in a directory named &lt;code&gt;__pycache__&lt;/code&gt; in the current directory, which contains compiled &lt;code&gt;.pyc&lt;/code&gt; files.&lt;/p&gt;
&lt;p&gt;Although you cannot compile these modules using &lt;code&gt;make&lt;/code&gt;, you can still use &lt;code&gt;make&lt;/code&gt; for automation tasks like running tests, installing dependencies, cleaning the &lt;code&gt;.pyc&lt;/code&gt; files etc.&lt;/p&gt;
&lt;h2 id=&quot;using-make-with-python&quot;&gt;Using Make With Python&lt;/h2&gt;
&lt;p&gt;In this tutorial, you’ll create a simple app that makes requests to &lt;code&gt;http://numbersapi.com&lt;/code&gt; and fetches random trivia about a user given number.&lt;/p&gt;
&lt;h3 id=&quot;the-sample-source-code&quot;&gt;The Sample Source Code&lt;/h3&gt;
&lt;p&gt;First, you’ll start by creating a file &lt;code&gt;api.py&lt;/code&gt; with the following code:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; requests&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;def&lt;/span&gt; get_fact(number):&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    url &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;http://numbersapi.com/&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;.&lt;span class=&quot;bu&quot;&gt;format&lt;/span&gt;(number)&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    r &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; requests.get(url)&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;if&lt;/span&gt; r.status_code &lt;span class=&quot;op&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;200&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(r.text)&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;bu&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;An error occurred, code=&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;{}&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&lt;/span&gt;.&lt;span class=&quot;bu&quot;&gt;format&lt;/span&gt;(r.status_code))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Create another file &lt;code&gt;app.py&lt;/code&gt; with the following code:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; api&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;api.get_fact(&lt;span class=&quot;bu&quot;&gt;input&lt;/span&gt;(&lt;span class=&quot;st&quot;&gt;&amp;quot;Enter a number: &amp;quot;&lt;/span&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This file simply imports the &lt;code&gt;api&lt;/code&gt; module and calls the &lt;code&gt;get_fact()&lt;/code&gt; function with a user provided number.&lt;/p&gt;
&lt;p&gt;Finally, create a file &lt;code&gt;requirements.txt&lt;/code&gt; with the dependencies of the app:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;requests&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This app only depends on the &lt;code&gt;requests&lt;/code&gt; module, but a real life project possibly depends on a large number of modules. Let’s run the app and see how it works.&lt;/p&gt;
&lt;p&gt;First, install the dependencies:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;pip&lt;/span&gt; install &lt;span class=&quot;at&quot;&gt;-r&lt;/span&gt; requirements.txt&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, run the actual app:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;python&lt;/span&gt; app.py&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will prompt you for a number and show you a trivia about that number:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$  python app.py
Enter a number: 20
20 is the number of questions in the popular party game Twenty Questions.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now let’s integrate &lt;code&gt;make&lt;/code&gt; with our project to automate the installation of dependencies and running the app.&lt;/p&gt;
&lt;h3 id=&quot;the-makefile&quot;&gt;The Makefile&lt;/h3&gt;
&lt;p&gt;To use &lt;code&gt;make&lt;/code&gt; in your project, you need to have a file named &lt;code&gt;Makefile&lt;/code&gt; at the root of your project. This file instructs &lt;code&gt;make&lt;/code&gt; on what to do. The Makefile consists of a set of rules. Each rule has 3 parts: a target, a list of prerequisites, and a recipe. They follow this format:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;target:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; pre-req1 pre-req2 pre-req3 ...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    recipes&lt;/span&gt;
&lt;span id=&quot;cb7-3&quot;&gt;&lt;a href=&quot;#cb7-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note that there are &lt;a href=&quot;/blog/repeatable-builds-every-time/#tips-for-taming-makefiles-in-large-teams&quot;&gt;tabs&lt;/a&gt; before the recipe lists. Anything other than tabs will result in an error.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;target&lt;/code&gt; represents a goal that you want to achieve, usually this is a file that needs to be created in your build. The prerequisites list tells &lt;code&gt;make&lt;/code&gt; which files are this target dependent on. The prerequisites can be a file or another target. Finally the recipes are a list of shell commands that will be executed by make as part of building the target.&lt;/p&gt;
&lt;p&gt;When &lt;code&gt;make&lt;/code&gt; executes a target, it looks at its prerequisites. If those prerequisites have their own recipes, &lt;code&gt;make&lt;/code&gt; executes them and when all the prerequisites are ready for a target, it executes the corresponding recipe for the current target. For each target, the recipes are executed only if the target doesn’t exist or the pre-requisites are newer than the target.&lt;/p&gt;
&lt;p&gt;Our app has two targets. First, the dependencies must be installed and then the app can be run.&lt;/p&gt;
&lt;p&gt;Let’s create the rule for running the app first:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;run:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    python app.py&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The target is named &lt;code&gt;run&lt;/code&gt; and it has no prerequisites, which it will be run every time you run &lt;code&gt;make run&lt;/code&gt;. You can test it by running &lt;code&gt;make run&lt;/code&gt; in a terminal.&lt;/p&gt;
&lt;p&gt;Create another target for the setup stage:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;setup:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; requirements.txt&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    pip install -r requirements.txt&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;setup&lt;/code&gt; target depends on the &lt;code&gt;requirements.txt&lt;/code&gt; file. Whenever the &lt;code&gt;requirements.txt&lt;/code&gt; file changes, the dependencies will be refreshed by running &lt;code&gt;pip install -r&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Finally, let’s have a &lt;code&gt;clean&lt;/code&gt; rule to clean up the &lt;code&gt;__pycache__&lt;/code&gt; folder:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    rm -rf __pycache__&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;creating-a-virtual-environment&quot;&gt;Creating a Virtual Environment&lt;/h3&gt;
&lt;p&gt;The sample app depends on the &lt;code&gt;requests&lt;/code&gt; library only. However, in a large project, there might be numerous dependencies. And if you are running multiple apps, it’s possible that some apps require the same dependencies, but a different version. This means that one Python installation may not be capable of satisfying the requirements of all applications. The solution for this is to use a &lt;a href=&quot;https://docs.python.org/3/glossary.html#term-virtual-environment&quot;&gt;virtual environment&lt;/a&gt;. This is a self-contained directory tree that contains a Python installation of a specific version.&lt;/p&gt;
&lt;p&gt;Different apps can use their own virtual environment where they can install their requirements. The virtual environments are isolated from each other, which means there will be no dependency conflicts.&lt;/p&gt;
&lt;p&gt;Python provides a module called &lt;a href=&quot;https://docs.python.org/3/library/venv.html#module-venv&quot;&gt;&lt;code&gt;venv&lt;/code&gt;&lt;/a&gt; which is used to create and manage virtual environments. Let’s see how a virtual environment can be used in the sample app.&lt;/p&gt;
&lt;p&gt;First, you need to create a virtual environment in the project root:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;python3&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-m&lt;/span&gt; venv venv&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This creates a &lt;code&gt;venv&lt;/code&gt; folder in your current directory, which contains the necessary files to make the virtual environment.&lt;/p&gt;
&lt;p&gt;There are two ways to use this virtual environment. Instead of using &lt;code&gt;python3&lt;/code&gt; or &lt;code&gt;pip&lt;/code&gt;, you have to use &lt;code&gt;./venv/bin/python3&lt;/code&gt; or &lt;code&gt;./venv/bin/pip&lt;/code&gt; to run the app or install dependencies:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;python3&lt;/span&gt; app.py &lt;span class=&quot;co&quot;&gt;# Uses the system Python&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-2&quot;&gt;&lt;a href=&quot;#cb12-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;./venv/bin/python3&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;# USes the virtualenv Python&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But writing &lt;code&gt;./venv.bin/&lt;/code&gt; every time can be time consuming, especially if you have to run a lot of commands that use Python or pip. To overcome this, you can “activate” the virtual environment by running:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;./venv/bin/activate&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will load the virtual environment in the current shell. This environment will stay active as long as you don’t close the shell, or deactivate manually.&lt;/p&gt;
&lt;p&gt;Once activated, running &lt;code&gt;python3&lt;/code&gt; or &lt;code&gt;pip&lt;/code&gt; will use the executables from the virtual environment. If you now run &lt;code&gt;pip install -r requirements.txt&lt;/code&gt;, the modules will be installed in the &lt;code&gt;venv&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;Once you are done with the virtual environment, you can deactivate the environment by running the &lt;code&gt;deactivate&lt;/code&gt; command.&lt;/p&gt;
&lt;h3 id=&quot;venv-in-make&quot;&gt;&lt;code&gt;venv&lt;/code&gt; in Make&lt;/h3&gt;
&lt;p&gt;You can utilize &lt;code&gt;make&lt;/code&gt; to automatically refresh your virtual environment and run your app with this virtual environment. To automatically reinstall the dependencies whenever the &lt;code&gt;requirements.txt&lt;/code&gt; file changes, write the following in your Makefile:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;venv/bin/activate:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; requirements.txt&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; python3 -m venv venv&lt;/span&gt;
&lt;span id=&quot;cb14-3&quot;&gt;&lt;a href=&quot;#cb14-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; ./venv/bin/pip install -r requirements.txt&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here the target is &lt;code&gt;venv/bin/activate&lt;/code&gt; which depends on &lt;code&gt;requirements.txt&lt;/code&gt;. Whenever &lt;code&gt;requirements.txt&lt;/code&gt; changes, it rebuilds the environment and installs the dependencies with pip, which re-creates the &lt;code&gt;activate&lt;/code&gt;. The actual goal here is the existence of the &lt;code&gt;venv&lt;/code&gt; directory, but since &lt;code&gt;make&lt;/code&gt; can only work with files, &lt;code&gt;venv/bin/activate&lt;/code&gt; is used instead.&lt;/p&gt;
&lt;p&gt;To run the app with this environment, create the following rule:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;run:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; venv/bin/activate&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; ./venv/bin/python3 app.py&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;run&lt;/code&gt; target depends on the &lt;code&gt;venv/bin/activate&lt;/code&gt; target. Once that target is satisfied, it runs the app using the virtual environment.&lt;/p&gt;
&lt;p&gt;Finally, update the &lt;code&gt;clean&lt;/code&gt; target to also delete the &lt;code&gt;venv&lt;/code&gt; directory:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb16&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb16-1&quot;&gt;&lt;a href=&quot;#cb16-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-2&quot;&gt;&lt;a href=&quot;#cb16-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb16-3&quot;&gt;&lt;a href=&quot;#cb16-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm -rf __pycache__&lt;/span&gt;
&lt;span id=&quot;cb16-4&quot;&gt;&lt;a href=&quot;#cb16-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm -rf venv&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s test this all out. First, delete the &lt;code&gt;venv&lt;/code&gt; directory if you have one. Now run &lt;code&gt;make run&lt;/code&gt;. Since the &lt;code&gt;venv/bin/activate&lt;/code&gt; file does not exist, &lt;code&gt;make&lt;/code&gt; will run the &lt;code&gt;venv/bin/activate&lt;/code&gt; target, which will install the dependencies and finally run the app using the virtual environment.&lt;/p&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/python-makefile/makerun.png&quot; alt=&quot;make run for Python venv&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;&lt;code&gt;make run&lt;/code&gt; for Python &lt;code&gt;venv&lt;/code&gt;&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;p&gt;If you run &lt;code&gt;make run&lt;/code&gt; once again, only the app will be run and the virtual environment will not be refreshed. You can use the &lt;code&gt;touch&lt;/code&gt; command to stimulate a change in the &lt;code&gt;requiremenst.txt&lt;/code&gt; file which will cause &lt;code&gt;make&lt;/code&gt; to run the setup step again -&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;touch requirements.txt&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now if you run &lt;code&gt;make run&lt;/code&gt;, the virtual environment will be recreated and then the app will be run.&lt;/p&gt;
&lt;h3 id=&quot;using-variables&quot;&gt;Using Variables&lt;/h3&gt;
&lt;p&gt;Observe that in our Makefile, we have references to the &lt;code&gt;venv&lt;/code&gt; directory in multiple places. In future, if we want to change the directory name to something else, we have to remember to perform the change in all the places. Also there isn’t any way for the user to customize the directory name without editing the Makefile. To overcome this, we can use variables. The variables not only make the Makefile cleaner, they can be overridden by the user without editing Makefile.&lt;/p&gt;
&lt;p&gt;A variable in Makefile starts with a $ and is enclosed in parentheses () or braces {}, unless its a single character variable.&lt;/p&gt;
&lt;p&gt;To set a variable, write a line starting with a variable name followed by &lt;code&gt;=&lt;/code&gt;, &lt;code&gt;:=&lt;/code&gt; or &lt;code&gt;::=&lt;/code&gt;, followed by the value of the variable:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;VENV &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; venv&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here the variable &lt;code&gt;VENV&lt;/code&gt; is set to &lt;code&gt;venv&lt;/code&gt;. Now whenever you use this variable in a rule, it will be replaced by its value.&lt;/p&gt;
&lt;p&gt;The rules now can be rewritten using the &lt;code&gt;VENV&lt;/code&gt; variable:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb19&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb19-1&quot;&gt;&lt;a href=&quot;#cb19-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;VENV &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; venv&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-2&quot;&gt;&lt;a href=&quot;#cb19-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;PYTHON &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;VENV&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/bin/python3&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-3&quot;&gt;&lt;a href=&quot;#cb19-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;PIP &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;VENV&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;st&quot;&gt;/bin/pip&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-4&quot;&gt;&lt;a href=&quot;#cb19-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-5&quot;&gt;&lt;a href=&quot;#cb19-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;run:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;VENV&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;/bin/activate&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-6&quot;&gt;&lt;a href=&quot;#cb19-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;PYTHON&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt; app.py&lt;/span&gt;
&lt;span id=&quot;cb19-7&quot;&gt;&lt;a href=&quot;#cb19-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-8&quot;&gt;&lt;a href=&quot;#cb19-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-9&quot;&gt;&lt;a href=&quot;#cb19-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;$(VENV)/bin/activate:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; requirements.txt&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-10&quot;&gt;&lt;a href=&quot;#cb19-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; python3 -m venv &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;VENV&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-11&quot;&gt;&lt;a href=&quot;#cb19-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;PIP&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt; install -r requirements.txt&lt;/span&gt;
&lt;span id=&quot;cb19-12&quot;&gt;&lt;a href=&quot;#cb19-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-13&quot;&gt;&lt;a href=&quot;#cb19-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-14&quot;&gt;&lt;a href=&quot;#cb19-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb19-15&quot;&gt;&lt;a href=&quot;#cb19-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm -rf __pycache__&lt;/span&gt;
&lt;span id=&quot;cb19-16&quot;&gt;&lt;a href=&quot;#cb19-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; rm -rf &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;VENV&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I have also replaced references to &lt;code&gt;python3&lt;/code&gt; and &lt;code&gt;pip&lt;/code&gt; with a variable. By default, they will use the binaries from the virtual environment.&lt;/p&gt;
&lt;p&gt;The variables can be overridden by providing the values when running the make command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb20&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb20-1&quot;&gt;&lt;a href=&quot;#cb20-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;make&lt;/span&gt; VENV=my_venv run&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;code&gt;VENV=my_venv&lt;/code&gt; overrides the default value of &lt;code&gt;VENV&lt;/code&gt; and now the virtual environment will be created in &lt;code&gt;my_venv&lt;/code&gt; directory. It is a good practice to use variables for all commands used in the Makefile, as well as their options and directories. This provides an easy way for the user to substitute alternatives.&lt;/p&gt;
&lt;h3 id=&quot;phony-targets&quot;&gt;Phony Targets&lt;/h3&gt;
&lt;p&gt;Your Makefile contains two special targets - run and clean. Special in the sense they don’t represent an actual file that exists. And since &lt;code&gt;make&lt;/code&gt; executes the recipes of a target if that target does not exist, these two targets will always be executed. However, if later if you have a file called &lt;code&gt;run&lt;/code&gt; or &lt;code&gt;clean&lt;/code&gt;, then since these targets have no prerequisites, &lt;code&gt;make&lt;/code&gt; will consider these to always be newer and so, will not execute the recipes.&lt;/p&gt;
&lt;p&gt;To overcome this, &lt;code&gt;make&lt;/code&gt; has something called a Phony target. By declaring a target to be Phony, you tell &lt;code&gt;make&lt;/code&gt; not to consider an existing file with the same name. To make the &lt;code&gt;run&lt;/code&gt; and &lt;code&gt;clean&lt;/code&gt; targets phony, add this to the top:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb21&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb21-1&quot;&gt;&lt;a href=&quot;#cb21-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ot&quot;&gt;.PHONY:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; run clean&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Using &lt;code&gt;make&lt;/code&gt; in your Python projects opens the door to lots of possibilities in terms of automation. You can use &lt;code&gt;make&lt;/code&gt; to run linters like &lt;code&gt;flake8&lt;/code&gt;, run tests using &lt;code&gt;pytest&lt;/code&gt;, or run code coverage using &lt;code&gt;coverage&lt;/code&gt;. If you wish to learn all the features of &lt;code&gt;make&lt;/code&gt;, be sure to check out the &lt;a href=&quot;http://www.gnu.org/software/make/manual/make.html&quot;&gt;manual&lt;/a&gt; by GNU.&lt;/p&gt;
&lt;p&gt;Being full of features, and primarily targeted towards compiled languages, &lt;code&gt;make&lt;/code&gt; can be difficult to use in a Python project, especially in large ones. If you are looking for a solution to avoid the complexities of Makefile, while still retaining the powerful automation capabilities, check out &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt;. Earthly takes a modern approach towards project builds and combines the best of both Makefile and Dockerfile. Earthly provides understandable and repeatable build scripts without any complexity.&lt;/p&gt;</content><author><name>Aniket Bhattacharyea</name></author><category term="Tutorials" /><summary type="html">Even though Python is regarded as an interpreted language and the files need not be compiled separately, many developers are unaware that you can still use make to automate different parts of developing a Python project, like running tests, cleaning builds, and installing dependencies. It’s honestly an underutilized function, and by integrating it into your routine, you can save time and avoid errors. make is a commonplace tool in the world of software development, especially compiled languages like C or C++. It is a tool which controls the generation of executable and other non-source files from a program’s source file. It can automate the process of building software by tracking its dependencies and compiling the program only when the dependencies change. The reason make is very common with compiled languages is because the compilation commands for those languages can be long and complicated and difficult to remember. Also, you need to compile each file and link the resulting object files together. So, whenever one of the files changes, it becomes necessary to recompile it. In this tutorial, you will learn the basics of make and how it can be used in a Python project. Is Python Compiled or Interpreted? Usually, all the programming languages can be classified into compiled or interpreted languages. In simple words, in a compiled language, the program is converted from a high level language to machine language. Whereas, in case of interpreted language, the source code is read and executed one line at a time. Since in an interpreted language you cannot compile the source files independently beforehand, you cannot utilize make like you would do for a compiled language. This makes make relatively underutilized for an interpreted language. Now, Python is usually considered to be an interpreted language. When you run a Python code, the Python interpreter reads the file line-by-line and runs it. But behind-the-scenes, the source code is compiled into bytecode. These are similar to CPU instructions, but instead of being run by the actual CPU, these are executed by a software called a Virtual Machine (VM), which acts as a pseudo-microprocessor that runs the bytecodes. The advantage is that you can run Python on any platform as long as the VM is installed. When you run a Python code, the interpreter implicitly compiles the code into bytecode and interprets it with the VM. The reason Python is regarded to be an interpreted language is because the compilation step is implicit. You don’t have to invoke a compiler manually. When you import a module into your code, Python compiles those modules into bytecode for caching purposes. These are stored in a directory named __pycache__ in the current directory, which contains compiled .pyc files. Although you cannot compile these modules using make, you can still use make for automation tasks like running tests, installing dependencies, cleaning the .pyc files etc. Using Make With Python In this tutorial, you’ll create a simple app that makes requests to http://numbersapi.com and fetches random trivia about a user given number. The Sample Source Code First, you’ll start by creating a file api.py with the following code: import requests def get_fact(number): url = &amp;quot;http://numbersapi.com/{}&amp;quot;.format(number) r = requests.get(url) if r.status_code == 200: print(r.text) else: print(&amp;quot;An error occurred, code={}&amp;quot;.format(r.status_code)) Create another file app.py with the following code: import api api.get_fact(input(&amp;quot;Enter a number: &amp;quot;)) This file simply imports the api module and calls the get_fact() function with a user provided number. Finally, create a file requirements.txt with the dependencies of the app: requests This app only depends on the requests module, but a real life project possibly depends on a large number of modules. Let’s run the app and see how it works. First, install the dependencies: pip install -r requirements.txt Then, run the actual app: python app.py This will prompt you for a number and show you a trivia about that number: $ python app.py Enter a number: 20 20 is the number of questions in the popular party game Twenty Questions. Now let’s integrate make with our project to automate the installation of dependencies and running the app. The Makefile To use make in your project, you need to have a file named Makefile at the root of your project. This file instructs make on what to do. The Makefile consists of a set of rules. Each rule has 3 parts: a target, a list of prerequisites, and a recipe. They follow this format: target: pre-req1 pre-req2 pre-req3 ... recipes ... Note that there are tabs before the recipe lists. Anything other than tabs will result in an error. The target represents a goal that you want to achieve, usually this is a file that needs to be created in your build. The prerequisites list tells make which files are this target dependent on. The prerequisites can be a file or another target. Finally the recipes are a list of shell commands that will be executed by make as part of building the target. When make executes a target, it looks at its prerequisites. If those prerequisites have their own recipes, make executes them and when all the prerequisites are ready for a target, it executes the corresponding recipe for the current target. For each target, the recipes are executed only if the target doesn’t exist or the pre-requisites are newer than the target. Our app has two targets. First, the dependencies must be installed and then the app can be run. Let’s create the rule for running the app first: run: python app.py The target is named run and it has no prerequisites, which it will be run every time you run make run. You can test it by running make run in a terminal. Create another target for the setup stage: setup: requirements.txt pip install -r requirements.txt The setup target depends on the requirements.txt file. Whenever the requirements.txt file changes, the dependencies will be refreshed by running pip install -r. Finally, let’s have a clean rule to clean up the __pycache__ folder: clean: rm -rf __pycache__ Creating a Virtual Environment The sample app depends on the requests library only. However, in a large project, there might be numerous dependencies. And if you are running multiple apps, it’s possible that some apps require the same dependencies, but a different version. This means that one Python installation may not be capable of satisfying the requirements of all applications. The solution for this is to use a virtual environment. This is a self-contained directory tree that contains a Python installation of a specific version. Different apps can use their own virtual environment where they can install their requirements. The virtual environments are isolated from each other, which means there will be no dependency conflicts. Python provides a module called venv which is used to create and manage virtual environments. Let’s see how a virtual environment can be used in the sample app. First, you need to create a virtual environment in the project root: python3 -m venv venv This creates a venv folder in your current directory, which contains the necessary files to make the virtual environment. There are two ways to use this virtual environment. Instead of using python3 or pip, you have to use ./venv/bin/python3 or ./venv/bin/pip to run the app or install dependencies: python3 app.py # Uses the system Python ./venv/bin/python3 # USes the virtualenv Python But writing ./venv.bin/ every time can be time consuming, especially if you have to run a lot of commands that use Python or pip. To overcome this, you can “activate” the virtual environment by running: ./venv/bin/activate This will load the virtual environment in the current shell. This environment will stay active as long as you don’t close the shell, or deactivate manually. Once activated, running python3 or pip will use the executables from the virtual environment. If you now run pip install -r requirements.txt, the modules will be installed in the venv directory. Once you are done with the virtual environment, you can deactivate the environment by running the deactivate command. venv in Make You can utilize make to automatically refresh your virtual environment and run your app with this virtual environment. To automatically reinstall the dependencies whenever the requirements.txt file changes, write the following in your Makefile: venv/bin/activate: requirements.txt python3 -m venv venv ./venv/bin/pip install -r requirements.txt Here the target is venv/bin/activate which depends on requirements.txt. Whenever requirements.txt changes, it rebuilds the environment and installs the dependencies with pip, which re-creates the activate. The actual goal here is the existence of the venv directory, but since make can only work with files, venv/bin/activate is used instead. To run the app with this environment, create the following rule: run: venv/bin/activate ./venv/bin/python3 app.py The run target depends on the venv/bin/activate target. Once that target is satisfied, it runs the app using the virtual environment. Finally, update the clean target to also delete the venv directory: clean: rm -rf __pycache__ rm -rf venv Let’s test this all out. First, delete the venv directory if you have one. Now run make run. Since the venv/bin/activate file does not exist, make will run the venv/bin/activate target, which will install the dependencies and finally run the app using the virtual environment. make run for Python venv If you run make run once again, only the app will be run and the virtual environment will not be refreshed. You can use the touch command to stimulate a change in the requiremenst.txt file which will cause make to run the setup step again - touch requirements.txt Now if you run make run, the virtual environment will be recreated and then the app will be run. Using Variables Observe that in our Makefile, we have references to the venv directory in multiple places. In future, if we want to change the directory name to something else, we have to remember to perform the change in all the places. Also there isn’t any way for the user to customize the directory name without editing the Makefile. To overcome this, we can use variables. The variables not only make the Makefile cleaner, they can be overridden by the user without editing Makefile. A variable in Makefile starts with a $ and is enclosed in parentheses () or braces {}, unless its a single character variable. To set a variable, write a line starting with a variable name followed by =, := or ::=, followed by the value of the variable: VENV = venv Here the variable VENV is set to venv. Now whenever you use this variable in a rule, it will be replaced by its value. The rules now can be rewritten using the VENV variable: VENV = venv PYTHON = $(VENV)/bin/python3 PIP = $(VENV)/bin/pip run: $(VENV)/bin/activate $(PYTHON) app.py $(VENV)/bin/activate: requirements.txt python3 -m venv $(VENV) $(PIP) install -r requirements.txt clean: rm -rf __pycache__ rm -rf $(VENV) I have also replaced references to python3 and pip with a variable. By default, they will use the binaries from the virtual environment. The variables can be overridden by providing the values when running the make command: make VENV=my_venv run Using VENV=my_venv overrides the default value of VENV and now the virtual environment will be created in my_venv directory. It is a good practice to use variables for all commands used in the Makefile, as well as their options and directories. This provides an easy way for the user to substitute alternatives. Phony Targets Your Makefile contains two special targets - run and clean. Special in the sense they don’t represent an actual file that exists. And since make executes the recipes of a target if that target does not exist, these two targets will always be executed. However, if later if you have a file called run or clean, then since these targets have no prerequisites, make will consider these to always be newer and so, will not execute the recipes. To overcome this, make has something called a Phony target. By declaring a target to be Phony, you tell make not to consider an existing file with the same name. To make the run and clean targets phony, add this to the top: .PHONY: run clean Conclusion Using make in your Python projects opens the door to lots of possibilities in terms of automation. You can use make to run linters like flake8, run tests using pytest, or run code coverage using coverage. If you wish to learn all the features of make, be sure to check out the manual by GNU. Being full of features, and primarily targeted towards compiled languages, make can be difficult to use in a Python project, especially in large ones. If you are looking for a solution to avoid the complexities of Makefile, while still retaining the powerful automation capabilities, check out Earthly. Earthly takes a modern approach towards project builds and combines the best of both Makefile and Dockerfile. Earthly provides understandable and repeatable build scripts without any complexity.</summary></entry><entry><title type="html">Creating a G++ Makefile</title><link href="https://earthly.dev/blog/g++-makefile/" rel="alternate" type="text/html" title="Creating a G++ Makefile" /><published>2021-07-06T00:00:00-04:00</published><updated>2021-07-06T00:00:00-04:00</updated><id>https://earthly.dev/blog/g++-makefile</id><content type="html" xml:base="https://earthly.dev/blog/g++-makefile/">&lt;p&gt;C++ is one of the &lt;a href=&quot;https://www.tiobe.com/tiobe-index/cplusplus/&quot;&gt;most dominant programming languages&lt;/a&gt;. Although there are many compilers available, &lt;a href=&quot;http://gcc.gnu.org/&quot;&gt;GCC&lt;/a&gt; still ranks as one of the most popular choices for C++. GCC is part of the GNU toolchain, which comes with utilities like GNU make, GNU bison, and GNU &lt;a href=&quot;/blog/autoconf&quot;&gt;AutoTools&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;what-is-gcc&quot;&gt;What Is GCC?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://gcc.gnu.org/&quot;&gt;GNU Compiler Collection&lt;/a&gt;, also known as GCC, started as a C compiler, created by Richard Stallman in 1984 as a part of his GNU project. GCC now supports many languages, including C++, Objective C, Java, Fortran, and Go. The latest version as of writing this article is GCC 11.1, released April 27, 2021.&lt;/p&gt;
&lt;p&gt;The C++ compiler of GCC is known as &lt;code&gt;g++&lt;/code&gt;. The &lt;code&gt;g++&lt;/code&gt; utility supports almost all mainstream C++ standards, including &lt;code&gt;c++98&lt;/code&gt;, &lt;code&gt;c++03&lt;/code&gt;, &lt;code&gt;c++11&lt;/code&gt;, &lt;code&gt;c++14&lt;/code&gt;, &lt;code&gt;c++17&lt;/code&gt;, and experimentally &lt;code&gt;c++20&lt;/code&gt; and &lt;code&gt;c++23&lt;/code&gt;. It also provides some GNU extensions to the standard to enable more useful features. You can check out the detailed standard support &lt;a href=&quot;https://gcc.gnu.org/projects/cxx-status.html&quot;&gt;on gnu.org&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In this tutorial, you will learn how to compile C++ programs with the &lt;code&gt;g++&lt;/code&gt; compiler provided by GCC, and how to use &lt;a href=&quot;https://www.gnu.org/software/make/&quot;&gt;Make&lt;/a&gt; to automate the compilation process.&lt;/p&gt;
&lt;h2 id=&quot;installing-gcc&quot;&gt;Installing GCC&lt;/h2&gt;
&lt;p&gt;I’ll touch briefly on installing for Linux, Mac, and Windows.&lt;/p&gt;
&lt;h3 id=&quot;linux&quot;&gt;Linux&lt;/h3&gt;
&lt;p&gt;GCC is one of the most common tools in the unix world, and is available in every single Linux distribution. Here, I show you how to install the GNU toolchain for some famous distributions.&lt;/p&gt;
&lt;p&gt;For Ubuntu, you need to run the following command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;sudo&lt;/span&gt; apt update &lt;span class=&quot;kw&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;sudo&lt;/span&gt; apt install build-essentials&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For Arch Linux, run:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;sudo&lt;/span&gt; pacman &lt;span class=&quot;at&quot;&gt;-S&lt;/span&gt; base-devel&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For &lt;a href=&quot;/blog/creating-and-hosting-your-own-rpm-packages-and-yum-repo&quot;&gt;Fedora&lt;/a&gt;, run:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;dnf&lt;/span&gt; groupinstall &lt;span class=&quot;st&quot;&gt;&amp;#39;Development Tools&amp;#39;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For other distributions, consult the official wiki of your distribution.&lt;/p&gt;
&lt;h3 id=&quot;mac&quot;&gt;Mac&lt;/h3&gt;
&lt;p&gt;To install GCC on Mac, run &lt;code&gt;brew install gcc&lt;/code&gt; which will place &lt;code&gt;g++-11&lt;/code&gt; in &lt;code&gt;/usr/local/bin&lt;/code&gt;. Then create an alias to &lt;code&gt;g++&lt;/code&gt;: &lt;code&gt;alias g++='g++-11'&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&quot;windows&quot;&gt;Windows&lt;/h3&gt;
&lt;p&gt;To use GCC in Windows, use &lt;a href=&quot;https://docs.microsoft.com/en-us/windows/wsl/install-win10&quot;&gt;WSL2&lt;/a&gt;. You can install GCC inside the Windows Subsystem for Linux (WSL) and use it from there.&lt;/p&gt;
&lt;h2 id=&quot;compiling-with-g&quot;&gt;Compiling With G++&lt;/h2&gt;
&lt;p&gt;Let’s take a look at how the compilation with G++ works. You will compile a simple &lt;code&gt;Hello, World!&lt;/code&gt; program. Save the following file as &lt;code&gt;hello.cpp&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode cpp&quot;&gt;&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include&lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; main&lt;span class=&quot;op&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;bu&quot;&gt;std::&lt;/span&gt;cout&lt;span class=&quot;op&quot;&gt; &amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;Hello, World!&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;std::&lt;/span&gt;endl&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To compile this file, simply pass this file to &lt;code&gt;g++&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;g++&lt;/span&gt; hello.cpp&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default, &lt;code&gt;g++&lt;/code&gt; will create an executable file named &lt;code&gt;a.out&lt;/code&gt;. You can change the output file name by passing the name to the &lt;code&gt;-o&lt;/code&gt; flag.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;g++&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-o&lt;/span&gt; hello hello.cpp&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will compile &lt;code&gt;hello.cpp&lt;/code&gt; to an executable named &lt;code&gt;hello&lt;/code&gt;. You can run the executable and see the output:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;./hello&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;the-compilation-process&quot;&gt;The Compilation Process&lt;/h2&gt;
&lt;p&gt;Although the compilation can be done with one command, the compilation process can be divided into four distinct phases:&lt;/p&gt;
&lt;ol type=&quot;1&quot;&gt;
&lt;li&gt;Preprocessing&lt;/li&gt;
&lt;li&gt;Compilation&lt;/li&gt;
&lt;li&gt;Assembly&lt;/li&gt;
&lt;li&gt;Linking&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In the preprocessing part, the GNU preprocessor (&lt;code&gt;cpp&lt;/code&gt;) is invoked, which copies the header files included via &lt;code&gt;#include&lt;/code&gt;, and expands all macros defined with &lt;code&gt;#define&lt;/code&gt;. You can perform this step manually by running the &lt;code&gt;cpp&lt;/code&gt; command.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;cpp&lt;/span&gt; hello.cpp &lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; hello.i&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The file &lt;code&gt;hello.i&lt;/code&gt; contains the preprocessed source code.&lt;/p&gt;
&lt;p&gt;In the next phase, the &lt;code&gt;g++&lt;/code&gt; compiler compiles the preprocessed source code to assembly language. You can run this step manually with the following command:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;g++&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-S&lt;/span&gt; hello.i&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;-S&lt;/code&gt; flag creates a file &lt;code&gt;hello.s&lt;/code&gt;, which contains the assembly code.&lt;/p&gt;
&lt;p&gt;In the next step, the assembler &lt;code&gt;as&lt;/code&gt; converts the assembly to machine code.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-o&lt;/span&gt; hello.o hello.s&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, the linker &lt;code&gt;ld&lt;/code&gt; links the object code with the library code to produce an executable.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;ld&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-o&lt;/span&gt; hello hello.o ...libraries...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;libraries&lt;/code&gt; argument above is a long list of libraries that you need to find out. I omitted the exact arguments because the list is really long and complicated, and depends on which libraries &lt;code&gt;g++&lt;/code&gt; is using on your system. If you are interested to find out, you can run the command &lt;code&gt;g++ -Q -v -o hello hello.cpp&lt;/code&gt; and take a look at the last line where &lt;code&gt;g++&lt;/code&gt; invokes &lt;code&gt;collect2&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;wide&quot;&gt;
&lt;figure&gt;
&lt;img src=&quot;/blog/assets/images/g++-makefile/libs.png&quot; alt=&quot;Libraries Used By g++&quot; /&gt;&lt;figcaption aria-hidden=&quot;true&quot;&gt;Libraries Used By g++&lt;/figcaption&gt;
&lt;/figure&gt;
&lt;/div&gt;
&lt;p&gt;Thankfully, you do not have to perform these steps manually, as invoking &lt;code&gt;g++&lt;/code&gt; itself will take care of all these steps.&lt;/p&gt;
&lt;h2 id=&quot;using-the-make-utility&quot;&gt;Using the &lt;code&gt;make&lt;/code&gt; Utility&lt;/h2&gt;
&lt;p&gt;Even though the compilation commands have been simple so far, this is not necessarily the case when you have multiple source files. As an example, consider this program:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode cpp&quot;&gt;&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;quot;func.h&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-2&quot;&gt;&lt;a href=&quot;#cb12-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-3&quot;&gt;&lt;a href=&quot;#cb12-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; main&lt;span class=&quot;op&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-4&quot;&gt;&lt;a href=&quot;#cb12-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    func&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-5&quot;&gt;&lt;a href=&quot;#cb12-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    func&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-6&quot;&gt;&lt;a href=&quot;#cb12-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb12-7&quot;&gt;&lt;a href=&quot;#cb12-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-8&quot;&gt;&lt;a href=&quot;#cb12-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;figcaption&gt;
&lt;code&gt;hello.cpp&lt;/code&gt;
&lt;/figcaption&gt;
&lt;p&gt;This file includes &lt;code&gt;func.h&lt;/code&gt;, which contains the declaration for a simple function:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode cpp&quot;&gt;&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#ifndef MAKE_GPP_FUNC&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#define MAKE_GPP_FUNC&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-3&quot;&gt;&lt;a href=&quot;#cb13-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-4&quot;&gt;&lt;a href=&quot;#cb13-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include&lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-5&quot;&gt;&lt;a href=&quot;#cb13-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-6&quot;&gt;&lt;a href=&quot;#cb13-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;void&lt;/span&gt; func&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-7&quot;&gt;&lt;a href=&quot;#cb13-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-8&quot;&gt;&lt;a href=&quot;#cb13-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#endif&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;figcaption&gt;
&lt;code&gt;func.h&lt;/code&gt;
&lt;/figcaption&gt;
&lt;p&gt;Finally, the definition of &lt;code&gt;func&lt;/code&gt; resides in &lt;code&gt;func.cpp&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode cpp&quot;&gt;&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;quot;func.h&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-3&quot;&gt;&lt;a href=&quot;#cb14-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;void&lt;/span&gt; func&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;op&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-4&quot;&gt;&lt;a href=&quot;#cb14-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;bu&quot;&gt;std::&lt;/span&gt;cout&lt;span class=&quot;op&quot;&gt; &amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;You passed: &amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; i &lt;span class=&quot;op&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;std::&lt;/span&gt;endl&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-5&quot;&gt;&lt;a href=&quot;#cb14-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;figcaption&gt;
&lt;code&gt;func.c&lt;/code&gt;
&lt;/figcaption&gt;
&lt;p&gt;In order to compile your program, you need to compile both &lt;code&gt;hello.cpp&lt;/code&gt; and &lt;code&gt;func.cpp&lt;/code&gt;, since the former depends on the latter.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ex&quot;&gt;g++&lt;/span&gt; &lt;span class=&quot;at&quot;&gt;-o&lt;/span&gt; hello hello.cpp func.cpp&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you have more files, then you need to list all of them, while taking care to set the correct include paths and library paths. Moreover, if your code uses any library, you need to list those libraries, too. The resultant command is likely massive and difficult to remember and type. Also, the compilation command will compile all of the source files every time it is executed. But if some of the source files haven’t been modified since the last compilation, it’s a waste of time and resources to compile all the files. But keeping track of what has changed manually is also a difficult task.&lt;/p&gt;
&lt;p&gt;This is where the &lt;code&gt;make&lt;/code&gt; utility helps. &lt;code&gt;make&lt;/code&gt; lets you define your target, and how to reach the target and what are the dependencies. Then it automatically keeps track of which dependencies have changed and recompiles only the necessary parts.&lt;/p&gt;
&lt;p&gt;So let’s see how you can utilize &lt;code&gt;make&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;the-makefile&quot;&gt;The Makefile&lt;/h2&gt;
&lt;p&gt;In order to let &lt;code&gt;make&lt;/code&gt; know what to do, you need to create a file named &lt;code&gt;Makefile&lt;/code&gt; in the root of your project. This file can also be named &lt;code&gt;makefile&lt;/code&gt; but is traditionally named &lt;code&gt;Makefile&lt;/code&gt; so that it appears near other important files such as &lt;code&gt;README&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Create an empty &lt;code&gt;Makefile&lt;/code&gt; in the project root and run the command &lt;code&gt;make&lt;/code&gt; from the project directory. You should see the following output:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;make: *** No targets. Stop.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It means &lt;code&gt;make&lt;/code&gt; has found the Makefile, but since it is empty, it doesn’t know what to do.&lt;/p&gt;
&lt;p&gt;Now let’s see how you can utilize Makefile to tell &lt;code&gt;make&lt;/code&gt; what to do. The Makefile consists of a set of rules. Each rule has three parts—a target, a list of prerequisites, and a recipe—like this:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb17&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb17-1&quot;&gt;&lt;a href=&quot;#cb17-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;target:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; pre-req1 pre-req2 pre-req3 ...&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb17-2&quot;&gt;&lt;a href=&quot;#cb17-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    recipes&lt;/span&gt;
&lt;span id=&quot;cb17-3&quot;&gt;&lt;a href=&quot;#cb17-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note that there are tabs before the recipe lists. You can’t use any other whitespace character. You must use &lt;a href=&quot;/blog/repeatable-builds-every-time/#tips-for-taming-makefiles-in-large-teams&quot;&gt;tabs&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;When &lt;code&gt;make&lt;/code&gt; executes a target, it looks at its prerequisites. If those prerequisites have their own recipes, &lt;code&gt;make&lt;/code&gt; executes them and when all the prerequisites are ready for a target, it executes the corresponding recipe for the current target. For each target, the recipes are executed only if the target doesn’t exist or the prerequisites are newer than the target.&lt;/p&gt;
&lt;p&gt;Let’s update the &lt;code&gt;Makefile&lt;/code&gt; for the example program:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb18&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb18-1&quot;&gt;&lt;a href=&quot;#cb18-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-2&quot;&gt;&lt;a href=&quot;#cb18-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-3&quot;&gt;&lt;a href=&quot;#cb18-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;hello:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello.o func.o&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-4&quot;&gt;&lt;a href=&quot;#cb18-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; g++ -o hello hello.o func.o&lt;/span&gt;
&lt;span id=&quot;cb18-5&quot;&gt;&lt;a href=&quot;#cb18-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-6&quot;&gt;&lt;a href=&quot;#cb18-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;func.o:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; func.cpp func.h&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-7&quot;&gt;&lt;a href=&quot;#cb18-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; g++ -c func.cpp&lt;/span&gt;
&lt;span id=&quot;cb18-8&quot;&gt;&lt;a href=&quot;#cb18-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-9&quot;&gt;&lt;a href=&quot;#cb18-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;hello.o:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello.cpp&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb18-10&quot;&gt;&lt;a href=&quot;#cb18-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; g++ -c hello.cpp&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, run the &lt;code&gt;make&lt;/code&gt; command again. You should see the commands being run by &lt;code&gt;make&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;g++ -c hello.cpp
g++ -c func.cpp
g++ -o hello hello.o func.o&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And you’ll notice that an executable called &lt;code&gt;hello&lt;/code&gt; has been created in the directory. So, how did &lt;code&gt;make&lt;/code&gt; do that? Let’s analyze.&lt;/p&gt;
&lt;p&gt;When you run &lt;code&gt;make&lt;/code&gt; without any arguments, it executes the first target. In the Makefile, the &lt;code&gt;all&lt;/code&gt; target has a prerequisite &lt;code&gt;hello&lt;/code&gt;. So, &lt;code&gt;make&lt;/code&gt; looks for a rule to create &lt;code&gt;hello&lt;/code&gt;. The rule &lt;code&gt;hello&lt;/code&gt; has two prerequisites &lt;code&gt;hello.o&lt;/code&gt; and &lt;code&gt;func.o&lt;/code&gt;. Now, the target &lt;code&gt;hello.o&lt;/code&gt; depends on &lt;code&gt;hello.cpp&lt;/code&gt; which exists and is newer than the target &lt;code&gt;hello.o&lt;/code&gt; (which does not exist). So, &lt;code&gt;make&lt;/code&gt; now executes the recipe for &lt;code&gt;hello.o&lt;/code&gt; and runs the command &lt;code&gt;g++ -c hello.cpp&lt;/code&gt;. This creates the &lt;code&gt;hello.o&lt;/code&gt; file.&lt;/p&gt;
&lt;p&gt;Now &lt;code&gt;make&lt;/code&gt; starts resolving &lt;code&gt;func.o&lt;/code&gt;. Both of its pre-requisites exist and are newer than the target. So &lt;code&gt;make&lt;/code&gt; executes the command &lt;code&gt;g++ -c func.cpp&lt;/code&gt;. Now that the target &lt;code&gt;hello&lt;/code&gt; has both the prerequisites satisfied, its recipe can be executed and the &lt;code&gt;hello&lt;/code&gt; file is created.&lt;/p&gt;
&lt;p&gt;Now what happens if one of the files is changed? Let’s change the &lt;code&gt;hello.cpp&lt;/code&gt; file and change the &lt;code&gt;func(10)&lt;/code&gt; line to &lt;code&gt;func(20)&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb20&quot;&gt;&lt;pre class=&quot;sourceCode cpp&quot;&gt;&lt;code class=&quot;sourceCode cpp&quot;&gt;&lt;span id=&quot;cb20-1&quot;&gt;&lt;a href=&quot;#cb20-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;pp&quot;&gt;#include &lt;/span&gt;&lt;span class=&quot;im&quot;&gt;&amp;quot;func.h&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-2&quot;&gt;&lt;a href=&quot;#cb20-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-3&quot;&gt;&lt;a href=&quot;#cb20-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;int&lt;/span&gt; main&lt;span class=&quot;op&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;{&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-4&quot;&gt;&lt;a href=&quot;#cb20-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    func&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-5&quot;&gt;&lt;a href=&quot;#cb20-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    func&lt;span class=&quot;op&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;);&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-6&quot;&gt;&lt;a href=&quot;#cb20-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;/span&gt;
&lt;span id=&quot;cb20-7&quot;&gt;&lt;a href=&quot;#cb20-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;cf&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;op&quot;&gt;;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb20-8&quot;&gt;&lt;a href=&quot;#cb20-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now if you run &lt;code&gt;make&lt;/code&gt;, you’ll notice that it does not execute all the steps:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;g++ -c hello.cpp
g++ -o hello hello.o func.o&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This time, &lt;code&gt;make&lt;/code&gt; does not compile &lt;code&gt;func.c&lt;/code&gt; because the file &lt;code&gt;func.o&lt;/code&gt; exists, and its prerequisites are not newer than itself. This is because you have not changed &lt;code&gt;func.cpp&lt;/code&gt; or &lt;code&gt;func.h&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;On the other hand, the file &lt;code&gt;hello.cpp&lt;/code&gt; is newer than &lt;code&gt;hello.o&lt;/code&gt;. So it needs to be recompiled, and when &lt;code&gt;hello.o&lt;/code&gt; is re-created, the target &lt;code&gt;hello&lt;/code&gt; needs to be executed, since it depends on &lt;code&gt;hello.o&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;You can also call &lt;code&gt;make&lt;/code&gt; with the name of a specific rule. For example, running &lt;code&gt;make func.o&lt;/code&gt; will only run the rule for &lt;code&gt;func.o&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;comments-in-makefile&quot;&gt;Comments in Makefile&lt;/h2&gt;
&lt;p&gt;You can have comments in Makefile, which start with a # and last till the end of the line.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb22&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb22-1&quot;&gt;&lt;a href=&quot;#cb22-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello &lt;/span&gt;&lt;span class=&quot;co&quot;&gt;# This is a comment&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-2&quot;&gt;&lt;a href=&quot;#cb22-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-3&quot;&gt;&lt;a href=&quot;#cb22-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;hello:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello.o&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb22-4&quot;&gt;&lt;a href=&quot;#cb22-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;using-variables&quot;&gt;Using Variables&lt;/h2&gt;
&lt;p&gt;Observe that in your Makefile, there are quite a lot of repetitions. For example:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb23&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb23-1&quot;&gt;&lt;a href=&quot;#cb23-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;func.o:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; func.cpp func.h&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb23-2&quot;&gt;&lt;a href=&quot;#cb23-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; g++ -c func.cpp&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this rule, we have the string &lt;code&gt;func&lt;/code&gt; repeated four times. Since here the base name of the source file and the compiled file are the same (&lt;code&gt;func&lt;/code&gt;), we can use variables to tidy up the rules. The variables not only make the Makefile cleaner, they can be overridden by the user so that they can customize the Makefile without editing it.&lt;/p&gt;
&lt;p&gt;A variable in Makefile starts with a &lt;code&gt;$&lt;/code&gt; and is enclosed in parentheses &lt;code&gt;()&lt;/code&gt;or braces &lt;code&gt;{}&lt;/code&gt;, unless it’s a single character variable.&lt;/p&gt;
&lt;p&gt;To set a variable, write a line starting with a variable name followed by &lt;code&gt;=&lt;/code&gt;, &lt;code&gt;:=&lt;/code&gt; or &lt;code&gt;::=&lt;/code&gt;, followed by the value of the variable:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb24&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb24-1&quot;&gt;&lt;a href=&quot;#cb24-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;objects &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; hello.o func.o&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here the variable &lt;code&gt;objects&lt;/code&gt; is set to &lt;code&gt;hello.o func.o&lt;/code&gt;. Now whenever you use this variable in a rule, it will be replaced by its value.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb25&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb25-1&quot;&gt;&lt;a href=&quot;#cb25-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;objects &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; hello.o func.o&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-2&quot;&gt;&lt;a href=&quot;#cb25-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-3&quot;&gt;&lt;a href=&quot;#cb25-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-4&quot;&gt;&lt;a href=&quot;#cb25-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-5&quot;&gt;&lt;a href=&quot;#cb25-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;hello:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;objects&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb25-6&quot;&gt;&lt;a href=&quot;#cb25-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    g++ -o hello &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;objects&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the same as writing:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb26&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb26-1&quot;&gt;&lt;a href=&quot;#cb26-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;hello:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello.o func.o&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb26-2&quot;&gt;&lt;a href=&quot;#cb26-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    g++ -o hello hello.o func.o&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There is another way of defining variables using the &lt;code&gt;?=&lt;/code&gt; operator. This defines the variable only if it has not been defined before.&lt;/p&gt;
&lt;p&gt;When you invoke &lt;code&gt;make&lt;/code&gt;, it converts all the environment variables available to it with a &lt;code&gt;make&lt;/code&gt; variable with the same name and value. This means you can set variables using environment variables. Also, you can override any variable by passing them while invoking make. For example, the &lt;code&gt;g++&lt;/code&gt; command can be invoked through a variable.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb27&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb27-1&quot;&gt;&lt;a href=&quot;#cb27-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;CXX &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; g++&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-2&quot;&gt;&lt;a href=&quot;#cb27-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dt&quot;&gt;objects &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;st&quot;&gt; hello.o func.o&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-3&quot;&gt;&lt;a href=&quot;#cb27-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-4&quot;&gt;&lt;a href=&quot;#cb27-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;all:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; hello&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-5&quot;&gt;&lt;a href=&quot;#cb27-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-6&quot;&gt;&lt;a href=&quot;#cb27-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;hello:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; &lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;objects&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb27-7&quot;&gt;&lt;a href=&quot;#cb27-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;CXX&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt; -o &lt;span class=&quot;ch&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt;objects&lt;/span&gt;&lt;span class=&quot;ch&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now running &lt;code&gt;make&lt;/code&gt; will compile the files with &lt;code&gt;g++&lt;/code&gt;. However, the user can now substitute alternative if they want to.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb28&quot;&gt;&lt;pre class=&quot;sourceCode bash&quot;&gt;&lt;code class=&quot;sourceCode bash&quot;&gt;&lt;span id=&quot;cb28-1&quot;&gt;&lt;a href=&quot;#cb28-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fu&quot;&gt;make&lt;/span&gt; CXX=clang++&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now the files will be compiled by &lt;code&gt;clang++&lt;/code&gt; since &lt;code&gt;CXX=clang++&lt;/code&gt; overrides the variable &lt;code&gt;CXX&lt;/code&gt; defined in the Makefile.&lt;/p&gt;
&lt;h2 id=&quot;phony-target&quot;&gt;Phony Target&lt;/h2&gt;
&lt;p&gt;So far, you have only created files, but &lt;code&gt;make&lt;/code&gt; can also “clean” files. Usually it’s a good idea to have a &lt;code&gt;clean&lt;/code&gt; target to delete all the generated files, basically returning the project to a clean slate.&lt;/p&gt;
&lt;p&gt;Here is an example for your Makefile:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb29&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb29-1&quot;&gt;&lt;a href=&quot;#cb29-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb29-2&quot;&gt;&lt;a href=&quot;#cb29-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    rm *.o hello&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can run it via &lt;code&gt;make clean&lt;/code&gt;. This cleans all the &lt;code&gt;.o&lt;/code&gt; files and the &lt;code&gt;hello&lt;/code&gt; file. Because the &lt;code&gt;rm&lt;/code&gt; command does not create a file named &lt;code&gt;clean&lt;/code&gt;, the &lt;code&gt;rm&lt;/code&gt; command will be executed every time you invoke &lt;code&gt;make clean&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;But if you ever create a file called &lt;code&gt;clean&lt;/code&gt; in the directory, &lt;code&gt;make&lt;/code&gt; will get confused. Since the &lt;code&gt;clean&lt;/code&gt; file is there, and the &lt;code&gt;clean&lt;/code&gt; target has no prerequisites, it is always considered to be newer than its prerequisites. Therefore, the recipe will not run.&lt;/p&gt;
&lt;p&gt;The same problem will arise with the &lt;code&gt;all&lt;/code&gt; target if there is ever a file named &lt;code&gt;all&lt;/code&gt;. To fix this, you can declare the targets to be “phony”.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb30&quot;&gt;&lt;pre class=&quot;sourceCode makefile&quot;&gt;&lt;code class=&quot;sourceCode makefile&quot;&gt;&lt;span id=&quot;cb30-1&quot;&gt;&lt;a href=&quot;#cb30-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;ot&quot;&gt;.PHONY:&lt;/span&gt;&lt;span class=&quot;dt&quot;&gt; all clean&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb30-2&quot;&gt;&lt;a href=&quot;#cb30-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb30-3&quot;&gt;&lt;a href=&quot;#cb30-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;dv&quot;&gt;clean:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb30-4&quot;&gt;&lt;a href=&quot;#cb30-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    rm *.o hello&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Makefile is one of the most important components of compiling C++ using &lt;code&gt;g++&lt;/code&gt;. It makes compilation easy and predictable and also saves time and resources by compiling only the necessary files. In this tutorial you learned how to install &lt;code&gt;g++&lt;/code&gt;, and compile C++ programs with &lt;code&gt;g++&lt;/code&gt;. You also learned how to write Makefiles and utilize &lt;code&gt;make&lt;/code&gt; for increased productivity and automation.&lt;/p&gt;
&lt;p&gt;Because &lt;code&gt;make&lt;/code&gt; is a feature rich utility and supports a wide range of systems, it has a steep learning curve. As your project grows in size, the Makefile also grows in complexity. If you are looking for a solution to avoid the complexities of Makefile, check out &lt;a href=&quot;https://earthly.dev/&quot;&gt;Earthly&lt;/a&gt;. Earthly takes the best ideas from Makefile and Dockerfile, and provides understandable and repeatable build scripts, minus the head-scratching parts of the Makefile.&lt;/p&gt;</content><author><name>Aniket Bhattacharyea</name></author><category term="Tutorials" /><summary type="html">C++ is one of the most dominant programming languages. Although there are many compilers available, GCC still ranks as one of the most popular choices for C++. GCC is part of the GNU toolchain, which comes with utilities like GNU make, GNU bison, and GNU AutoTools. What Is GCC? GNU Compiler Collection, also known as GCC, started as a C compiler, created by Richard Stallman in 1984 as a part of his GNU project. GCC now supports many languages, including C++, Objective C, Java, Fortran, and Go. The latest version as of writing this article is GCC 11.1, released April 27, 2021. The C++ compiler of GCC is known as g++. The g++ utility supports almost all mainstream C++ standards, including c++98, c++03, c++11, c++14, c++17, and experimentally c++20 and c++23. It also provides some GNU extensions to the standard to enable more useful features. You can check out the detailed standard support on gnu.org. In this tutorial, you will learn how to compile C++ programs with the g++ compiler provided by GCC, and how to use Make to automate the compilation process. Installing GCC I’ll touch briefly on installing for Linux, Mac, and Windows. Linux GCC is one of the most common tools in the unix world, and is available in every single Linux distribution. Here, I show you how to install the GNU toolchain for some famous distributions. For Ubuntu, you need to run the following command: sudo apt update &amp;amp;&amp;amp; sudo apt install build-essentials For Arch Linux, run: sudo pacman -S base-devel For Fedora, run: dnf groupinstall &amp;#39;Development Tools&amp;#39; For other distributions, consult the official wiki of your distribution. Mac To install GCC on Mac, run brew install gcc which will place g++-11 in /usr/local/bin. Then create an alias to g++: alias g++='g++-11'. Windows To use GCC in Windows, use WSL2. You can install GCC inside the Windows Subsystem for Linux (WSL) and use it from there. Compiling With G++ Let’s take a look at how the compilation with G++ works. You will compile a simple Hello, World! program. Save the following file as hello.cpp: #include&amp;lt;iostream&amp;gt; int main() { std::cout &amp;lt;&amp;lt; &amp;quot;Hello, World!&amp;quot; &amp;lt;&amp;lt; std::endl; return 0; } To compile this file, simply pass this file to g++: g++ hello.cpp By default, g++ will create an executable file named a.out. You can change the output file name by passing the name to the -o flag. g++ -o hello hello.cpp This will compile hello.cpp to an executable named hello. You can run the executable and see the output: ./hello The Compilation Process Although the compilation can be done with one command, the compilation process can be divided into four distinct phases: Preprocessing Compilation Assembly Linking In the preprocessing part, the GNU preprocessor (cpp) is invoked, which copies the header files included via #include, and expands all macros defined with #define. You can perform this step manually by running the cpp command. cpp hello.cpp &amp;gt; hello.i The file hello.i contains the preprocessed source code. In the next phase, the g++ compiler compiles the preprocessed source code to assembly language. You can run this step manually with the following command: g++ -S hello.i The -S flag creates a file hello.s, which contains the assembly code. In the next step, the assembler as converts the assembly to machine code. as -o hello.o hello.s Finally, the linker ld links the object code with the library code to produce an executable. ld -o hello hello.o ...libraries... The libraries argument above is a long list of libraries that you need to find out. I omitted the exact arguments because the list is really long and complicated, and depends on which libraries g++ is using on your system. If you are interested to find out, you can run the command g++ -Q -v -o hello hello.cpp and take a look at the last line where g++ invokes collect2 Libraries Used By g++ Thankfully, you do not have to perform these steps manually, as invoking g++ itself will take care of all these steps. Using the make Utility Even though the compilation commands have been simple so far, this is not necessarily the case when you have multiple source files. As an example, consider this program: #include &amp;quot;func.h&amp;quot; int main() { func(10); func(100); return 0; } hello.cpp This file includes func.h, which contains the declaration for a simple function: #ifndef MAKE_GPP_FUNC #define MAKE_GPP_FUNC #include&amp;lt;iostream&amp;gt; void func(int i); #endif func.h Finally, the definition of func resides in func.cpp: #include &amp;quot;func.h&amp;quot; void func(int i) { std::cout &amp;lt;&amp;lt; &amp;quot;You passed: &amp;quot; &amp;lt;&amp;lt; i &amp;lt;&amp;lt; std::endl; } func.c In order to compile your program, you need to compile both hello.cpp and func.cpp, since the former depends on the latter. g++ -o hello hello.cpp func.cpp If you have more files, then you need to list all of them, while taking care to set the correct include paths and library paths. Moreover, if your code uses any library, you need to list those libraries, too. The resultant command is likely massive and difficult to remember and type. Also, the compilation command will compile all of the source files every time it is executed. But if some of the source files haven’t been modified since the last compilation, it’s a waste of time and resources to compile all the files. But keeping track of what has changed manually is also a difficult task. This is where the make utility helps. make lets you define your target, and how to reach the target and what are the dependencies. Then it automatically keeps track of which dependencies have changed and recompiles only the necessary parts. So let’s see how you can utilize make. The Makefile In order to let make know what to do, you need to create a file named Makefile in the root of your project. This file can also be named makefile but is traditionally named Makefile so that it appears near other important files such as README. Create an empty Makefile in the project root and run the command make from the project directory. You should see the following output: make: *** No targets. Stop. It means make has found the Makefile, but since it is empty, it doesn’t know what to do. Now let’s see how you can utilize Makefile to tell make what to do. The Makefile consists of a set of rules. Each rule has three parts—a target, a list of prerequisites, and a recipe—like this: target: pre-req1 pre-req2 pre-req3 ... recipes ... Note that there are tabs before the recipe lists. You can’t use any other whitespace character. You must use tabs. When make executes a target, it looks at its prerequisites. If those prerequisites have their own recipes, make executes them and when all the prerequisites are ready for a target, it executes the corresponding recipe for the current target. For each target, the recipes are executed only if the target doesn’t exist or the prerequisites are newer than the target. Let’s update the Makefile for the example program: all: hello hello: hello.o func.o g++ -o hello hello.o func.o func.o: func.cpp func.h g++ -c func.cpp hello.o: hello.cpp g++ -c hello.cpp Now, run the make command again. You should see the commands being run by make: g++ -c hello.cpp g++ -c func.cpp g++ -o hello hello.o func.o And you’ll notice that an executable called hello has been created in the directory. So, how did make do that? Let’s analyze. When you run make without any arguments, it executes the first target. In the Makefile, the all target has a prerequisite hello. So, make looks for a rule to create hello. The rule hello has two prerequisites hello.o and func.o. Now, the target hello.o depends on hello.cpp which exists and is newer than the target hello.o (which does not exist). So, make now executes the recipe for hello.o and runs the command g++ -c hello.cpp. This creates the hello.o file. Now make starts resolving func.o. Both of its pre-requisites exist and are newer than the target. So make executes the command g++ -c func.cpp. Now that the target hello has both the prerequisites satisfied, its recipe can be executed and the hello file is created. Now what happens if one of the files is changed? Let’s change the hello.cpp file and change the func(10) line to func(20): #include &amp;quot;func.h&amp;quot; int main() { func(20); func(100); return 0; } Now if you run make, you’ll notice that it does not execute all the steps: g++ -c hello.cpp g++ -o hello hello.o func.o This time, make does not compile func.c because the file func.o exists, and its prerequisites are not newer than itself. This is because you have not changed func.cpp or func.h. On the other hand, the file hello.cpp is newer than hello.o. So it needs to be recompiled, and when hello.o is re-created, the target hello needs to be executed, since it depends on hello.o. You can also call make with the name of a specific rule. For example, running make func.o will only run the rule for func.o Comments in Makefile You can have comments in Makefile, which start with a # and last till the end of the line. all: hello # This is a comment hello: hello.o ... Using Variables Observe that in your Makefile, there are quite a lot of repetitions. For example: func.o: func.cpp func.h g++ -c func.cpp In this rule, we have the string func repeated four times. Since here the base name of the source file and the compiled file are the same (func), we can use variables to tidy up the rules. The variables not only make the Makefile cleaner, they can be overridden by the user so that they can customize the Makefile without editing it. A variable in Makefile starts with a $ and is enclosed in parentheses ()or braces {}, unless it’s a single character variable. To set a variable, write a line starting with a variable name followed by =, := or ::=, followed by the value of the variable: objects = hello.o func.o Here the variable objects is set to hello.o func.o. Now whenever you use this variable in a rule, it will be replaced by its value. objects = hello.o func.o all: hello hello: $(objects) g++ -o hello $(objects) This is the same as writing: hello: hello.o func.o g++ -o hello hello.o func.o There is another way of defining variables using the ?= operator. This defines the variable only if it has not been defined before. When you invoke make, it converts all the environment variables available to it with a make variable with the same name and value. This means you can set variables using environment variables. Also, you can override any variable by passing them while invoking make. For example, the g++ command can be invoked through a variable. CXX = g++ objects = hello.o func.o all: hello hello: $(objects) $(CXX) -o $(objects) Now running make will compile the files with g++. However, the user can now substitute alternative if they want to. make CXX=clang++ Now the files will be compiled by clang++ since CXX=clang++ overrides the variable CXX defined in the Makefile. Phony Target So far, you have only created files, but make can also “clean” files. Usually it’s a good idea to have a clean target to delete all the generated files, basically returning the project to a clean slate. Here is an example for your Makefile: clean: rm *.o hello You can run it via make clean. This cleans all the .o files and the hello file. Because the rm command does not create a file named clean, the rm command will be executed every time you invoke make clean. But if you ever create a file called clean in the directory, make will get confused. Since the clean file is there, and the clean target has no prerequisites, it is always considered to be newer than its prerequisites. Therefore, the recipe will not run. The same problem will arise with the all target if there is ever a file named all. To fix this, you can declare the targets to be “phony”. .PHONY: all clean clean: rm *.o hello Conclusion Makefile is one of the most important components of compiling C++ using g++. It makes compilation easy and predictable and also saves time and resources by compiling only the necessary files. In this tutorial you learned how to install g++, and compile C++ programs with g++. You also learned how to write Makefiles and utilize make for increased productivity and automation. Because make is a feature rich utility and supports a wide range of systems, it has a steep learning curve. As your project grows in size, the Makefile also grows in complexity. If you are looking for a solution to avoid the complexities of Makefile, check out Earthly. Earthly takes the best ideas from Makefile and Dockerfile, and provides understandable and repeatable build scripts, minus the head-scratching parts of the Makefile.</summary></entry><entry><title type="html">Python Concatenate Lists</title><link href="https://earthly.dev/blog/python-concatenate-lists/" rel="alternate" type="text/html" title="Python Concatenate Lists" /><published>2021-07-06T00:00:00-04:00</published><updated>2021-07-06T00:00:00-04:00</updated><id>https://earthly.dev/blog/python-concatenate-lists</id><content type="html" xml:base="https://earthly.dev/blog/python-concatenate-lists/">&lt;div class=&quot;narrow-code&quot;&gt;

&lt;h2 id=&quot;concatenate-two-lists-in-python&quot;&gt;Concatenate Two Lists in Python&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Problem:&lt;/strong&gt; You have two lists and you’d like to join them into a new list. Solution:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;Python &lt;span class=&quot;fl&quot;&gt;3.8.2&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; one &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; two &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; one &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; two&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;four&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;five&amp;#39;&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;notice--warning notice--big&quot;&gt;
&lt;p&gt;&lt;strong&gt;📢 TLDR: Use &lt;code&gt;+&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In almost all simple situations, &lt;strong&gt;using &lt;code&gt;list1 + list2&lt;/code&gt; is the way you want to concatenate lists&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;The edge cases below are better in some situations, but &lt;code&gt;+&lt;/code&gt; is generally the best choice. All options covered work in Python 2.3, Python 2.7, and all versions of Python 3&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;combine-lists-in-place-in-python&quot;&gt;Combine Lists In Place In Python&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Problem:&lt;/strong&gt; You have a huge list, and you want to add a smaller list on the end while minimizing memory usage.&lt;/p&gt;
&lt;p&gt;In this case, it may be best to append to the existing list, reusing it instead of recreating a new list.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;longlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, ... ]&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;shortlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; x.extend(y)&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; x&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;,  ..., &lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As with any optimization, you should verify that this reduces memory thrash in your specific case and stick to the simple idiomatic &lt;code&gt;x + y&lt;/code&gt; otherwise.&lt;/p&gt;
&lt;p&gt;Let’s use the &lt;a href=&quot;https://docs.python.org/3/library/timeit.html&quot;&gt;&lt;code&gt;timeit&lt;/code&gt;&lt;/a&gt; module to check some performance numbers.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# Performance Check&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; setup &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;x = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;,&amp;quot;three&amp;quot;] * 1000 &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;y = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;,&amp;quot;six&amp;quot;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# x + y with large x&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;x + y&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1000000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;3.6260274310000113&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# x.extend(y) with large x&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-10&quot;&gt;&lt;a href=&quot;#cb3-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;x.extend(y)&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1000000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb3-11&quot;&gt;&lt;a href=&quot;#cb3-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;0.06857255800002804&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this example, where x is 3000 elements, extend is around 50x faster.&lt;/p&gt;
&lt;div class=&quot;notice--info&quot;&gt;
&lt;p&gt;&lt;strong&gt;❗ Concatenating Lists With Large Elements is Fine&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If the elements in your list are huge (million character strings), but the list size is less than a thousand elements, the previous solution &lt;code&gt;x + y&lt;/code&gt; will work just fine. This is because Python stores references to the values in the list, not the values themselves. Thus, the element size makes no difference to the runtime complexity.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; x &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; y &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;#This is fine&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; z &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; x &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; y&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;#Performance Testing (extend is slower for large elements)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-6&quot;&gt;&lt;a href=&quot;#cb4-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;  setup &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-7&quot;&gt;&lt;a href=&quot;#cb4-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;x = [&amp;quot;one&amp;quot; * 1000, &amp;quot;two&amp;quot; * 1000, &amp;quot;three&amp;quot; * 1000]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-8&quot;&gt;&lt;a href=&quot;#cb4-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;y = [&amp;quot;four&amp;quot; * 1000, &amp;quot;five&amp;quot; * 1000]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-9&quot;&gt;&lt;a href=&quot;#cb4-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-10&quot;&gt;&lt;a href=&quot;#cb4-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;x + y&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1000000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-11&quot;&gt;&lt;a href=&quot;#cb4-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;0.05397573999994165&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-12&quot;&gt;&lt;a href=&quot;#cb4-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;x.extend(y)&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1000000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb4-13&quot;&gt;&lt;a href=&quot;#cb4-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;0.06511967799997365&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In this case, &lt;code&gt;extend&lt;/code&gt; does not have an advantage.&lt;/p&gt;
&lt;/div&gt;
&lt;h3 id=&quot;avoid-chain-from-itertools-for-two-lists&quot;&gt;Avoid Chain From &lt;code&gt;itertools&lt;/code&gt; For Two Lists&lt;/h3&gt;
&lt;p&gt;It is possible to use &lt;code&gt;chain&lt;/code&gt; from &lt;code&gt;itertools&lt;/code&gt; to create an iterable of two lists.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;longlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;,, .......... ]&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;shortlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; itertools &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; chain&lt;/span&gt;
&lt;span id=&quot;cb5-6&quot;&gt;&lt;a href=&quot;#cb5-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; z &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(chain(longlist, shortlist)&lt;/span&gt;
&lt;span id=&quot;cb5-7&quot;&gt;&lt;a href=&quot;#cb5-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, , .........., &lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can check the performance of using chain:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb6&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb6-1&quot;&gt;&lt;a href=&quot;#cb6-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; setup &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-2&quot;&gt;&lt;a href=&quot;#cb6-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;from itertools import chain&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-3&quot;&gt;&lt;a href=&quot;#cb6-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;x = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;,&amp;quot;three&amp;quot;] * 1000 &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-4&quot;&gt;&lt;a href=&quot;#cb6-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;y = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;,&amp;quot;six&amp;quot;]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-5&quot;&gt;&lt;a href=&quot;#cb6-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-6&quot;&gt;&lt;a href=&quot;#cb6-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# x + y with large x&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-7&quot;&gt;&lt;a href=&quot;#cb6-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;# x.extend(y) with large x&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-8&quot;&gt;&lt;a href=&quot;#cb6-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;x.extend(y)&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1000000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb6-9&quot;&gt;&lt;a href=&quot;#cb6-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;0.06857255800002804&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb6-10&quot;&gt;&lt;a href=&quot;#cb6-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;list(chain(x, y))&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;1000000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb6-11&quot;&gt;&lt;a href=&quot;#cb6-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;16.810488051999982&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;code&gt;chain&lt;/code&gt; with two lists is slower in all cases tested, and &lt;code&gt;x + y&lt;/code&gt; is easier to understand.&lt;/p&gt;
&lt;h2 id=&quot;combining-n-lists-in-python&quot;&gt;Combining N Lists in Python&lt;/h2&gt;
&lt;p&gt;If you need to add three or even ten lists together and the lists are statically known, then &lt;code&gt;+&lt;/code&gt; for concatenate works great.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb7&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb7-1&quot;&gt;&lt;a href=&quot;#cb7-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; one &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb7-2&quot;&gt;&lt;a href=&quot;#cb7-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; two &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb7-3&quot;&gt;&lt;a href=&quot;#cb7-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; three &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb7-4&quot;&gt;&lt;a href=&quot;#cb7-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; z &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; one &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; two &lt;span class=&quot;op&quot;&gt;+&lt;/span&gt; three&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;flatten-a-list-of-lists-in-python&quot;&gt;Flatten a List of Lists in Python&lt;/h2&gt;
&lt;p&gt;However, if the number of lists is dynamic and unknown until runtime, &lt;code&gt;chain&lt;/code&gt; from &lt;code&gt;itertools&lt;/code&gt; becomes a great option. Chain takes a list of lists and flattens it into a single list.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb8&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb8-1&quot;&gt;&lt;a href=&quot;#cb8-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; l &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [[&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;],[&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;],[]] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;99&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb8-2&quot;&gt;&lt;a href=&quot;#cb8-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;], [&lt;span class=&quot;st&quot;&gt;&amp;#39;four&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;five&amp;#39;&lt;/span&gt;], [], ...&lt;/span&gt;
&lt;span id=&quot;cb8-3&quot;&gt;&lt;a href=&quot;#cb8-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(chain.from_iterable(l))&lt;/span&gt;
&lt;span id=&quot;cb8-4&quot;&gt;&lt;a href=&quot;#cb8-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;four&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;five&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, ... ]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;chain&lt;/code&gt; can take anything iterable, making it an excellent choice for combining lists, dictionaries, and other iterable structures.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb9&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb9-1&quot;&gt;&lt;a href=&quot;#cb9-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;im&quot;&gt;from&lt;/span&gt; itertools &lt;span class=&quot;im&quot;&gt;import&lt;/span&gt; chain&lt;/span&gt;
&lt;span id=&quot;cb9-2&quot;&gt;&lt;a href=&quot;#cb9-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; one &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;]&lt;/span&gt;
&lt;span id=&quot;cb9-3&quot;&gt;&lt;a href=&quot;#cb9-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; two &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; {&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;}&lt;/span&gt;
&lt;span id=&quot;cb9-4&quot;&gt;&lt;a href=&quot;#cb9-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(chain(one, two, one))&lt;/span&gt;
&lt;span id=&quot;cb9-5&quot;&gt;&lt;a href=&quot;#cb9-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;[&lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;performance-of-flattening-a-list-of-lists&quot;&gt;Performance of Flattening a List of Lists&lt;/h3&gt;
&lt;p&gt;Performance doesn’t always matter, but readability always does, and the chain method is a straightforward way to combine lists of lists. That said, let’s put readability aside for a moment and try to find the fastest way to flatten lists.&lt;/p&gt;
&lt;p&gt;One option is iterating ourselves:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb10&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb10-1&quot;&gt;&lt;a href=&quot;#cb10-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;result &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; []&lt;/span&gt;
&lt;span id=&quot;cb10-2&quot;&gt;&lt;a href=&quot;#cb10-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; nestedlist &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; l:&lt;/span&gt;
&lt;span id=&quot;cb10-3&quot;&gt;&lt;a href=&quot;#cb10-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    result.extend(nestedlist)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let’s check its performance vs chain:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb11&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb11-1&quot;&gt;&lt;a href=&quot;#cb11-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; setup &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-2&quot;&gt;&lt;a href=&quot;#cb11-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;from itertools import chain&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-3&quot;&gt;&lt;a href=&quot;#cb11-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;l = [[&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] * 99&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-4&quot;&gt;&lt;a href=&quot;#cb11-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-5&quot;&gt;&lt;a href=&quot;#cb11-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;# Add Nested Lists using chain.from_iterable&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-6&quot;&gt;&lt;a href=&quot;#cb11-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;list(chain.from_iterable(l))&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb11-7&quot;&gt;&lt;a href=&quot;#cb11-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;1.0384087909997106&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-8&quot;&gt;&lt;a href=&quot;#cb11-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;### Add using our own iteration&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-9&quot;&gt;&lt;a href=&quot;#cb11-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; run &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-10&quot;&gt;&lt;a href=&quot;#cb11-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;result = []&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-11&quot;&gt;&lt;a href=&quot;#cb11-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;for nestedlist in l:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-12&quot;&gt;&lt;a href=&quot;#cb11-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;    result.extend(nestedlist)  &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-13&quot;&gt;&lt;a href=&quot;#cb11-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb11-14&quot;&gt;&lt;a href=&quot;#cb11-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(run, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb11-15&quot;&gt;&lt;a href=&quot;#cb11-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;1.8619721710001613&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This shows that &lt;code&gt;chain.from_iterable&lt;/code&gt; is faster than extend.&lt;/p&gt;
&lt;h2 id=&quot;flattening-and-merging-lists-with-one-big-list&quot;&gt;Flattening and Merging Lists With One Big List&lt;/h2&gt;
&lt;p&gt;What about adding a list of lists to an existing and large list? We saw that using extend can be faster with two lists when one is significantly longer than the other so let’s test the performance of &lt;code&gt;extend&lt;/code&gt; with N lists.&lt;/p&gt;
&lt;p&gt;First, we use our standard &lt;code&gt;chain.from_iterable&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb12&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb12-1&quot;&gt;&lt;a href=&quot;#cb12-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;# Method 1 - chain.from_iterable &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-2&quot;&gt;&lt;a href=&quot;#cb12-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; longlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb12-3&quot;&gt;&lt;a href=&quot;#cb12-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; nestedlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [longlist, [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;],[&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;],[]]&lt;/span&gt;
&lt;span id=&quot;cb12-4&quot;&gt;&lt;a href=&quot;#cb12-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;bu&quot;&gt;list&lt;/span&gt;(chain.from_iterable(nestedlist))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We then test its performance:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb13&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb13-1&quot;&gt;&lt;a href=&quot;#cb13-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; setup &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-2&quot;&gt;&lt;a href=&quot;#cb13-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;from itertools import chain&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-3&quot;&gt;&lt;a href=&quot;#cb13-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-4&quot;&gt;&lt;a href=&quot;#cb13-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;combinedlist = [longlist, [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-5&quot;&gt;&lt;a href=&quot;#cb13-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb13-6&quot;&gt;&lt;a href=&quot;#cb13-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(&lt;span class=&quot;st&quot;&gt;&amp;#39;list(chain.from_iterable(combinedlist))&amp;#39;&lt;/span&gt;, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100000&lt;/span&gt;)&lt;/span&gt;
&lt;span id=&quot;cb13-7&quot;&gt;&lt;a href=&quot;#cb13-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;1.8676087710009597&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, let’s try concatenating by adding everything onto the long list:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb14&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb14-1&quot;&gt;&lt;a href=&quot;#cb14-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;co&quot;&gt;# Method 2 - extend&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-2&quot;&gt;&lt;a href=&quot;#cb14-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;  longlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;] &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1000&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb14-3&quot;&gt;&lt;a href=&quot;#cb14-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;  nestedlist &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; [[&lt;span class=&quot;st&quot;&gt;&amp;quot;one&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;two&amp;quot;&lt;/span&gt;, &lt;span class=&quot;st&quot;&gt;&amp;quot;three&amp;quot;&lt;/span&gt;],[&lt;span class=&quot;st&quot;&gt;&amp;quot;four&amp;quot;&lt;/span&gt;,&lt;span class=&quot;st&quot;&gt;&amp;quot;five&amp;quot;&lt;/span&gt;],[]]&lt;/span&gt;
&lt;span id=&quot;cb14-4&quot;&gt;&lt;a href=&quot;#cb14-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;  &lt;span class=&quot;cf&quot;&gt;for&lt;/span&gt; item &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; nestedlist:&lt;/span&gt;
&lt;span id=&quot;cb14-5&quot;&gt;&lt;a href=&quot;#cb14-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;     longlist.extent(item)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Performance Test:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb15&quot;&gt;&lt;pre class=&quot;sourceCode python&quot;&gt;&lt;code class=&quot;sourceCode python&quot;&gt;&lt;span id=&quot;cb15-1&quot;&gt;&lt;a href=&quot;#cb15-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; setup &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-2&quot;&gt;&lt;a href=&quot;#cb15-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;from itertools import chain&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-3&quot;&gt;&lt;a href=&quot;#cb15-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-4&quot;&gt;&lt;a href=&quot;#cb15-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;nestedlist = [[&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]]&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-5&quot;&gt;&lt;a href=&quot;#cb15-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-6&quot;&gt;&lt;a href=&quot;#cb15-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; run &lt;span class=&quot;op&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st&quot;&gt;&amp;quot;&amp;quot;&amp;quot;\&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-7&quot;&gt;&lt;a href=&quot;#cb15-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;for item in nestedlist:&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-8&quot;&gt;&lt;a href=&quot;#cb15-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;   longlist.extend(item)&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-9&quot;&gt;&lt;a href=&quot;#cb15-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;st&quot;&gt;   &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb15-10&quot;&gt;&lt;a href=&quot;#cb15-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;op&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; timeit.timeit(run, setup&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;setup, number&lt;span class=&quot;op&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;dv&quot;&gt;100000&lt;/span&gt;) &lt;/span&gt;
&lt;span id=&quot;cb15-11&quot;&gt;&lt;a href=&quot;#cb15-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;fl&quot;&gt;0.02403609199973289&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There we go, &lt;code&gt;extend&lt;/code&gt; is much faster when flattening lists or concatenating many lists with one long list. If you encounter this, using &lt;code&gt;extend&lt;/code&gt; to add the smaller lists to the long list can decrease the work that has to be done and increase performance.&lt;/p&gt;
&lt;h2 id=&quot;summary&quot;&gt;Summary&lt;/h2&gt;
&lt;p&gt;These are the main variants of combining lists in python. Use this table to guide you in the future.&lt;/p&gt;
&lt;p&gt;Also, if you are looking for a nice way to standardize the processes around your python projects – running tests, installing dependencies, and linting code – take a look at Earthly for &lt;a href=&quot;https://earthly.dev/&quot;&gt;Repeatable Builds&lt;/a&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&quot;header&quot;&gt;
&lt;th&gt;Condition&lt;/th&gt;
&lt;th&gt;Solution&lt;/th&gt;
&lt;th style=&quot;text-align: center;&quot;&gt;Performance Optimization&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;2 lists&lt;/td&gt;
&lt;td&gt;&lt;code&gt;x + y&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;1 large list, 1 small list&lt;/td&gt;
&lt;td&gt;&lt;code&gt;x.extend(y)&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;Known number of N lists&lt;/td&gt;
&lt;td&gt;&lt;code&gt;x + y + z&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;Unknown number of N lists&lt;/td&gt;
&lt;td&gt;&lt;code&gt;list(chain.from_iterable(l))&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;odd&quot;&gt;
&lt;td&gt;List of Lists&lt;/td&gt;
&lt;td&gt;&lt;code&gt;list(chain.from_iterable(l))&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&quot;even&quot;&gt;
&lt;td&gt;1 large list, many small lists&lt;/td&gt;
&lt;td&gt;&lt;code&gt;for l1 in l: x.extend(...)&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align: center;&quot;&gt;Yes&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;section class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;I did all the performance testing using Python 3.9.5 on MacOS BigSur.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;If you don’t have a performance bottleneck, clarity trumps performance, and you should ignore the performance suggestions.&lt;/p&gt;
&lt;/div&gt;
&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Tutorials" /><summary type="html">Concatenate Two Lists in Python Problem: You have two lists and you’d like to join them into a new list. Solution: Python 3.8.2 &amp;gt;&amp;gt;&amp;gt; one = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] &amp;gt;&amp;gt;&amp;gt; two = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] &amp;gt;&amp;gt;&amp;gt; one + two [&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, &amp;#39;four&amp;#39;, &amp;#39;five&amp;#39;] 📢 TLDR: Use + In almost all simple situations, using list1 + list2 is the way you want to concatenate lists. The edge cases below are better in some situations, but + is generally the best choice. All options covered work in Python 2.3, Python 2.7, and all versions of Python 31. Combine Lists In Place In Python Problem: You have a huge list, and you want to add a smaller list on the end while minimizing memory usage. In this case, it may be best to append to the existing list, reusing it instead of recreating a new list. &amp;gt;&amp;gt;&amp;gt;longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000 [&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, &amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, ... ] &amp;gt;&amp;gt;&amp;gt;shortlist = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] &amp;gt;&amp;gt;&amp;gt; x.extend(y) &amp;gt;&amp;gt;&amp;gt; x [&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, &amp;#39;one&amp;#39;, ..., &amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] As with any optimization, you should verify that this reduces memory thrash in your specific case and stick to the simple idiomatic x + y otherwise. Let’s use the timeit module to check some performance numbers. # Performance Check &amp;gt;&amp;gt;&amp;gt; setup = &amp;quot;&amp;quot;&amp;quot;\ x = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;,&amp;quot;three&amp;quot;] * 1000 y = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;,&amp;quot;six&amp;quot;] &amp;quot;&amp;quot;&amp;quot; # x + y with large x &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;x + y&amp;#39;, setup=setup, number=1000000) 3.6260274310000113 # x.extend(y) with large x &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;x.extend(y)&amp;#39;, setup=setup, number=1000000) 0.06857255800002804 In this example, where x is 3000 elements, extend is around 50x faster. ❗ Concatenating Lists With Large Elements is Fine If the elements in your list are huge (million character strings), but the list size is less than a thousand elements, the previous solution x + y will work just fine. This is because Python stores references to the values in the list, not the values themselves. Thus, the element size makes no difference to the runtime complexity. &amp;gt;&amp;gt;&amp;gt; x = [&amp;quot;one&amp;quot; * 1000, &amp;quot;two&amp;quot; * 1000, &amp;quot;three&amp;quot; * 1000] &amp;gt;&amp;gt;&amp;gt; y = [&amp;quot;four&amp;quot; * 1000, &amp;quot;five&amp;quot; * 1000] &amp;gt;&amp;gt;&amp;gt; #This is fine &amp;gt;&amp;gt;&amp;gt; z = x + y &amp;gt;&amp;gt;&amp;gt; #Performance Testing (extend is slower for large elements) &amp;gt;&amp;gt;&amp;gt; setup = &amp;quot;&amp;quot;&amp;quot;\ x = [&amp;quot;one&amp;quot; * 1000, &amp;quot;two&amp;quot; * 1000, &amp;quot;three&amp;quot; * 1000] y = [&amp;quot;four&amp;quot; * 1000, &amp;quot;five&amp;quot; * 1000] &amp;quot;&amp;quot;&amp;quot; &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;x + y&amp;#39;, setup=setup, number=1000000) 0.05397573999994165 &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;x.extend(y)&amp;#39;, setup=setup, number=1000000) 0.06511967799997365 In this case, extend does not have an advantage. Avoid Chain From itertools For Two Lists It is possible to use chain from itertools to create an iterable of two lists. &amp;gt;&amp;gt;&amp;gt;longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000 [&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, &amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;,, .......... ] &amp;gt;&amp;gt;&amp;gt;shortlist = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] &amp;gt;&amp;gt;&amp;gt; from itertools import chain &amp;gt;&amp;gt;&amp;gt; z = list(chain(longlist, shortlist) [&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, &amp;#39;one&amp;#39;, , .........., &amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] We can check the performance of using chain: &amp;gt;&amp;gt;&amp;gt; setup = &amp;quot;&amp;quot;&amp;quot;\ from itertools import chain x = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;,&amp;quot;three&amp;quot;] * 1000 y = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;,&amp;quot;six&amp;quot;] &amp;quot;&amp;quot;&amp;quot; # x + y with large x # x.extend(y) with large x &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;x.extend(y)&amp;#39;, setup=setup, number=1000000) 0.06857255800002804 &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;list(chain(x, y))&amp;#39;, setup=setup, number=1000000) 16.810488051999982 Using chain with two lists is slower in all cases tested, and x + y is easier to understand. Combining N Lists in Python If you need to add three or even ten lists together and the lists are statically known, then + for concatenate works great. &amp;gt;&amp;gt;&amp;gt; one = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] &amp;gt;&amp;gt;&amp;gt; two = [&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;] &amp;gt;&amp;gt;&amp;gt; three = [] &amp;gt;&amp;gt;&amp;gt; z = one + two + three Flatten a List of Lists in Python However, if the number of lists is dynamic and unknown until runtime, chain from itertools becomes a great option. Chain takes a list of lists and flattens it into a single list. &amp;gt;&amp;gt;&amp;gt; l = [[&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] * 99 [[&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;], [&amp;#39;four&amp;#39;, &amp;#39;five&amp;#39;], [], ... &amp;gt;&amp;gt;&amp;gt; list(chain.from_iterable(l)) [&amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, &amp;#39;three&amp;#39;, &amp;#39;four&amp;#39;, &amp;#39;five&amp;#39;, &amp;#39;one&amp;#39;, &amp;#39;two&amp;#39;, ... ] chain can take anything iterable, making it an excellent choice for combining lists, dictionaries, and other iterable structures. &amp;gt;&amp;gt;&amp;gt; from itertools import chain &amp;gt;&amp;gt;&amp;gt; one = [1,2,3] &amp;gt;&amp;gt;&amp;gt; two = {1,2,3} &amp;gt;&amp;gt;&amp;gt; list(chain(one, two, one)) [1, 2, 3, 1, 2, 3, 1, 2, 3] Performance of Flattening a List of Lists Performance doesn’t always matter, but readability always does, and the chain method is a straightforward way to combine lists of lists. That said, let’s put readability aside for a moment and try to find the fastest way to flatten lists. One option is iterating ourselves: result = [] for nestedlist in l: result.extend(nestedlist) Let’s check its performance vs chain: &amp;gt;&amp;gt;&amp;gt; setup = &amp;quot;&amp;quot;&amp;quot;\ from itertools import chain l = [[&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] * 99 &amp;quot;&amp;quot;&amp;quot; &amp;gt;&amp;gt;&amp;gt; # Add Nested Lists using chain.from_iterable &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;list(chain.from_iterable(l))&amp;#39;, setup=setup, number=100000) 1.0384087909997106 &amp;gt;&amp;gt;&amp;gt; ### Add using our own iteration &amp;gt;&amp;gt;&amp;gt; run = &amp;quot;&amp;quot;&amp;quot;\ result = [] for nestedlist in l: result.extend(nestedlist) &amp;quot;&amp;quot;&amp;quot; &amp;gt;&amp;gt;&amp;gt; timeit.timeit(run, setup=setup, number=100000) 1.8619721710001613 This shows that chain.from_iterable is faster than extend. Flattening and Merging Lists With One Big List What about adding a list of lists to an existing and large list? We saw that using extend can be faster with two lists when one is significantly longer than the other so let’s test the performance of extend with N lists. First, we use our standard chain.from_iterable. &amp;gt;&amp;gt;&amp;gt; # Method 1 - chain.from_iterable &amp;gt;&amp;gt;&amp;gt; longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000 &amp;gt;&amp;gt;&amp;gt; nestedlist = [longlist, [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] &amp;gt;&amp;gt;&amp;gt; list(chain.from_iterable(nestedlist)) We then test its performance: &amp;gt;&amp;gt;&amp;gt; setup = &amp;quot;&amp;quot;&amp;quot;\ from itertools import chain longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000; combinedlist = [longlist, [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] &amp;quot;&amp;quot;&amp;quot; &amp;gt;&amp;gt;&amp;gt; timeit.timeit(&amp;#39;list(chain.from_iterable(combinedlist))&amp;#39;, setup=setup, number=100000) 1.8676087710009597 Next, let’s try concatenating by adding everything onto the long list: &amp;gt;&amp;gt;&amp;gt; # Method 2 - extend &amp;gt;&amp;gt;&amp;gt; longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000 &amp;gt;&amp;gt;&amp;gt; nestedlist = [[&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] &amp;gt;&amp;gt;&amp;gt; for item in nestedlist: &amp;gt;&amp;gt;&amp;gt; longlist.extent(item) Performance Test: &amp;gt;&amp;gt;&amp;gt; setup = &amp;quot;&amp;quot;&amp;quot;\ from itertools import chain longlist = [&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;] * 1000; nestedlist = [[&amp;quot;one&amp;quot;,&amp;quot;two&amp;quot;, &amp;quot;three&amp;quot;],[&amp;quot;four&amp;quot;,&amp;quot;five&amp;quot;],[]] &amp;quot;&amp;quot;&amp;quot; &amp;gt;&amp;gt;&amp;gt; run = &amp;quot;&amp;quot;&amp;quot;\ for item in nestedlist: longlist.extend(item) &amp;quot;&amp;quot;&amp;quot; &amp;gt;&amp;gt;&amp;gt; timeit.timeit(run, setup=setup, number=100000) 0.02403609199973289 There we go, extend is much faster when flattening lists or concatenating many lists with one long list. If you encounter this, using extend to add the smaller lists to the long list can decrease the work that has to be done and increase performance. Summary These are the main variants of combining lists in python. Use this table to guide you in the future. Also, if you are looking for a nice way to standardize the processes around your python projects – running tests, installing dependencies, and linting code – take a look at Earthly for Repeatable Builds. Condition Solution Performance Optimization2 2 lists x + y No 1 large list, 1 small list x.extend(y) Yes Known number of N lists x + y + z No Unknown number of N lists list(chain.from_iterable(l)) No List of Lists list(chain.from_iterable(l)) No 1 large list, many small lists for l1 in l: x.extend(...) Yes I did all the performance testing using Python 3.9.5 on MacOS BigSur.↩︎ If you don’t have a performance bottleneck, clarity trumps performance, and you should ignore the performance suggestions. ↩︎</summary></entry><entry><title type="html">SQL Errors and Video Cameras</title><link href="https://earthly.dev/blog/video-camera-on/" rel="alternate" type="text/html" title="SQL Errors and Video Cameras" /><published>2021-06-29T00:00:00-04:00</published><updated>2021-06-29T00:00:00-04:00</updated><id>https://earthly.dev/blog/video-camera-on</id><content type="html" xml:base="https://earthly.dev/blog/video-camera-on/">&lt;div class=&quot;narrow-code&quot;&gt;
&lt;p&gt;Some years ago, when I worked in a physical office, I was having trouble with a new report I was developing. The reasonably complex SQL that generated the report would sometimes be missing a single row that would reappear if I reran things.&lt;/p&gt;
&lt;p&gt;The SQL looked something like this:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb1&quot;&gt;&lt;pre class=&quot;sourceCode sql&quot;&gt;&lt;code class=&quot;sourceCode sql&quot;&gt;&lt;span id=&quot;cb1-1&quot;&gt;&lt;a href=&quot;#cb1-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- sort and insert first partition into repo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-2&quot;&gt;&lt;a href=&quot;#cb1-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;INTO&lt;/span&gt; Report&lt;/span&gt;
&lt;span id=&quot;cb1-3&quot;&gt;&lt;a href=&quot;#cb1-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; name &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; input1 &lt;/span&gt;
&lt;span id=&quot;cb1-4&quot;&gt;&lt;a href=&quot;#cb1-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;BY&lt;/span&gt; val;&lt;/span&gt;
&lt;span id=&quot;cb1-5&quot;&gt;&lt;a href=&quot;#cb1-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt; &lt;/span&gt;
&lt;span id=&quot;cb1-6&quot;&gt;&lt;a href=&quot;#cb1-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; Report;&lt;/span&gt;
&lt;span id=&quot;cb1-7&quot;&gt;&lt;a href=&quot;#cb1-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;one&lt;/span&gt;
&lt;span id=&quot;cb1-8&quot;&gt;&lt;a href=&quot;#cb1-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;two&lt;/span&gt;
&lt;span id=&quot;cb1-9&quot;&gt;&lt;a href=&quot;#cb1-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;three &lt;span class=&quot;co&quot;&gt;-- yep&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-10&quot;&gt;&lt;a href=&quot;#cb1-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-11&quot;&gt;&lt;a href=&quot;#cb1-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- sort and insert second partition into repo&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-12&quot;&gt;&lt;a href=&quot;#cb1-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;INTO&lt;/span&gt; Report&lt;/span&gt;
&lt;span id=&quot;cb1-13&quot;&gt;&lt;a href=&quot;#cb1-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; name &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; input2 &lt;/span&gt;
&lt;span id=&quot;cb1-14&quot;&gt;&lt;a href=&quot;#cb1-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;BY&lt;/span&gt; val;&lt;/span&gt;
&lt;span id=&quot;cb1-15&quot;&gt;&lt;a href=&quot;#cb1-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-16&quot;&gt;&lt;a href=&quot;#cb1-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; Report;&lt;/span&gt;
&lt;span id=&quot;cb1-17&quot;&gt;&lt;a href=&quot;#cb1-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;one&lt;/span&gt;
&lt;span id=&quot;cb1-18&quot;&gt;&lt;a href=&quot;#cb1-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;two&lt;/span&gt;
&lt;span id=&quot;cb1-19&quot;&gt;&lt;a href=&quot;#cb1-19&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;three&lt;/span&gt;
&lt;span id=&quot;cb1-20&quot;&gt;&lt;a href=&quot;#cb1-20&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;four &lt;/span&gt;
&lt;span id=&quot;cb1-21&quot;&gt;&lt;a href=&quot;#cb1-21&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;five &lt;/span&gt;
&lt;span id=&quot;cb1-22&quot;&gt;&lt;a href=&quot;#cb1-22&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;six &lt;span class=&quot;co&quot;&gt;-- yep&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-23&quot;&gt;&lt;a href=&quot;#cb1-23&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb1-24&quot;&gt;&lt;a href=&quot;#cb1-24&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; top &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; Report;&lt;/span&gt;
&lt;span id=&quot;cb1-25&quot;&gt;&lt;a href=&quot;#cb1-25&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;one&lt;/span&gt;
&lt;span id=&quot;cb1-26&quot;&gt;&lt;a href=&quot;#cb1-26&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;two&lt;/span&gt;
&lt;span id=&quot;cb1-27&quot;&gt;&lt;a href=&quot;#cb1-27&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;four &lt;span class=&quot;co&quot;&gt;-- wait, what?&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I was going to spend the morning tracking this down. That was my daily stand-up update. But when I gave it, I caught a look from my teammate Isabella (not her real name). The look helped me solve the problem. We’ll get to the solution in a moment, but I want to talk about that facial expression – I am always on the lookout for it now.&lt;/p&gt;
&lt;h2 id=&quot;the-wait-what-look&quot;&gt;The Wait-What? Look&lt;/h2&gt;
&lt;div class=&quot;align-right&quot;&gt;
&lt;p&gt;&lt;picture&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused1-500-a0a7ebe24.webp 500w&quot; type=&quot;image/webp&quot;&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused1-500-b12c046e3.png 500w&quot; type=&quot;image/png&quot;&gt;&lt;img width=&quot;260px&quot; src=&quot;/blog/generated/assets/images/video-camera-on/confused1-800-b12c046e3.png&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;figcaption&gt;
“I’ve traced it to a bug in the SMTP protocol”
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;I once saw someone go up to a post-office box and confidently empty their lunch garbage into it - like it was a food court garbage bin. I made the facial expression then - I could feel my lips pull to one side and my eyes narrow in confusion. Am I seeing this correctly?&lt;/p&gt;
&lt;p&gt;I’ve spotted this look in so many daily stand-ups since then. Usually, it’s very fleeting, but I try not to let it pass by unremarked because unpacking it can save so much time. It easy to thrash on a problem and forget some simple assumption you’ve made. This face is a sign you’ve overlooked something important.&lt;/p&gt;
&lt;p&gt;Are daily stand-ups valuable? Sometimes they are, and sometimes they aren’t&lt;a href=&quot;#fn1&quot; class=&quot;footnote-ref&quot; id=&quot;fnref1&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt;. If you’re blocked on something, then telling the team is essential, but you shouldn’t wait for the next stand-up to share that. There are also all kinds of social reasons why a stand-up is healthy. I work from my home office and have for many years, and a video stand-up is a great way to actually have some small talk, screen to screen, with my teammates. Some parts of a daily stand-up are just a status report, and I’m not sure that ‘what I did yesterday and what I’m doing today part’ is always valuable. But the actual off-topic parts of a stand-up – the part where I complain about how difficult it is to get a permit for building my deck, and where Alex explains about foraging for mushrooms – those parts help keep me sane and happy.&lt;/p&gt;
&lt;h2 id=&quot;thats-not-quite-right&quot;&gt;That’s Not Quite Right&lt;/h2&gt;
&lt;div class=&quot;align-left&quot;&gt;
&lt;p&gt;&lt;picture&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused2-500-1f53a66bd.webp 500w&quot; type=&quot;image/webp&quot;&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused2-500-4089110d6.png 500w&quot; type=&quot;image/png&quot;&gt;&lt;img width=&quot;260px&quot; src=&quot;/blog/generated/assets/images/video-camera-on/confused2-800-4089110d6.png&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;figcaption&gt;
“I’m inserting ‘foo’ but retrieving ‘disk is full’”
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;We are always simulating the world around us on some subconscious level. It helps us predict what is going to happen next. For example, my neighbor is out watering his grass right now – I can see him out my office window. If his hose wasn’t on, I’m not sure I would notice because I’m not paying that much attention. But if he casually jumped from the ground to the second-story roof of his house, it would become the center of my attention. It would trigger some that’s-not-quite-right effect, and I would unconsciously make that confused face.&lt;/p&gt;
&lt;p&gt;That is why a stand-up can be valuable, in person or screen to screen. You can give your update when you are stuck, and you can watch for that failed-simulation face. Then ask them what they are thinking. Chances are they know where you missed a step or where you have a false assumption. At the very least, you’ve violated their intuition about the problem, and unpacking that feeling is a good idea.&lt;/p&gt;
&lt;h2 id=&quot;non-verbal-communication-requires-cameras-on&quot;&gt;Non-Verbal Communication Requires Cameras On&lt;/h2&gt;
&lt;div class=&quot;align-right&quot;&gt;
&lt;p&gt;&lt;picture&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused3-500-957022048.webp 500w&quot; type=&quot;image/webp&quot;&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused3-500-7d0fb7a4e.png 500w&quot; type=&quot;image/png&quot;&gt;&lt;img width=&quot;260px&quot; src=&quot;/blog/generated/assets/images/video-camera-on/confused3-800-7d0fb7a4e.png&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;figcaption&gt;
“All users were created on a Thursday in 1970”
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;I’ve heard many times before that 70% of communication is non-verbal. This seems to oversell non-verbals or maybe I’m just not great at reading them. This whole confused-face signal could be replaced with chin-scratching emoji or a sign that said: “Wait, What?”. But, when I do get a non-verbal signal, it can save me hours and days of time. I don’t think you can easily replicate this signal with asynchronous communication. One reason is that these non-verbal cues often represent subtle feelings. Someone can hear your update and think to themselves, “That doesn’t sound right”, but they may not be comfortable enough or care enough to say it out loud. Or it’s just fleeting thought before they start their own update. You have to catch these expressions, and you can’t do it without seeing the person.&lt;/p&gt;
&lt;p&gt;This doesn’t mean that everyone should always be able to see everyone in every meeting. If you are joining a 50 person meeting with a single presenter and everyone has their camera off, then follow suit. If you are eating your lunch in a meeting, I don’t need to see or hear you chew. But if you are seeking help or giving help or pairing on an issue with me, then I want to see your face. The examples and facial expressions here are extreme but even just seeing that I’ve gone too fast and lost you, or that you’re starting to say something, can improve the fidelity of the conversation.&lt;/p&gt;
&lt;p&gt;People find zoom meetings fatiguing, and I get that. The world contains too many meetings. But I’m shocked when I talk to someone on a remote team that never uses video. If you’re not seeing your teammate’s face when you describe a problem, who knows what you are missing&lt;a href=&quot;#fn2&quot; class=&quot;footnote-ref&quot; id=&quot;fnref2&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;the-sql-solution&quot;&gt;The SQL Solution&lt;/h2&gt;
&lt;div class=&quot;align-left&quot;&gt;
&lt;p&gt;&lt;picture&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused4-500-55b7c9ac2.webp 500w&quot; type=&quot;image/webp&quot;&gt;&lt;source srcset=&quot;/blog/generated/assets/images/video-camera-on/confused4-500-4d79dd6c3.png 500w&quot; type=&quot;image/png&quot;&gt;&lt;img width=&quot;260px&quot; src=&quot;/blog/generated/assets/images/video-camera-on/confused4-800-4d79dd6c3.png&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;figcaption&gt;
“the max message size in the queue&lt;br/&gt; is now 2 gigabytes”
&lt;/figcaption&gt;
&lt;/div&gt;
&lt;p&gt;So about the SQL. I got &lt;code&gt;the look&lt;/code&gt; from Isabella because a select statement like I was describing should be deterministic. Isabella’s spidey-sense told her either I was wrong about results changing or I was misusing SQL. It turned out to be the latter.&lt;/p&gt;
&lt;p&gt;You see, I was inserting records sorted and selecting them out without an explicit order. Also, my simple recounting of the report’s logic (and my code snippet above) was missing a critical detail – one I had forgotten about&lt;a href=&quot;#fn3&quot; class=&quot;footnote-ref&quot; id=&quot;fnref3&quot; role=&quot;doc-noteref&quot;&gt;&lt;sup&gt;3&lt;/sup&gt;&lt;/a&gt;. Sometimes I had to delete duplicate keys from the report table. Guess what happens when you insert things in-order into a table with deleted rows? Its implementation-specific, but sometimes, the invisible spaces left by the deleted rows will be filled in by the inserted data, undoing the insertion order. My row wasn’t missing. My data just wasn’t sorted correctly. Once I added in an &lt;code&gt;order by&lt;/code&gt; everything worked.&lt;/p&gt;
&lt;/div&gt;
&lt;!-- markdownlint-disable MD046 --&gt;
&lt;section class=&quot;footnotes&quot; role=&quot;doc-endnotes&quot;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&quot;fn1&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;&lt;a href=&quot;http://localhost:4002/blog/thought-leaders/&quot;&gt;Like everything&lt;/a&gt;, they work well in some contexts and not in others. If they aren’t helpful, drop them and try something else.&lt;a href=&quot;#fnref1&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn2&quot; role=&quot;doc-endnote&quot;&gt;&lt;p&gt;I’ve run this idea by people I know who work remotely and never turn their camera on. Not everyone is convinced, and I find that genuinely confusing. Maybe they have a lot of useless meetings? Perhaps the local culture is against cameras? Or maybe they always know what they are doing, and I never do?&lt;a href=&quot;#fnref2&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&quot;fn3&quot; role=&quot;doc-endnote&quot;&gt;Here is a minimal reproduction in Postgres.
&lt;div class=&quot;narrow-code&quot;&gt;
&lt;p&gt;I have some tables with summary data in it:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb2&quot;&gt;&lt;pre class=&quot;sourceCode sql&quot;&gt;&lt;code class=&quot;sourceCode sql&quot;&gt;&lt;span id=&quot;cb2-1&quot;&gt;&lt;a href=&quot;#cb2-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- simplified tables&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-2&quot;&gt;&lt;a href=&quot;#cb2-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;TABLE&lt;/span&gt; Report (name &lt;span class=&quot;dt&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;13&lt;/span&gt;));&lt;/span&gt;
&lt;span id=&quot;cb2-3&quot;&gt;&lt;a href=&quot;#cb2-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;TABLE&lt;/span&gt; input1(name &lt;span class=&quot;dt&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;13&lt;/span&gt;), val bigint);&lt;/span&gt;
&lt;span id=&quot;cb2-4&quot;&gt;&lt;a href=&quot;#cb2-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;TABLE&lt;/span&gt; input2(name &lt;span class=&quot;dt&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;dv&quot;&gt;13&lt;/span&gt;), val bigint);&lt;/span&gt;
&lt;span id=&quot;cb2-5&quot;&gt;&lt;a href=&quot;#cb2-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-6&quot;&gt;&lt;a href=&quot;#cb2-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- which, per user, had summary data something like this&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-7&quot;&gt;&lt;a href=&quot;#cb2-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;INTO&lt;/span&gt; input1&lt;/span&gt;
&lt;span id=&quot;cb2-8&quot;&gt;&lt;a href=&quot;#cb2-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;VALUES&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-9&quot;&gt;&lt;a href=&quot;#cb2-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;one&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb2-10&quot;&gt;&lt;a href=&quot;#cb2-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;two&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;2&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb2-11&quot;&gt;&lt;a href=&quot;#cb2-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb2-12&quot;&gt;&lt;a href=&quot;#cb2-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;three&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;
&lt;span id=&quot;cb2-13&quot;&gt;&lt;a href=&quot;#cb2-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-14&quot;&gt;&lt;a href=&quot;#cb2-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;INTO&lt;/span&gt; input2&lt;/span&gt;
&lt;span id=&quot;cb2-15&quot;&gt;&lt;a href=&quot;#cb2-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;VALUES&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb2-16&quot;&gt;&lt;a href=&quot;#cb2-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;four&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;4&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb2-17&quot;&gt;&lt;a href=&quot;#cb2-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;five&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;5&lt;/span&gt;),&lt;/span&gt;
&lt;span id=&quot;cb2-18&quot;&gt;&lt;a href=&quot;#cb2-18&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;    (&lt;span class=&quot;st&quot;&gt;&amp;#39;six&amp;#39;&lt;/span&gt;, &lt;span class=&quot;dv&quot;&gt;6&lt;/span&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I sort it and put it in the report table then remove any duplicates:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb3&quot;&gt;&lt;pre class=&quot;sourceCode sql&quot;&gt;&lt;code class=&quot;sourceCode sql&quot;&gt;&lt;span id=&quot;cb3-1&quot;&gt;&lt;a href=&quot;#cb3-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- sort and insert first partition&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-2&quot;&gt;&lt;a href=&quot;#cb3-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;INTO&lt;/span&gt; Report&lt;/span&gt;
&lt;span id=&quot;cb3-3&quot;&gt;&lt;a href=&quot;#cb3-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; name &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; input1 &lt;/span&gt;
&lt;span id=&quot;cb3-4&quot;&gt;&lt;a href=&quot;#cb3-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;BY&lt;/span&gt; val;&lt;/span&gt;
&lt;span id=&quot;cb3-5&quot;&gt;&lt;a href=&quot;#cb3-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-6&quot;&gt;&lt;a href=&quot;#cb3-6&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- delete duplicate records &lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-7&quot;&gt;&lt;a href=&quot;#cb3-7&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; Report &lt;span class=&quot;kw&quot;&gt;where&lt;/span&gt; name &lt;span class=&quot;kw&quot;&gt;in&lt;/span&gt; ( &lt;/span&gt;
&lt;span id=&quot;cb3-8&quot;&gt;&lt;a href=&quot;#cb3-8&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;select&lt;/span&gt; name&lt;/span&gt;
&lt;span id=&quot;cb3-9&quot;&gt;&lt;a href=&quot;#cb3-9&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;from&lt;/span&gt; Report &lt;/span&gt;
&lt;span id=&quot;cb3-10&quot;&gt;&lt;a href=&quot;#cb3-10&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;by&lt;/span&gt; name &lt;/span&gt;
&lt;span id=&quot;cb3-11&quot;&gt;&lt;a href=&quot;#cb3-11&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;having&lt;/span&gt; &lt;span class=&quot;fu&quot;&gt;count&lt;/span&gt;(&lt;span class=&quot;op&quot;&gt;*&lt;/span&gt;) &lt;span class=&quot;op&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-12&quot;&gt;&lt;a href=&quot;#cb3-12&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;);&lt;/span&gt;
&lt;span id=&quot;cb3-13&quot;&gt;&lt;a href=&quot;#cb3-13&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-14&quot;&gt;&lt;a href=&quot;#cb3-14&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- sort and insert second partition&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb3-15&quot;&gt;&lt;a href=&quot;#cb3-15&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;INTO&lt;/span&gt; Report&lt;/span&gt;
&lt;span id=&quot;cb3-16&quot;&gt;&lt;a href=&quot;#cb3-16&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; name &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; input2 &lt;/span&gt;
&lt;span id=&quot;cb3-17&quot;&gt;&lt;a href=&quot;#cb3-17&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;BY&lt;/span&gt; val;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then I return the N results as part of the report:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb4&quot;&gt;&lt;pre class=&quot;sourceCode sql&quot;&gt;&lt;code class=&quot;sourceCode sql&quot;&gt;&lt;span id=&quot;cb4-1&quot;&gt;&lt;a href=&quot;#cb4-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;co&quot;&gt;-- show Top N report&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb4-2&quot;&gt;&lt;a href=&quot;#cb4-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; Report &lt;span class=&quot;kw&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;
&lt;span id=&quot;cb4-3&quot;&gt;&lt;a href=&quot;#cb4-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;one&lt;/span&gt;
&lt;span id=&quot;cb4-4&quot;&gt;&lt;a href=&quot;#cb4-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;two&lt;/span&gt;
&lt;span id=&quot;cb4-5&quot;&gt;&lt;a href=&quot;#cb4-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;four&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The actual problem was more complex, involved abusing row_number() and was in SQL SERVER, but the solution is still the same: use an &lt;code&gt;order by&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;sourceCode&quot; id=&quot;cb5&quot;&gt;&lt;pre class=&quot;sourceCode sql&quot;&gt;&lt;code class=&quot;sourceCode sql&quot;&gt;&lt;span id=&quot;cb5-1&quot;&gt;&lt;a href=&quot;#cb5-1&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;co&quot;&gt;-- show Top N report&lt;/span&gt;&lt;/span&gt;
&lt;span id=&quot;cb5-2&quot;&gt;&lt;a href=&quot;#cb5-2&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;kw&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;op&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;FROM&lt;/span&gt; Report &lt;span class=&quot;kw&quot;&gt;Order&lt;/span&gt; &lt;span class=&quot;kw&quot;&gt;By&lt;/span&gt; name &lt;span class=&quot;kw&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;dv&quot;&gt;3&lt;/span&gt;;&lt;/span&gt;
&lt;span id=&quot;cb5-3&quot;&gt;&lt;a href=&quot;#cb5-3&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  one&lt;/span&gt;
&lt;span id=&quot;cb5-4&quot;&gt;&lt;a href=&quot;#cb5-4&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  two&lt;/span&gt;
&lt;span id=&quot;cb5-5&quot;&gt;&lt;a href=&quot;#cb5-5&quot; aria-hidden=&quot;true&quot; tabindex=&quot;-1&quot;&gt;&lt;/a&gt;  three&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
SQL makes no guarantees about tables being in insertion order. &lt;!-- markdownlint-enable MD046 --&gt;
&lt;/div&gt;
&lt;a href=&quot;#fnref3&quot; class=&quot;footnote-back&quot; role=&quot;doc-backlink&quot;&gt;↩︎&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</content><author><name>Adam Gordon Bell</name></author><category term="Articles" /><summary type="html">Some years ago, when I worked in a physical office, I was having trouble with a new report I was developing. The reasonably complex SQL that generated the report would sometimes be missing a single row that would reappear if I reran things. The SQL looked something like this: -- sort and insert first partition into repo INSERT INTO Report SELECT name FROM input1 ORDER BY val; SELECT * FROM Report; one two three -- yep -- sort and insert second partition into repo INSERT INTO Report SELECT name FROM input2 ORDER BY val; SELECT * FROM Report; one two three four five six -- yep SELECT top 3 * FROM Report; one two four -- wait, what? I was going to spend the morning tracking this down. That was my daily stand-up update. But when I gave it, I caught a look from my teammate Isabella (not her real name). The look helped me solve the problem. We’ll get to the solution in a moment, but I want to talk about that facial expression – I am always on the lookout for it now. The Wait-What? Look “I’ve traced it to a bug in the SMTP protocol” I once saw someone go up to a post-office box and confidently empty their lunch garbage into it - like it was a food court garbage bin. I made the facial expression then - I could feel my lips pull to one side and my eyes narrow in confusion. Am I seeing this correctly? I’ve spotted this look in so many daily stand-ups since then. Usually, it’s very fleeting, but I try not to let it pass by unremarked because unpacking it can save so much time. It easy to thrash on a problem and forget some simple assumption you’ve made. This face is a sign you’ve overlooked something important. Are daily stand-ups valuable? Sometimes they are, and sometimes they aren’t1. If you’re blocked on something, then telling the team is essential, but you shouldn’t wait for the next stand-up to share that. There are also all kinds of social reasons why a stand-up is healthy. I work from my home office and have for many years, and a video stand-up is a great way to actually have some small talk, screen to screen, with my teammates. Some parts of a daily stand-up are just a status report, and I’m not sure that ‘what I did yesterday and what I’m doing today part’ is always valuable. But the actual off-topic parts of a stand-up – the part where I complain about how difficult it is to get a permit for building my deck, and where Alex explains about foraging for mushrooms – those parts help keep me sane and happy. That’s Not Quite Right “I’m inserting ‘foo’ but retrieving ‘disk is full’” We are always simulating the world around us on some subconscious level. It helps us predict what is going to happen next. For example, my neighbor is out watering his grass right now – I can see him out my office window. If his hose wasn’t on, I’m not sure I would notice because I’m not paying that much attention. But if he casually jumped from the ground to the second-story roof of his house, it would become the center of my attention. It would trigger some that’s-not-quite-right effect, and I would unconsciously make that confused face. That is why a stand-up can be valuable, in person or screen to screen. You can give your update when you are stuck, and you can watch for that failed-simulation face. Then ask them what they are thinking. Chances are they know where you missed a step or where you have a false assumption. At the very least, you’ve violated their intuition about the problem, and unpacking that feeling is a good idea. Non-Verbal Communication Requires Cameras On “All users were created on a Thursday in 1970” I’ve heard many times before that 70% of communication is non-verbal. This seems to oversell non-verbals or maybe I’m just not great at reading them. This whole confused-face signal could be replaced with chin-scratching emoji or a sign that said: “Wait, What?”. But, when I do get a non-verbal signal, it can save me hours and days of time. I don’t think you can easily replicate this signal with asynchronous communication. One reason is that these non-verbal cues often represent subtle feelings. Someone can hear your update and think to themselves, “That doesn’t sound right”, but they may not be comfortable enough or care enough to say it out loud. Or it’s just fleeting thought before they start their own update. You have to catch these expressions, and you can’t do it without seeing the person. This doesn’t mean that everyone should always be able to see everyone in every meeting. If you are joining a 50 person meeting with a single presenter and everyone has their camera off, then follow suit. If you are eating your lunch in a meeting, I don’t need to see or hear you chew. But if you are seeking help or giving help or pairing on an issue with me, then I want to see your face. The examples and facial expressions here are extreme but even just seeing that I’ve gone too fast and lost you, or that you’re starting to say something, can improve the fidelity of the conversation. People find zoom meetings fatiguing, and I get that. The world contains too many meetings. But I’m shocked when I talk to someone on a remote team that never uses video. If you’re not seeing your teammate’s face when you describe a problem, who knows what you are missing2. The SQL Solution “the max message size in the queue is now 2 gigabytes” So about the SQL. I got the look from Isabella because a select statement like I was describing should be deterministic. Isabella’s spidey-sense told her either I was wrong about results changing or I was misusing SQL. It turned out to be the latter. You see, I was inserting records sorted and selecting them out without an explicit order. Also, my simple recounting of the report’s logic (and my code snippet above) was missing a critical detail – one I had forgotten about3. Sometimes I had to delete duplicate keys from the report table. Guess what happens when you insert things in-order into a table with deleted rows? Its implementation-specific, but sometimes, the invisible spaces left by the deleted rows will be filled in by the inserted data, undoing the insertion order. My row wasn’t missing. My data just wasn’t sorted correctly. Once I added in an order by everything worked. Like everything, they work well in some contexts and not in others. If they aren’t helpful, drop them and try something else.↩︎ I’ve run this idea by people I know who work remotely and never turn their camera on. Not everyone is convinced, and I find that genuinely confusing. Maybe they have a lot of useless meetings? Perhaps the local culture is against cameras? Or maybe they always know what they are doing, and I never do?↩︎ Here is a minimal reproduction in Postgres. I have some tables with summary data in it: -- simplified tables CREATE TABLE Report (name varchar(13)); CREATE TABLE input1(name varchar(13), val bigint); CREATE TABLE input2(name varchar(13), val bigint); -- which, per user, had summary data something like this INSERT INTO input1 VALUES (&amp;#39;one&amp;#39;, 1), (&amp;#39;two&amp;#39;, 2), (&amp;#39;three&amp;#39;, 3), (&amp;#39;three&amp;#39;, 3); INSERT INTO input2 VALUES (&amp;#39;four&amp;#39;, 4), (&amp;#39;five&amp;#39;, 5), (&amp;#39;six&amp;#39;, 6); I sort it and put it in the report table then remove any duplicates: -- sort and insert first partition INSERT INTO Report SELECT name FROM input1 ORDER BY val; -- delete duplicate records DELETE FROM Report where name in ( select name from Report group by name having count(*) &amp;gt; 1 ); -- sort and insert second partition INSERT INTO Report SELECT name FROM input2 ORDER BY val; Then I return the N results as part of the report: -- show Top N report SELECT * FROM Report limit 3; one two four The actual problem was more complex, involved abusing row_number() and was in SQL SERVER, but the solution is still the same: use an order by: -- show Top N report SELECT * FROM Report Order By name limit 3; one two three SQL makes no guarantees about tables being in insertion order. ↩︎</summary></entry></feed>